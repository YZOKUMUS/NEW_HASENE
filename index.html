<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Hasene Arapça Oyunu</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#667eea">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Hasene Arapça">
    <meta name="msapplication-TileColor" content="#667eea">
    <meta name="msapplication-config" content="browserconfig.xml">
    
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" href="icon-192-v4-RED-MUSHAF.png">
    <link rel="apple-touch-icon" sizes="192x192" href="icon-192-v4-RED-MUSHAF.png">
    <link rel="apple-touch-icon" sizes="512x512" href="icon-512-v4-RED-MUSHAF.png">
    
    <!-- Osmanlı Hafs Hattı Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Amiri+Quran&family=Scheherazade+New:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        /* ============ TEMEL AYARLAR ============ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: Arial, sans-serif;
            background: #667eea;
            min-height: 100vh;
            padding: 10px;
        }

        /* ============ KONTEYNER ============ */
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        /* ============ BAŞLIK ============ */
        .header {
            text-align: center;
            margin-bottom: 20px;
            color: #2D5F3F;
            position: relative;
        }

        .header h1 {
            font-size: 1.5em;
            margin-bottom: 5px;
        }

        .settings-btn {
            position: absolute;
            right: 0;
            top: 0;
            background: #F4C430;
            border: none;
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
        }

        /* ============ ANA MENÜ ============ */
        .main-menu {
            display: flex;
            flex-direction: column;
            gap: 15px;
            width: 100%;
        }

        .menu-item {
            background: linear-gradient(135deg, #2D5F3F 0%, #1E4D7B 100%);
            color: white;
            border: none;
            padding: 20px;
            border-radius: 15px;
            cursor: pointer;
            text-align: center;
            transition: transform 0.3s, box-shadow 0.3s;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            width: 100%;
            margin-bottom: 15px;
        }

        .menu-item:last-child {
            margin-bottom: 0;
        }

        .menu-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        .menu-item:active {
            transform: translateY(0);
        }

        .menu-icon {
            font-size: 3em;
            margin-bottom: 10px;
        }

        .menu-title {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .menu-desc {
            font-size: 0.9em;
            opacity: 0.9;
        }

        /* ============ ÜST BUTONLAR ============ */
        .top-btn {
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .top-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3) !important;
        }

        .top-btn:active {
            transform: translateY(0);
        }

        /* ============ GERİ BUTONU ============ */
        .back-btn {
            background: #666;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 5px;
            cursor: pointer;
            margin-bottom: 10px;
            font-size: 0.8em;
            font-weight: 500;
        }

        .back-btn:active {
            background: #555;
        }

        /* ============ MOD SEÇİCİ ============ */
        .mode-selector {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
        }

        .mode-selector h3 {
            color: #2D5F3F;
            margin: 15px 0 10px 0;
            font-size: 1.1em;
        }

        .mode-btn, .diff-btn {
            display: block;
            width: 100%;
            background: white;
            border: 3px solid #ddd;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 10px;
            cursor: pointer;
            text-align: left;
            transition: all 0.3s ease;
            position: relative;
        }

        .mode-btn:hover, .diff-btn:hover {
            border-color: #2D5F3F;
            transform: translateX(5px);
        }

        .mode-btn.active {
            background: linear-gradient(135deg, #2D5F3F 0%, #1E4D7B 100%);
            color: white;
            border-color: #2D5F3F;
            transform: scale(1.02);
            box-shadow: 0 4px 15px rgba(45, 95, 63, 0.3);
        }
        
        .diff-btn.active {
            /* Renk JavaScript'te ayarlanıyor */
            transform: scale(1.02);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .mode-btn.active::after, .diff-btn.active::after {
            content: '✓';
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.5em;
            font-weight: bold;
        }

        .mode-btn strong, .diff-btn strong {
            display: block;
            font-size: 1.1em;
            margin-bottom: 5px;
        }

        .mode-btn small, .diff-btn small {
            display: block;
            opacity: 0.8;
        }

        .start-btn {
            width: 100%;
            background: #F4C430;
            border: none;
            padding: 15px;
            border-radius: 10px;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            margin-top: 20px;
        }

        .start-btn:active {
            background: #d4a820;
        }

        /* ============ OYUN BİLGİSİ ============ */
        .game-info {
            display: flex;
            justify-content: space-around;
            margin-bottom: 15px;
            padding: 10px;
            background: #f5f5f5;
            border-radius: 10px;
            font-size: 0.9em;
            color: #333;
        }

        .game-info div {
            font-weight: bold;
        }

        /* ============ İSTATİSTİKLER ============ */
        .stats {
            display: flex;
            justify-content: space-between;
            gap: 6px;
            margin-bottom: 10px;
        }

        .stat {
            flex: 1;
            background: #2D5F3F;
            color: white;
            padding: 6px 8px;
            border-radius: 6px;
            text-align: center;
        }

        .stat-label {
            font-size: 0.65em;
            opacity: 0.9;
            font-weight: 500;
        }

        .stat-value {
            font-size: 1.1em;
            font-weight: bold;
            margin-top: 3px;
        }

        /* ============ İLERLEME ÇUBUĞU ============ */
        .progress {
            height: 8px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .progress-bar {
            height: 100%;
            background: #F4C430;
            width: 0%;
            transition: width 0.3s;
        }

        /* ============ OYUN ALANI ============ */
        .game-box {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
        }

        .sure-info {
            text-align: center;
            color: #666;
            font-size: 0.9em;
            margin-bottom: 15px;
        }

        .arabic {
            font-size: 16px;   /* Arapça metin için büyük font boyutu */
            text-align: center;
            color: #2D5F3F;
            font-weight: bold;
            margin: 20px 0;
            direction: rtl;
            /* Osmanlı Hafs Hattı - Kur'an yazı tipi */
            font-family: 'Amiri Quran', 'Scheherazade New', 'Traditional Arabic', 'Arabic Typesetting', serif;
            font-weight: 400;
            line-height: 1.8;
            letter-spacing: 0;
        }

        /* ============ SES BUTONU ============ */
        .audio-btn {
            display: block;
            width: 100%;
            background: #F4C430;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.85em;
            cursor: pointer;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .audio-btn:active {
            background: #d4a820;
        }

        /* ============ İPUCU BUTONU ============ */
        .hint-btn {
            display: block;
            width: 100%;
            background: #64B5F6;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.85em;
            cursor: pointer;
            margin-bottom: 12px;
            font-weight: 500;
        }

        .hint-btn:active {
            background: #42A5F5;
        }

        .hint-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        /* ============ SEÇENEKLER ============ */
        .options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .option {   /* Tek bir seçenek butonu */
            background: white;
            border: 2px solid #ddd;
            padding: 15px;
            border-radius: 10px;
            font-size: 16px;       
            cursor: pointer;
            text-align: left;
        }

        .option:active {
            background: #f0f0f0;
        }

        .option.correct {
            background: #4CAF50;
            color: white;
            border-color: #4CAF50;
        }

        .option.wrong {
            background: #f44336;
            color: white;
            border-color: #f44336;
        }

        .option:disabled {
            cursor: default;
        }

        /* ============ GERİ BİLDİRİM ============ */
        .feedback {
            text-align: center;
            font-size: 1.1em;
            font-weight: bold;
            min-height: 30px;
            margin: 15px 0;
        }

        .feedback.correct {
            color: #4CAF50;
        }

        .feedback.wrong {
            color: #f44336;
        }

        /* ============ SONRAKİ BUTON ============ */
        .next-btn {
            display: none;
            width: 100%;
            background: #2D5F3F;
            color: white;
            border: none;
            padding: 10px 12px;
            border-radius: 6px;
            font-size: 0.9em;
            cursor: pointer;
            font-weight: 500;
        }

        .next-btn:active {
            background: #1d3f2f;
        }

        /* ============ AYET & DUA MODLARI ============ */
        .ayet-card, .dua-card {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 10px;
        }

        .translation {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            color: #333;
            font-size: 1.1em;
            line-height: 1.6;
            text-align: center;
        }

        .pronunciation {
            background: #E3F2FD;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            color: #1565C0;
            font-size: 1em;
            font-style: italic;
            text-align: center;
        }

        .dua-title {
            text-align: center;
            color: #2D5F3F;
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .navigation-btns {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .nav-btn {
            flex: 1;
            background: #2D5F3F;
            color: white;
            border: none;
            padding: 8px 10px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.8em;
            font-weight: 500;
        }

        .nav-btn:active {
            background: #1d3f2f;
        }

        .nav-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        /* ============ DUA KATEGORİLERİ ============ */
        .dua-categories {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .category-btn {
            background: white;
            border: 2px solid #2D5F3F;
            color: #2D5F3F;
            padding: 15px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: bold;
            transition: all 0.3s;
        }

        .category-btn:active {
            background: #2D5F3F;
            color: white;
        }

        /* ============ HADİS KARTI ============ */
        .hadis-card {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 10px;
        }

        .hadis-category {
            background: #2D5F3F;
            color: white;
            padding: 8px 15px;
            border-radius: 8px;
            font-size: 0.9em;
            display: inline-block;
            margin-bottom: 10px;
        }

        .hadis-title {
            color: #2D5F3F;
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .hadis-header {
            background: #E3F2FD;
            padding: 10px;
            border-radius: 8px;
            color: #1565C0;
            font-size: 0.95em;
            margin-bottom: 15px;
        }

        .hadis-text {
            background: white;
            padding: 15px;
            border-radius: 10px;
            line-height: 1.8;
            color: #333;
            margin-bottom: 15px;
            text-align: justify;
        }

        .hadis-ref {
            background: #FFF3E0;
            padding: 10px;
            border-radius: 8px;
            font-size: 0.85em;
            color: #E65100;
            margin-bottom: 15px;
        }

        /* ============ MODAL ============ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 9999;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            width: 80%;
            max-width: 300px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            position: relative;
        }

        .modal h2 {
            color: #2D5F3F;
            font-size: 2em;
            margin-bottom: 15px;
        }

        .modal p {
            font-size: 1.2em;
            margin-bottom: 20px;
        }

        .modal-btn {
            width: 100%;
            background: #F4C430;
            border: none;
            padding: 8px;
            border-radius: 6px;
            font-size: 0.85em;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Oyun İstatistikleri Barı -->
        <div class="header" style="background: white; border: 2px solid #e0e0e0; border-radius: 15px; padding: 12px 15px; display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 10px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
            <!-- Puan -->
            <div style="display: flex; flex-direction: column; align-items: center; gap: 3px;">
                <div style="background: #FF9800; color: white; width: 28px; height: 28px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 12px;" id="gamePoints">0</div>
                <span style="font-size: 11px; color: #666;">Puan</span>
            </div>
            
            <!-- Yıldız -->
            <div style="display: flex; flex-direction: column; align-items: center; gap: 3px;">
                <div style="display: flex; align-items: center; gap: 3px;">
                    <span style="font-size: 16px; color: #FFD700;">⭐</span>
                    <span style="font-weight: bold; font-size: 14px; color: #333;" id="starPoints">0</span>
                </div>
                <span style="font-size: 11px; color: #666;">Yıldız</span>
            </div>

            <!-- Rozet -->
            <div style="display: flex; flex-direction: column; align-items: center; gap: 3px;">
                <div style="display: flex; align-items: center; gap: 3px;">
                    <span style="font-size: 16px;" id="topBadgeIcon">🥉</span>
                    <span style="font-weight: bold; font-size: 14px; color: #333;" id="topBadgeCount">0</span>
                </div>
                <span style="font-size: 11px; color: #666;">Rozet</span>
            </div>
            
            <!-- Seviye -->
            <div style="display: flex; flex-direction: column; align-items: center; gap: 2px;">
                <div style="display: flex; align-items: center; gap: 3px;">
                    <span style="font-size: 11px; color: #666;">Lv</span>
                    <span style="background: #9C27B0; color: white; padding: 2px 6px; border-radius: 8px; font-weight: bold; font-size: 11px;" id="playerLevel">1</span>
                </div>
                <!-- Seviye İlerleme Çubuğu -->
                <div style="width: 60px; height: 3px; background: #e0e0e0; border-radius: 2px; overflow: hidden;">
                    <div style="height: 100%; background: #9C27B0; transition: width 0.3s;" id="levelProgress"></div>
                </div>
            </div>
        </div>

        <!-- Ana Menü -->
        <div class="main-menu" id="mainMenu">
            <!-- Üst Butonlar -->
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 15px;">
                <button class="top-btn" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 12px; padding: 12px; font-size: 0.9em; font-weight: 600; display: flex; align-items: center; justify-content: center; gap: 8px; box-shadow: 0 3px 10px rgba(102,126,234,0.3); cursor: pointer;" onclick="showDailyTasksModal()">
                    <span style="font-size: 1.2em;">📋</span>
                    Günlük Görevler
                </button>
                
                <button class="top-btn" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; border: none; border-radius: 12px; padding: 12px; font-size: 0.9em; font-weight: 600; display: flex; align-items: center; justify-content: center; gap: 8px; box-shadow: 0 3px 10px rgba(245,87,108,0.3); cursor: pointer;" onclick="showBadgesModal()">
                    <span style="font-size: 1.2em;">🏆</span>
                    Başarılar
                </button>
                
                <button class="top-btn" style="background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); color: #333; border: none; border-radius: 12px; padding: 12px; font-size: 0.9em; font-weight: 600; display: flex; align-items: center; justify-content: center; gap: 8px; box-shadow: 0 3px 10px rgba(168,237,234,0.4); cursor: pointer;" onclick="showStatsModal()">
                    <span style="font-size: 1.2em;">📊</span>
                    İstatistikler
                </button>
                
                <button class="top-btn" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; border: none; border-radius: 12px; padding: 12px; font-size: 0.9em; font-weight: 600; display: flex; align-items: center; justify-content: center; gap: 8px; box-shadow: 0 3px 10px rgba(79,172,254,0.3); cursor: pointer;" onclick="showCalendarModal()"
                    <span style="font-size: 1.2em;">📅</span>
                    Takvim
                </button>
            </div>
            
            <!-- Zorluk Butonları -->
            <div style="display: flex; gap: 8px; margin-bottom: 20px; flex-wrap: nowrap; justify-content: center;">
                <button class="diff-btn" id="mainDiffKolay" style="flex: 1; min-width: 90px; max-width: 120px; margin: 0; padding: 10px; font-size: 0.85em; background: white; color: #4CAF50; border: 2px solid #4CAF50;">
                    <strong>🌱 Kolay</strong>
                </button>
                <button class="diff-btn active" id="mainDiffOrta" style="flex: 1; min-width: 90px; max-width: 120px; margin: 0; padding: 10px; font-size: 0.85em; background: #FF9800; color: white; border: 2px solid #FF9800;">
                    <strong>⚖️ Orta</strong>
                </button>
                <button class="diff-btn" id="mainDiffZor" style="flex: 1; min-width: 90px; max-width: 120px; margin: 0; padding: 10px; font-size: 0.85em; background: white; color: #f44336; border: 2px solid #f44336;">
                    <strong>🔥 Zor</strong>
                </button>
            </div>

            <button class="menu-item" id="kelimeCevirBtn" style="margin-bottom: 10px; padding: 12px; background: linear-gradient(135deg, #ffd700 0%, #ffb347 100%); color: #8b4513; box-shadow: 0 4px 15px rgba(255,215,0,0.4); border: 2px solid #daa520;">
                <div class="menu-icon" style="font-size: 1.8em; margin-bottom: 3px;">📚</div>
                <div class="menu-title" style="font-size: 1em; font-weight: bold;">Kelime Çevir</div>
                <div class="menu-desc" style="font-size: 0.8em;">Arapça kelimeyi Türkçe'ye çevir</div>
            </button>

            <button class="menu-item" id="dinleBulBtn" style="margin-bottom: 10px; padding: 12px; background: linear-gradient(135deg, #74c0fc 0%, #339af0 100%); color: white; box-shadow: 0 4px 15px rgba(51,154,240,0.3);">
                <div class="menu-icon" style="font-size: 1.8em; margin-bottom: 3px;">🎧</div>
                <div class="menu-title" style="font-size: 1em;">Dinle ve Bul</div>
                <div class="menu-desc" style="font-size: 0.8em;">Kelimeyi dinle, doğru kelimeyi bul</div>
            </button>

            <button class="menu-item" id="boslukDoldurBtn" style="margin-bottom: 10px; padding: 12px; background: linear-gradient(135deg, #9775fa 0%, #7048e8 100%); color: white; box-shadow: 0 4px 15px rgba(112,72,232,0.3);">
                <div class="menu-icon" style="font-size: 1.8em; margin-bottom: 3px;">✍️</div>
                <div class="menu-title" style="font-size: 1em;">Boşluk Doldur</div>
                <div class="menu-desc" style="font-size: 0.8em;">Ayetteki eksik kelimeyi tamamla</div>
            </button>

            <button class="menu-item" id="duaEtBtn" style="margin-bottom: 10px; padding: 12px; background: linear-gradient(135deg, #51cf66 0%, #37b24d 100%); color: white; box-shadow: 0 4px 15px rgba(55,178,77,0.3);">
                <div class="menu-icon" style="font-size: 1.8em; margin-bottom: 3px;">🤲</div>
                <div class="menu-title" style="font-size: 1em;">Dua Et ve Dinle</div>
                <div class="menu-desc" style="font-size: 0.8em;">Kur'an'dan duaları öğren</div>
            </button>

            <button class="menu-item" id="ayetOkuBtn" style="margin-bottom: 10px; padding: 12px; background: linear-gradient(135deg, #4dabf7 0%, #1c7ed6 100%); color: white; box-shadow: 0 4px 15px rgba(28,126,214,0.3);">
                <div class="menu-icon" style="font-size: 1.8em; margin-bottom: 3px;">📖</div>
                <div class="menu-title" style="font-size: 1em;">Ayet Oku ve Dinle</div>
                <div class="menu-desc" style="font-size: 0.8em;">Ayetleri dinle ve oku</div>
            </button>

            <button class="menu-item" id="hadisOkuBtn" style="margin-bottom: 0; padding: 12px; background: linear-gradient(135deg, #ff8787 0%, #fa5252 100%); color: white; box-shadow: 0 4px 15px rgba(250,82,82,0.3);">
                <div class="menu-icon" style="font-size: 1.8em; margin-bottom: 3px;">📜</div>
                <div class="menu-title" style="font-size: 1em;">Hadis Oku</div>
                <div class="menu-desc" style="font-size: 0.8em;">Hadis-i Şerifleri oku</div>
            </button>
        </div>

        <!-- Kelime Çevir Alt Mod Seçimi -->
        <div class="mode-selector" id="modeSelector" style="display: none;">
            <button class="back-btn" id="backToMenuBtn">← Geri</button>
            
            <div id="modeButtons"></div>
            
            <button class="start-btn" id="startBtn">Oyunu Başlat</button>
        </div>

        <!-- Ayet Okuma Modu -->
        <div class="ayet-mode" id="ayetMode" style="display: none;">
            <button class="back-btn" id="backFromAyetBtn">← Geri</button>
            <div class="ayet-card">
                <div class="sure-info" id="ayetSureInfo">Yükleniyor...</div>
                <div class="arabic" id="ayetArabic">بِسْمِ ٱللَّهِ ٱلرَّحْمَٰنِ ٱلرَّحِيمِ</div>
                <div class="translation" id="ayetTranslation">Yükleniyor...</div>
                <button class="audio-btn" id="ayetAudioBtn">🔊 Ayeti Dinle</button>
                <div class="navigation-btns">
                    <button class="nav-btn" id="prevAyetBtn">← Önceki</button>
                    <button class="nav-btn" id="nextAyetBtn">Sonraki →</button>
                </div>
            </div>
        </div>

        <!-- Dua Modu -->
        <div class="dua-mode" id="duaMode" style="display: none;">
            <button class="back-btn" id="backFromDuaBtn">← Geri</button>
            <div class="dua-card">
                <div class="sure-info" id="duaSureInfo">Yükleniyor...</div>
                <div class="arabic" id="duaArabic">Arapça Metin</div>
                <div class="translation" id="duaTranslation">Anlamı</div>
                <button class="audio-btn" id="duaAudioBtn">🔊 Duayı Dinle</button>
                <div class="navigation-btns">
                    <button class="nav-btn" id="prevDuaBtn">← Önceki</button>
                    <button class="nav-btn" id="nextDuaBtn">Sonraki →</button>
                </div>
            </div>
        </div>

        <!-- Hadis Oku Modu -->
        <div class="hadis-mode" id="hadisMode" style="display: none;">
            <button class="back-btn" id="backFromHadisBtn">← Geri</button>
            <div class="hadis-card">
                <div class="hadis-category" id="hadisCategory">Kategori</div>
                <div class="hadis-title" id="hadisTitle">Başlık</div>
                <div class="hadis-header" id="hadisHeader">Ravi</div>
                <div class="hadis-text" id="hadisText">Hadis Metni</div>
                <div class="hadis-ref" id="hadisRef">Referans</div>
                <div class="navigation-btns">
                    <button class="nav-btn" id="prevHadisBtn">← Önceki</button>
                    <button class="nav-btn" id="nextHadisBtn">Sonraki →</button>
                </div>
            </div>
        </div>

        <!-- Boşluk Doldur Modu -->
        <div class="bosluk-mode" id="boslukMode" style="display: none;">
            <button class="back-btn" id="backFromBoslukBtn">← Geri</button>
            
            <!-- İstatistikler -->
            <div class="stats">
                <div class="stat">
                    <div class="stat-label">Puan</div>
                    <div class="stat-value" id="boslukScore">0</div>
                </div>
                <div class="stat">
                    <div class="stat-label">Doğru</div>
                    <div class="stat-value" id="boslukCorrect">0</div>
                </div>
                <div class="stat">
                    <div class="stat-label">Yanlış</div>
                    <div class="stat-value" id="boslukWrong">0</div>
                </div>
            </div>

            <div class="game-box">
                <div class="sure-info" id="boslukSureInfo">Yükleniyor...</div>
                <div class="arabic" id="boslukAyetText">Ayet metni yükleniyor...</div>
                <button class="audio-btn" id="boslukAudioBtn">🔊 Ayeti Dinle</button>
                <div class="options" id="boslukOptions"></div>
                <div class="feedback" id="boslukFeedback"></div>
                <button class="next-btn" id="boslukNextBtn">Sonraki Soru →</button>
            </div>
        </div>

        <!-- Dinle ve Bul Modu -->
        <div class="dinle-mode" id="dinleMode" style="display: none;">
            <button class="back-btn" id="backFromDinleBtn">← Geri</button>
            
            <!-- İstatistikler -->
            <div class="stats">
                <div class="stat">
                    <div class="stat-label">Puan</div>
                    <div class="stat-value" id="dinleScore">0</div>
                </div>
                <div class="stat">
                    <div class="stat-label">Doğru</div>
                    <div class="stat-value" id="dinleCorrect">0</div>
                </div>
                <div class="stat">
                    <div class="stat-label">Yanlış</div>
                    <div class="stat-value" id="dinleWrong">0</div>
                </div>
            </div>

            <div class="game-box">
                <div class="sure-info" id="dinleSureInfo">Ses dosyasını dinle</div>
                <div style="text-align: center; margin: 30px 0;">
                    <div style="font-size: 4em;">🎧</div>
                </div>
                <button class="audio-btn" id="dinleAudioBtn">🔊 Kelimeyi Dinle</button>
                <div class="options" id="dinleOptions"></div>
                <div class="feedback" id="dinleFeedback"></div>
                <button class="next-btn" id="dinleNextBtn">Sonraki Soru →</button>
            </div>
        </div>

        <!-- Oyun Ekranı -->
        <div class="game-screen" id="gameScreen" style="display: none;">
        <button class="back-btn" id="backFromGameBtn">← Geri</button>

        <!-- İstatistikler -->
        <div class="stats">
            <div class="stat">
                <div class="stat-label">Puan</div>
                <div class="stat-value" id="score">0</div>
            </div>
            <div class="stat">
                <div class="stat-label">Seviye</div>
                <div class="stat-value" id="level">1</div>
            </div>
            <div class="stat">
                <div class="stat-label">Doğru</div>
                <div class="stat-value" id="correct">0</div>
            </div>
            <div class="stat">
                <div class="stat-label">Yanlış</div>
                <div class="stat-value" id="wrong">0</div>
            </div>
        </div>

        <!-- Can ve Süre -->
        <div class="game-info">
            <div id="livesDisplay" style="display: none;">
                ❤️ Can: <span id="lives">3</span>
            </div>
            <div id="timerDisplay" style="display: none;">
                ⏱️ Süre: <span id="timer">30</span>s
            </div>
            <div>
                📊 Mod: <span id="currentMode">Klasik</span>
            </div>
        </div>

        <!-- İlerleme -->
        <div class="progress">
            <div class="progress-bar" id="progressBar"></div>
        </div>

        <!-- Oyun Alanı -->
        <div class="game-box">
            <div class="sure-info" id="sureInfo">Yükleniyor...</div>
            <div class="arabic" id="arabicWord">رَكَّبَكَ</div>
            <button class="audio-btn" id="audioBtn">🔊 Sesi Dinle</button>
            <button class="hint-btn" id="hintBtn" style="display: none;">💡 İpucu</button>
            <div class="options" id="options"></div>
            <div class="feedback" id="feedback"></div>
            <button class="next-btn" id="nextBtn">Sonraki Soru →</button>
        </div>
        </div>  <!-- gameScreen sonu -->
    </div>

    <!-- Modal -->
    <div class="modal" id="modal">
        <div class="modal-content">
            <h2>🎉 Tebrikler!</h2>
            <p>Seviye <span id="newLevel"></span>'e yükseldiniz!</p>
            <p style="font-size: 0.9em; color: #666; margin-top: 10px;">
                Toplam Puanınız: <strong id="modalTotalPoints">0</strong><br>
                Bir sonraki seviye için: <strong id="modalNextLevelPoints">0</strong> puan gerekli
            </p>
            <button class="modal-btn" id="modalBtn">Devam Et</button>
        </div>
    </div>

    <!-- Başarılar Modal -->
    <div class="modal" id="badgesModal">
        <div class="modal-content" style="max-width: 400px; max-height: 80vh; overflow-y: auto;">
            <h3 style="margin: 15px 0 10px 0; font-size: 1.3em;">🏆 Başarılarınız</h3>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 15px 0;">
                <!-- Elmas -->
                <div style="text-align: center; padding: 8px; border-radius: 8px; background: linear-gradient(135deg, #e1f5fe 0%, #b3e5fc 100%);">
                    <div style="font-size: 1.2em;">💎</div>
                    <div style="font-weight: bold; margin: 2px 0; font-size: 0.8em;">Elmas</div>
                    <div style="font-size: 1em; font-weight: bold; color: #00bcd4;" id="diamondBadgeCount">0</div>
                    <div style="font-size: 0.6em; color: #666;">5 Altın = 1 Elmas</div>
                </div>
                
                <!-- Altın -->
                <div style="text-align: center; padding: 8px; border-radius: 8px; background: linear-gradient(135deg, #fff8e1 0%, #ffecb3 100%);">
                    <div style="font-size: 1.2em;">🥇</div>
                    <div style="font-weight: bold; margin: 2px 0; font-size: 0.8em;">Altın</div>
                    <div style="font-size: 1em; font-weight: bold; color: #ff9800;" id="goldBadgeCount">0</div>
                    <div style="font-size: 0.6em; color: #666;">5 Gümüş = 1 Altın</div>
                </div>
                
                <!-- Gümüş -->
                <div style="text-align: center; padding: 8px; border-radius: 8px; background: linear-gradient(135deg, #f3e5f5 0%, #e1bee7 100%);">
                    <div style="font-size: 1.2em;">🥈</div>
                    <div style="font-weight: bold; margin: 2px 0; font-size: 0.8em;">Gümüş</div>
                    <div style="font-size: 1em; font-weight: bold; color: #9c27b0;" id="silverBadgeCount">0</div>
                    <div style="font-size: 0.6em; color: #666;">5 Bronz = 1 Gümüş</div>
                </div>
                
                <!-- Bronz -->
                <div style="text-align: center; padding: 8px; border-radius: 8px; background: linear-gradient(135deg, #fff3e0 0%, #ffcc80 100%);">
                    <div style="font-size: 1.2em;">🥉</div>
                    <div style="font-weight: bold; margin: 2px 0; font-size: 0.8em;">Bronz</div>
                    <div style="font-size: 1em; font-weight: bold; color: #ff5722;" id="bronzeBadgeCount">0</div>
                    <div style="font-size: 0.6em; color: #666;">5 Yıldız = 1 Bronz</div>
                </div>
            </div>
            
            <div style="text-align: center; margin: 15px 0; padding: 10px; background: #f5f5f5; border-radius: 8px;">
                <div style="font-size: 1.1em; margin-bottom: 5px;">📊 İlerlemeniz</div>
                <div>⭐ <span id="badgesModalStars">0</span> Yıldız</div>
                <div>📈 <span id="badgesModalLevel">1</span>. Seviye</div>
                <div>🎯 <span id="badgesModalPoints">0</span> Puan</div>
            </div>
            
            <button class="modal-btn" onclick="closeBadgesModal()">Kapat</button>
        </div>
    </div>

    <!-- Takvim Modal -->
    <div class="modal" id="calendarModal">
        <div class="modal-content" style="max-width: 320px; max-height: 80vh; overflow-y: auto; padding: 20px;">
            <h3 style="margin: 10px 0 6px 0; font-size: 1em;">📅 Günlük Takip</h3>
            
            <!-- Streak Bilgisi -->
            <div style="text-align: center; margin: 10px 0; padding: 6px; background: linear-gradient(135deg, #ff9800 0%, #ff5722 100%); border-radius: 5px; color: white;">
                <span style="font-size: 0.9em;">🔥</span>
                <span style="font-size: 1em; font-weight: bold; margin: 0 5px;" id="currentStreak">0</span>
                <span style="font-size: 0.7em;">Ardışık Gün</span>
            </div>
            
            <!-- İstatistikler -->
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 6px; margin: 10px 0;">
                <div style="text-align: center; padding: 6px; background: #f5f5f5; border-radius: 5px;">
                    <div style="font-size: 0.9em; font-weight: bold; color: #4caf50;" id="totalPlayDays">0</div>
                    <div style="font-size: 0.65em; color: #666;">Toplam Oyun Günü</div>
                </div>
                <div style="text-align: center; padding: 6px; background: #f5f5f5; border-radius: 5px;">
                    <div style="font-size: 0.9em; font-weight: bold; color: #2196f3;" id="bestStreak">0</div>
                    <div style="font-size: 0.65em; color: #666;">En İyi Streak</div>
                </div>
            </div>
            
            <!-- Mini Takvim -->
            <div style="background: white; border: 2px solid #e0e0e0; border-radius: 6px; padding: 10px; margin: 10px 0;">
                <div style="text-align: center; font-weight: bold; margin-bottom: 6px; font-size: 0.85em;" id="calendarMonth">Kasım 2025</div>
                <div id="calendarGrid" style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 2px; text-align: center;">
                    <!-- Takvim günleri buraya eklenecek -->
                </div>
            </div>
            
            <!-- Bugünkü Hedef -->
            <div style="background: #e8f5e8; border-radius: 5px; padding: 6px; margin: 10px 0;">
                <div style="font-weight: bold; margin-bottom: 3px; color: #2e7d2e; font-size: 0.75em;">🎯 Bugünkü Hedefin</div>
                <div style="font-size: 0.65em; color: #666;">5 doğru cevap vererek günü tamamla!</div>
                <div style="margin-top: 3px; font-size: 0.75em;">
                    <span id="todayProgress">0</span>/5 <span id="todayProgressIcon">⏳</span>
                </div>
            </div>
            
            <button class="modal-btn" onclick="closeCalendarModal()">Kapat</button>
        </div>
    </div>

    <!-- Günlük Görevler Modal -->
    <div class="modal" id="dailyTasksModal">
        <div class="modal-content" style="max-width: 480px; max-height: 80vh; overflow-y: auto;">
            <h3 style="margin: 12px 0 8px 0; font-size: 1.1em;">🎯 Günlük Görevler</h3>
            
            <!-- Genel İlerleme -->
            <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 10px; border-radius: 8px; margin: 12px 0; text-align: center;">
                <div style="font-size: 0.95em; font-weight: bold;">Bugünkü İlerleme</div>
                <div style="font-size: 0.8em; margin-top: 4px;">
                    <span id="completedTasks">0</span>/<span id="totalTasks">5</span> Görev Tamamlandı
                </div>
                <div style="background: rgba(255,255,255,0.3); border-radius: 10px; height: 6px; margin: 6px 0;">
                    <div id="taskProgress" style="background: white; height: 100%; border-radius: 10px; width: 0%; transition: width 0.3s;"></div>
                </div>
            </div>

            <!-- Temel Görevler -->
            <div style="margin: 16px 0;">
                <h4 style="margin: 8px 0; color: #333; font-size: 0.95em;">📋 Temel Görevler</h4>
                
                <div id="dailyTasksList">
                    <!-- Görevler buraya dinamik eklenecek -->
                </div>
            </div>

            <!-- Bonus Görevler -->
            <div style="margin: 16px 0;">
                <h4 style="margin: 8px 0; color: #333; font-size: 0.95em;">⭐ Bonus Görevler</h4>
                
                <div id="bonusTasksList">
                    <!-- Bonus görevler buraya dinamik eklenecek -->
                </div>
            </div>

            <!-- Ödül Toplama -->
            <div id="rewardsSection" style="display: none; background: #e8f5e8; border-radius: 8px; padding: 12px; margin: 12px 0; text-align: center;">
                <div style="font-size: 1em; color: #2e7d2e; font-weight: bold;">🎉 Tebrikler!</div>
                <div style="font-size: 0.8em; color: #666; margin: 4px 0;">Tüm görevleri tamamladın!</div>
                <button id="claimRewardsBtn" onclick="claimDailyRewards()" style="background: #4caf50; color: white; border: none; padding: 6px 12px; border-radius: 6px; font-size: 0.8em; cursor: pointer;">
                    +5 ⭐ Ödül Topla
                </button>
            </div>

            <button class="modal-btn" onclick="closeDailyTasksModal()">Kapat</button>
        </div>
    </div>

    <!-- İstatistikler Modal -->
    <div class="modal" id="statsModal">
        <div class="modal-content" style="max-width: 420px; max-height: 90vh; overflow-y: auto; padding: 20px;">
            <h3 style="margin: 10px 0 8px 0; font-size: 1.1em; text-align: center;">📊 Oyun İstatistikleri</h3>
            
            <!-- Genel Özet -->
            <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 10px; border-radius: 8px; margin: 8px 0; text-align: center;">
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; text-align: center; margin-bottom: 10px;">
                    <div>
                        <div style="font-size: 1.4em; font-weight: bold;" id="statsLevel">1</div>
                        <div style="font-size: 0.7em; opacity: 0.9;">Seviye</div>
                    </div>
                    <div>
                        <div style="font-size: 1.4em; font-weight: bold;" id="statsPoints">0</div>
                        <div style="font-size: 0.7em; opacity: 0.9;">Toplam Puan</div>
                    </div>
                    <div>
                        <div style="font-size: 1.4em; font-weight: bold;" id="statsStars">0</div>
                        <div style="font-size: 0.7em; opacity: 0.9;">⭐ Yıldız</div>
                    </div>
                </div>
                
                <!-- Seviye İlerleme Barı -->
                <div style="margin-top: 10px;">
                    <div style="display: flex; justify-content: space-between; font-size: 0.75em; margin-bottom: 5px; opacity: 0.9;">
                        <span>Seviye <span id="statsCurrentLevel">1</span></span>
                        <span>Seviye <span id="statsNextLevel">2</span></span>
                    </div>
                    <div style="background: rgba(255,255,255,0.2); height: 6px; border-radius: 3px; overflow: hidden;">
                        <div id="statsLevelProgress" style="background: rgba(255,255,255,0.9); height: 100%; width: 0%; border-radius: 3px; transition: width 0.3s ease;"></div>
                    </div>
                    <div style="font-size: 0.75em; margin-top: 4px; opacity: 0.8;">
                        <span id="statsLevelPointsNeeded">0</span> puan daha
                    </div>
                </div>
            </div>

            <!-- Rozet Sistemi -->
            <div style="background: #f8f9ff; padding: 12px; border-radius: 8px; margin: 12px 0;">
                <h4 style="margin: 0 0 8px 0; color: #2d5f3f; font-size: 1em;">🏆 Rozetler</h4>
                <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 6px; text-align: center;">
                    <div style="padding: 6px; background: white; border-radius: 5px; border: 2px solid #f1c40f;">
                        <div style="font-size: 1.2em;">🥉</div>
                        <div style="font-size: 0.65em; color: #666;">Bronz</div>
                        <div style="font-weight: bold; font-size: 0.8em;" id="statsBronze">0</div>
                    </div>
                    <div style="padding: 6px; background: white; border-radius: 5px; border: 2px solid #95a5a6;">
                        <div style="font-size: 1.2em;">🥈</div>
                        <div style="font-size: 0.65em; color: #666;">Gümüş</div>
                        <div style="font-weight: bold; font-size: 0.8em;" id="statsSilver">0</div>
                    </div>
                    <div style="padding: 6px; background: white; border-radius: 5px; border: 2px solid #f39c12;">
                        <div style="font-size: 1.2em;">🥇</div>
                        <div style="font-size: 0.65em; color: #666;">Altın</div>
                        <div style="font-weight: bold; font-size: 0.8em;" id="statsGold">0</div>
                    </div>
                    <div style="padding: 6px; background: white; border-radius: 5px; border: 2px solid #9b59b6;">
                        <div style="font-size: 1.2em;">💎</div>
                        <div style="font-size: 0.65em; color: #666;">Elmas</div>
                        <div style="font-weight: bold; font-size: 0.8em;" id="statsDiamond">0</div>
                    </div>
                </div>
            </div>

            <!-- Başarı Analizi -->
            <div style="background: #f0f8ff; padding: 8px; border-radius: 6px; margin: 8px 0;">
                <h4 style="margin: 0 0 6px 0; color: #2980b9; font-size: 0.9em;">📈 Başarı Analizi</h4>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 6px;">
                    <div style="text-align: center; padding: 6px; background: white; border-radius: 5px;">
                        <div style="font-size: 1.1em; font-weight: bold; color: #27ae60;" id="statsSuccessRate">0%</div>
                        <div style="font-size: 0.7em; color: #666;">Başarı Oranı</div>
                    </div>
                    <div style="text-align: center; padding: 6px; background: white; border-radius: 5px;">
                        <div style="font-size: 1.1em; font-weight: bold; color: #3498db;" id="statsAvgPointsPerDay">0</div>
                        <div style="font-size: 0.7em; color: #666;">Günlük Ort. Puan</div>
                    </div>
                    <div style="text-align: center; padding: 6px; background: white; border-radius: 5px;">
                        <div style="font-size: 1.1em; font-weight: bold; color: #e67e22;" id="statsPlayConsistency">0%</div>
                        <div style="font-size: 0.7em; color: #666;">Oyun Tutarlılığı</div>
                    </div>
                    <div style="text-align: center; padding: 6px; background: white; border-radius: 5px;">
                        <div style="font-size: 1.1em; font-weight: bold; color: #9b59b6;" id="statsLevelProgress">0%</div>
                        <div style="font-size: 0.7em; color: #666;">Seviye İlerlemesi</div>
                    </div>
                </div>
            </div>

            <!-- Streak Bilgileri -->
            <div style="background: #fff7e6; padding: 12px; border-radius: 8px; margin: 12px 0;">
                <h4 style="margin: 0 0 8px 0; color: #d68910; font-size: 1em;">🔥 Streak İstatistikleri</h4>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                    <div style="text-align: center; padding: 8px; background: white; border-radius: 6px;">
                        <div style="font-size: 1.3em; font-weight: bold; color: #e67e22;" id="statsCurrentStreak">0</div>
                        <div style="font-size: 0.8em; color: #666;">Mevcut Streak</div>
                    </div>
                    <div style="text-align: center; padding: 8px; background: white; border-radius: 6px;">
                        <div style="font-size: 1.3em; font-weight: bold; color: #e67e22;" id="statsBestStreak">0</div>
                        <div style="font-size: 0.8em; color: #666;">En İyi Streak</div>
                    </div>
                    <div style="text-align: center; padding: 8px; background: white; border-radius: 6px;">
                        <div style="font-size: 1.3em; font-weight: bold; color: #27ae60;" id="statsTotalDays">0</div>
                        <div style="font-size: 0.8em; color: #666;">Toplam Oyun Günü</div>
                    </div>
                    <div style="text-align: center; padding: 8px; background: white; border-radius: 6px;">
                        <div style="font-size: 1.3em; font-weight: bold; color: #3498db;" id="statsTodayProgress">0</div>
                        <div style="font-size: 0.8em; color: #666;">Bugünkü İlerleme</div>
                    </div>
                </div>
            </div>

            <!-- Oyun Türü İstatistikleri -->
            <div style="background: #f0fff4; padding: 8px; border-radius: 6px; margin: 8px 0;">
                <h4 style="margin: 0 0 6px 0; color: #27ae60; font-size: 0.9em;">🎮 Oyun Türü İstatistikleri (Bugün)</h4>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 4px; font-size: 0.8em;">
                    <div style="padding: 5px; background: white; border-radius: 4px; display: flex; justify-content: space-between;">
                        <span>📚 Kelime Çevir:</span>
                        <strong id="statsKelimeCevir">0</strong>
                    </div>
                    <div style="padding: 5px; background: white; border-radius: 4px; display: flex; justify-content: space-between;">
                        <span>🎧 Dinle & Bul:</span>
                        <strong id="statsDinleBul">0</strong>
                    </div>
                    <div style="padding: 5px; background: white; border-radius: 4px; display: flex; justify-content: space-between;">
                        <span>📝 Boşluk Doldur:</span>
                        <strong id="statsBoslukDoldur">0</strong>
                    </div>
                    <div style="padding: 5px; background: white; border-radius: 4px; display: flex; justify-content: space-between;">
                        <span>📖 Ayet Oku:</span>
                        <strong id="statsAyetOku">0</strong>
                    </div>
                    <div style="padding: 5px; background: white; border-radius: 4px; display: flex; justify-content: space-between;">
                        <span>🤲 Dua Öğren:</span>
                        <strong id="statsDuaOgre">0</strong>
                    </div>
                    <div style="padding: 5px; background: white; border-radius: 4px; display: flex; justify-content: space-between;">
                        <span>📜 Hadis Oku:</span>
                        <strong id="statsHadisOku">0</strong>
                    </div>
                </div>
            </div>

            <!-- Bugünkü Toplam İstatistikler -->
            <div style="background: #fef9e7; padding: 8px; border-radius: 6px; margin: 8px 0;">
                <h4 style="margin: 0 0 6px 0; color: #b7950b; font-size: 0.9em;">⚡ Bugünkü Performans</h4>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 6px;">
                    <div style="text-align: center; padding: 6px; background: white; border-radius: 5px;">
                        <div style="font-size: 1.1em; font-weight: bold; color: #27ae60;" id="statsTodayCorrect">0</div>
                        <div style="font-size: 0.7em; color: #666;">Toplam Doğru</div>
                    </div>
                    <div style="text-align: center; padding: 6px; background: white; border-radius: 5px;">
                        <div style="font-size: 1.1em; font-weight: bold; color: #f39c12;" id="statsTodayPoints">0</div>
                        <div style="font-size: 0.7em; color: #666;">Toplam Puan</div>
                    </div>
                    <div style="text-align: center; padding: 6px; background: white; border-radius: 5px;">
                        <div style="font-size: 1.1em; font-weight: bold; color: #e74c3c;" id="statsPerfectStreak">0</div>
                        <div style="font-size: 0.7em; color: #666;">Mükemmel Seri</div>
                    </div>
                    <div style="text-align: center; padding: 6px; background: white; border-radius: 5px;">
                        <div style="font-size: 1.1em; font-weight: bold; color: #8e44ad;" id="statsDifficultyCount">0</div>
                        <div style="font-size: 0.7em; color: #666;">Farklı Zorluk</div>
                    </div>
                </div>
            </div>

            <!-- İstatistik Sıfırlama Uyarısı -->
            <div style="background: #ffebee; padding: 10px; border-radius: 6px; margin: 12px 0; border-left: 4px solid #f44336;">
                <div style="font-size: 0.85em; color: #c62828; margin-bottom: 8px;">⚠️ Dikkat: Tüm istatistikleri sıfırlamak istiyorsan:</div>
                <button onclick="confirmResetStats()" style="background: #f44336; color: white; border: none; padding: 8px 12px; border-radius: 4px; font-size: 0.8em; cursor: pointer;">
                    🔄 Tüm İstatistikleri Sıfırla
                </button>
            </div>

            <!-- Kapat Butonu -->
            <button class="modal-btn" onclick="closeStatsModal()">Kapat</button>
        </div>
    </div>

    <!-- Oyun Bitti Modal -->
    <div class="modal" id="gameOverModal">
        <div class="modal-content">
            <h2 id="gameOverTitle">😢 Oyun Bitti</h2>
            <p id="gameOverText"></p>
            <p>Toplam Puan: <strong id="finalScore">0</strong></p>
            <button class="modal-btn" id="restartBtn">Yeniden Başla</button>
        </div>
    </div>

    <script>
        // DOM yüklendikten sonra çalıştır
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🚀 DOM yüklendi, oyun başlatılıyor...');
            
        // ============ AYARLAR - BURADAN KONTROLEDEBİLİRSİN ============
        const CONFIG = {
            // OYUN MODLARI
            gameModes: {
                klasik: {
                    name: '📚 Klasik',
                    description: 'Normal oyun modu',
                    questionsPerLevel: 10,
                    timeLimit: 0,  // 0 = süre yok
                    lives: 0,      // 0 = sınırsız can
                    showHint: true
                },
                hizli: {
                    name: '⚡ Hızlı',
                    description: '30 saniye süre',
                    questionsPerLevel: 15,
                    timeLimit: 30,
                    lives: 0,
                    showHint: false
                },
                hayat: {
                    name: '❤️ 3 Can',
                    description: '3 hak, yanlış = -1 can',
                    questionsPerLevel: 20,
                    timeLimit: 0,
                    lives: 3,
                    showHint: true
                },
                zorluk: {
                    name: '🔥 Zorluk',
                    description: 'Sadece zor kelimeler',
                    questionsPerLevel: 10,
                    timeLimit: 20,
                    lives: 3,
                    showHint: false,
                    minDifficulty: 7  // 7-10 arası zorluk
                }
            },

            // ZORLUK SEVİYELERİ (Eşit Dağılımlı: Her biri ~4945 kelime)
            difficultyLevels: {
                kolay: {
                    name: '😊 Kolay',
                    minDiff: 5,
                    maxDiff: 9,
                    pointsMultiplier: 1
                },
                orta: {
                    name: '😐 Orta',
                    minDiff: 10,
                    maxDiff: 11,
                    pointsMultiplier: 2
                },
                zor: {
                    name: '😤 Zor',
                    minDiff: 12,
                    maxDiff: 21,
                    pointsMultiplier: 3
                },
                karisik: {
                    name: '🎲 Karışık',
                    minDiff: 5,
                    maxDiff: 21,
                    pointsMultiplier: 2
                }
            },

            // VARSAYILAN AYARLAR
            defaultMode: 'klasik',
            defaultDifficulty: 'orta',  // UI'da mevcut olan zorluk seviyesi
            wrongAnswerPenalty: 5  // Yanlış cevap puan cezası
        };

        // ============ OYUN DURUMU ============
        let kelimeBulData = [];  // kelimebul.json
        let ayetOkuData = [];    // ayetoku.json
        let duaData = [];        // duaet.json
        let hadisData = [];      // hadisoku.json
        
        let currentQuestion = null;
        let currentAyetIndex = 0;
        let currentDuaIndex = 0;
        let currentHadisIndex = 0;
        
        // Ses kontrolü için
        let currentAudio = null;
        
        // Kelime Çevir oyunu için
        let kelimeCevirScore = 0;
        let kelimeCevirCorrect = 0;
        let kelimeCevirWrong = 0;
        
        // Dinle ve Bul oyunu için
        let dinleScore = 0;
        let dinleCorrect = 0;
        let dinleWrong = 0;
        
        // Boşluk Doldur oyunu için
        let boslukScore = 0;
        let boslukCorrect = 0;
        let boslukWrong = 0;
        
        // GLOBAL (KALICI) PUANLAR
        let totalPoints = 0;  // Toplam oyun puanı (kalıcı)
        let starPoints = 0;   // Yıldız puanı (her 500 puan = 1 yıldız)
        let level = 1;        // Global seviye

        // ROZET SİSTEMİ
        let badges = {
            bronze: 0,   // Bronz rozetler (5 yıldız = 1 bronz)
            silver: 0,   // Gümüş rozetler (5 bronz = 1 gümüş)
            gold: 0,     // Altın rozetler (5 gümüş = 1 altın)
            diamond: 0   // Elmas rozetler (5 altın = 1 elmas)
        };

        // STREAK SİSTEMİ (GÜNLİK TAKİP)
        let streakData = {
            currentStreak: 0,    // Mevcut ardışık gün sayısı
            bestStreak: 0,       // En iyi streak rekoru
            lastPlayDate: '',    // Son oyun oynanan tarih (YYYY-MM-DD)
            totalPlayDays: 0,    // Toplam oyun oynanan gün sayısı
            dailyGoal: 5,        // Günlük hedef (doğru cevap sayısı)
            todayProgress: 0,    // Bugünkü ilerleme
            todayDate: '',       // Bugünün tarihi
            playDates: []        // Oyun oynanan tarihler listesi
        };

        // GÜNLİK GÖREVLER SİSTEMİ
        let dailyTasks = {
            lastTaskDate: '',    // Son görev yenileme tarihi
            tasks: [],           // Günlük görevler listesi
            bonusTasks: [],      // Bonus görevler listesi
            completedTasks: [],  // Tamamlanan görevler
            rewardsClaimed: false, // Ödül toplandı mı?
            todayStats: {        // Bugünkü oyun istatistikleri
                kelimeCevir: 0,
                dinleBul: 0,
                boslukDoldur: 0,
                ayetOku: 0,
                duaOgre: 0,
                hadisOku: 0,
                toplamDogru: 0,
                toplamPuan: 0,
                perfectStreak: 0,
                farklıZorluk: new Set()
            }
        };

        // SESSION (OYUN İÇİ) PUANLAR
        let sessionScore = 0;     // Bu oyunun puanı
        let sessionCorrect = 0;   // Bu oyunun doğru sayısı
        let sessionWrong = 0;     // Bu oyunun yanlış sayısı

        // ESKI DEĞİŞKENLER (Geriye uyumluluk için)
        let score = 0;
        let correct = 0;
        let wrong = 0;
        let questionCount = 0;
        let currentMode = CONFIG.defaultMode;
        let currentDifficulty = CONFIG.defaultDifficulty;
        
        console.log('Session değişkenleri başlatıldı:', {sessionScore, sessionCorrect, sessionWrong});
        console.log(`🏁 Varsayılan zorluk seviyesi: ${currentDifficulty}`);
        let lives = 0;
        let timer = null;
        let timeLeft = 0;

        // ============ DOM ELEMANLARI ============
        const elements = {
            // Ana menü
            mainMenu: document.getElementById('mainMenu'),
            kelimeCevirBtn: document.getElementById('kelimeCevirBtn'),
            dinleBulBtn: document.getElementById('dinleBulBtn'),
            boslukDoldurBtn: document.getElementById('boslukDoldurBtn'),
            duaEtBtn: document.getElementById('duaEtBtn'),
            ayetOkuBtn: document.getElementById('ayetOkuBtn'),
            hadisOkuBtn: document.getElementById('hadisOkuBtn'),
            
            // Kelime oyunu
            score: document.getElementById('score'),
            level: document.getElementById('level'),
            correct: document.getElementById('correct'),
            wrong: document.getElementById('wrong'),
            progressBar: document.getElementById('progressBar'),
            sureInfo: document.getElementById('sureInfo'),
            arabicWord: document.getElementById('arabicWord'),
            audioBtn: document.getElementById('audioBtn'),
            hintBtn: document.getElementById('hintBtn'),
            options: document.getElementById('options'),
            feedback: document.getElementById('feedback'),
            nextBtn: document.getElementById('nextBtn'),
            difficulty: document.getElementById('difficulty'),
            modal: document.getElementById('modal'),
            newLevel: document.getElementById('newLevel'),
            modalBtn: document.getElementById('modalBtn'),
            modeSelector: document.getElementById('modeSelector'),
            gameScreen: document.getElementById('gameScreen'),
            settingsBtn: document.getElementById('settingsBtn'),
            startBtn: document.getElementById('startBtn'),
            modeButtons: document.getElementById('modeButtons'),
            difficultyButtons: document.getElementById('difficultyButtons'),
            lives: document.getElementById('lives'),
            livesDisplay: document.getElementById('livesDisplay'),
            timer: document.getElementById('timer'),
            timerDisplay: document.getElementById('timerDisplay'),
            currentMode: document.getElementById('currentMode'),
            gameOverModal: document.getElementById('gameOverModal'),
            gameOverTitle: document.getElementById('gameOverTitle'),
            gameOverText: document.getElementById('gameOverText'),
            finalScore: document.getElementById('finalScore'),
            restartBtn: document.getElementById('restartBtn'),
            backToMenuBtn: document.getElementById('backToMenuBtn'),
            backFromGameBtn: document.getElementById('backFromGameBtn'),
            
            // Ayet modu
            ayetMode: document.getElementById('ayetMode'),
            ayetSureInfo: document.getElementById('ayetSureInfo'),
            ayetArabic: document.getElementById('ayetArabic'),
            ayetTranslation: document.getElementById('ayetTranslation'),
            ayetAudioBtn: document.getElementById('ayetAudioBtn'),
            prevAyetBtn: document.getElementById('prevAyetBtn'),
            nextAyetBtn: document.getElementById('nextAyetBtn'),
            backFromAyetBtn: document.getElementById('backFromAyetBtn'),
            
            // Dua modu
            duaMode: document.getElementById('duaMode'),
            duaSureInfo: document.getElementById('duaSureInfo'),
            duaArabic: document.getElementById('duaArabic'),
            duaTranslation: document.getElementById('duaTranslation'),
            duaAudioBtn: document.getElementById('duaAudioBtn'),
            prevDuaBtn: document.getElementById('prevDuaBtn'),
            nextDuaBtn: document.getElementById('nextDuaBtn'),
            backFromDuaBtn: document.getElementById('backFromDuaBtn'),
            
            // Hadis modu
            hadisMode: document.getElementById('hadisMode'),
            hadisCategory: document.getElementById('hadisCategory'),
            hadisTitle: document.getElementById('hadisTitle'),
            hadisHeader: document.getElementById('hadisHeader'),
            hadisText: document.getElementById('hadisText'),
            hadisRef: document.getElementById('hadisRef'),
            prevHadisBtn: document.getElementById('prevHadisBtn'),
            nextHadisBtn: document.getElementById('nextHadisBtn'),
            backFromHadisBtn: document.getElementById('backFromHadisBtn'),
            
            // Boşluk Doldur modu
            boslukMode: document.getElementById('boslukMode'),
            boslukSureInfo: document.getElementById('boslukSureInfo'),
            boslukAyetText: document.getElementById('boslukAyetText'),
            boslukAudioBtn: document.getElementById('boslukAudioBtn'),
            boslukOptions: document.getElementById('boslukOptions'),
            boslukFeedback: document.getElementById('boslukFeedback'),
            boslukNextBtn: document.getElementById('boslukNextBtn'),
            boslukScore: document.getElementById('boslukScore'),
            boslukCorrect: document.getElementById('boslukCorrect'),
            boslukWrong: document.getElementById('boslukWrong'),
            backFromBoslukBtn: document.getElementById('backFromBoslukBtn'),
            
            // Dinle ve Bul modu
            dinleMode: document.getElementById('dinleMode'),
            dinleSureInfo: document.getElementById('dinleSureInfo'),
            dinleAudioBtn: document.getElementById('dinleAudioBtn'),
            dinleOptions: document.getElementById('dinleOptions'),
            dinleFeedback: document.getElementById('dinleFeedback'),
            dinleNextBtn: document.getElementById('dinleNextBtn'),
            dinleScore: document.getElementById('dinleScore'),
            dinleCorrect: document.getElementById('dinleCorrect'),
            dinleWrong: document.getElementById('dinleWrong'),
            backFromDinleBtn: document.getElementById('backFromDinleBtn')
        };

        // ============ SES ÇALMA FONKSİYONU ============
        function playAudio(audioUrl, button) {
            // Eğer ses çalıyorsa durdur
            if (currentAudio && !currentAudio.paused) {
                currentAudio.pause();
                currentAudio.currentTime = 0;
            }
            
            if (!audioUrl) {
                console.error('Ses dosyası bulunamadı');
                return;
            }
            
            // Butonu devre dışı bırak
            if (button) button.disabled = true;
            
            currentAudio = new Audio(audioUrl);
            
            currentAudio.play().catch(err => {
                console.error('Ses hatası:', err);
                if (button) button.disabled = false;
            });
            
            // Ses bittiğinde butonu aktif et
            currentAudio.onended = () => {
                if (button) button.disabled = false;
            };
        }

        // ============ VERİ YÜKLEME ============
        async function loadData() {
            try {
                // Kelime verilerini yükle (Kelime Çevir ve Dinle ve Bul için)
                const kelimeResponse = await fetch('kelimebul.json');
                kelimeBulData = await kelimeResponse.json();
                // console.log(`${kelimeBulData.length} kelime yüklendi`);
                
                // Ayet verilerini yükle (Boşluk Doldur ve Ayet Oku için)
                const ayetResponse = await fetch('ayetoku.json');
                ayetOkuData = await ayetResponse.json();
                // console.log(`${ayetOkuData.length} ayet yüklendi`);
                
                // Dua verilerini yükle (Dua Et için)
                const duaResponse = await fetch('duaet.json');
                duaData = await duaResponse.json();
                // console.log(`${duaData.length} dua yüklendi`);
                
                // Hadis verilerini yükle (Hadis Oku için)
                const hadisResponse = await fetch('hadisoku.json');
                hadisData = await hadisResponse.json();
                // console.log(`${hadisData.length} hadis yüklendi`);
                
                // Mod seçiciyi başlat
                initModeSelector();

                // Ana menü zorluk butonlarını başlat
                initMainMenuDifficultyButtons();
                
            } catch (error) {
                console.error('Veri yükleme hatası:', error);
                elements.mainMenu.innerHTML = '<p style="color: red; text-align: center;">Veriler yüklenemedi!</p>';
            }
        }

        // ============ İNDEXEDDB SİSTEMİ (ÜÇÜNCü TARAF ÇEREZİ SORUNU İÇİN) ============
        let db = null;
        
        function initIndexedDB() {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open('HaseneGameDB', 1);
                
                request.onerror = () => reject(request.error);
                request.onsuccess = () => {
                    db = request.result;
                    resolve(db);
                };
                
                request.onupgradeneeded = (event) => {
                    db = event.target.result;
                    if (!db.objectStoreNames.contains('gameData')) {
                        db.createObjectStore('gameData');
                    }
                };
            });
        }
        
        function saveToIndexedDB(key, value) {
            if (!db) return;
            try {
                const transaction = db.transaction(['gameData'], 'readwrite');
                const store = transaction.objectStore('gameData');
                store.put(value, key);
            } catch(e) { console.log('IndexedDB save failed:', e); }
        }
        
        function loadFromIndexedDB(key) {
            return new Promise((resolve) => {
                if (!db) { resolve(null); return; }
                try {
                    const transaction = db.transaction(['gameData'], 'readonly');
                    const store = transaction.objectStore('gameData');
                    const request = store.get(key);
                    request.onsuccess = () => resolve(request.result || null);
                    request.onerror = () => resolve(null);
                } catch(e) { resolve(null); }
            });
        }

        // URL TABANLI VERİ SAKLAMA (Mobil fallback - hiçbir şey çalışmazsa)
        function saveToURL() {
            const gameData = {
                p: totalPoints, // points
                b: badges.bronze + ',' + badges.silver + ',' + badges.gold + ',' + badges.diamond, // badges
                s: streakData.currentStreak, // streak
                d: new Date().toISOString().split('T')[0] // date
            };
            const encoded = btoa(JSON.stringify(gameData));
            const newUrl = window.location.origin + window.location.pathname + '?data=' + encoded;
            
            // URL'yi geçmişe ekle (geri butonu ile erişilebilir)
            if (window.history.pushState) {
                window.history.pushState({gameData: encoded}, '', newUrl);
            }
            console.log('🔗 URL\'ye kaydedildi:', totalPoints, 'puan');
        }
        
        function loadFromURL() {
            try {
                const urlParams = new URLSearchParams(window.location.search);
                const data = urlParams.get('data');
                if (data) {
                    const decoded = JSON.parse(atob(data));
                    totalPoints = parseInt(decoded.p) || 0;
                    
                    // Rozet verilerini yükle
                    if (decoded.b) {
                        const badgeArray = decoded.b.split(',');
                        badges.bronze = parseInt(badgeArray[0]) || 0;
                        badges.silver = parseInt(badgeArray[1]) || 0;
                        badges.gold = parseInt(badgeArray[2]) || 0;
                        badges.diamond = parseInt(badgeArray[3]) || 0;
                    }
                    
                    // Streak verilerini yükle
                    if (decoded.s) {
                        streakData.currentStreak = parseInt(decoded.s) || 0;
                    }
                    
                    console.log('🔗 URL\'den yüklendi:', totalPoints, 'puan');
                    return true;
                }
            } catch(e) {
                console.log('URL yükleme hatası:', e);
            }
            return false;
        }

        // ============ İSTATİSTİK BAR FONKSİYONLARI ============
        async function loadStats() {
            try {
                // IndexedDB'den yükle (üçüncü taraf çerez sorunu için)
                const savedPoints = await loadFromIndexedDB('hasene_totalPoints');
                const savedBadges = await loadFromIndexedDB('hasene_badges');
                const savedStreak = await loadFromIndexedDB('hasene_streak');
                const savedTasks = await loadFromIndexedDB('hasene_dailyTasks');
                
                // Puanları yükle (IndexedDB öncelikli, localStorage yedek)
                totalPoints = parseInt(savedPoints || localStorage.getItem('hasene_totalPoints') || '0');
                starPoints = Math.floor(totalPoints / 500);
                level = calculateLevel(totalPoints);
                
                console.log('📊 IndexedDB yüklendi:', {totalPoints, savedPoints});
            } catch (error) {
                console.log('IndexedDB hatası, localStorage denenecek:', error);
                try {
                    // localStorage dene
                    totalPoints = parseInt(localStorage.getItem('hasene_totalPoints') || '0');
                    starPoints = Math.floor(totalPoints / 500);
                    level = calculateLevel(totalPoints);
                    console.log('📊 localStorage yüklendi:', totalPoints);
                } catch (localError) {
                    console.log('localStorage da çalışmıyor, URL deneniyor:', localError);
                    // Son çare: URL'den yükle
                    const urlLoaded = loadFromURL();
                    if (urlLoaded) {
                        starPoints = Math.floor(totalPoints / 500);
                        level = calculateLevel(totalPoints);
                    } else {
                        // Hiçbir şey çalışmıyor, varsayılan değerler
                        totalPoints = 0;
                        starPoints = 0;
                        level = 1;
                        console.log('⚠️ Hiçbir veri sistemi çalışmıyor, sıfırdan başlatılıyor');
                    }
                }
            }
            
            // Rozet sistemi yükle (IndexedDB öncelikli)
            const savedBadgesIndexedDB = await loadFromIndexedDB('hasene_badges');
            const savedBadgesData = savedBadgesIndexedDB || localStorage.getItem('hasene_badges');
            if (savedBadgesData) {
                badges = JSON.parse(typeof savedBadgesData === 'string' ? savedBadgesData : JSON.stringify(savedBadgesData));
            }
            
            // Streak sistemi yükle (IndexedDB öncelikli)
            const savedStreakIndexedDB = await loadFromIndexedDB('hasene_streak');
            const savedStreak = savedStreakIndexedDB || localStorage.getItem('hasene_streak');
            if (savedStreak) {
                streakData = { ...streakData, ...JSON.parse(typeof savedStreak === 'string' ? savedStreak : JSON.stringify(savedStreak)) };
            }
            
            // Günlük görevler yükle (IndexedDB öncelikli) - BU ÇOOK ÖNEMLİ!
            const savedTasksIndexedDB = await loadFromIndexedDB('hasene_dailyTasks');
            const savedTasks = savedTasksIndexedDB || localStorage.getItem('hasene_dailyTasks');
            if (savedTasks) {
                dailyTasks = { ...dailyTasks, ...JSON.parse(typeof savedTasks === 'string' ? savedTasks : JSON.stringify(savedTasks)) };
                // Set nesnelerini yeniden oluştur
                dailyTasks.todayStats.farklıZorluk = new Set(dailyTasks.todayStats.farklıZorluk || []);
            }
            
            // Oyun ayarları yükle (currentMode ve currentDifficulty) - ÇOOK ÖNEMLİ!
            const savedModeIndexedDB = await loadFromIndexedDB('hasene_currentMode');
            const savedMode = savedModeIndexedDB || localStorage.getItem('hasene_currentMode');
            if (savedMode && CONFIG.gameModes[savedMode]) {
                currentMode = savedMode;
                console.log(`🎮 Kaydedilen mod yüklendi: ${currentMode}`);
            }
            
            const savedDifficultyIndexedDB = await loadFromIndexedDB('hasene_currentDifficulty');
            const savedDifficulty = savedDifficultyIndexedDB || localStorage.getItem('hasene_currentDifficulty');
            if (savedDifficulty && CONFIG.difficultyLevels[savedDifficulty]) {
                currentDifficulty = savedDifficulty;
                console.log(`🎯 Kaydedilen zorluk yüklendi: ${currentDifficulty}`);
            }
            
            console.log('📋 Günlük görevler yüklendi:', {
                completedTasks: dailyTasks.completedTasks.length,
                todayStats: dailyTasks.todayStats,
                lastTaskDate: dailyTasks.lastTaskDate
            });
            
            console.log('🎮 Oyun ayarları yüklendi:', {
                currentMode: currentMode,
                currentDifficulty: currentDifficulty
            });
            
            // Günlük kontrol
            checkDailyProgress();
            checkDailyTasks();
        }

        // Daha zorlu seviye hesaplama sistemi
        function calculateLevel(points) {
            if (points < 1000) return 1;        // Level 1: 0-999 puan
            if (points < 2500) return 2;        // Level 2: 1000-2499 puan  
            if (points < 5000) return 3;        // Level 3: 2500-4999 puan
            if (points < 8500) return 4;        // Level 4: 5000-8499 puan
            if (points < 13000) return 5;       // Level 5: 8500-12999 puan
            if (points < 19000) return 6;       // Level 6: 13000-18999 puan
            if (points < 26500) return 7;       // Level 7: 19000-26499 puan
            if (points < 35500) return 8;       // Level 8: 26500-35499 puan
            if (points < 46000) return 9;       // Level 9: 35500-45999 puan
            if (points < 58000) return 10;      // Level 10: 46000-57999 puan
            
            // Level 10'dan sonra her seviye için 15000 puan artış
            const afterLevel10 = points - 58000;
            return 10 + Math.floor(afterLevel10 / 15000) + 1;
        }

        // Bir sonraki seviye için gereken puan
        function getNextLevelRequiredPoints(currentLevel) {
            const levelThresholds = [0, 1000, 2500, 5000, 8500, 13000, 19000, 26500, 35500, 46000, 58000];
            
            // currentLevel 1-10 arasındaysa threshold'u döndür
            if (currentLevel >= 1 && currentLevel <= 10) {
                return levelThresholds[currentLevel];
            }
            
            // Level 10'dan sonra - her seviye için 15000 puan artış
            if (currentLevel > 10) {
                return 58000 + ((currentLevel - 10) * 15000);
            }
            
            // Level 0 veya geçersiz değerler için
            return levelThresholds[1]; // Level 1 threshold'u
        }

        async function saveStats() {
            try {
                // ÇOKLU KAYDETME SİSTEMİ (Üçüncü taraf çerez sorunu için)
                
                // 1. IndexedDB (ana sistem - çerez engellemelerinden etkilenmez)
                if (db) {
                    saveToIndexedDB('hasene_totalPoints', totalPoints.toString());
                    saveToIndexedDB('hasene_badges', JSON.stringify(badges));
                    saveToIndexedDB('hasene_streak', JSON.stringify(streakData));
                    
                    const tasksToSave = { 
                        ...dailyTasks, 
                        todayStats: {
                            ...dailyTasks.todayStats,
                            farklıZorluk: Array.from(dailyTasks.todayStats.farklıZorluk)
                        }
                    };
                    saveToIndexedDB('hasene_dailyTasks', JSON.stringify(tasksToSave));
                    
                    // Oyun ayarları da kaydet (currentMode & currentDifficulty) - KRİTİK!
                    saveToIndexedDB('hasene_currentMode', currentMode);
                    saveToIndexedDB('hasene_currentDifficulty', currentDifficulty);
                }
                
                // 2. localStorage (yedek sistem)
                try {
                    localStorage.setItem('hasene_totalPoints', totalPoints.toString());
                    localStorage.setItem('hasene_badges', JSON.stringify(badges));
                    localStorage.setItem('hasene_streak', JSON.stringify(streakData));
                    
                    // GÜNLÜK GÖREVLER de localStorage'a kaydet (kritik!)
                    const tasksToSave = { 
                        ...dailyTasks, 
                        todayStats: {
                            ...dailyTasks.todayStats,
                            farklıZorluk: Array.from(dailyTasks.todayStats.farklıZorluk)
                        }
                    };
                    localStorage.setItem('hasene_dailyTasks', JSON.stringify(tasksToSave));
                    
                    // Oyun ayarları da localStorage'a kaydet - KRİTİK!
                    localStorage.setItem('hasene_currentMode', currentMode);
                    localStorage.setItem('hasene_currentDifficulty', currentDifficulty);
                } catch(e) { console.log('localStorage failed:', e); }
                
                // 3. URL sistemi (son çare - mobil için)
                try {
                    saveToURL();
                } catch(e) { console.log('URL save failed:', e); }
                
                console.log('💾 ÜÇLÜ KORUMA: IndexedDB + localStorage + URL ile kaydedildi!', totalPoints);
                
            } catch (error) {
                console.error('❌ Kaydetme hatası:', error);
            }
        }

        function resetAllStats() {
            // Tüm istatistikleri sıfırla
            totalPoints = 0;
            starPoints = 0;
            level = 1;
            sessionScore = 0;
            sessionCorrect = 0;
            sessionWrong = 0;
            
            // Rozetleri sıfırla
            badges = { bronze: 0, silver: 0, gold: 0, diamond: 0 };
            
            // Streak verilerini sıfırla
            streakData = {
                currentStreak: 0,
                playDates: [],
                dailyGoal: 5,
                dailyCorrect: 0
            };
            
            // Daily tasks sıfırla
            dailyTasks = {
                lastTaskDate: null,
                tasks: [],
                bonusTasks: [],
                completedTasks: [],
                rewardsClaimed: false,
                todayStats: {
                    kelimeCevir: 0,
                    dinleBul: 0,
                    boslukDoldur: 0,
                    ayetOku: 0,
                    duaOgre: 0,
                    hadisOku: 0,
                    toplamDogru: 0,
                    toplamPuan: 0,
                    perfectStreak: 0,
                    farklıZorluk: new Set()
                }
            };
            
            // ÜÇ SİSTEMİ DE TAMAMEN TEMİZLE!
            
            // 1. IndexedDB'yi temizle (ANA SİSTEM)
            if (db) {
                try {
                    const transaction = db.transaction(['gameData'], 'readwrite');
                    const store = transaction.objectStore('gameData');
                    store.clear(); // Tüm IndexedDB verilerini sil
                    console.log('🗑️ IndexedDB temizlendi');
                } catch(e) { 
                    console.log('IndexedDB temizleme hatası:', e); 
                }
            }
            
            // 2. localStorage'ı tamamen temizle
            localStorage.removeItem('hasene_totalPoints');
            localStorage.removeItem('hasene_badges');
            localStorage.removeItem('hasene_streak');
            localStorage.removeItem('hasene_dailyTasks');
            localStorage.removeItem('hasene_currentMode');
            localStorage.removeItem('hasene_currentDifficulty');
            console.log('🗑️ localStorage tamamen temizlendi');
            
            // 3. URL geçmişini temizle (mümkünse)
            try {
                if (window.history.replaceState) {
                    window.history.replaceState({}, '', window.location.pathname);
                }
                console.log('🗑️ URL geçmişi temizlendi');
            } catch(e) { 
                console.log('URL temizleme hatası:', e); 
            }
            
            // Yeni günlük görevler oluştur
            generateDailyTasks(new Date().toISOString().split('T')[0]);
            
            // Ekranı güncelle
            updateStatsBar();
            updateUI();
            
            console.log('✅ TÜM 3 SİSTEM TEMİZLENDİ! IndexedDB + localStorage + URL');
            alert('🔄 Tüm veriler TAMAMEN sıfırlandı! IndexedDB, localStorage ve URL geçmişi temizlendi.');
        }

        function updateStatsBar() {
            // Üst bar güncelle
            document.getElementById('gamePoints').textContent = totalPoints;
            
            // Yıldız puanı güncelle (her 500 puana 1 yıldız)
            starPoints = Math.floor(totalPoints / 500);
            document.getElementById('starPoints').textContent = starPoints;
            
            // Rozet sistemini güncelle
            updateBadgeSystem();
            
            // Seviye güncelle (yeni hesaplama sistemi)
            level = calculateLevel(totalPoints);
            document.getElementById('playerLevel').textContent = level;
            
            // Seviye ilerleme çubuğunu güncelle
            let currentLevelStart, nextLevelStart;
            
            if (level === 1) {
                currentLevelStart = 0;
                nextLevelStart = 1000;
            } else if (level <= 10) {
                const thresholds = [0, 1000, 2500, 5000, 8500, 13000, 19000, 26500, 35500, 46000, 58000];
                currentLevelStart = thresholds[level - 1];
                nextLevelStart = thresholds[level];
            } else {
                // Level 10'dan sonra
                currentLevelStart = 58000 + ((level - 11) * 15000);
                nextLevelStart = 58000 + ((level - 10) * 15000);
            }
            
            const currentLevelPoints = totalPoints - currentLevelStart;
            const levelRequiredPoints = nextLevelStart - currentLevelStart;
            const progressPercentage = Math.max(0, Math.min((currentLevelPoints / levelRequiredPoints) * 100, 100));
            
            const levelProgressElement = document.getElementById('levelProgress');
            if (levelProgressElement) {
                levelProgressElement.style.width = progressPercentage + '%';
            }
            
            // Alt bar (oyun içi stats) güncelle
            const scoreElement = document.getElementById('score');
            const levelElement = document.getElementById('level');
            if (scoreElement) scoreElement.textContent = totalPoints;
            if (levelElement) levelElement.textContent = level;
            
            // Kaydet
            saveStats();
            
            // Debug için mevcut değerleri logla
            console.log('📊 Mevcut İstatistikler:', {
                totalPoints: totalPoints,
                starPoints: starPoints, 
                level: level,
                sessionScore: sessionScore,
                sessionCorrect: sessionCorrect,
                sessionWrong: sessionWrong
            });
        }

        // SESSION PUAN FONKSİYONLARI
        function addSessionPoints(points) {
            console.log(`💰 === addSessionPoints(${points}) ÇAĞRILDI ===`);
            console.log(`📊 Önce: sessionScore=${sessionScore}, sessionCorrect=${sessionCorrect}`);
            sessionScore += points;
            sessionCorrect++;
            
            // Geriye uyumluluk için eski değişkenleri de güncelle
            score = sessionScore;
            correct = sessionCorrect;
            console.log(`📊 Sonra: sessionScore=${sessionScore}, sessionCorrect=${sessionCorrect}`);
            console.log(`🎨 updateUI() çağrılıyor...`);
            updateUI(); // Sadece oyun içi barı güncelle
            console.log(`✅ addSessionPoints tamamlandı!`);
        }

        function addSessionWrong() {
            console.log(`❌ === addSessionWrong() ÇAĞRILDI ===`);
            console.log(`📊 Önce: sessionWrong=${sessionWrong}, wrong=${wrong}`);
            sessionWrong++;
            wrong = sessionWrong; // Geriye uyumluluk
            console.log(`📊 Sonra: sessionWrong=${sessionWrong}, wrong=${wrong}`);
            console.log(`🎨 updateUI() çağrılıyor...`);
            updateUI();
            console.log(`✅ addSessionWrong tamamlandı!`);
        }

        // ============ ROZET SİSTEMİ ============
        function updateBadgeSystem() {
            // Her 5 yıldız = 1 bronz rozet
            // Her 5 bronz = 1 gümüş rozet  
            // Her 5 gümüş = 1 altın rozet
            // Her 5 altın = 1 elmas rozet
            
            const totalStars = starPoints;
            const newBronze = Math.floor(totalStars / 5);
            const newSilver = Math.floor(newBronze / 5);
            const newGold = Math.floor(newSilver / 5);
            const newDiamond = Math.floor(newGold / 5);
            
            // Rozet seviye kontrolü ve modal gösterimi
            if (newDiamond > badges.diamond) {
                badges.diamond = newDiamond;
                showBadgeUpModal('diamond', '💎 Elmas');
            } else if (newGold > badges.gold) {
                badges.gold = newGold;
                showBadgeUpModal('gold', '🥇 Altın');
            } else if (newSilver > badges.silver) {
                badges.silver = newSilver;
                showBadgeUpModal('silver', '🥈 Gümüş');
            } else if (newBronze > badges.bronze) {
                badges.bronze = newBronze;
                showBadgeUpModal('bronze', '🥉 Bronz');
            }
            
            // Tüm rozet sayılarını güncelle
            badges.bronze = newBronze;
            badges.silver = newSilver;
            badges.gold = newGold;
            badges.diamond = newDiamond;
            
            // En yüksek rozeti göster
            updateTopBadgeDisplay();
        }

        function updateTopBadgeDisplay() {
            const topBadgeIcon = document.getElementById('topBadgeIcon');
            const topBadgeCount = document.getElementById('topBadgeCount');
            
            if (badges.diamond > 0) {
                topBadgeIcon.textContent = '💎';
                topBadgeCount.textContent = badges.diamond;
            } else if (badges.gold > 0) {
                topBadgeIcon.textContent = '🥇';
                topBadgeCount.textContent = badges.gold;
            } else if (badges.silver > 0) {
                topBadgeIcon.textContent = '🥈';
                topBadgeCount.textContent = badges.silver;
            } else if (badges.bronze > 0) {
                topBadgeIcon.textContent = '🥉';
                topBadgeCount.textContent = badges.bronze;
            } else {
                topBadgeIcon.textContent = '🥉';
                topBadgeCount.textContent = '0';
            }
        }

        function showBadgeUpModal(badgeType, badgeName) {
            // Rozet atlama modalı - şimdilik alert, sonra düzeltiriz
            alert(`🎉 Tebrikler! ${badgeName} rozeti kazandınız!`);
        }

        function showBadgesModal() {
            // Tüm rozet sayılarını güncelle
            document.getElementById('diamondBadgeCount').textContent = badges.diamond;
            document.getElementById('goldBadgeCount').textContent = badges.gold;
            document.getElementById('silverBadgeCount').textContent = badges.silver;
            document.getElementById('bronzeBadgeCount').textContent = badges.bronze;
            
            // İlerleme bilgilerini güncelle
            document.getElementById('badgesModalStars').textContent = starPoints;
            document.getElementById('badgesModalLevel').textContent = level;
            document.getElementById('badgesModalPoints').textContent = totalPoints.toLocaleString();
            
            // Modal'ı göster
            document.getElementById('badgesModal').style.display = 'flex';
        }

        function closeBadgesModal() {
            document.getElementById('badgesModal').style.display = 'none';
        }

        // ============ İSTATİSTİKLER SİSTEMİ ============
        function showStatsModal() {
            // Genel istatistikleri güncelle
            document.getElementById('statsLevel').textContent = level;
            document.getElementById('statsPoints').textContent = totalPoints.toLocaleString();
            document.getElementById('statsStars').textContent = starPoints;
            
            // Seviye ilerleme barını hesapla
            let currentLevelStart, nextLevelStart;
            const nextLevel = level + 1;
            
            if (level === 1) {
                currentLevelStart = 0;
                nextLevelStart = 1000;
            } else if (level <= 10) {
                const thresholds = [0, 1000, 2500, 5000, 8500, 13000, 19000, 26500, 35500, 46000, 58000];
                currentLevelStart = thresholds[level - 1];
                nextLevelStart = thresholds[level] || (58000 + ((level - 10) * 15000));
            } else {
                // Level 10'dan sonra
                currentLevelStart = 58000 + ((level - 11) * 15000);
                nextLevelStart = 58000 + ((level - 10) * 15000);
            }
            
            const currentLevelPoints = totalPoints - currentLevelStart;
            const levelRequiredPoints = nextLevelStart - currentLevelStart;
            const progressPercentage = Math.max(0, Math.min((currentLevelPoints / levelRequiredPoints) * 100, 100));
            const pointsNeeded = Math.max(0, nextLevelStart - totalPoints);
            
            document.getElementById('statsCurrentLevel').textContent = level;
            document.getElementById('statsNextLevel').textContent = nextLevel;
            document.getElementById('statsLevelProgress').style.width = progressPercentage + '%';
            document.getElementById('statsLevelPointsNeeded').textContent = pointsNeeded.toLocaleString();
            
            // Rozet sayılarını güncelle
            document.getElementById('statsBronze').textContent = badges.bronze;
            document.getElementById('statsSilver').textContent = badges.silver;
            document.getElementById('statsGold').textContent = badges.gold;
            document.getElementById('statsDiamond').textContent = badges.diamond;
            
            // Başarı analizi hesapla
            const totalGameActions = dailyTasks.todayStats.kelimeCevir + dailyTasks.todayStats.dinleBul + 
                                   dailyTasks.todayStats.boslukDoldur + dailyTasks.todayStats.ayetOku + 
                                   dailyTasks.todayStats.duaOgre + dailyTasks.todayStats.hadisOku;
            
            const successRate = totalGameActions > 0 ? Math.round((dailyTasks.todayStats.toplamDogru / totalGameActions) * 100) : 0;
            const avgPointsPerDay = streakData.totalPlayDays > 0 ? Math.round(totalPoints / streakData.totalPlayDays) : totalPoints;
            const playConsistency = Math.round((streakData.totalPlayDays / Math.max(1, getDaysFromFirstPlay())) * 100);
            const levelProgressPercent = Math.round(progressPercentage);
            
            document.getElementById('statsSuccessRate').textContent = successRate + '%';
            document.getElementById('statsAvgPointsPerDay').textContent = avgPointsPerDay.toLocaleString();
            document.getElementById('statsPlayConsistency').textContent = Math.min(100, playConsistency) + '%';
            document.getElementById('statsLevelProgress').textContent = levelProgressPercent + '%';
            
            // Streak bilgilerini güncelle
            document.getElementById('statsCurrentStreak').textContent = streakData.currentStreak;
            document.getElementById('statsBestStreak').textContent = streakData.bestStreak;
            document.getElementById('statsTotalDays').textContent = streakData.totalPlayDays;
            document.getElementById('statsTodayProgress').textContent = Math.min(streakData.todayProgress, streakData.dailyGoal) + '/' + streakData.dailyGoal;
            
            // Bugünkü oyun türü istatistikleri
            document.getElementById('statsKelimeCevir').textContent = dailyTasks.todayStats.kelimeCevir;
            document.getElementById('statsDinleBul').textContent = dailyTasks.todayStats.dinleBul;
            document.getElementById('statsBoslukDoldur').textContent = dailyTasks.todayStats.boslukDoldur;
            document.getElementById('statsAyetOku').textContent = dailyTasks.todayStats.ayetOku;
            document.getElementById('statsDuaOgre').textContent = dailyTasks.todayStats.duaOgre;
            document.getElementById('statsHadisOku').textContent = dailyTasks.todayStats.hadisOku;
            
            // Bugünkü performans
            document.getElementById('statsTodayCorrect').textContent = dailyTasks.todayStats.toplamDogru;
            document.getElementById('statsTodayPoints').textContent = dailyTasks.todayStats.toplamPuan;
            document.getElementById('statsPerfectStreak').textContent = dailyTasks.todayStats.perfectStreak;
            document.getElementById('statsDifficultyCount').textContent = dailyTasks.todayStats.farklıZorluk.size;
            
            // Modal'ı göster
            document.getElementById('statsModal').style.display = 'flex';
            
            console.log('📊 İstatistikler modalı açıldı');
        }

        function getDaysFromFirstPlay() {
            if (streakData.playDates.length === 0) return 1;
            
            const firstPlayDate = new Date(streakData.playDates[0]);
            const today = new Date();
            const diffTime = Math.abs(today - firstPlayDate);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            return Math.max(1, diffDays);
        }
        
        function closeStatsModal() {
            document.getElementById('statsModal').style.display = 'none';
        }
        
        function confirmResetStats() {
            const confirmed = confirm('🚨 DİKKAT!\n\nTüm oyun verilerini sıfırlamak istediğinden emin misin?\n\n• Tüm puanlar (0\'a döner)\n• Tüm rozetler (silinir)\n• Tüm streak verileri (sıfırlanır)\n• Tüm günlük görevler (yenilenir)\n• Tüm istatistikler (temizlenir)\n\nBu işlem GERİ ALINMAZ!\n\nDevam etmek istiyor musun?');
            
            if (confirmed) {
                // İkinci onay
                const doubleConfirmed = confirm('🔥 SON UYARI!\n\nGerçekten TÜM VERİLERİ sıfırlamak istiyor musun?\n\nBu işlemden sonra oyuna sıfırdan başlayacaksın!\n\n✅ EVET = Sıfırla\n❌ HAYIR = İptal et');
                
                if (doubleConfirmed) {
                    closeStatsModal(); // Modal'ı kapat
                    resetAllStats(); // Mevcut fonksiyonu kullan
                }
            }
        }

        // Global fonksiyonlar (window'a ekle)
        window.showStatsModal = showStatsModal;
        window.closeStatsModal = closeStatsModal;
        window.confirmResetStats = confirmResetStats;

        // ============ TAKVİM SİSTEMİ ============
        function checkDailyProgress() {
            const today = new Date().toISOString().split('T')[0]; // YYYY-MM-DD
            
            // Eğer bugün ilk defa açılıyorsa
            if (streakData.todayDate !== today) {
                // Önceki gün kontrolü
                const yesterday = new Date();
                yesterday.setDate(yesterday.getDate() - 1);
                const yesterdayStr = yesterday.toISOString().split('T')[0];
                
                // Streak kontrolü
                if (streakData.lastPlayDate === yesterdayStr) {
                    // Dün oynadı, streak devam ediyor
                    streakData.currentStreak++;
                } else if (streakData.lastPlayDate !== today) {
                    // Streak kırıldı
                    streakData.currentStreak = 0;
                }
                
                // Bugünün verilerini sıfırla
                streakData.todayDate = today;
                streakData.todayProgress = 0;
            }
        }

        function updateDailyProgress(correctAnswers) {
            const today = new Date().toISOString().split('T')[0];
            
            // Günlük ilerleme güncelle
            streakData.todayProgress += correctAnswers;
            
            // Takvim açıksa bugünkü hedefi gerçek zamanlı güncelle
            const todayProgressElement = document.getElementById('todayProgress');
            const todayProgressIconElement = document.getElementById('todayProgressIcon');
            
            if (todayProgressElement) {
                const currentProgress = Math.min(streakData.todayProgress, streakData.dailyGoal);
                todayProgressElement.textContent = currentProgress;
                
                // İlerlemeye göre dinamik emoji
                if (todayProgressIconElement) {
                    if (currentProgress >= 5) {
                        todayProgressIconElement.textContent = '✅'; // Tamamlandı
                    } else if (currentProgress >= 3) {
                        todayProgressIconElement.textContent = '🔥'; // İyi gidiyor  
                    } else if (currentProgress >= 1) {
                        todayProgressIconElement.textContent = '💪'; // Başlamış
                    } else {
                        todayProgressIconElement.textContent = '⏳'; // Henüz başlamamış
                    }
                }
            }
            
            // Günlük hedef tamamlandı mı?
            if (streakData.todayProgress >= streakData.dailyGoal && streakData.lastPlayDate !== today) {
                // İlk defa bugün hedefi tamamladı
                streakData.lastPlayDate = today;
                streakData.totalPlayDays++;
                
                // Oyun tarihi listesine ekle
                if (!streakData.playDates.includes(today)) {
                    streakData.playDates.push(today);
                    streakData.playDates.sort();
                }
                
                // Streak güncelle
                streakData.currentStreak = Math.max(streakData.currentStreak, 1);
                if (streakData.currentStreak > streakData.bestStreak) {
                    streakData.bestStreak = streakData.currentStreak;
                }
                
                // Veriyi kaydet
                saveStats();
                
                // Eğer takvim açıksa otomatik yenile (mavi -> yeşil)
                const calendarModal = document.getElementById('calendarModal');
                if (calendarModal && calendarModal.style.display === 'flex') {
                    generateCalendar();
                }
            }
        }

        function showCalendarModal() {
            // Streak bilgilerini güncelle
            document.getElementById('currentStreak').textContent = streakData.currentStreak;
            document.getElementById('totalPlayDays').textContent = streakData.totalPlayDays;
            document.getElementById('bestStreak').textContent = streakData.bestStreak;
            
            const currentProgress = Math.min(streakData.todayProgress, streakData.dailyGoal);
            document.getElementById('todayProgress').textContent = currentProgress;
            
            // İlerlemeye göre dinamik emoji
            const todayProgressIconElement = document.getElementById('todayProgressIcon');
            if (todayProgressIconElement) {
                if (currentProgress >= 5) {
                    todayProgressIconElement.textContent = '✅'; // Tamamlandı
                } else if (currentProgress >= 3) {
                    todayProgressIconElement.textContent = '🔥'; // İyi gidiyor  
                } else if (currentProgress >= 1) {
                    todayProgressIconElement.textContent = '💪'; // Başlamış
                } else {
                    todayProgressIconElement.textContent = '⏳'; // Henüz başlamamış
                }
            }
            
            // Takvimi oluştur
            generateCalendar();
            
            // Modal'ı göster
            document.getElementById('calendarModal').style.display = 'flex';
        }

        function closeCalendarModal() {
            document.getElementById('calendarModal').style.display = 'none';
        }

        function generateCalendar() {
            const today = new Date();
            const year = today.getFullYear();
            const month = today.getMonth();
            const todayDate = today.getDate();
            
            // Ay adını güncelle
            const monthNames = [
                'Ocak', 'Şubat', 'Mart', 'Nisan', 'Mayıs', 'Haziran',
                'Temmuz', 'Ağustos', 'Eylül', 'Ekim', 'Kasım', 'Aralık'
            ];
            document.getElementById('calendarMonth').textContent = `${monthNames[month]} ${year}`;
            
            // Takvim grid'ini temizle ve yeni HTML oluştur (çok daha hızlı)
            const grid = document.getElementById('calendarGrid');
            
            // HTML string olarak oluştur (DOM manipulation'dan çok daha hızlı)
            let html = '';
            
            // Haftanın günlerini ekle (daha kısa isimler + küçük font)
            const dayNames = ['Pz', 'Pt', 'Sl', 'Çr', 'Pr', 'Cm', 'Ct'];
            dayNames.forEach(day => {
                html += `<div style="font-weight: 600; font-size: 0.65em; color: #666; padding: 3px;">${day}</div>`;
            });
            
            // Ayın ilk gününün haftanın hangi günü olduğunu bul
            const firstDay = new Date(year, month, 1);
            const startingDayOfWeek = (firstDay.getDay() + 6) % 7; // Pazartesi = 0
            
            // Boş günler ekle
            for (let i = 0; i < startingDayOfWeek; i++) {
                html += '<div></div>';
            }
            
            // playDates array'ini Set'e çevir (çok daha hızlı arama)
            const playDatesSet = new Set(streakData.playDates);
            
            // Ayın günlerini ekle
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            for (let day = 1; day <= daysInMonth; day++) {
                const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                
                let style = 'padding: 6px 3px; border-radius: 50%; cursor: pointer; font-size: 0.75em; min-height: 28px; display: flex; align-items: center; justify-content: center;';
                
                // Bugün ise vurgula
                if (day === todayDate) {
                    style += ' background: #2196f3; color: white; font-weight: bold;';
                }
                // Oyun oynandıysa yeşil
                else if (playDatesSet.has(dateStr)) {
                    style += ' background: #4caf50; color: white;';
                }
                // Geçmiş günlerse gri
                else if (day < todayDate) {
                    style += ' color: #ccc;';
                }
                
                html += `<div style="${style}">${day}</div>`;
            }
            
            // Tek seferde HTML'i set et (çok hızlı)
            grid.innerHTML = html;
        }

        // Global fonksiyonlar (window'a ekle ki HTML onclick çalışsın)
        window.showCalendarModal = showCalendarModal;
        window.closeCalendarModal = closeCalendarModal;

        // ============ GÜNLİK GÖREVLER SİSTEMİ ============
        function checkDailyTasks() {
            const today = new Date().toISOString().split('T')[0];
            
            console.log('🔍 Günlük görev kontrolü:', {
                bugün: today,
                sonGörevTarihi: dailyTasks.lastTaskDate,
                yeniGünMü: dailyTasks.lastTaskDate !== today,
                mevcutTamamlananlar: dailyTasks.completedTasks.length,
                bugünküStats: dailyTasks.todayStats
            });
            
            // Eğer yeni gün başladıysa görevleri yenile
            if (dailyTasks.lastTaskDate !== today) {
                console.log('🔄 Yeni gün başladı, görevler yenileniyor...');
                generateDailyTasks(today);
            } else {
                console.log('✅ Aynı gün, mevcut görevler korunuyor');
            }
        }

        function generateDailyTasks(date) {
            // Temel görevler listesi
            const baseTasks = [
                { id: 'kelime5', name: '5 kelime çevir', target: 5, current: 0, type: 'kelimeCevir', reward: 1 },
                { id: 'ayet3', name: '3 ayet oku', target: 3, current: 0, type: 'ayetOku', reward: 1 },
                { id: 'dua2', name: '2 dua öğren', target: 2, current: 0, type: 'duaOgre', reward: 1 },
                { id: 'hadis1', name: '1 hadis oku', target: 1, current: 0, type: 'hadisOku', reward: 1 },
                { id: 'dogru10', name: '10 doğru cevap ver', target: 10, current: 0, type: 'toplamDogru', reward: 1 },
                { id: 'puan100', name: '100 puan topla', target: 100, current: 0, type: 'toplamPuan', reward: 1 }
            ];

            // Bonus görevler listesi
            const bonusTasksList = [
                { id: 'perfect5', name: 'Hiç yanlış yapmadan 5 soru çöz', target: 5, current: 0, type: 'perfectStreak', reward: 2 },
                { id: 'allDiff', name: '3 farklı zorlukta oyna', target: 3, current: 0, type: 'farklıZorluk', reward: 2 },
                { id: 'combo15', name: '15 doğru cevap ver (bonus)', target: 15, current: 0, type: 'toplamDogru', reward: 2 },
                { id: 'dinle3', name: '3 kelime dinle', target: 3, current: 0, type: 'dinleBul', reward: 2 },
                { id: 'bosluk2', name: '2 boşluk doldur', target: 2, current: 0, type: 'boslukDoldur', reward: 2 }
            ];

            // Rastgele 2 bonus görev seç
            const selectedBonus = bonusTasksList.sort(() => 0.5 - Math.random()).slice(0, 2);

            dailyTasks.lastTaskDate = date;
            dailyTasks.tasks = baseTasks;
            dailyTasks.bonusTasks = selectedBonus;
            dailyTasks.completedTasks = [];
            dailyTasks.rewardsClaimed = false;
            dailyTasks.todayStats = {
                kelimeCevir: 0,
                dinleBul: 0,
                boslukDoldur: 0,
                ayetOku: 0,
                duaOgre: 0,
                hadisOku: 0,
                toplamDogru: 0,
                toplamPuan: 0,
                perfectStreak: 0,
                farklıZorluk: new Set()
            };

            console.log('🎯 Yeni günlük görevler oluşturuldu:', {
                tarih: date,
                temelGörevler: baseTasks.length,
                bonusGörevler: selectedBonus.length,
                tamamlananlar: dailyTasks.completedTasks.length,
                stats: dailyTasks.todayStats
            });

            saveStats();
        }

        function updateTaskProgress(gameType, amount = 1) {
            console.log(`📋 updateTaskProgress çağrıldı: ${gameType} +${amount}`);
            
            // Oyun tipine göre istatistiği güncelle
            if (dailyTasks.todayStats[gameType] !== undefined) {
                const eskiDeger = dailyTasks.todayStats[gameType];
                dailyTasks.todayStats[gameType] += amount;
                console.log(`📊 ${gameType}: ${eskiDeger} → ${dailyTasks.todayStats[gameType]}`);
            }

            // Zorluk takibi
            if (currentDifficulty) {
                dailyTasks.todayStats.farklıZorluk.add(currentDifficulty);
                console.log(`🎯 Zorluk eklendi: ${currentDifficulty}, toplam: ${dailyTasks.todayStats.farklıZorluk.size}`);
            }

            // Görevleri kontrol et ve güncelle
            const allTasks = [...dailyTasks.tasks, ...dailyTasks.bonusTasks];
            
            allTasks.forEach(task => {
                const eskiCurrent = task.current;
                if (task.type === gameType) {
                    task.current = Math.min(task.target, dailyTasks.todayStats[gameType]);
                } else if (task.type === 'farklıZorluk') {
                    task.current = dailyTasks.todayStats.farklıZorluk.size;
                }

                // Görev tamamlandı mı?
                if (task.current >= task.target && !dailyTasks.completedTasks.includes(task.id)) {
                    dailyTasks.completedTasks.push(task.id);
                    console.log(`✅ Görev tamamlandı: ${task.id} (${task.name})`);
                }
                
                if (eskiCurrent !== task.current) {
                    console.log(`🎯 Görev ilerleme: ${task.id} ${eskiCurrent}/${task.target} → ${task.current}/${task.target}`);
                }
            });

            console.log(`📋 Toplam tamamlanan görev: ${dailyTasks.completedTasks.length}`);
            saveStats();
        }

        function showDailyTasksModal() {
            // Günlük görevleri kontrol et ve güncelle
            checkDailyTasks();
            
            // Debug: Görev durumunu logla
            console.log('📋 Daily Tasks Debug:', {
                tasks: dailyTasks.tasks.length,
                bonusTasks: dailyTasks.bonusTasks.length,
                completed: dailyTasks.completedTasks.length,
                lastDate: dailyTasks.lastTaskDate,
                today: new Date().toISOString().split('T')[0]
            });
            
            // Görev verilerini güncelle
            updateTasksDisplay();
            
            // Modal'ı göster
            document.getElementById('dailyTasksModal').style.display = 'flex';
        }

        function closeDailyTasksModal() {
            document.getElementById('dailyTasksModal').style.display = 'none';
        }

        function updateTasksDisplay() {
            // Güvenlik kontrolü: Eğer görevler boşsa, yeniden oluştur
            if (!dailyTasks.tasks || dailyTasks.tasks.length === 0) {
                console.log('⚠️ Tasks boş, yeniden oluşturuluyor...');
                generateDailyTasks(new Date().toISOString().split('T')[0]);
            }
            
            const completedCount = dailyTasks.completedTasks.length;
            const totalCount = dailyTasks.tasks.length + dailyTasks.bonusTasks.length;
            
            console.log('📊 updateTasksDisplay:', { completedCount, totalCount });
            
            // Genel ilerleme
            document.getElementById('completedTasks').textContent = completedCount;
            document.getElementById('totalTasks').textContent = totalCount;
            
            const progressPercent = (completedCount / totalCount) * 100;
            document.getElementById('taskProgress').style.width = progressPercent + '%';

            // Temel görevleri göster
            const dailyList = document.getElementById('dailyTasksList');
            dailyList.innerHTML = '';
            
            dailyTasks.tasks.forEach(task => {
                const taskElement = createTaskElement(task);
                dailyList.appendChild(taskElement);
            });

            // Bonus görevleri göster
            const bonusList = document.getElementById('bonusTasksList');
            bonusList.innerHTML = '';
            
            dailyTasks.bonusTasks.forEach(task => {
                const taskElement = createTaskElement(task);
                bonusList.appendChild(taskElement);
            });

            // Ödül bölümü
            const rewardsSection = document.getElementById('rewardsSection');
            if (completedCount === totalCount && !dailyTasks.rewardsClaimed) {
                rewardsSection.style.display = 'block';
            } else {
                rewardsSection.style.display = 'none';
            }
        }

        function createTaskElement(task) {
            const isCompleted = dailyTasks.completedTasks.includes(task.id);
            const progressPercent = (task.current / task.target) * 100;
            
            const div = document.createElement('div');
            div.style.cssText = `
                padding: 10px; 
                border: 2px solid ${isCompleted ? '#4caf50' : '#e0e0e0'}; 
                border-radius: 6px; 
                margin: 6px 0;
                background: ${isCompleted ? '#f1f8e9' : 'white'};
            `;
            
            div.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px;">
                    <span style="font-weight: 600; font-size: 0.85em; color: ${isCompleted ? '#2e7d2e' : '#333'};">
                        ${isCompleted ? '✅' : '⏳'} ${getTaskDisplayName(task)}
                    </span>
                    <span style="font-size: 0.75em; color: #666;">+${task.reward} ⭐</span>
                </div>
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div style="flex: 1; background: #f0f0f0; border-radius: 8px; height: 5px; margin-right: 8px;">
                        <div style="background: ${isCompleted ? '#4caf50' : '#2196f3'}; height: 100%; border-radius: 8px; width: ${progressPercent}%; transition: width 0.3s;"></div>
                    </div>
                    <span style="font-size: 0.7em; color: #666; font-weight: 500;">${task.current}/${task.target}</span>
                </div>
            `;
            
            return div;
        }

        function getTaskDisplayName(task) {
            // Görev tipine göre uygun isim döndür
            const taskNames = {
                'kelime5': 'Kelime Çevir',
                'ayet3': 'Ayet Oku', 
                'dua2': 'Dua Öğren',
                'dogru10': 'Doğru Cevaplar',
                'puan100': 'Puan Topla',
                'perfect5': 'Mükemmel Seri',
                'allDiff': 'Farklı Zorluklar',
                'hadis1': 'Hadis Oku',
                'dinle3': 'Dinle & Bul',
                'bosluk2': 'Boşluk Doldur'
            };
            
            return taskNames[task.id] || task.name;
        }

        function claimDailyRewards() {
            const completedCount = dailyTasks.completedTasks.length;
            const totalCount = dailyTasks.tasks.length + dailyTasks.bonusTasks.length;
            
            if (completedCount === totalCount && !dailyTasks.rewardsClaimed) {
                // 5 yıldız bonus ver
                const bonusPoints = 5 * 500; // 5 yıldız = 2500 puan
                totalPoints += bonusPoints;
                
                dailyTasks.rewardsClaimed = true;
                saveStats();
                updateStatsBar();
                
                // Ödül modalı göster
                alert('🎉 Tebrikler! 5 yıldız bonus kazandın!');
                
                updateTasksDisplay();
            }
        }

        // Ödül butonu event listener
        document.addEventListener('DOMContentLoaded', () => {
            const claimBtn = document.getElementById('claimRewardsBtn');
            if (claimBtn) {
                claimBtn.addEventListener('click', claimDailyRewards);
            }
        });

        // Global fonksiyonlar
        window.showDailyTasksModal = showDailyTasksModal;
        window.closeDailyTasksModal = closeDailyTasksModal;
        window.claimDailyRewards = claimDailyRewards;

        // GLOBAL PUAN FONKSİYONU (Oyun bitince çağrılır)
        function addToGlobalPoints(points, correctAnswers = 0) {
            const oldLevel = calculateLevel(totalPoints);
            totalPoints += points;
            const newLevel = calculateLevel(totalPoints);
            
            // Seviye atlama kontrolü
            if (newLevel > oldLevel) {
                level = newLevel;
                showLevelUpModal(newLevel);
            }
            
            // Günlük ilerlemeyi güncelle
            if (correctAnswers > 0) {
                updateDailyProgress(correctAnswers);
                
                // Günlük görevleri güncelle
                updateTaskProgress('toplamDogru', correctAnswers);
                updateTaskProgress('toplamPuan', points);
            }
            
            updateStatsBar(); // Global barı güncelle
        }
        
        // ============ ZORLUK UI GÜNCELLEYICI ============
        function updateDifficultyUI() {
            // Kaydedilen zorluk seviyesine göre UI'yı ayarla
            console.log(`🎯 Zorluk UI güncelleniyor: ${currentDifficulty}`);
            
            // Tüm butonları başlangıç durumuna getir
            document.getElementById('mainDiffKolay').style.cssText = 'flex: 1; min-width: 90px; max-width: 120px; margin: 0; padding: 10px; font-size: 0.85em; background: white; color: #4CAF50; border: 2px solid #4CAF50;';
            document.getElementById('mainDiffOrta').style.cssText = 'flex: 1; min-width: 90px; max-width: 120px; margin: 0; padding: 10px; font-size: 0.85em; background: white; color: #FF9800; border: 2px solid #FF9800;';
            document.getElementById('mainDiffZor').style.cssText = 'flex: 1; min-width: 90px; max-width: 120px; margin: 0; padding: 10px; font-size: 0.85em; background: white; color: #f44336; border: 2px solid #f44336;';
            
            // Active class'ları temizle
            document.querySelectorAll('#mainMenu .diff-btn').forEach(btn => btn.classList.remove('active'));
            
            // Seçili zorluk seviyesini vurgula
            if (currentDifficulty === 'kolay') {
                document.getElementById('mainDiffKolay').style.cssText = 'flex: 1; min-width: 90px; max-width: 120px; margin: 0; padding: 10px; font-size: 0.85em; background: #4CAF50; color: white; border: 2px solid #4CAF50;';
                document.getElementById('mainDiffKolay').classList.add('active');
            } else if (currentDifficulty === 'orta') {
                document.getElementById('mainDiffOrta').style.cssText = 'flex: 1; min-width: 90px; max-width: 120px; margin: 0; padding: 10px; font-size: 0.85em; background: #FF9800; color: white; border: 2px solid #FF9800;';
                document.getElementById('mainDiffOrta').classList.add('active');
            } else if (currentDifficulty === 'zor') {
                document.getElementById('mainDiffZor').style.cssText = 'flex: 1; min-width: 90px; max-width: 120px; margin: 0; padding: 10px; font-size: 0.85em; background: #f44336; color: white; border: 2px solid #f44336;';
                document.getElementById('mainDiffZor').classList.add('active');
            }
        }

        // ============ ANA MENÜ ZORLUK BUTONLARI ============
        function initMainMenuDifficultyButtons() {
            // console.log('🔧 initMainMenuDifficultyButtons çağrıldı');
            
            // Kaydedilen zorluk seviyesini UI'da göster
            updateDifficultyUI();
            
            document.getElementById('mainDiffKolay').onclick = () => {
                console.log('🎯 Zorluk seçildi: KOLAY');
                currentDifficulty = 'kolay';
                saveStats(); // Zorluk değiştiğinde kaydet!
                // Kolay yeşil seçili, diğerleri kendi border renkleri ile beyaz
                document.getElementById('mainDiffKolay').style.cssText = 'flex: 1; min-width: 90px; max-width: 120px; margin: 0; padding: 10px; font-size: 0.85em; background: #4CAF50; color: white; border: 2px solid #4CAF50;';
                document.getElementById('mainDiffOrta').style.cssText = 'flex: 1; min-width: 90px; max-width: 120px; margin: 0; padding: 10px; font-size: 0.85em; background: white; color: #FF9800; border: 2px solid #FF9800;';
                document.getElementById('mainDiffZor').style.cssText = 'flex: 1; min-width: 90px; max-width: 120px; margin: 0; padding: 10px; font-size: 0.85em; background: white; color: #f44336; border: 2px solid #f44336;';
                // Active class'ları güncelle
                document.querySelectorAll('#mainMenu .diff-btn').forEach(btn => btn.classList.remove('active'));
                document.getElementById('mainDiffKolay').classList.add('active');
            };
            
            document.getElementById('mainDiffOrta').onclick = () => {
                console.log('🎯 Zorluk seçildi: ORTA');
                currentDifficulty = 'orta';
                saveStats(); // Zorluk değiştiğinde kaydet!
                // Orta turuncu seçili, diğerleri kendi border renkleri ile beyaz
                document.getElementById('mainDiffKolay').style.cssText = 'flex: 1; min-width: 90px; max-width: 120px; margin: 0; padding: 10px; font-size: 0.85em; background: white; color: #4CAF50; border: 2px solid #4CAF50;';
                document.getElementById('mainDiffOrta').style.cssText = 'flex: 1; min-width: 90px; max-width: 120px; margin: 0; padding: 10px; font-size: 0.85em; background: #FF9800; color: white; border: 2px solid #FF9800;';
                document.getElementById('mainDiffZor').style.cssText = 'flex: 1; min-width: 90px; max-width: 120px; margin: 0; padding: 10px; font-size: 0.85em; background: white; color: #f44336; border: 2px solid #f44336;';
                // Active class'ları güncelle
                document.querySelectorAll('#mainMenu .diff-btn').forEach(btn => btn.classList.remove('active'));
                document.getElementById('mainDiffOrta').classList.add('active');
            };
            
            document.getElementById('mainDiffZor').onclick = () => {
                console.log('🎯 Zorluk seçildi: ZOR');
                currentDifficulty = 'zor';
                saveStats(); // Zorluk değiştiğinde kaydet!
                // Zor kırmızı seçili, diğerleri kendi border renkleri ile beyaz
                document.getElementById('mainDiffKolay').style.cssText = 'flex: 1; min-width: 90px; max-width: 120px; margin: 0; padding: 10px; font-size: 0.85em; background: white; color: #4CAF50; border: 2px solid #4CAF50;';
                document.getElementById('mainDiffOrta').style.cssText = 'flex: 1; min-width: 90px; max-width: 120px; margin: 0; padding: 10px; font-size: 0.85em; background: white; color: #FF9800; border: 2px solid #FF9800;';
                document.getElementById('mainDiffZor').style.cssText = 'flex: 1; min-width: 90px; max-width: 120px; margin: 0; padding: 10px; font-size: 0.85em; background: #f44336; color: white; border: 2px solid #f44336;';
                // Active class'ları güncelle
                document.querySelectorAll('#mainMenu .diff-btn').forEach(btn => btn.classList.remove('active'));
                document.getElementById('mainDiffZor').classList.add('active');
            };
        }

        // ============ ANA MENÜ NAVİGASYONU ============
        // Kelime Çevir modu - oyun modları seçici ile başlar
        elements.kelimeCevirBtn.onclick = () => {
            console.log('📚 === KELİME ÇEVİR OYUNU BAŞLATILIYOR ===');
            console.log('📋 1. Veri kontrol ediliyor...');
            
            if (kelimeBulData.length === 0) {
                console.log('❌ Kelime verileri yüklenemedi!');
                alert('Kelime verileri yüklenemedi!');
                return;
            }
            console.log(`✅ Kelime verileri OK: ${kelimeBulData.length} kelime mevcut`);
            console.log(`🎯 Mevcut zorluk: ${currentDifficulty}`);
            
            console.log('📋 2. Mode Selector açılıyor...');
            elements.mainMenu.style.display = 'none';
            elements.modeSelector.style.display = 'block';
            elements.settingsBtn.style.display = 'block';
            console.log('✅ Mode Selector açıldı!');
        };

        // Dinle ve Bul modu - Doğrudan başlat
        elements.dinleBulBtn.onclick = () => {
            console.log('🔥 === DINLE VE BUL OYUNU BAŞLATILIYOR ===');
            console.log('📋 1. Veri kontrol ediliyor...');
            
            if (kelimeBulData.length === 0) {
                console.log('❌ Kelime verileri yüklenemedi!');
                alert('Kelime verileri yüklenemedi!');
                return;
            }
            console.log(`✅ Kelime verileri OK: ${kelimeBulData.length} kelime mevcut`);
            
            console.log('📋 2. Zorluk seviyesi kontrol ediliyor...');
            console.log(`🎯 Mevcut zorluk: ${currentDifficulty}`);
            console.log(`🎯 Zorluk config:`, CONFIG.difficultyLevels[currentDifficulty]);
            
            console.log('📋 3. UI değiştiriliyor...');
            elements.mainMenu.style.display = 'none';
            elements.dinleMode.style.display = 'block';
            console.log('✅ UI değişikliği tamamlandı');
            
            console.log('📋 4. Oyun değişkenleri sıfırlanıyor...');
            console.log(`🔄 Önceki değerler: score=${dinleScore}, correct=${dinleCorrect}, wrong=${dinleWrong}, questionCount=${dinleQuestionCount}`);
            // Dinle modunu başlat
            dinleScore = 0;
            dinleCorrect = 0;
            dinleWrong = 0;
            dinleQuestionCount = 0;
            console.log(`✅ Yeni değerler: score=${dinleScore}, correct=${dinleCorrect}, wrong=${dinleWrong}, questionCount=${dinleQuestionCount}`);
            console.log(`📊 Session değerler: sessionScore=${sessionScore}, sessionCorrect=${sessionCorrect}, sessionWrong=${sessionWrong}`);
            
            updateDinleUI();
            loadDinleQuestion();
        };

        // Boşluk Doldur modu
        elements.boslukDoldurBtn.onclick = () => {
            console.log('📋 === BOŞLUK DOLDUR OYUNU BAŞLATILIYOR ===');
            console.log('📋 1. Veri kontrol ediliyor...');
            
            if (ayetOkuData.length === 0) {
                console.log('❌ Ayet verileri yüklenemedi!');
                alert('Ayet verileri yüklenemedi!');
                return;
            }
            console.log(`✅ Ayet verileri OK: ${ayetOkuData.length} ayet mevcut`);
            console.log(`🎯 Mevcut zorluk: ${currentDifficulty}`);
            
            console.log('📋 2. UI değiştiriliyor...');
            elements.mainMenu.style.display = 'none';
            elements.boslukMode.style.display = 'block';
            console.log('✅ UI değişikliği tamamlandı');
            
            console.log('📋 3. Oyun değişkenleri sıfırlanıyor...');
            console.log(`🔄 Önceki değerler: score=${boslukScore}, correct=${boslukCorrect}, wrong=${boslukWrong}`);
            // Boşluk modunu başlat
            boslukScore = 0;
            boslukCorrect = 0;
            boslukWrong = 0;
            console.log(`✅ Yeni değerler: score=${boslukScore}, correct=${boslukCorrect}, wrong=${boslukWrong}`);
            console.log(`📊 Session değerler: sessionScore=${sessionScore}, sessionCorrect=${sessionCorrect}, sessionWrong=${sessionWrong}`);
            
            updateBoslukUI();
            loadBoslukQuestion();
        };

        // Dua Et modu
        elements.duaEtBtn.onclick = () => {
            if (duaData.length === 0) {
                alert('Dua verileri yüklenemedi!');
                return;
            }
            elements.mainMenu.style.display = 'none';
            elements.duaMode.style.display = 'block';
            // Rastgele dua ile başla
            currentDuaIndex = Math.floor(Math.random() * duaData.length);
            showDua();
        };

        // Ayet Oku modu
        elements.ayetOkuBtn.onclick = () => {
            if (ayetOkuData.length === 0) {
                alert('Ayet verileri yüklenemedi!');
                return;
            }
            elements.mainMenu.style.display = 'none';
            elements.ayetMode.style.display = 'block';
            // Rastgele ayet ile başla
            currentAyetIndex = Math.floor(Math.random() * ayetOkuData.length);
            showAyet();
        };

        // Hadis Oku modu
        elements.hadisOkuBtn.onclick = () => {
            if (hadisData.length === 0) {
                alert('Hadis verileri yüklenemedi!');
                return;
            }
            elements.mainMenu.style.display = 'none';
            elements.hadisMode.style.display = 'block';
            // Rastgele hadis ile başla
            currentHadisIndex = Math.floor(Math.random() * hadisData.length);
            showHadis();
        };

        // Geri butonları
        elements.backToMenuBtn.onclick = () => {
            elements.modeSelector.style.display = 'none';
            elements.mainMenu.style.display = 'block';
            elements.settingsBtn.style.display = 'none';
        };

        elements.backFromGameBtn.onclick = () => {
            stopTimer();
            if (elements.gameScreen) elements.gameScreen.style.display = 'none';
            if (elements.modeSelector) elements.modeSelector.style.display = 'none';
            if (elements.mainMenu) {
                elements.mainMenu.removeAttribute('style');
                elements.mainMenu.style.display = 'block';
            }
            if (elements.settingsBtn) elements.settingsBtn.style.display = 'none';
        };

        elements.backFromAyetBtn.onclick = () => {
            elements.ayetMode.style.display = 'none';
            elements.modeSelector.style.display = 'none';
            elements.gameScreen.style.display = 'none';
            elements.mainMenu.removeAttribute('style');
            elements.mainMenu.style.display = 'block';
            elements.settingsBtn.style.display = 'none';
        };

        elements.backFromDuaBtn.onclick = () => {
            elements.duaMode.style.display = 'none';
            elements.modeSelector.style.display = 'none';
            elements.gameScreen.style.display = 'none';
            elements.mainMenu.removeAttribute('style');
            elements.mainMenu.style.display = 'block';
            elements.settingsBtn.style.display = 'none';
        };

        elements.backFromHadisBtn.onclick = () => {
            elements.hadisMode.style.display = 'none';
            elements.modeSelector.style.display = 'none';
            elements.gameScreen.style.display = 'none';
            elements.mainMenu.removeAttribute('style');
            elements.mainMenu.style.display = 'block';
            elements.settingsBtn.style.display = 'none';
        };

        elements.backFromBoslukBtn.onclick = () => {
            elements.boslukMode.style.display = 'none';
            elements.modeSelector.style.display = 'none';
            elements.gameScreen.style.display = 'none';
            elements.mainMenu.removeAttribute('style');
            elements.mainMenu.style.display = 'block';
            elements.settingsBtn.style.display = 'none';
        };

        elements.backFromDinleBtn.onclick = () => {
            elements.dinleMode.style.display = 'none';
            elements.modeSelector.style.display = 'none';
            elements.gameScreen.style.display = 'none';
            elements.mainMenu.removeAttribute('style');
            elements.mainMenu.style.display = 'block';
            elements.settingsBtn.style.display = 'none';
        };

        // ============ MOD SEÇİCİYİ BAŞLAT (Sadece Kelime Çevir için) ============
        function initModeSelector() {
            // Sadece Kelime Çevir oyun modlarını oluştur
            Object.keys(CONFIG.gameModes).forEach(modeKey => {
                const mode = CONFIG.gameModes[modeKey];
                const btn = document.createElement('button');
                btn.className = 'mode-btn';
                if (modeKey === currentMode) btn.classList.add('active');
                btn.innerHTML = `<strong>${mode.name}</strong><small>${mode.description}</small>`;
                btn.onclick = () => selectMode(modeKey);
                elements.modeButtons.appendChild(btn);
            });
        }

        // ============ MOD SEÇ ============
        function selectMode(modeKey) {
            currentMode = modeKey;
            saveStats(); // Mod değiştiğinde kaydet!
            document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
            event.target.closest('.mode-btn').classList.add('active');
        }

        // ============ OYUNU BAŞLAT ============
        elements.startBtn.onclick = () => {
            const mode = CONFIG.gameModes[currentMode];
            
            // Ayarları uygula
            lives = mode.lives;
            if (lives > 0) {
                elements.livesDisplay.style.display = 'block';
                elements.lives.textContent = lives;
            } else {
                elements.livesDisplay.style.display = 'none';
            }

            if (mode.timeLimit > 0) {
                elements.timerDisplay.style.display = 'block';
            } else {
                elements.timerDisplay.style.display = 'none';
            }

            if (mode.showHint) {
                elements.hintBtn.style.display = 'block';
            } else {
                elements.hintBtn.style.display = 'none';
            }

            elements.currentMode.textContent = mode.name;

            // Session puanlarını sıfırla (global puanları koru)
            sessionScore = 0;
            sessionCorrect = 0;
            sessionWrong = 0;
            questionCount = 0;
            
            // Geriye uyumluluk için eski değişkenleri de sıfırla
            score = 0;
            correct = 0;
            wrong = 0;

            updateUI();

            // Ekranları değiştir - Sadece Kelime Çevir oyunu başlat
            elements.modeSelector.style.display = 'none';
            elements.gameScreen.style.display = 'block';
            loadQuestion();
        };

        // ============ AYARLARA DÖN ============
        if (elements.settingsBtn) {
            elements.settingsBtn.onclick = () => {
                stopTimer();
                elements.gameScreen.style.display = 'none';
                elements.modeSelector.style.display = 'block';
            };
        }

        // ============ AYET GÖSTER ============
        // ============ SORU YÜKLEME (Kelime Çevir) ============
        function loadQuestion() {
            console.log('📚 === KELİME ÇEVİR SORU YÜKLENİYOR ===');
            console.log(`📊 Mevcut soru sayısı: ${questionCount}`);
            console.log(`🎯 Mevcut mod: ${currentMode}`);
            console.log(`🎯 Zorluk: ${currentDifficulty}`);
            
            const mode = CONFIG.gameModes[currentMode];
            console.log(`📋 Mod detayları:`, mode);
            
            // Soru sayısı kontrolü - oyun bitirme
            if (questionCount >= mode.questionsPerLevel) {
                console.log(`🏁 === KELİME ÇEVİR OYUNU BİTTİ ===`);
                console.log(`✅ ${mode.questionsPerLevel} soru tamamlandı!`);
                console.log(`📊 Final session score: ${sessionScore}`);
                
                // Günlük görev ilerlemesini güncelle
                updateTaskProgress('kelimeCevir', sessionCorrect);
                
                // Session puanlarını global'e aktar
                console.log(`💰 Session puanları global'e aktarılıyor: ${sessionScore} puan`);
                addToGlobalPoints(sessionScore, sessionCorrect);
                
                // Direkt ana menüye dön (popup yok)
                console.log(`🔄 Ana menüye dönülüyor...`);
                elements.gameScreen.style.display = 'none';
                elements.modeSelector.style.display = 'none';
                elements.mainMenu.style.display = 'block';
                console.log(`✅ Kelime Çevir oyunu bitti ve ana menüye dönüldü!`);
                return;
            }

            // Can kontrolü
            if (mode.lives > 0 && lives <= 0) {
                console.log(`💀 Can bitti! Oyun sona eriyor...`);
                gameOver('Can bitti!');
                return;
            }

            console.log(`🔍 Zorluk filtreleme başlıyor...`);
            console.log(`🎯 Seçili zorluk: ${currentDifficulty}`);
            
            // Zorluk filtreleme
            const diffLevel = CONFIG.difficultyLevels[currentDifficulty];
            console.log(`📋 Zorluk aralığı: ${diffLevel.minDiff}-${diffLevel.maxDiff}`);
            console.log(`📦 Toplam kelime sayısı: ${kelimeBulData.length}`);
            
            let filteredData = kelimeBulData.filter(w => 
                w.difficulty >= diffLevel.minDiff && w.difficulty <= diffLevel.maxDiff
            );
            console.log(`✅ Zorluk filtresi sonrası: ${filteredData.length} kelime`);

            // Mod özel zorluk kontrolü
            if (mode.minDifficulty) {
                console.log(`📋 Mod minimum zorluk kontrolü: >= ${mode.minDifficulty}`);
                filteredData = filteredData.filter(w => w.difficulty >= mode.minDifficulty);
                console.log(`✅ Mod filtresi sonrası: ${filteredData.length} kelime`);
            }

            if (filteredData.length === 0) {
                filteredData = kelimeBulData;
            }

            // Rastgele kelime seç
            currentQuestion = filteredData[Math.floor(Math.random() * filteredData.length)];

            // UI güncelle
            elements.arabicWord.textContent = currentQuestion.kelime;
            elements.sureInfo.textContent = `${currentQuestion.sure_adi} Suresi`;

            // Seçenekler oluştur
            const wrongAnswers = getWrongAnswers(3);
            const allOptions = [
                { text: currentQuestion.anlam, correct: true },
                ...wrongAnswers.map(w => ({ text: w.anlam, correct: false }))
            ];

            // Karıştır
            shuffle(allOptions);

            // Seçenekleri göster
            elements.options.innerHTML = '';
            const labels = ['A', 'B', 'C', 'D'];
            allOptions.forEach((opt, i) => {
                const btn = document.createElement('button');
                btn.className = 'option';
                btn.textContent = `${labels[i]}) ${opt.text}`;
                btn.onclick = () => checkAnswer(btn, opt.correct);
                elements.options.appendChild(btn);
            });

            // Sıfırla
            elements.feedback.textContent = '';
            elements.feedback.className = 'feedback';
            elements.nextBtn.style.display = 'none';
            elements.hintBtn.disabled = false;

            // İlerleme güncelle
            updateProgress();

            // Süreyi başlat
            if (mode.timeLimit > 0) {
                startTimer(mode.timeLimit);
            }
        }

        // ============ YANLIŞ CEVAPLAR ============
        function getWrongAnswers(count) {
            const wrong = [];
            const filtered = kelimeBulData.filter(w => w.id !== currentQuestion.id);
            
            while (wrong.length < count && filtered.length > 0) {
                const idx = Math.floor(Math.random() * filtered.length);
                const word = filtered[idx];
                
                if (!wrong.find(w => w.anlam === word.anlam)) {
                    wrong.push(word);
                }
                filtered.splice(idx, 1);
            }
            
            return wrong;
        }

        // ============ KARIŞTIR ============
        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        // ============ CEVAP KONTROL ============
        function checkAnswer(button, isCorrect) {
            console.log(`🚨 === KELİME ÇEVİR CEVAP KONTROLÜ ===`);
            console.log(`👆 Tıklanan buton: "${button.textContent}"`);
            console.log(`✅/❌ isCorrect parametresi: ${isCorrect}`);
            console.log(`📊 Mevcut soru: #${questionCount + 1}`);
            console.log(`📊 Önce - session: score=${sessionScore}, correct=${sessionCorrect}, wrong=${sessionWrong}`);
            console.log(`📊 Önce - kelime çevir: score=${score}, correct=${correct}, wrong=${wrong}`);
            
            stopTimer();
            
            // Tüm butonları kapat
            const allBtns = document.querySelectorAll('.option');
            console.log(`🔒 ${allBtns.length} buton devre dışı bırakılıyor...`);
            allBtns.forEach(btn => btn.disabled = true);

            const mode = CONFIG.gameModes[currentMode];
            const diffLevel = CONFIG.difficultyLevels[currentDifficulty];
            console.log(`🎯 Mod: ${currentMode}, Zorluk: ${currentDifficulty}`);

            if (isCorrect) {
                console.log(`✅ === DOĞRU CEVAP İŞLEMİ ===`);
                button.classList.add('correct');
                elements.feedback.textContent = '✅ Doğru!';
                elements.feedback.className = 'feedback correct';
                
                const points = currentQuestion.difficulty * diffLevel.pointsMultiplier;
                console.log(`💰 Puan hesaplama: ${currentQuestion.difficulty} × ${diffLevel.pointsMultiplier} = ${points} puan`);
                console.log(`📊 addSessionPoints(${points}) çağrılıyor...`);
                addSessionPoints(points); // Session puanına ekle
                
                // Daily task progress - her doğru cevap için
                updateTaskProgress('kelimeCevir', 1);
                console.log(`✅ Doğru cevap işlemi tamamlandı!`);
                
                updateUI();
            } else {
                console.log(`❌ === YANLIŞ CEVAP İŞLEMİ ===`);
                button.classList.add('wrong');
                elements.feedback.textContent = `❌ Yanlış! Doğru: ${currentQuestion.anlam}`;
                elements.feedback.className = 'feedback wrong';
                
                console.log(`📊 addSessionWrong() çağrılıyor...`);
                addSessionWrong(); // Session yanlış sayısını artır
                
                console.log(`💸 Puan cezası uygulanıyor: ${CONFIG.wrongAnswerPenalty} puan`);
                console.log(`📊 Eski score: ${score}`);
                // Puan cezası
                score = Math.max(0, score - CONFIG.wrongAnswerPenalty);
                console.log(`📊 Yeni score: ${score}`);
                
                // Can kaybı
                if (mode.lives > 0) {
                    console.log(`💀 Can kaybı: ${lives} - 1 = ${lives - 1}`);
                    lives--;
                    elements.lives.textContent = lives;
                    
                    if (lives <= 0) {
                        setTimeout(() => gameOver('Canlarınız bitti!'), 1500);
                    }
                }

                updateUI();

                // Doğru cevabı göster
                allBtns.forEach(btn => {
                    if (btn.textContent.includes(currentQuestion.anlam)) {
                        btn.classList.add('correct');
                    }
                });
            }

            questionCount++;
            elements.nextBtn.style.display = 'block';
        }

        // ============ SES ÇALMA ============
        elements.audioBtn.onclick = () => {
            if (currentQuestion && currentQuestion.ses_dosyasi) {
                playAudio(currentQuestion.ses_dosyasi, elements.audioBtn);
            }
        };

        // ============ SONRAKİ SORU ============
        elements.nextBtn.onclick = () => {
            loadQuestion();
        };

        // ============ İLERLEME GÜNCELLE ============
        function updateProgress() {
            const mode = CONFIG.gameModes[currentMode];
            const progress = (questionCount / mode.questionsPerLevel) * 100;
            elements.progressBar.style.width = `${progress}%`;
        }

        // ============ UI GÜNCELLE ============
        function updateUI() {
            // Alt bar: Sadece session (oyun içi) puanları göster
            elements.score.textContent = sessionScore;
            elements.correct.textContent = sessionCorrect;
            elements.wrong.textContent = sessionWrong;
            elements.level.textContent = level; // Global seviye
        }

        // ============ SÜRE YÖNETİMİ ============
        function startTimer(seconds) {
            stopTimer();
            timeLeft = seconds;
            elements.timer.textContent = timeLeft;
            
            timer = setInterval(() => {
                timeLeft--;
                elements.timer.textContent = timeLeft;
                
                if (timeLeft <= 0) {
                    stopTimer();
                    gameOver('Süre doldu!');
                }
            }, 1000);
        }

        function stopTimer() {
            if (timer) {
                clearInterval(timer);
                timer = null;
            }
        }

        // ============ İPUCU ============
        elements.hintBtn.onclick = () => {
            // Bir yanlış cevabı kaldır
            const allBtns = document.querySelectorAll('.option');
            const wrongBtns = Array.from(allBtns).filter(btn => 
                !btn.textContent.includes(currentQuestion.anlam) && !btn.disabled
            );
            
            if (wrongBtns.length > 0) {
                const randomWrong = wrongBtns[Math.floor(Math.random() * wrongBtns.length)];
                randomWrong.style.opacity = '0.3';
                randomWrong.disabled = true;
                
                // İpucu puan cezası
                score = Math.max(0, score - 10);
                updateUI();
                
                elements.hintBtn.disabled = true;
            }
        };

        // ============ SEVİYE ATLAMA ============
        function showLevelUpModal(newLevel) {
            elements.newLevel.textContent = newLevel;
            
            // Modal için ek bilgileri güncelle
            const modalTotalPoints = document.getElementById('modalTotalPoints');
            const modalNextLevelPoints = document.getElementById('modalNextLevelPoints');
            
            if (modalTotalPoints && modalNextLevelPoints) {
                modalTotalPoints.textContent = totalPoints.toLocaleString();
                modalNextLevelPoints.textContent = getNextLevelRequiredPoints(newLevel).toLocaleString();
            }
            
            elements.modal.style.display = 'flex';
        }

        // Eski levelUp fonksiyonu artık kullanılmıyor
        function levelUp() {
            // Bu fonksiyon artık kullanılmıyor - yeni puan bazlı sistem kullanıyoruz
        }

        // ============ OYUN BİTTİ ============
        function gameOver(reason) {
            stopTimer();
            
            // Session puanlarını global'e aktar
            addToGlobalPoints(sessionScore, sessionCorrect);
            
            elements.gameOverTitle.textContent = '😢 Oyun Bitti';
            elements.gameOverText.textContent = reason;
            elements.finalScore.textContent = `Bu Oyun: ${sessionScore} puan\nToplam: ${totalPoints} puan`;
            elements.gameOverModal.style.display = 'block';
        }

        // ============ YENİDEN BAŞLAT ============
        elements.restartBtn.onclick = () => {
            elements.gameOverModal.style.display = 'none';
            elements.gameScreen.style.display = 'none';
            elements.modeSelector.style.display = 'none';
            elements.mainMenu.style.display = 'block';
            elements.settingsBtn.style.display = 'none';
        };

        // ============ MODAL KAPAT ============
        elements.modalBtn.onclick = () => {
            elements.modal.style.display = 'none';
            // Sadece modal'ı kapat - seviye yükselme bilgilendirmesi için gereksiz işlem yapma
        };

        // ============ DİNLE VE BUL MODU ============
        let currentDinleQuestion = null;
        let dinleQuestionCount = 0;
        const DINLE_MAX_QUESTIONS = 10;

        function loadDinleQuestion() {
            console.log(`🎪 === SORU YÜKLENİYOR ===`);
            console.log(`📊 Mevcut soru sayısı: ${dinleQuestionCount}/${DINLE_MAX_QUESTIONS}`);
            console.log(`📊 Oyun durumu: score=${dinleScore}, correct=${dinleCorrect}, wrong=${dinleWrong}`);
            
            // 10 soru kontrolü
            if (dinleQuestionCount >= DINLE_MAX_QUESTIONS) {
                console.log(`🏁 === OYUN BİTİŞİ TETİKLENDİ ===`);
                console.log(`✅ ${DINLE_MAX_QUESTIONS} soru tamamlandı!`);
                console.log(`📊 Final oyun skorları: dinleScore=${dinleScore}, dinleCorrect=${dinleCorrect}, dinleWrong=${dinleWrong}`);
                console.log(`📊 Final session skorları: sessionScore=${sessionScore}, sessionCorrect=${sessionCorrect}, sessionWrong=${sessionWrong}`);
                
                // Günlük görev ilerlemesini güncelle
                updateTaskProgress('dinleBul', sessionCorrect);
                
                console.log(`💰 Session puanları global'e aktarılıyor: ${sessionScore} puan`);
                // Session puanlarını global'e aktar
                addToGlobalPoints(sessionScore, sessionCorrect);
                
                console.log(`🔄 Ana menüye dönülüyor...`);
                // Direkt ana menüye dön
                elements.dinleMode.style.display = 'none';
                elements.mainMenu.style.display = 'block';
                
                console.log(`🧹 Oyun değişkenleri temizleniyor...`);
                // Sıfırla
                dinleScore = 0;
                dinleCorrect = 0;
                dinleWrong = 0;
                dinleQuestionCount = 0;
                updateDinleUI();
                console.log(`✅ Oyun bitti ve ana menüye dönüldü!`);
                return;
            }

            console.log(`🔍 Zorluk filtreleme başlıyor...`);
            console.log(`🎯 Seçili zorluk: ${currentDifficulty}`);
            // Zorluk filtreleme (Kelime Çevir ile aynı)
            const diffLevel = CONFIG.difficultyLevels[currentDifficulty];
            console.log(`📋 Zorluk aralığı: ${diffLevel.minDiff}-${diffLevel.maxDiff}`);
            console.log(`📦 Toplam kelime sayısı: ${kelimeBulData.length}`);
            
            let filteredData = kelimeBulData.filter(w => 
                w.difficulty >= diffLevel.minDiff && w.difficulty <= diffLevel.maxDiff
            );
            console.log(`✅ Filtrelenmiş kelime sayısı: ${filteredData.length}`);

            if (filteredData.length === 0) {
                console.log(`⚠️ Filtrelenmiş veri boş! Tüm kelimeler kullanılacak.`);
                filteredData = kelimeBulData;
            }

            console.log(`🎲 Rastgele kelime seçiliyor...`);
            const randomIndex = Math.floor(Math.random() * filteredData.length);
            currentDinleQuestion = filteredData[randomIndex];
            console.log(`✅ Seçilen index: ${randomIndex}/${filteredData.length}`);
            
            console.log(`📝 === SORU #${dinleQuestionCount + 1} ===`);
            console.log(`🔤 Kelime: "${currentDinleQuestion.kelime}"`);
            console.log(`💭 Anlam: "${currentDinleQuestion.anlam}"`);
            console.log(`📊 Soru zorluğu: ${currentDinleQuestion.difficulty}`);
            console.log(`📊 Seçili zorluk: ${currentDifficulty} (${diffLevel.minDiff}-${diffLevel.maxDiff})`);
            console.log(`🎯 Puan hesaplama: ${currentDinleQuestion.difficulty} × 2 = ${currentDinleQuestion.difficulty * 2} puan`);

            console.log(`🎨 UI güncelleniyor...`);
            // UI güncelle
            elements.dinleSureInfo.textContent = `${currentDinleQuestion.sure_adi} Suresi`;
            console.log(`✅ Sure bilgisi: ${currentDinleQuestion.sure_adi} Suresi`);

            console.log(`🔀 Seçenekler oluşturuluyor... (4 Arapça kelime)`);
            // Seçenekler oluştur (4 Arapça kelime) - aynı zorluktan
            const wrongAnswers = [];
            let attempts = 0;
            while (wrongAnswers.length < 3 && attempts < 50) {
                attempts++;
                const random = filteredData[Math.floor(Math.random() * filteredData.length)];
                if (random.kelime !== currentDinleQuestion.kelime && 
                    !wrongAnswers.find(w => w.kelime === random.kelime)) {
                    wrongAnswers.push(random);
                    console.log(`✅ Yanlış cevap #${wrongAnswers.length}: "${random.kelime}" (zorluk: ${random.difficulty})`);
                }
            }
            console.log(`📊 Yanlış cevap oluşturma: ${attempts} deneme, ${wrongAnswers.length}/3 başarılı`);

            const allOptions = [
                { text: currentDinleQuestion.kelime, correct: true },
                ...wrongAnswers.map(w => ({ text: w.kelime, correct: false }))
            ];
            console.log(`🎯 Doğru cevap: "${currentDinleQuestion.kelime}" (index: 0)`);
            console.log(`❌ Yanlış cevaplar: ${wrongAnswers.map(w => `"${w.kelime}"`).join(', ')}`);

            shuffle(allOptions);

            // Seçenekleri göster
            elements.dinleOptions.innerHTML = '';
            const labels = ['A', 'B', 'C', 'D'];
            allOptions.forEach((opt, i) => {
                const btn = document.createElement('button');
                btn.className = 'option';
                btn.textContent = `${labels[i]}) ${opt.text}`;
                btn.onclick = () => checkDinleAnswer(btn, opt.correct);
                elements.dinleOptions.appendChild(btn);
            });

            elements.dinleFeedback.textContent = '';
            elements.dinleFeedback.className = 'feedback';
            elements.dinleNextBtn.style.display = 'none';

            // Otomatik ses çal
            if (currentDinleQuestion.ses_dosyasi) {
                playAudio(currentDinleQuestion.ses_dosyasi, elements.dinleAudioBtn);
            }
        }

        elements.dinleAudioBtn.onclick = () => {
            if (currentDinleQuestion && currentDinleQuestion.ses_dosyasi) {
                playAudio(currentDinleQuestion.ses_dosyasi, elements.dinleAudioBtn);
            }
        };

        function checkDinleAnswer(button, isCorrect) {
            console.log(`🚨 === CEVAP KONTROLÜ BAŞLIYOR ===`);
            console.log(`👆 Tıklanan buton: "${button.textContent}"`);
            console.log(`✅/❌ isCorrect parametresi: ${isCorrect}`);
            console.log(`📊 Mevcut soru: #${dinleQuestionCount + 1}/${DINLE_MAX_QUESTIONS}`);
            console.log(`� Önce - session score: ${sessionScore}, session correct: ${sessionCorrect}, session wrong: ${sessionWrong}`);
            console.log(`📊 Önce - dinle score: ${dinleScore}, dinle correct: ${dinleCorrect}, dinle wrong: ${dinleWrong}`);
            
            const allBtns = elements.dinleOptions.querySelectorAll('.option');
            console.log(`🔒 ${allBtns.length} buton devre dışı bırakılıyor...`);
            allBtns.forEach(btn => btn.disabled = true);

            if (isCorrect) {
                console.log(`✅ === DOĞRU CEVAP İŞLEMİ ===`);
                button.classList.add('correct');
                elements.dinleFeedback.textContent = '✅ Doğru!';
                elements.dinleFeedback.className = 'feedback correct';
                
                const points = currentDinleQuestion.difficulty * 2;
                console.log(`💰 Puan hesaplama: ${currentDinleQuestion.difficulty} × 2 = ${points} puan`);
                
                console.log(`📊 Dinle score güncelleniyor: ${dinleScore} + ${points} = ${dinleScore + points}`);
                dinleScore += points; // Local oyun puanı
                
                console.log(`📊 Dinle correct güncelleniyor: ${dinleCorrect} + 1 = ${dinleCorrect + 1}`);
                dinleCorrect++;
                
                console.log(`📊 addSessionPoints(${points}) çağrılıyor...`);
                addSessionPoints(points); // Session puanına ekle
                
                // Daily task progress - her doğru cevap için
                updateTaskProgress('dinleBul', 1);
                console.log(`✅ Doğru cevap işlemi tamamlandı!`);
                console.log(`📊 Sonra - session score: ${sessionScore}, session correct: ${sessionCorrect}`);
            } else {
                console.log(`❌ === YANLIŞ CEVAP İŞLEMİ ===`);
                button.classList.add('wrong');
                elements.dinleFeedback.textContent = `❌ Yanlış! Doğru: ${currentDinleQuestion.kelime} (${currentDinleQuestion.anlam})`;
                elements.dinleFeedback.className = 'feedback wrong';
                
                console.log(`📊 Dinle wrong güncelleniyor: ${dinleWrong} + 1 = ${dinleWrong + 1}`);
                dinleWrong++;
                
                console.log(`📊 addSessionWrong() çağrılıyor...`);
                addSessionWrong(); // Session yanlış sayısını artır
                console.log(`❌ ÖNEMLI: Yanlış cevap için puan EKLENMEDİ!`);
                console.log(`📊 Session score değişmedi: ${sessionScore}`);

                console.log(`🔍 Doğru cevabı gösteriliyor...`);
                // Doğru cevabı göster
                let correctButtonFound = false;
                allBtns.forEach(btn => {
                    if (btn.textContent.includes(currentDinleQuestion.kelime)) {
                        btn.classList.add('correct');
                        correctButtonFound = true;
                        console.log(`✅ Doğru buton bulundu ve işaretlendi: "${btn.textContent}"`);
                    }
                });
                if (!correctButtonFound) {
                    console.log(`⚠️ Doğru buton bulunamadı!`);
                }
            }

            console.log(`📊 Soru sayacı artırılıyor: ${dinleQuestionCount} + 1 = ${dinleQuestionCount + 1}`);
            dinleQuestionCount++; // Soru sayacını artır
            console.log(`📊 FINAL - session: score=${sessionScore}, correct=${sessionCorrect}, wrong=${sessionWrong}`);
            console.log(`📊 FINAL - dinle: score=${dinleScore}, correct=${dinleCorrect}, wrong=${dinleWrong}, questionCount=${dinleQuestionCount}`);
            console.log(`🚨 === CEVAP KONTROLÜ BİTTİ ===`);
            console.log(`🎨 UI güncelleniyor ve Next butonu gösteriliyor...`);
            updateDinleUI();
            elements.dinleNextBtn.style.display = 'block';
            console.log(`✅ Cevap işlemi tamamen tamamlandı!`);
        }

        elements.dinleNextBtn.onclick = () => {
            console.log(`🔄 Next butonu tıklandı! Yeni soru yükleniyor...`);
            console.log(`📊 Bir sonraki soru: #${dinleQuestionCount + 1}/${DINLE_MAX_QUESTIONS}`);
            elements.dinleNextBtn.style.display = 'none';
            loadDinleQuestion();
        };

        function updateDinleUI() {
            console.log(`🎨 DinleUI güncelleniyor...`);
            console.log(`📊 Gösterilecek değerler: score=${dinleScore}, correct=${dinleCorrect}, wrong=${dinleWrong}`);
            elements.dinleScore.textContent = dinleScore;
            elements.dinleCorrect.textContent = dinleCorrect;
            elements.dinleWrong.textContent = dinleWrong;
            console.log(`✅ DinleUI güncellendi!`);
        }

        // ============ BOŞLUK DOLDUR MODU ============
        let currentBoslukQuestion = null;
        let missingWord = '';
        let missingIndex = -1;
        let boslukQuestionCount = 0;
        const BOSLUK_MAX_QUESTIONS = 10;

        function loadBoslukQuestion() {
            console.log('📋 === BOŞLUK DOLDUR SORU YÜKLENİYOR ===');
            console.log(`📊 Mevcut soru sayısı: ${boslukQuestionCount}/${BOSLUK_MAX_QUESTIONS}`);
            console.log(`📊 Oyun durumu: score=${boslukScore}, correct=${boslukCorrect}, wrong=${boslukWrong}`);
            
            // 10 soru kontrolü
            if (boslukQuestionCount >= BOSLUK_MAX_QUESTIONS) {
                console.log(`🏁 === BOŞLUK DOLDUR OYUNU BİTTİ ===`);
                console.log(`✅ ${BOSLUK_MAX_QUESTIONS} soru tamamlandı!`);
                console.log(`📊 Final oyun skorları: boslukScore=${boslukScore}, boslukCorrect=${boslukCorrect}, boslukWrong=${boslukWrong}`);
                console.log(`📊 Final session skorları: sessionScore=${sessionScore}, sessionCorrect=${sessionCorrect}, sessionWrong=${sessionWrong}`);
                
                // Günlük görev ilerlemesini güncelle
                updateTaskProgress('boslukDoldur', sessionCorrect);
                
                console.log(`💰 Session puanları global'e aktarılıyor: ${sessionScore} puan`);
                // Session puanlarını global'e aktar
                addToGlobalPoints(sessionScore, sessionCorrect);
                
                console.log(`🔄 Ana menüye dönülüyor...`);
                // Direkt ana menüye dön
                elements.boslukMode.style.display = 'none';
                elements.mainMenu.style.display = 'block';
                
                console.log(`🧹 Oyun değişkenleri temizleniyor...`);
                // Sıfırla
                boslukScore = 0;
                boslukCorrect = 0;
                boslukWrong = 0;
                boslukQuestionCount = 0;
                updateBoslukUI();
                console.log(`✅ Boşluk Doldur oyunu bitti ve ana menüye dönüldü!`);
                return;
            }

            console.log(`🔍 Ayet filtreleme başlıyor...`);
            // Rastgele ayet seç (ayet_metni olan ayetleri filtrele)
            const validAyets = ayetOkuData.filter(a => a.ayet_metni && a.ayet_metni.trim());
            console.log(`📦 Toplam ayet sayısı: ${ayetOkuData.length}`);
            console.log(`✅ Geçerli ayet sayısı: ${validAyets.length}`);
            
            if (validAyets.length === 0) {
                console.error('❌ Geçerli ayet bulunamadı!');
                return;
            }
            
            console.log(`🎲 Rastgele ayet seçiliyor...`);
            const randomIndex = Math.floor(Math.random() * validAyets.length);
            const ayet = validAyets[randomIndex];
            console.log(`✅ Seçilen ayet index: ${randomIndex}/${validAyets.length}`);
            
            console.log(`📝 === SORU #${boslukQuestionCount + 1} ===`);
            console.log(`📖 Sure: ${ayet.sure_adi || 'Bilinmiyor'}`);
            console.log(`🔢 Ayet No: ${ayet.ayet_no || 'Bilinmiyor'}`);
            console.log(`📝 Ayet Metni: "${ayet.ayet_metni}"`);
            
            // Ayet metnini kelimelere böl
            const words = ayet.ayet_metni.split(' ').filter(w => w && w.trim());
            console.log(`🔤 Kelime sayısı: ${words.length}`);
            console.log(`🔤 Kelimeler:`, words);
            
            if (words.length < 4) {
                // Çok kısa ayetler için tekrar dene
                loadBoslukQuestion();
                return;
            }

            // Rastgele bir kelimeyi gizle
            missingIndex = Math.floor(Math.random() * words.length);
            missingWord = words[missingIndex];

            // Boşluk ile değiştir
            const displayText = words.map((w, i) => i === missingIndex ? '______' : w).join(' ');

            currentBoslukQuestion = ayet;

            // UI güncelle
            elements.boslukSureInfo.textContent = `${ayet.sure_adı || 'Sûre'} - Ayet`;
            elements.boslukAyetText.textContent = displayText;

            // Seçenekler oluştur (boşluğa gelecek kelime)
            const wrongWords = [];
            let attempts = 0;
            while (wrongWords.length < 3 && attempts < 100) {
                attempts++;
                const randomAyet = validAyets[Math.floor(Math.random() * validAyets.length)];
                if (!randomAyet.ayet_metni) continue;
                
                const randomWords = randomAyet.ayet_metni.split(' ').filter(w => w && w.trim());
                if (randomWords.length === 0) continue;
                
                const randomWord = randomWords[Math.floor(Math.random() * randomWords.length)];
                if (randomWord && randomWord !== missingWord && !wrongWords.includes(randomWord)) {
                    wrongWords.push(randomWord);
                }
            }
            
            // Eğer yeterli yanlış cevap bulunamadıysa, eksik olanları doldur
            while (wrongWords.length < 3) {
                wrongWords.push('...');
            }

            const allOptions = [
                { text: missingWord, correct: true },
                ...wrongWords.map(w => ({ text: w, correct: false }))
            ];

            shuffle(allOptions);

            // Seçenekleri göster
            elements.boslukOptions.innerHTML = '';
            const labels = ['A', 'B', 'C', 'D'];
            allOptions.forEach((opt, i) => {
                const btn = document.createElement('button');
                btn.className = 'option';
                btn.textContent = `${labels[i]}) ${opt.text}`;
                btn.onclick = () => checkBoslukAnswer(btn, opt.correct);
                elements.boslukOptions.appendChild(btn);
            });

            elements.boslukFeedback.textContent = '';
            elements.boslukFeedback.className = 'feedback';
            elements.boslukNextBtn.style.display = 'none';
        }

        elements.boslukAudioBtn.onclick = () => {
            if (currentBoslukQuestion && currentBoslukQuestion.ayet_ses_dosyasi) {
                playAudio(currentBoslukQuestion.ayet_ses_dosyasi, elements.boslukAudioBtn);
            }
        };

        function checkBoslukAnswer(button, isCorrect) {
            console.log(`🚨 === BOŞLUK DOLDUR CEVAP KONTROLÜ ===`);
            console.log(`👆 Tıklanan buton: "${button.textContent}"`);
            console.log(`✅/❌ isCorrect parametresi: ${isCorrect}`);
            console.log(`📊 Mevcut soru: #${boslukQuestionCount + 1}/${BOSLUK_MAX_QUESTIONS}`);
            console.log(`📊 Eksik kelime: "${missingWord}"`);
            console.log(`📊 Önce - session: score=${sessionScore}, correct=${sessionCorrect}, wrong=${sessionWrong}`);
            console.log(`📊 Önce - boşluk: score=${boslukScore}, correct=${boslukCorrect}, wrong=${boslukWrong}`);
            
            const allBtns = elements.boslukOptions.querySelectorAll('.option');
            console.log(`🔒 ${allBtns.length} buton devre dışı bırakılıyor...`);
            allBtns.forEach(btn => btn.disabled = true);

            if (isCorrect) {
                console.log(`✅ === DOĞRU CEVAP İŞLEMİ ===`);
                button.classList.add('correct');
                elements.boslukFeedback.textContent = '✅ Doğru!';
                elements.boslukFeedback.className = 'feedback correct';
                
                console.log(`💰 Boşluk Doldur sabit puan: 10 puan ekleniyor`);
                console.log(`📊 Boşluk score güncelleniyor: ${boslukScore} + 10 = ${boslukScore + 10}`);
                boslukScore += 10; // Local oyun puanı
                boslukCorrect++;
                
                console.log(`📊 addSessionPoints(10) çağrılıyor...`);
                addSessionPoints(10); // Session puanına ekle
                
                // Daily task progress - her doğru cevap için
                updateTaskProgress('boslukDoldur', 1);
                console.log(`✅ Doğru cevap işlemi tamamlandı!`);

                // Tam ayeti göster
                elements.boslukAyetText.textContent = currentBoslukQuestion.ayet_metni;
            } else {
                console.log(`❌ === YANLIŞ CEVAP İŞLEMİ ===`);
                button.classList.add('wrong');
                elements.boslukFeedback.textContent = `❌ Yanlış! Doğru kelime: ${missingWord}`;
                elements.boslukFeedback.className = 'feedback wrong';
                
                console.log(`📊 Boşluk wrong güncelleniyor: ${boslukWrong} + 1 = ${boslukWrong + 1}`);
                boslukWrong++;
                
                console.log(`📊 addSessionWrong() çağrılıyor...`);
                addSessionWrong(); // Session yanlış sayısını artır
                console.log(`❌ ÖNEMLI: Yanlış cevap için puan EKLENMEDİ!`);

                console.log(`🔍 Doğru cevabı gösteriliyor...`);
                // Doğru cevabı göster
                let correctButtonFound = false;
                allBtns.forEach(btn => {
                    if (btn.textContent.includes(missingWord)) {
                        btn.classList.add('correct');
                        correctButtonFound = true;
                        console.log(`✅ Doğru buton bulundu: "${btn.textContent}"`);
                    }
                });
                if (!correctButtonFound) {
                    console.log(`⚠️ Doğru buton bulunamadı! Aranan: "${missingWord}"`);
                }

                // Tam ayeti göster
                elements.boslukAyetText.textContent = currentBoslukQuestion.ayet_metni;
            }

            console.log(`📊 Soru sayacı artırılıyor: ${boslukQuestionCount} + 1 = ${boslukQuestionCount + 1}`);
            boslukQuestionCount++; // Soru sayacını artır
            console.log(`📊 FINAL - session: score=${sessionScore}, correct=${sessionCorrect}, wrong=${sessionWrong}`);
            console.log(`📊 FINAL - boşluk: score=${boslukScore}, correct=${boslukCorrect}, wrong=${boslukWrong}, questionCount=${boslukQuestionCount}`);
            console.log(`🚨 === BOŞLUK DOLDUR CEVAP KONTROLÜ BİTTİ ===`);
            updateBoslukUI();
            elements.boslukNextBtn.style.display = 'block';
        }

        elements.boslukNextBtn.onclick = () => {
            loadBoslukQuestion();
        };

        function updateBoslukUI() {
            console.log(`🎨 BoslukUI güncelleniyor...`);
            console.log(`📊 Gösterilecek değerler: score=${boslukScore}, correct=${boslukCorrect}, wrong=${boslukWrong}`);
            elements.boslukScore.textContent = boslukScore;
            elements.boslukCorrect.textContent = boslukCorrect;
            elements.boslukWrong.textContent = boslukWrong;
            console.log(`✅ BoslukUI güncellendi!`);
        }

        // ============ DUA ET MODU ============
        function showDua() {
            const dua = duaData[currentDuaIndex];
            if (!dua) return;

            elements.duaSureInfo.textContent = `Ayet: ${dua.ayet || ''}`;
            elements.duaArabic.textContent = dua.dua || '';
            elements.duaTranslation.textContent = dua.tercume || '';

            elements.prevDuaBtn.disabled = currentDuaIndex === 0;
            elements.nextDuaBtn.disabled = currentDuaIndex === duaData.length - 1;
        }

        elements.prevDuaBtn.onclick = () => {
            if (currentDuaIndex > 0) {
                currentDuaIndex--;
                showDua();
                // Navigasyon - görev sayılmaz
            }
        };

        elements.nextDuaBtn.onclick = () => {
            if (currentDuaIndex < duaData.length - 1) {
                currentDuaIndex++;
                showDua();
                // Navigasyon - görev sayılmaz
            }
        };

        elements.duaAudioBtn.onclick = () => {
            const dua = duaData[currentDuaIndex];
            if (dua && dua.ses_url) {
                // Ses başlangıç zamanı için özel işlem
                if (currentAudio && !currentAudio.paused) {
                    currentAudio.pause();
                    currentAudio.currentTime = 0;
                }
                
                elements.duaAudioBtn.disabled = true;
                currentAudio = new Audio(dua.ses_url);
                
                if (dua.start) {
                    currentAudio.currentTime = dua.start;
                }
                
                currentAudio.play().catch(err => {
                    console.error('Ses hatası:', err);
                    elements.duaAudioBtn.disabled = false;
                });
                
                currentAudio.onended = () => {
                    elements.duaAudioBtn.disabled = false;
                    // Daily task progress - SONUNA KADAR dinledi!
                    updateTaskProgress('duaOgre', 1);
                };
            }
        };

        // ============ AYET OKU MODU (RASTGELE) ============
        function showAyet() {
            // Rastgele ayet seç
            currentAyetIndex = Math.floor(Math.random() * ayetOkuData.length);
            const ayet = ayetOkuData[currentAyetIndex];
            if (!ayet) return;
            
            elements.ayetSureInfo.textContent = `${ayet.sure_adı || 'Sûre'} - Ayet`;
            elements.ayetArabic.textContent = ayet.ayet_metni || '';
            elements.ayetTranslation.textContent = ayet.meal || '';
        }

        elements.prevAyetBtn.onclick = () => {
            showAyet(); // Rastgele önceki ayet
            // Navigasyon - görev sayılmaz
        };

        elements.nextAyetBtn.onclick = () => {
            showAyet(); // Rastgele sonraki ayet
            // Navigasyon - görev sayılmaz
        };

        elements.ayetAudioBtn.onclick = () => {
            const ayet = ayetOkuData[currentAyetIndex];
            if (ayet && ayet.ayet_ses_dosyasi) {
                // Eğer ses çalıyorsa durdur
                if (currentAudio && !currentAudio.paused) {
                    currentAudio.pause();
                    currentAudio.currentTime = 0;
                }
                
                elements.ayetAudioBtn.disabled = true;
                currentAudio = new Audio(ayet.ayet_ses_dosyasi);
                
                currentAudio.play().catch(err => {
                    console.error('Ses hatası:', err);
                    elements.ayetAudioBtn.disabled = false;
                });
                
                // Ses sonuna kadar dinlendiğinde görev sayılsın
                currentAudio.onended = () => {
                    elements.ayetAudioBtn.disabled = false;
                    // Daily task progress - SONUNA KADAR dinledi!
                    updateTaskProgress('ayetOku', 1);
                };
            }
        };

        // ============ HADİS OKU MODU (RASTGELE) ============
        function showHadis() {
            // Rastgele hadis seç
            currentHadisIndex = Math.floor(Math.random() * hadisData.length);
            const hadis = hadisData[currentHadisIndex];
            if (!hadis) return;

            elements.hadisCategory.textContent = hadis.section || '';
            elements.hadisTitle.textContent = hadis.chapterName || '';
            elements.hadisHeader.textContent = hadis.header || '';
            elements.hadisText.textContent = hadis.text || '';
            elements.hadisRef.textContent = hadis.refno || '';
        }

        elements.prevHadisBtn.onclick = () => {
            showHadis(); // Rastgele önceki hadis
            // Daily task progress - hadis okuma
            updateTaskProgress('hadisOku', 1);
        };

        elements.nextHadisBtn.onclick = () => {
            showHadis(); // Rastgele sonraki hadis
            // Daily task progress - hadis okuma
            updateTaskProgress('hadisOku', 1);
        };

        // ============ OYUNU BAŞLAT ============
        loadData();
        updateStatsBar(); // İstatistik barını initialize et
            // Global debug fonksiyonu - console'dan çağırılabilir
            window.debugStats = function() {
                console.log('🔧 DEBUG - Mevcut Oyun İstatistikleri:');
                console.log('Total Points:', typeof totalPoints !== 'undefined' ? totalPoints : 'Henüz yüklenmedi');
                console.log('Star Points:', typeof starPoints !== 'undefined' ? starPoints : 'Henüz yüklenmedi');
                console.log('Level:', typeof level !== 'undefined' ? level : 'Henüz yüklenmedi');
                console.log('Session Score:', typeof sessionScore !== 'undefined' ? sessionScore : 'Henüz yüklenmedi');
            };

            // Seviye geçiş test fonksiyonu - console'dan çağırılabilir
            window.testLevelUp = function(targetPoints) {
                console.log('🎯 Seviye geçiş testi başlatılıyor...');
                console.log('Mevcut puan:', totalPoints);
                console.log('Hedef puan:', targetPoints);
                
                // Hedef puana sıçrama
                const oldLevel = calculateLevel(totalPoints);
                totalPoints = targetPoints;
                const newLevel = calculateLevel(totalPoints);
                
                console.log('Eski seviye:', oldLevel);
                console.log('Yeni seviye:', newLevel);
                
                // Seviye atlama kontrolü
                if (newLevel > oldLevel) {
                    level = newLevel;
                    console.log('✅ Seviye atlandı! Modal gösteriliyor...');
                    showLevelUpModal(newLevel);
                } else {
                    console.log('❌ Seviye atlanmadı.');
                }
                
                updateStatsBar();
                saveStats(); // Değişiklikleri kaydet
            };

            // Hızlı seviye test fonksiyonları
            window.testLevel2 = () => testLevelUp(1000);   // Seviye 2'ye çık
            window.testLevel3 = () => testLevelUp(2500);   // Seviye 3'e çık
            window.testLevel5 = () => testLevelUp(8500);   // Seviye 5'e çık
            window.testLevel10 = () => testLevelUp(46000); // Seviye 10'a çık
            window.resetPoints = () => { 
                totalPoints = 0; 
                level = 1; 
                updateStatsBar(); 
                saveStats(); 
                console.log('🔄 Puanlar sıfırlandı'); 
            };
            window.resetAllStats = resetAllStats;

            // Modal fonksiyonlarını global hale getir
            window.showBadgesModal = showBadgesModal;
            window.closeBadgesModal = closeBadgesModal;
            
            // SON ADIM: Kaydedilmiş verileri yükle
            try {
                // VERI SİSTEMİ BAŞLATMA (üçüncü taraf çerez sorunu için)
                console.log('🚀 Veri sistemi başlatılıyor...');
                
                // IndexedDB başlat (çerez engellemelerinden etkilenmez)
                initIndexedDB().then(async () => {
                    console.log('✅ IndexedDB hazır!');
                    await loadStats(); // Verileri yükle (IndexedDB öncelikli) - AWAIT EKLENDİ!
                    updateStatsBar();
                    console.log('💾 Veriler yüklendi:', totalPoints, 'puan');
                }).catch(async (error) => {
                    console.error('❌ IndexedDB hatası, localStorage kullanılıyor:', error);
                    await loadStats(); // Fallback olarak localStorage - AWAIT EKLENDİ!
                    updateStatsBar();
                });
            } catch (error) {
                alert(`❌ HATA: ${error.message}`);
                console.error('❌ Veri yükleme hatası:', error);
            }
        
        }); // DOMContentLoaded event listener sonu

        // ============ PWA SERVICE WORKER KAYDI ============
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(registration => {
                        console.log('🎮 SW registered: ', registration);
                        
                        // PWA yükleme prompt'u
                        let deferredPrompt;
                        window.addEventListener('beforeinstallprompt', (e) => {
                            console.log('💾 PWA install prompt available');
                            e.preventDefault();
                            deferredPrompt = e;
                            
                            // Install button göster (isteğe bağlı)
                            showPWAInstallPrompt(deferredPrompt);
                        });

                        // PWA yüklendiğinde
                        window.addEventListener('appinstalled', (evt) => {
                            console.log('📱 PWA was installed');
                            alert('🎉 Hasene Arapça Oyunu başarıyla yüklendi!\n\nArtık telefon masaüstünden açabilirsiniz! 🚀');
                        });
                    })
                    .catch(registrationError => {
                        console.log('❌ SW registration failed: ', registrationError);
                    });
            });

            // PWA Install Prompt fonksiyonu
            function showPWAInstallPrompt(deferredPrompt) {
                // 3 saniye sonra install prompt göster
                setTimeout(() => {
                    if (confirm('📱 Bu oyunu telefonunuza yüklemek ister misiniz?\n\n✅ Offline oynayabilirsiniz\n🚀 Daha hızlı açılır\n📲 Masaüstü ikonu oluşur')) {
                        deferredPrompt.prompt();
                        deferredPrompt.userChoice.then((choiceResult) => {
                            if (choiceResult.outcome === 'accepted') {
                                console.log('✅ User accepted the install prompt');
                            } else {
                                console.log('❌ User dismissed the install prompt');
                            }
                            deferredPrompt = null;
                        });
                    }
                }, 3000);
            }
        }

    </script>
</body>
</html>
