<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Hasene Arapça Oyunu</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#667eea">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Hasene Arapça">
    <meta name="msapplication-TileColor" content="#667eea">
    <meta name="msapplication-config" content="browserconfig.xml">
    
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" href="icon-192-v4-RED-MUSHAF.png">
    <link rel="apple-touch-icon" sizes="192x192" href="icon-192-v4-RED-MUSHAF.png">
    <link rel="apple-touch-icon" sizes="512x512" href="icon-512-v4-RED-MUSHAF.png">
    
    <!-- Osmanlı Hafs Hattı Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Amiri+Quran&family=Scheherazade+New:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        /* ============ TEMEL AYARLAR ============ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            padding: 10px;
            padding-top: max(10px, env(safe-area-inset-top));
            padding-bottom: max(10px, env(safe-area-inset-bottom));
            padding-left: max(10px, env(safe-area-inset-left));
            padding-right: max(10px, env(safe-area-inset-right));
            position: relative;
            overflow-x: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Animated Background Pattern */
        body::before {
            content: '';
            position: absolute;
            width: 200%;
            height: 200%;
            background-image: 
                radial-gradient(circle at 20% 50%, rgba(255, 215, 0, 0.03) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(139, 69, 19, 0.03) 0%, transparent 50%);
            animation: rotate 30s linear infinite;
            pointer-events: none;
        }

        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* ============ LOADING SAYFASI ============ */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            animation: fadeIn 0.5s ease-in;
        }

        .loading-screen.fade-out {
            animation: fadeOut 0.8s ease-out forwards;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }

        .loading-logo {
            width: 180px;
            height: 180px;
            margin-bottom: 30px;
            animation: pulse 3s ease-in-out infinite;
            filter: drop-shadow(0 0 30px rgba(244, 196, 48, 0.5));
            will-change: transform;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }

        .loading-title {
            font-size: 3em;
            font-weight: 900;
            color: #FFD700;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
            margin-bottom: 40px;
            letter-spacing: 8px;
            animation: glow 2s ease-in-out infinite;
        }

        @keyframes glow {
            0%, 100% { text-shadow: 0 0 20px rgba(255, 215, 0, 0.5); }
            50% { text-shadow: 0 0 40px rgba(255, 215, 0, 0.8), 0 0 60px rgba(255, 215, 0, 0.6); }
        }

        .hadis-box {
            max-width: 500px;
            padding: 30px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            border: 2px solid rgba(255, 215, 0, 0.3);
            backdrop-filter: blur(10px);
            margin-bottom: 40px;
        }

        .hadis-arabic {
            font-size: 24px;
            color: #FFD700;
            text-align: center;
            font-family: 'Amiri Quran', 'Scheherazade New', serif;
            line-height: 2;
            margin-bottom: 20px;
            direction: rtl;
        }

        .hadis-turkish {
            font-size: 16px;
            color: #ffffff;
            text-align: center;
            line-height: 1.8;
            font-style: italic;
            opacity: 0.9;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(255, 215, 0, 0.2);
            border-top: 4px solid #FFD700;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            color: #FFD700;
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 50px;
            animation: blink 1.5s ease-in-out infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .copyright {
            position: absolute;
            bottom: 60px;
            color: rgba(255, 255, 255, 0.6);
            font-size: 14px;
            font-weight: 500;
            letter-spacing: 2px;
        }

        /* ============ KONTEYNER ============ */
        .container {
            max-width: 600px;
            width: 100%;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.98);
            border-radius: 30px;
            padding: 0;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            overflow: hidden;
            backdrop-filter: blur(10px);
            position: relative;
            z-index: 1;
            max-height: 100vh;
            overflow-y: auto;
        }

        /* Scrollbar styling */
        .container::-webkit-scrollbar {
            width: 8px;
        }

        .container::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.05);
            border-radius: 10px;
        }

        .container::-webkit-scrollbar-thumb {
            background: rgba(139, 69, 19, 0.3);
            border-radius: 10px;
        }

        .container::-webkit-scrollbar-thumb:hover {
            background: rgba(139, 69, 19, 0.5);
        }

        /* ============ BAŞLIK ============ */
        .header {
            text-align: center;
            background: linear-gradient(135deg, #8B4513 0%, #D2691E 50%, #CD853F 100%);
            padding: 30px 20px 25px;
            color: white;
            position: relative;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            font-size: 1.7em;
            margin-bottom: 8px;
            font-weight: 700;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            letter-spacing: 0.5px;
        }

        .header h1::before {
            content: '✨ ';
        }

        .settings-btn {
            position: absolute;
            right: 15px;
            top: 15px;
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            padding: 8px 15px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1em;
            color: white;
            font-weight: 600;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .settings-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }

        /* ============ ANA MENÜ ============ */
        .main-menu {
            display: flex;
            flex-direction: column;
            gap: 12px;
            width: 100%;
            padding: 0 15px 20px 15px;
        }

        .menu-item {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            color: #2c3e50;
            border: none;
            padding: 20px;
            border-radius: 20px;
            cursor: pointer;
            text-align: left;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            width: 100%;
            margin-bottom: 0;
            position: relative;
            overflow: hidden;
        }

        .menu-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(139, 69, 19, 0.05) 0%, rgba(210, 105, 30, 0.1) 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .menu-item:hover::before {
            opacity: 1;
        }

        .menu-item:last-child {
            margin-bottom: 0;
        }

        .menu-item:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 10px 30px rgba(139, 69, 19, 0.2);
        }

        .menu-item:active {
            transform: translateY(-2px) scale(1.01);
        }

        .menu-icon {
            font-size: 2.5em;
            margin-bottom: 10px;
            filter: drop-shadow(0 4px 6px rgba(0, 0, 0, 0.1));
            position: relative;
            z-index: 1;
        }

        .menu-title {
            font-size: 1.15em;
            font-weight: 700;
            margin-bottom: 5px;
            color: #2c3e50;
            position: relative;
            z-index: 1;
        }

        .menu-desc {
            font-size: 0.85em;
            opacity: 0.8;
            line-height: 1.4;
            color: #6c757d;
            position: relative;
            z-index: 1;
        }

        /* ============ ÜST BUTONLAR ============ */
        .top-btn {
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .top-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15) !important;
            opacity: 1 !important;
        }

        .top-btn:active {
            transform: translateY(0);
        }

        /* ============ STATS BAR ============ */
        .header[style*="grid-template-columns"] {
            background: rgba(255, 255, 255, 0.95) !important;
            backdrop-filter: blur(10px) !important;
            border: none !important;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05) !important;
            box-shadow: none !important;
            padding: 15px 10px !important;
            border-radius: 0 !important;
            margin-bottom: 0 !important;
        }

        .header[style*="grid-template-columns"] > div {
            gap: 4px !important;
        }

        .header[style*="grid-template-columns"] span {
            font-size: 1.5em !important;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));
        }

        .header[style*="grid-template-columns"] div[style*="font-size: 0.93em"] {
            font-weight: 700 !important;
            color: #2c3e50 !important;
        }

        /* ============ TOP NAVIGATION ============ */
        div[style*="display: flex; gap: 4px; margin-bottom: 8px"] {
            background: rgba(248, 249, 250, 0.8) !important;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05) !important;
            padding: 15px !important;
            gap: 6px !important;
        }

        div[style*="display: flex; gap: 4px; margin-bottom: 8px"] .top-btn {
            background: white !important;
            border: 2px solid transparent !important;
            border-radius: 12px !important;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08) !important;
        }

        div[style*="display: flex; gap: 4px; margin-bottom: 8px"] .top-btn:hover {
            border-color: #8B4513 !important;
        }

        /* ============ DIFFICULTY BUTTONS ============ */
        div[style*="display: flex; gap: 2px; margin-bottom: 6px"] {
            background: linear-gradient(to bottom, rgba(248, 249, 250, 0.5), transparent) !important;
            padding: 15px 15px 10px !important;
            gap: 8px !important;
        }

        .diff-btn {
            border-radius: 15px !important;
            padding: 12px !important;
            font-size: 0.85em !important;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05) !important;
            transition: all 0.3s ease !important;
            border: 2px solid #e9ecef !important;
        }

        .diff-btn:hover {
            transform: translateY(-3px) !important;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15) !important;
        }

        .diff-btn.active,
        #mainDiffOrta[style*="background: #FF9800"] {
            background: linear-gradient(135deg, #fff9e6 0%, #ffffff 100%) !important;
            border-color: #ffc107 !important;
        }

        /* ============ GAME MODE CARDS - SPECIAL GRADIENTS ============ */
        #kelimeCevirBtn {
            background: linear-gradient(135deg, #fff5e6 0%, #ffe8cc 100%) !important;
        }

        #dinleBulBtn {
            background: linear-gradient(135deg, #e6f3ff 0%, #cce5ff 100%) !important;
            color: #1e4d7b !important;
        }

        #boslukDoldurBtn {
            background: linear-gradient(135deg, #f0e6ff 0%, #e0ccff 100%) !important;
            color: #5b3a9d !important;
        }

        #duaEtBtn {
            background: linear-gradient(135deg, #e6ffe6 0%, #ccffcc 100%) !important;
            color: #2d5f3f !important;
        }

        /* ============ GAME SCREEN ============ */
        .game-screen {
            padding: 20px 15px;
        }

        /* ============ GERİ BUTONU ============ */
        .back-btn {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9) 0%, rgba(248, 249, 250, 0.9) 100%);
            color: #2c3e50;
            border: 2px solid rgba(0, 0, 0, 0.1);
            padding: 6px 12px;
            border-radius: 8px;
            cursor: pointer;
            margin-bottom: 10px;
            font-size: 0.85em;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
        }

        .back-btn:hover {
            background: white;
            transform: translateX(-3px);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.12);
            border-color: #8B4513;
            color: #8B4513;
        }

        .back-btn:active {
            transform: translateX(-2px);
        }

        /* ============ MOD SEÇİCİ ============ */
        .mode-selector {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
        }

        .mode-selector h3 {
            color: #2D5F3F;
            margin: 15px 0 10px 0;
            font-size: 1.1em;
        }

        .mode-btn, .diff-btn {
            display: block;
            width: 100%;
            background: white;
            border: 3px solid #ddd;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 10px;
            cursor: pointer;
            text-align: left;
            transition: all 0.3s ease;
            position: relative;
        }

        .mode-btn:hover, .diff-btn:hover {
            border-color: #2D5F3F;
            transform: translateX(5px);
        }

        .mode-btn.active {
            background: linear-gradient(135deg, #2D5F3F 0%, #1E4D7B 100%);
            color: white;
            border-color: #2D5F3F;
            transform: scale(1.02);
            box-shadow: 0 4px 15px rgba(45, 95, 63, 0.3);
        }
        
        .diff-btn.active {
            /* Renk JavaScript'te ayarlanıyor */
            transform: scale(1.02);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .mode-btn.active::after, .diff-btn.active::after {
            content: '';
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.5em;
            font-weight: bold;
        }

        .mode-btn strong, .diff-btn strong {
            display: block;
            font-size: 1.1em;
            margin-bottom: 5px;
        }

        .mode-btn small, .diff-btn small {
            display: block;
            opacity: 0.8;
        }

        .start-btn {
            width: 100%;
            background: #F4C430;
            border: none;
            padding: 15px;
            border-radius: 10px;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            margin-top: 20px;
        }

        .start-btn:active {
            background: #d4a820;
        }

        /* ============ OYUN BİLGİSİ ============ */
        .game-info {
            display: flex;
            justify-content: space-around;
            margin-bottom: 15px;
            padding: 12px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(248, 249, 250, 0.95) 100%);
            border-radius: 15px;
            font-size: 0.9em;
            color: #2c3e50;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            backdrop-filter: blur(10px);
        }

        .game-info div {
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* ============ İSTATİSTİKLER ============ */
        .stats {
            display: flex;
            justify-content: space-between;
            gap: 6px;
            margin-bottom: 12px;
        }

        .stat {
            flex: 1;
            background: linear-gradient(135deg, #8B4513 0%, #D2691E 100%);
            color: white;
            padding: 8px 6px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(139, 69, 19, 0.15);
            transition: all 0.3s ease;
        }

        .stat:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(139, 69, 19, 0.25);
        }

        .stat-label {
            font-size: 0.6em;
            opacity: 0.9;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        .stat-value {
            font-size: 1.2em;
            font-weight: 700;
            margin-top: 2px;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
        }

        /* ============ OYUN ALANI ============ */
        .game-box {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(248, 249, 250, 0.9) 100%);
            padding: 15px 15px;
            border-radius: 15px;
            margin-bottom: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.06);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }

        .sure-info {
            text-align: center;
            color: #999;
            font-size: 0.65em;
            margin: -3px 0 8px 0;
            font-family: 'Courier New', monospace;
            opacity: 0.7;
        }

        .arabic {
            font-size: 32px;
            text-align: center;
            color: #8B4513;
            font-weight: bold;
            margin: 15px 0;
            direction: rtl;
            font-family: 'Amiri Quran', 'Scheherazade New', 'Traditional Arabic', 'Arabic Typesetting', serif;
            font-weight: 400;
            line-height: 1.6;
            letter-spacing: 0;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            padding: 12px;
            background: rgba(139, 69, 19, 0.03);
            border-radius: 12px;
        }

        /* ============ BUTON SIRASI ============ */
        .button-row {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-bottom: 8px;
        }

        /* ============ SES BUTONU ============ */
        .audio-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 50px;
            height: 50px;
            margin: 0;
            background: transparent;
            border: none;
            border-radius: 0;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: none;
            filter: contrast(1.3) brightness(1.1);
            background-image: url('hoparlor1.png');
            background-size: 100%;
            background-repeat: no-repeat;
            background-position: center;
        }

        .audio-btn:hover {
            transform: scale(1.15) translateY(-2px);
            box-shadow: 0 5px 20px rgba(139, 69, 19, 0.5);
            filter: brightness(1.2);
        }

        .audio-btn:active {
            transform: scale(0.95);
        }

        /* ============ İPUCU BUTONU ============ */
        .hint-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 50px;
            height: 50px;
            margin: 0;
            background: transparent;
            border: none;
            border-radius: 0;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: none;
            filter: contrast(1.3) brightness(1.1);
            background-image: url('clue.png');
            background-size: 100%;
            background-repeat: no-repeat;
            background-position: center;
        }

        .hint-btn:hover {
            transform: scale(1.1) translateY(-2px);
            filter: contrast(1.4) brightness(1.2);
        }

        .hint-btn:active {
            transform: scale(0.95);
        }

        .hint-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        /* ============ SEÇENEKLER ============ */
        .options {
            display: flex;
            flex-direction: column;
            gap: 5px;
            margin: 10px 0;
        }

        .option {
            background: white;
            border: 2px solid rgba(0, 0, 0, 0.08);
            padding: 14px 16px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            text-align: left;
            transition: all 0.3s ease;
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.04);
            font-weight: 500;
            color: #1c1c1c;
            line-height: 1.3;
        }

        .option:hover {
            transform: translateX(3px);
            border-color: #8B4513;
            box-shadow: 0 2px 8px rgba(139, 69, 19, 0.12);
        }

        .option:active {
            transform: translateX(2px);
        }

        /* Arapça seçenekler için özel stil */
        .option.arabic-option {
            font-size: 22px;
            font-family: 'Amiri Quran', 'Scheherazade New', 'Traditional Arabic', 'Arabic Typesetting', serif;
            direction: ltr;
            text-align: center;
            font-weight: 400;
            line-height: 1.4;
            color: #1c1c1c;
        }

        /* Arapça seçeneklerdeki metin için RTL */
        .option.arabic-option span[style*="direction: rtl"] {
            font-family: 'Amiri Quran', 'Scheherazade New', 'Traditional Arabic', 'Arabic Typesetting', serif;
        }

        .option.correct {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            border-color: #4CAF50;
            color: white;
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.4);
        }

        .option.wrong {
            background: linear-gradient(135deg, #f44336 0%, #d32f2f 100%);
            border-color: #f44336;
            color: white;
            box-shadow: 0 4px 15px rgba(244, 67, 54, 0.4);
        }

        .option:disabled {
            cursor: default;
            opacity: 0.7;
        }

        /* ============ GERİ BİLDİRİM ============ */
        .feedback {
            text-align: center;
            font-size: 1em;
            font-weight: 700;
            min-height: 25px;
            margin: 10px 0;
            padding: 8px;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .feedback.correct {
            color: #4CAF50;
            background: rgba(76, 175, 80, 0.1);
        }

        .feedback.wrong {
            color: #f44336;
            background: rgba(244, 67, 54, 0.1);
        }

        /* ============ SONRAKİ BUTON ============ */
        .next-btn {
            display: none;
            width: 100%;
            background: linear-gradient(135deg, #8B4513 0%, #D2691E 100%);
            color: white;
            border: 2px solid rgba(139, 69, 19, 0.3);
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 0.85em;
            cursor: pointer;
            font-weight: 700;
            transition: all 0.3s ease;
            box-shadow: 0 2px 10px rgba(139, 69, 19, 0.2);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .next-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(139, 69, 19, 0.3);
        }

        .next-btn:active {
            transform: translateY(0);
        }

        /* ============ AYET & DUA MODLARI ============ */
        .ayet-card, .dua-card {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 10px;
        }

        .translation {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            color: #333;
            font-size: 1.1em;
            line-height: 1.6;
            text-align: center;
        }

        .pronunciation {
            background: #E3F2FD;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            color: #1565C0;
            font-size: 1em;
            font-style: italic;
            text-align: center;
        }

        .dua-title {
            text-align: center;
            color: #2D5F3F;
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .navigation-btns {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .nav-btn {
            flex: 1;
            background: #2D5F3F;
            color: white;
            border: none;
            padding: 8px 10px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.8em;
            font-weight: 500;
        }

        .nav-btn:active {
            background: #1d3f2f;
        }

        .nav-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        /* ============ DUA KATEGORİLERİ ============ */
        .dua-categories {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .category-btn {
            background: white;
            border: 2px solid #2D5F3F;
            color: #2D5F3F;
            padding: 15px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: bold;
            transition: all 0.3s;
        }

        .category-btn:active {
            background: #2D5F3F;
            color: white;
        }

        /* ============ HADİS KARTI ============ */
        .hadis-card {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 10px;
        }

        .hadis-category {
            background: #2D5F3F;
            color: white;
            padding: 8px 15px;
            border-radius: 8px;
            font-size: 0.9em;
            display: inline-block;
            margin-bottom: 10px;
        }

        .hadis-title {
            color: #2D5F3F;
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .hadis-header {
            background: #E3F2FD;
            padding: 10px;
            border-radius: 8px;
            color: #1565C0;
            font-size: 0.95em;
            margin-bottom: 15px;
        }

        .hadis-text {
            background: white;
            padding: 15px;
            border-radius: 10px;
            line-height: 1.8;
            color: #333;
            margin-bottom: 15px;
            text-align: justify;
        }

        .hadis-ref {
            background: #FFF3E0;
            padding: 10px;
            border-radius: 8px;
            font-size: 0.85em;
            color: #E65100;
            margin-bottom: 15px;
        }

        /* ============ FİLTRE BUTONLARI ============ */
        .filter-btn {
            transition: all 0.3s ease;
        }
        
        .filter-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }
        
        .filter-btn.active {
            background: #3498db !important;
            transform: scale(1.05);
        }

        /* ============ MODAL ============ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            backdrop-filter: blur(5px);
            z-index: 9999;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            padding: 40px 30px;
            border-radius: 25px;
            text-align: center;
            width: 85%;
            max-width: 350px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.4);
            position: relative;
            border: 2px solid rgba(255, 255, 255, 0.5);
            animation: modalFadeIn 0.3s ease;
        }

        @keyframes modalFadeIn {
            from {
                opacity: 0;
                transform: scale(0.9) translateY(20px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        .modal h2 {
            color: #8B4513;
            font-size: 2.2em;
            margin-bottom: 15px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .modal p {
            font-size: 1.1em;
            margin-bottom: 20px;
            color: #2c3e50;
            line-height: 1.6;
        }

        .modal-btn {
            width: 100%;
            background: linear-gradient(135deg, #F4C430 0%, #FFD700 100%);
            border: 2px solid rgba(244, 196, 48, 0.3);
            padding: 15px;
            border-radius: 15px;
            font-size: 1em;
            cursor: pointer;
            font-weight: 700;
            color: #2c3e50;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(244, 196, 48, 0.4);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .modal-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(244, 196, 48, 0.5);
        }

        .modal-btn:active {
            transform: translateY(0);
        }

        /* ============ ÖZEL ONAY POP-UP ============ */
        .custom-confirm {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.85);
            backdrop-filter: blur(8px);
            z-index: 10000;
            align-items: center;
            justify-content: center;
        }

        .confirm-content {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            padding: 35px 25px;
            border-radius: 20px;
            text-align: center;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 25px 80px rgba(0,0,0,0.6);
            border: 2px solid rgba(255, 215, 0, 0.3);
            animation: confirmFadeIn 0.4s ease;
        }

        @keyframes confirmFadeIn {
            from {
                opacity: 0;
                transform: scale(0.8) translateY(30px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        .confirm-title {
            color: #FFD700;
            font-size: 1.8em;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .confirm-stats {
            background: rgba(255, 215, 0, 0.1);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            border: 1px solid rgba(255, 215, 0, 0.2);
        }

        .confirm-stat {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 8px 0;
            color: white;
            font-size: 1.1em;
        }

        .confirm-message {
            color: #b8c5d6;
            font-size: 1em;
            margin: 15px 0;
            line-height: 1.5;
        }

        .confirm-buttons {
            display: flex;
            gap: 15px;
            margin-top: 25px;
        }

        .confirm-btn {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 12px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .confirm-btn.ok {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.4);
        }

        .confirm-btn.ok:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(231, 76, 60, 0.5);
        }

        .confirm-btn.cancel {
            background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(149, 165, 166, 0.4);
        }

        .confirm-btn.cancel:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(149, 165, 166, 0.5);
        }

        /* ============ MOBİL RESPONSİVE ============ */
        @media (max-width: 768px) {
            /* Ana container */
            .container {
                padding: 10px;
                max-width: 100%;
            }

            /* Üst bar küçük ekranlar için */
            .header {
                grid-template-columns: 1fr 1fr;
                gap: 8px;
                padding: 10px;
                margin-bottom: 15px;
            }

            /* Oyun kutusu mobil için */
            .game-box {
                padding: 15px;
                margin: 10px 0;
            }

            /* Arapça font mobilde daha büyük */
            .arabic {
                font-size: 34px;  /* Daha büyük boyut */
                margin: 20px 0;
                line-height: 1.6;
            }

            /* Seçenekler mobilde daha rahat */
            .options {
                gap: 8px;  /* Mobilde biraz daha fazla boşluk */
            }

            .option {
                font-size: 18px;  /* Daha büyük */
                padding: 18px 16px;
                margin: 0;  /* Gap kullandığımız için margin kaldırıldı */
            }

            /* Mobilde Arapça seçenekler */
            .option.arabic-option {
                font-size: 24px;
            }

            /* Butonlar mobilde daha büyük */
            .audio-btn, .hint-btn, .next-btn {
                padding: 15px;
                font-size: 1em;
                margin: 12px 0;
            }

            /* Modal mobilde tam ekran */
            .modal-content {
                max-width: 95%;
                max-height: 95vh;
                margin: 10px auto;
                padding: 20px;
            }

            /* İstatistikler grid mobilde */
            .stats {
                gap: 8px;
                grid-template-columns: 1fr 1fr 1fr;
            }

            .stat {
                padding: 8px;
            }

            /* Ana menü butonları mobilde */
            .main-btn {
                padding: 18px;
                font-size: 1em;
                margin: 8px 0;
            }
        }

        @media (max-width: 480px) {
            /* Çok küçük ekranlar için */
            .arabic {
                font-size: 30px;  /* Daha büyük boyut */
                margin: 25px 0;
            }

            .options {
                gap: 8px;  /* Daha kompakt */
            }

            .option {
                font-size: 16px;  /* Daha uygun boyut */
                padding: 16px 12px;
            }

            /* Küçük ekranlarda Arapça seçenekler */
            .option.arabic-option {
                font-size: 20px;
            }

            .header {
                grid-template-columns: 1fr;
                text-align: center;
            }

            .main-btn {
                padding: 20px;
                font-size: 1.1em;
            }

            /* Stats daha kompakt */
            .stats {
                grid-template-columns: 1fr 1fr;
                gap: 5px;
            }

            /* Modal çok küçük ekranlarda */
            .modal-content {
                max-width: 98%;
                padding: 15px;
            }
        }

        /* ============ ANİMASYONLAR ============ */
        @keyframes pulse {
            0% { 
                box-shadow: 0 0 8px rgba(52,152,219,0.5); 
                transform: scale(1); 
            }
            50% { 
                box-shadow: 0 0 16px rgba(52,152,219,0.7); 
                transform: scale(1.02); 
            }
            100% { 
                box-shadow: 0 0 8px rgba(52,152,219,0.5); 
                transform: scale(1); 
            }
        }

        /* GPU hızlandırması için animasyonlu elementler */
        [style*="animation"] {
            will-change: transform, box-shadow;
            transform: translateZ(0); /* Hardware acceleration trigger */
        }

        /* Performans optimizasyonu */
        * {
            scroll-behavior: auto !important; /* Smooth scroll'u devre dışı bırak */
        }

        body {
            overflow-anchor: auto; /* Chrome'da scroll anchor'ı optimize et */
        }
        
        @keyframes slideDown {
            from {
                transform: translateX(-50%) translateY(-100%);
                opacity: 0;
            }
            to {
                transform: translateX(-50%) translateY(0);
                opacity: 1;
            }
        }
        
        @keyframes slideUp {
            from {
                transform: translateX(-50%) translateY(0);
                opacity: 1;
            }
            to {
                transform: translateX(-50%) translateY(-100%);
                opacity: 0;
            }
        }
        
        @keyframes comboPopIn {
            0% {
                transform: scale(0.5);
                opacity: 0;
            }
            50% {
                transform: scale(1.1);
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }
        
        @keyframes comboShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-10px); }
            20%, 40%, 60%, 80% { transform: translateX(10px); }
        }
        
        @keyframes correctPulse {
            0% { 
                box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.7);
                transform: scale(1);
            }
            50% { 
                box-shadow: 0 0 0 20px rgba(34, 197, 94, 0);
                transform: scale(1.05);
            }
            100% { 
                box-shadow: 0 0 0 0 rgba(34, 197, 94, 0);
                transform: scale(1);
            }
        }
        
        @keyframes wrongShake {
            0%, 100% { 
                transform: translateX(0);
            }
            10%, 30%, 50%, 70%, 90% { 
                transform: translateX(-8px);
            }
            20%, 40%, 60%, 80% { 
                transform: translateX(8px);
            }
        }
    </style>
</head>
<body>
    <!-- Loading Sayfası -->
    <div class="loading-screen" id="loadingScreen">
        <img src="icon-512-v4-RED-MUSHAF.png" alt="Hasene Logo" class="loading-logo">
        
        <div class="loading-title">HASENE</div>
        
        <div class="hadis-box">
            <div class="hadis-arabic">
                مَنْ قَرَأَ حَرْفًا مِنْ كِتَابِ اللَّهِ فَلَهُ بِهِ حَسَنَةٌ وَالْحَسَنَةُ بِعَشْرِ أَمْثَالِهَا
            </div>
            <div class="hadis-turkish">
                "Kim Allah'ın kitabından bir harf okursa, ona bir sevap verilir. O sevap da on mislidir."
                <br><small style="opacity: 0.7; font-size: 13px; margin-top: 10px; display: block;">(Tirmizi, Sevâbü'l-Kur'ân 16)</small>
            </div>
        </div>
        
        <div class="loading-spinner"></div>
        <div class="loading-text">Yükleniyor...</div>
        
        <div class="copyright">© YZOKUMUS 2025</div>
    </div>

    <div class="container" id="mainContainer" style="display: none;">
        <!-- Oyun İstatistikleri Barı -->
        <div class="header" style="background: #f8f9fa; border: 1px solid #e0e0e0; border-radius: 8px; padding: 4px 4px; display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 2px; margin-bottom: 8px; box-shadow: none; opacity: 0.85; font-size: 0.93em;">
            <!-- Puan -->
            <div style="display: flex; flex-direction: column; align-items: center; gap: 1px;">
                <div style="background: #FF9800; color: white; width: 28px; height: 28px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 9px;" id="gamePoints">0</div>
            </div>
            
            <!-- Yıldız -->
            <div style="display: flex; flex-direction: column; align-items: center; gap: 1px;">
                <div style="display: flex; align-items: center; gap: 3px;">
                    <span style="font-size: 16px; color: #FFD700;">⭐</span>
                    <span style="font-weight: bold; font-size: 14px; color: #333;" id="starPoints">0</span>
                </div>
            </div>

            <!-- Rozet -->
            <div style="display: flex; flex-direction: column; align-items: center; gap: 1px;">
                <div style="display: flex; align-items: center; gap: 3px;">
                    <span style="font-size: 16px;" id="topBadgeIcon">🥉</span>
                    <span style="font-weight: bold; font-size: 14px; color: #333;" id="topBadgeCount">0</span>
                </div>
            </div>
            
            <!-- Seviye -->
            <div style="display: flex; flex-direction: column; align-items: center; gap: 1px;">
                <div style="display: flex; align-items: center; gap: 3px;">
                    <span style="font-size: 11px; color: #666;">Lv</span>
                    <span style="background: #9C27B0; color: white; padding: 2px 6px; border-radius: 8px; font-weight: bold; font-size: 11px;" id="playerLevel">1</span>
                </div>
                <!-- Seviye İlerleme Çubuğu -->
                <div style="width: 60px; height: 3px; background: #e0e0e0; border-radius: 2px; overflow: hidden;">
                    <div style="height: 100%; background: #9C27B0; transition: width 0.3s;" id="levelProgress"></div>
                </div>
            </div>
        </div>

        <!-- Günlük Hedef Progress Bar -->
        <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 12px; padding: 12px; margin-bottom: 8px; box-shadow: 0 4px 15px rgba(102,126,234,0.3);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                <div style="display: flex; align-items: center; gap: 8px;">
                    <span style="font-size: 1.3em;">🎯</span>
                    <div>
                        <div style="color: white; font-weight: 600; font-size: 0.9em;">Günlük Hedef</div>
                        <div style="color: rgba(255,255,255,0.8); font-size: 0.75em;" id="dailyGoalText">2700 XP hedefine ulaş!</div>
                    </div>
                </div>
                <button onclick="showDailyGoalSettings()" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 5px 10px; border-radius: 6px; font-size: 0.8em; cursor: pointer; transition: all 0.3s;">
                    ⚙️
                </button>
            </div>
            <div style="background: rgba(255,255,255,0.3); height: 12px; border-radius: 6px; overflow: hidden; position: relative;">
                <div id="dailyGoalProgress" style="background: linear-gradient(90deg, #4ade80 0%, #22c55e 100%); height: 100%; width: 0%; border-radius: 6px; transition: width 0.5s ease; box-shadow: 0 2px 8px rgba(74,222,128,0.4);"></div>
                <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 0.7em; text-shadow: 0 1px 2px rgba(0,0,0,0.3);" id="dailyGoalProgressText">0 / 2700 XP</div>
            </div>
        </div>

        <!-- Ana Menü -->
        <div class="main-menu" id="mainMenu">
            <!-- Üst Butonlar -->
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 4px; margin-bottom: 6px;">
                <button id="dailyTasksBtn" class="top-btn" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 8px; padding: 6px; font-size: 0.8em; font-weight: 500; display: flex; align-items: center; justify-content: center; gap: 4px; box-shadow: none; cursor: pointer; opacity: 0.92;">
                    <span style="font-size: 1em;">📋</span>
                    Günlük Görevler
                </button>
                
                <button id="badgesBtn" class="top-btn" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; border: none; border-radius: 8px; padding: 6px; font-size: 0.8em; font-weight: 500; display: flex; align-items: center; justify-content: center; gap: 4px; box-shadow: none; cursor: pointer; opacity: 0.92;">
                    <span style="font-size: 1em;">🏆</span>
                    Başarılar
                </button>
                
                <button class="top-btn" style="background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); color: #333; border: none; border-radius: 8px; padding: 6px; font-size: 0.8em; font-weight: 500; display: flex; align-items: center; justify-content: center; gap: 4px; box-shadow: none; cursor: pointer; opacity: 0.92;" onclick="showStatsModal()">
                    <span style="font-size: 1em;">📊</span>
                    İstatistikler
                </button>
                
                <button class="top-btn" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; border: none; border-radius: 8px; padding: 6px; font-size: 0.8em; font-weight: 500; display: flex; align-items: center; justify-content: center; gap: 4px; box-shadow: none; cursor: pointer; opacity: 0.92;" onclick="showCalendarModal()">
                    <span style="font-size: 1em;">�</span>
                    Takvim
                </button>
            </div>
            
            <!-- XP Bilgi Butonu -->
            <div style="margin-bottom: 6px;">
                <button id="xpInfoBtn" style="width: 100%; background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%); color: white; border: none; border-radius: 8px; padding: 6px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 5px; box-shadow: 0 2px 6px rgba(251,191,36,0.3); transition: all 0.3s; font-weight: 600; font-size: 0.8em;">
                    <span style="font-size: 1em;">�</span>
                    <div>XP Nasıl Kazanılır?</div>
                    <span style="font-size: 0.8em;">ℹ️</span>
                </button>
            </div>
            
            <!-- Zorluk Butonları -->
            <div style="display: flex; gap: 2px; margin-bottom: 6px; flex-wrap: nowrap; justify-content: center;">
                <button class="diff-btn" id="mainDiffKolay" style="flex: 1; min-width: 60px; max-width: 85px; margin: 0; padding: 4px; font-size: 0.7em; background: white; color: #4CAF50; border: 1px solid #4CAF50; border-radius: 5px;">
                    <strong>🌱 Kolay</strong>
                </button>
                <button class="diff-btn active" id="mainDiffOrta" style="flex: 1; min-width: 60px; max-width: 85px; margin: 0; padding: 4px; font-size: 0.7em; background: #FF9800; color: white; border: 1px solid #FF9800; border-radius: 5px;">
                    <strong>⚖️ Orta</strong>
                </button>
                <button class="diff-btn" id="mainDiffZor" style="flex: 1; min-width: 60px; max-width: 85px; margin: 0; padding: 4px; font-size: 0.7em; background: white; color: #f44336; border: 1px solid #f44336; border-radius: 5px;">
                    <strong>🔥 Zor</strong>
                </button>
            </div>

            <button class="menu-item" id="kelimeCevirBtn" style="margin-bottom: 10px; padding: 12px; background: linear-gradient(135deg, #ffd700 0%, #ffb347 100%); color: #8b4513; box-shadow: 0 4px 15px rgba(255,215,0,0.4); border: 2px solid #daa520;">
                <div class="menu-icon" style="font-size: 1.8em; margin-bottom: 3px;">📚</div>
                <div class="menu-title" style="font-size: 1em; font-weight: bold;">Kelime Çevir</div>
                <div class="menu-desc" style="font-size: 0.8em;">Arapça kelimeyi Türkçe'ye çevir</div>
            </button>

            <button class="menu-item" id="dinleBulBtn" style="margin-bottom: 10px; padding: 12px; background: linear-gradient(135deg, #74c0fc 0%, #339af0 100%); color: white; box-shadow: 0 4px 15px rgba(51,154,240,0.3);">
                <div class="menu-icon" style="font-size: 1.8em; margin-bottom: 3px;">🎧</div>
                <div class="menu-title" style="font-size: 1em;">Dinle ve Bul</div>
                <div class="menu-desc" style="font-size: 0.8em;">Kelimeyi dinle, doğru kelimeyi bul</div>
            </button>

            <button class="menu-item" id="boslukDoldurBtn" style="margin-bottom: 10px; padding: 12px; background: linear-gradient(135deg, #9775fa 0%, #7048e8 100%); color: white; box-shadow: 0 4px 15px rgba(112,72,232,0.3);">
                <div class="menu-icon" style="font-size: 1.8em; margin-bottom: 3px;">✍️</div>
                <div class="menu-title" style="font-size: 1em;">Boşluk Doldur</div>
                <div class="menu-desc" style="font-size: 0.8em;">Ayetteki eksik kelimeyi tamamla</div>
            </button>

            <button class="menu-item" id="duaEtBtn" style="margin-bottom: 10px; padding: 12px; background: linear-gradient(135deg, #51cf66 0%, #37b24d 100%); color: white; box-shadow: 0 4px 15px rgba(55,178,77,0.3);">
                <div class="menu-icon" style="font-size: 1.8em; margin-bottom: 3px;">🤲</div>
                <div class="menu-title" style="font-size: 1em;">Dua Et ve Dinle</div>
                <div class="menu-desc" style="font-size: 0.8em;">Kur'an'dan duaları öğren</div>
            </button>

            <button class="menu-item" id="ayetOkuBtn" style="margin-bottom: 10px; padding: 12px; background: linear-gradient(135deg, #4dabf7 0%, #1c7ed6 100%); color: white; box-shadow: 0 4px 15px rgba(28,126,214,0.3);">
                <div class="menu-icon" style="font-size: 1.8em; margin-bottom: 3px;">📖</div>
                <div class="menu-title" style="font-size: 1em;">Ayet Oku ve Dinle</div>
                <div class="menu-desc" style="font-size: 0.8em;">Ayetleri dinle ve oku</div>
            </button>

            <button class="menu-item" id="hadisOkuBtn" style="margin-bottom: 0; padding: 12px; background: linear-gradient(135deg, #ff8787 0%, #fa5252 100%); color: white; box-shadow: 0 4px 15px rgba(250,82,82,0.3);">
                <div class="menu-icon" style="font-size: 1.8em; margin-bottom: 3px;">📜</div>
                <div class="menu-title" style="font-size: 1em;">Hadis Oku</div>
                <div class="menu-desc" style="font-size: 0.8em;">Hadis-i Şerifleri oku</div>
            </button>
        </div>

        <!-- Kelime Çevir Alt Mod Seçimi -->
        <div class="mode-selector" id="modeSelector" style="display: none;">
            <button class="back-btn" id="backToMenuBtn">← Geri</button>
            
            <div id="modeButtons"></div>
            
            <button class="start-btn" id="startBtn">Oyunu Başlat</button>
        </div>

        <!-- Ayet Okuma Modu -->
        <div class="ayet-mode" id="ayetMode" style="display: none;">
            <button class="back-btn" id="backFromAyetBtn">← Geri</button>
            <div class="ayet-card">
                <div class="sure-info" id="ayetSureInfo">Yükleniyor...</div>
                <div class="arabic" id="ayetArabic">بِسْمِ ٱللَّهِ ٱلرَّحْمَٰنِ ٱلرَّحِيمِ</div>
                <div class="translation" id="ayetTranslation">Yükleniyor...</div>
                <button class="audio-btn" id="ayetAudioBtn"></button>
                <div class="navigation-btns">
                    <button class="nav-btn" id="prevAyetBtn">← Önceki</button>
                    <button class="nav-btn" id="nextAyetBtn">Sonraki →</button>
                </div>
            </div>
        </div>

        <!-- Dua Modu -->
        <div class="dua-mode" id="duaMode" style="display: none;">
            <button class="back-btn" id="backFromDuaBtn">← Geri</button>
            <div class="dua-card">
                <div class="sure-info" id="duaSureInfo">Yükleniyor...</div>
                <div class="arabic" id="duaArabic">Arapça Metin</div>
                <div class="translation" id="duaTranslation">Anlamı</div>
                <button class="audio-btn" id="duaAudioBtn"></button>
                <div class="navigation-btns">
                    <button class="nav-btn" id="prevDuaBtn">← Önceki</button>
                    <button class="nav-btn" id="nextDuaBtn">Sonraki →</button>
                </div>
            </div>
        </div>

        <!-- Hadis Oku Modu -->
        <div class="hadis-mode" id="hadisMode" style="display: none;">
            <button class="back-btn" id="backFromHadisBtn">← Geri</button>
            <div class="hadis-card">
                <div class="hadis-category" id="hadisCategory">Kategori</div>
                <div class="hadis-title" id="hadisTitle">Başlık</div>
                <div class="hadis-header" id="hadisHeader">Ravi</div>
                <div class="hadis-text" id="hadisText">Hadis Metni</div>
                <div class="hadis-ref" id="hadisRef">Referans</div>
                <div class="navigation-btns">
                    <button class="nav-btn" id="prevHadisBtn">← Önceki</button>
                    <button class="nav-btn" id="nextHadisBtn">Sonraki →</button>
                </div>
            </div>
        </div>

        <!-- Boşluk Doldur Modu -->
        <div class="bosluk-mode" id="boslukMode" style="display: none;">
            <button class="back-btn" id="backFromBoslukBtn">← Geri</button>
            
            <!-- İstatistikler -->
            <div class="stats">
                <div class="stat">
                    <div class="stat-label">Puan</div>
                    <div class="stat-value" id="boslukScore">0</div>
                </div>
                <div class="stat">
                    <div class="stat-label">Doğru</div>
                    <div class="stat-value" id="boslukCorrect">0</div>
                </div>
                <div class="stat">
                    <div class="stat-label">Yanlış</div>
                    <div class="stat-value" id="boslukWrong">0</div>
                </div>
            </div>

            <div class="game-box">
                <div class="arabic" id="boslukAyetText">Ayet metni yükleniyor...</div>
                <div class="sure-info" id="boslukSureInfo">Ayet ID: 0</div>
                <button class="audio-btn" id="boslukAudioBtn"></button>
                <div class="options" id="boslukOptions"></div>
                <div class="feedback" id="boslukFeedback"></div>
                <button class="next-btn" id="boslukNextBtn">Sonraki Soru →</button>
            </div>
        </div>

        <!-- Dinle ve Bul Modu -->
        <div class="dinle-mode" id="dinleMode" style="display: none;">
            <button class="back-btn" id="backFromDinleBtn">← Geri</button>
            
            <!-- İstatistikler -->
            <div class="stats">
                <div class="stat">
                    <div class="stat-label">Puan</div>
                    <div class="stat-value" id="dinleScore">0</div>
                </div>
                <div class="stat">
                    <div class="stat-label">Doğru</div>
                    <div class="stat-value" id="dinleCorrect">0</div>
                </div>
                <div class="stat">
                    <div class="stat-label">Yanlış</div>
                    <div class="stat-value" id="dinleWrong">0</div>
                </div>
            </div>

            <div class="game-box">
                <div style="text-align: center; margin: 30px 0;">
                    <div style="font-size: 4em; color: #00CED1; text-shadow: 0 0 10px #00CED1;">🎧</div>
                </div>
                <div class="sure-info" id="dinleSureInfo">ID: 0</div>
                <button class="audio-btn" id="dinleAudioBtn"></button>
                <div class="options" id="dinleOptions"></div>
                <div class="feedback" id="dinleFeedback"></div>
                <button class="next-btn" id="dinleNextBtn">Sonraki Soru →</button>
            </div>
        </div>

        <!-- Oyun Ekranı -->
        <div class="game-screen" id="gameScreen" style="display: none;">
        <button class="back-btn" id="backFromGameBtn">← Geri</button>

        <!-- İstatistikler -->
        <div class="stats">
            <div class="stat">
                <div class="stat-label">Puan</div>
                <div class="stat-value" id="score">0</div>
            </div>
            <div class="stat">
                <div class="stat-label">Seviye</div>
                <div class="stat-value" id="level">1</div>
            </div>
            <div class="stat">
                <div class="stat-label">Doğru</div>
                <div class="stat-value" id="correct">0</div>
            </div>
            <div class="stat">
                <div class="stat-label">Yanlış</div>
                <div class="stat-value" id="wrong">0</div>
            </div>
        </div>

        <!-- Combo Indicator -->
        <div id="comboIndicator" style="display: none; text-align: center; padding: 12px; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); border-radius: 12px; margin: 10px 0; animation: comboPopIn 0.3s ease; box-shadow: 0 4px 15px rgba(245,87,108,0.4);">
            <div style="font-size: 1.8em; font-weight: bold; color: white; text-shadow: 0 2px 4px rgba(0,0,0,0.3);">
                🔥 COMBO <span id="comboCount">3</span>x 🔥
            </div>
            <div style="font-size: 0.9em; color: rgba(255,255,255,0.9); margin-top: 4px;">
                +<span id="comboBonus">5</span> Bonus XP!
            </div>
            <div style="font-size: 0.7em; color: rgba(255,255,255,0.7); margin-top: 2px;">
                (Her 3 combo = +5 XP)
            </div>
        </div>

        <!-- Can ve Süre -->
        <div class="game-info">
            <div id="livesDisplay" style="display: none;">
                ❤️ Can: <span id="lives">3</span>
            </div>
            <div id="timerDisplay" style="display: none;">
                ⏱️ Süre: <span id="timer">30</span>s
            </div>
            <div>
                📊 Mod: <span id="currentMode">Klasik</span>
            </div>
        </div>

        <!-- Oyun Alanı -->
        <div class="game-box">
            <div class="arabic" id="arabicWord">رَكَّبَكَ</div>
            <div class="sure-info" id="sureInfo">ID: 0</div>
            <div class="button-row">
                <button class="audio-btn" id="audioBtn"></button>
                <button class="hint-btn" id="hintBtn" style="display: none;"></button>
            </div>
            <div class="options" id="options"></div>
            <div class="feedback" id="feedback"></div>
            <button class="next-btn" id="nextBtn">Sonraki Soru →</button>
        </div>
        </div>  <!-- gameScreen sonu -->
    </div>

    <!-- Modal -->
    <div class="modal" id="modal">
        <div class="modal-content">
            <h2>🎉 Tebrikler!</h2>
            <p>Seviye <span id="newLevel"></span>'e yükseldiniz!</p>
            <p style="font-size: 0.9em; color: #666; margin-top: 10px;">
                Toplam Puanınız: <strong id="modalTotalPoints">0</strong><br>
                Bir sonraki seviye için: <strong id="modalNextLevelPoints">0</strong> puan gerekli
            </p>
            <button class="modal-btn" id="modalBtn">Devam Et</button>
        </div>
    </div>

    <!-- Başarılar Modal -->
    <div class="modal" id="badgesModal">
        <div class="modal-content" style="max-width: 400px; max-height: 80vh; overflow-y: auto;">
            <h3 style="margin: 15px 0 10px 0; font-size: 1.3em;">🏆 Başarılarınız</h3>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 15px 0;">
                <!-- Elmas -->
                <div style="text-align: center; padding: 8px; border-radius: 8px; background: linear-gradient(135deg, #e1f5fe 0%, #b3e5fc 100%);">
                    <div style="font-size: 1.2em;">💎</div>
                    <div style="font-weight: bold; margin: 2px 0; font-size: 0.8em;">Elmas</div>
                    <div style="font-size: 1em; font-weight: bold; color: #00bcd4;" id="diamondBadgeCount">0</div>
                    <div style="font-size: 0.6em; color: #666;">5 Altın = 1 Elmas</div>
                </div>
                
                <!-- Altın -->
                <div style="text-align: center; padding: 8px; border-radius: 8px; background: linear-gradient(135deg, #fff8e1 0%, #ffecb3 100%);">
                    <div style="font-size: 1.2em;">🥇</div>
                    <div style="font-weight: bold; margin: 2px 0; font-size: 0.8em;">Altın</div>
                    <div style="font-size: 1em; font-weight: bold; color: #ff9800;" id="goldBadgeCount">0</div>
                    <div style="font-size: 0.6em; color: #666;">5 Gümüş = 1 Altın</div>
                </div>
                
                <!-- Gümüş -->
                <div style="text-align: center; padding: 8px; border-radius: 8px; background: linear-gradient(135deg, #f3e5f5 0%, #e1bee7 100%);">
                    <div style="font-size: 1.2em;">🥈</div>
                    <div style="font-weight: bold; margin: 2px 0; font-size: 0.8em;">Gümüş</div>
                    <div style="font-size: 1em; font-weight: bold; color: #9c27b0;" id="silverBadgeCount">0</div>
                    <div style="font-size: 0.6em; color: #666;">5 Bronz = 1 Gümüş</div>
                </div>
                
                <!-- Bronz -->
                <div style="text-align: center; padding: 8px; border-radius: 8px; background: linear-gradient(135deg, #fff3e0 0%, #ffcc80 100%);">
                    <div style="font-size: 1.2em;">🥉</div>
                    <div style="font-weight: bold; margin: 2px 0; font-size: 0.8em;">Bronz</div>
                    <div style="font-size: 1em; font-weight: bold; color: #ff5722;" id="bronzeBadgeCount">0</div>
                    <div style="font-size: 0.6em; color: #666;">5 Yıldız = 1 Bronz</div>
                </div>
            </div>
            
            <div style="text-align: center; margin: 15px 0; padding: 10px; background: #f5f5f5; border-radius: 8px;">
                <div style="font-size: 1.1em; margin-bottom: 5px;">📊 İlerlemeniz</div>
                <div>⭐ <span id="badgesModalStars">0</span> Yıldız</div>
                <div>📈 <span id="badgesModalLevel">1</span>. Seviye</div>
                <div>🎯 <span id="badgesModalPoints">0</span> Puan</div>
            </div>
            
            <button class="modal-btn" id="closeBadgesBtn">Kapat</button>
        </div>
    </div>

    <!-- Takvim Modal -->
    <div class="modal" id="calendarModal">
        <div class="modal-content" style="max-width: 580px; max-height: 90vh; overflow-y: auto; padding: 25px; background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);">
            
            <!-- Başlık -->
            <div style="text-align: center; margin-bottom: 20px;">
                <h2 style="margin: 0; font-size: 1.4em; color: #f39c12; font-weight: bold;">günlük seri!</h2>
            </div>
            
            <!-- Haftalık Streak Gösterimi -->
            <div id="weeklyStreakDisplay" style="margin: 15px 0; padding: 0 5px;">
                <!-- Bu alan JavaScript ile doldurulacak -->
            </div>
            
            <!-- Aylık Takvim Bölümü -->
            <div style="margin: 20px 0; background: rgba(44, 62, 80, 0.3); border-radius: 12px; padding: 15px;">
                <!-- Başlık kaldırıldı -->
                
                <!-- Mini Takvim -->
                <div style="background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 8px; padding: 12px;">
                    <div style="text-align: center; font-weight: bold; margin-bottom: 12px; font-size: 1em; color: #ecf0f1;" id="calendarMonth">Kasım 2025</div>
                    <div id="calendarGrid" style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px; text-align: center; max-width: 100%;">
                        <!-- Takvim günleri buraya eklenecek -->
                    </div>
                    
                    <!-- Legend (Minimal, No Label) -->
                    <div style="margin-top: 12px; padding-top: 8px; border-top: 1px solid rgba(255, 255, 255, 0.1);">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 4px; font-size: 0.55em; color: #bdc3c7;">
                            <span style="display: flex; align-items: center; gap: 2px;">
                                <div style="font-size: 1.2em;">🎯</div>
                                Bugün
                            </span>
                            <span style="display: flex; align-items: center; gap: 2px;">
                                <div style="font-size: 1.2em;">✅</div>
                                Tamamlandı
                            </span>
                            <span style="display: flex; align-items: center; gap: 2px;">
                                <div style="font-size: 1.2em;">🔥</div>
                                Streak
                            </span>
                            <span style="display: flex; align-items: center; gap: 2px;">
                                <div style="font-size: 1.2em;">❄️</div>
                                Boş
                            </span>
                        </div>
                    </div>
                </div>
            </div>

            <button id="closeCalendarBtn" style="width: 100%; padding: 12px; background: #e74c3c; color: white; border: none; border-radius: 8px; font-size: 1em; font-weight: bold; cursor: pointer; margin-top: 20px;">Kapat</button>
        </div>
    </div>

    <!-- Günlük Görevler Modal -->
    <div class="modal" id="dailyTasksModal">
        <div class="modal-content" style="max-width: 480px; max-height: 80vh; overflow-y: auto;">
            <h3 style="margin: 8px 0 6px 0; font-size: 1em;">🎯 Günlük Görevler</h3>
            
            <!-- Genel İlerleme -->
            <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 6px; border-radius: 6px; margin: 8px 0; text-align: center;">
                <div style="font-size: 0.8em; font-weight: bold;">Bugünkü İlerleme</div>
                <div style="font-size: 0.7em; margin-top: 2px;">
                    <span id="completedTasks">0</span>/<span id="totalTasks">5</span> Görev Tamamlandı
                </div>
                <div style="background: rgba(255,255,255,0.3); border-radius: 8px; height: 4px; margin: 4px 0;">
                    <div id="taskProgress" style="background: white; height: 100%; border-radius: 8px; width: 0%; transition: width 0.3s;"></div>
                </div>
            </div>

            <!-- Temel Görevler -->
            <div style="margin: 16px 0;">
                <div id="dailyTasksList">
                    <!-- Görevler buraya dinamik eklenecek -->
                </div>
            </div>

            <!-- Bonus Görevler -->
            <div style="margin: 16px 0;">
                <h4 style="margin: 8px 0; color: #333; font-size: 0.95em;">⭐ Bonus Görevler</h4>
                
                <div id="bonusTasksList">
                    <!-- Bonus görevler buraya dinamik eklenecek -->
                </div>
            </div>

            <!-- Ödül Toplama -->
            <div id="rewardsSection" style="display: none; background: #e8f5e8; border-radius: 8px; padding: 12px; margin: 12px 0; text-align: center;">
                <div style="font-size: 1em; color: #2e7d2e; font-weight: bold;">🎉 Tebrikler!</div>
                <div style="font-size: 0.8em; color: #666; margin: 4px 0;">Tüm görevleri tamamladın!</div>
                <button id="claimRewardsBtn" onclick="claimDailyRewards()" style="background: #4caf50; color: white; border: none; padding: 6px 12px; border-radius: 6px; font-size: 0.8em; cursor: pointer;">
                    +5 ⭐ Ödül Topla
                </button>
            </div>

            <button class="modal-btn" id="closeDailyTasksBtn">Kapat</button>
        </div>
    </div>

    <!-- İstatistikler Modal -->
    <div class="modal" id="statsModal">
        <div class="modal-content" style="max-width: 420px; max-height: 90vh; overflow-y: auto; padding: 20px;">
            <h3 style="margin: 10px 0 15px 0; font-size: 1.1em; text-align: center;">📊 İstatistikler</h3>
            
            <!-- Tab Butonları -->
            <div style="display: flex; gap: 8px; margin-bottom: 15px; border-bottom: 2px solid #e0e0e0; padding-bottom: 8px;">
                <button id="statsTabGeneral" onclick="switchStatsTab('general')" style="flex: 1; padding: 10px; background: linear-gradient(135deg, #8B4513 0%, #D2691E 100%); color: white; border: none; border-radius: 8px; font-weight: 600; font-size: 0.9em; cursor: pointer; transition: all 0.3s ease;">
                    📈 Genel
                </button>
                <button id="statsTabWords" onclick="switchStatsTab('words')" style="flex: 1; padding: 10px; background: white; color: #666; border: 2px solid #e0e0e0; border-radius: 8px; font-weight: 600; font-size: 0.9em; cursor: pointer; transition: all 0.3s ease;">
                    📚 Kelimeler
                </button>
            </div>

            <!-- Genel İstatistikler Tab -->
            <div id="statsContentGeneral" style="display: block;">
            <!-- Genel Özet -->
            <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 10px; border-radius: 8px; margin: 8px 0; text-align: center;">
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; text-align: center; margin-bottom: 10px;">
                    <div>
                        <div style="font-size: 1.4em; font-weight: bold;" id="statsLevel">1</div>
                        <div style="font-size: 0.7em; opacity: 0.9;">Seviye</div>
                    </div>
                    <div>
                        <div style="font-size: 1.4em; font-weight: bold;" id="statsPoints">0</div>
                        <div style="font-size: 0.7em; opacity: 0.9;">XP (Ana Puan)</div>
                    </div>
                    <div>
                        <div style="font-size: 1.4em; font-weight: bold;" id="statsStars">0</div>
                        <div style="font-size: 0.7em; opacity: 0.9;">⭐ Yıldız (100 XP)</div>
                    </div>
                </div>
                
                <!-- Seviye İlerleme Barı -->
                <div style="margin-top: 10px;">
                    <div style="display: flex; justify-content: space-between; font-size: 0.75em; margin-bottom: 5px; opacity: 0.9;">
                        <span>Seviye <span id="statsCurrentLevel">1</span></span>
                        <span>Seviye <span id="statsNextLevel">2</span></span>
                    </div>
                    <div style="background: rgba(255,255,255,0.2); height: 6px; border-radius: 3px; overflow: hidden;">
                        <div id="statsLevelProgress" style="background: rgba(255,255,255,0.9); height: 100%; width: 0%; border-radius: 3px; transition: width 0.3s ease;"></div>
                    </div>
                    <div style="font-size: 0.75em; margin-top: 4px; opacity: 0.8;">
                        <span id="statsLevelPointsNeeded">0</span> XP daha
                    </div>
                </div>
            </div>

            <!-- Rozet Sistemi -->
            <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 12px; border-radius: 12px; margin: 12px 0; box-shadow: 0 4px 12px rgba(102,126,234,0.3);">
                <h4 style="margin: 0 0 10px 0; color: white; font-size: 1em; text-align: center;">🏆 XP Bazlı Rozet Sistemi</h4>
                <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; text-align: center;">
                    <div style="padding: 8px; background: white; border-radius: 8px; border: 2px solid #cd7f32;">
                        <div style="font-size: 1.5em;">🥉</div>
                        <div style="font-size: 0.7em; color: #666; margin: 4px 0;">Bronz</div>
                        <div style="font-weight: bold; font-size: 0.9em; color: #cd7f32;" id="statsBronze">0</div>
                        <div style="font-size: 0.6em; color: #888; margin-top: 2px;">2K XP</div>
                    </div>
                    <div style="padding: 8px; background: white; border-radius: 8px; border: 2px solid #c0c0c0;">
                        <div style="font-size: 1.5em;">🥈</div>
                        <div style="font-size: 0.7em; color: #666; margin: 4px 0;">Gümüş</div>
                        <div style="font-weight: bold; font-size: 0.9em; color: #c0c0c0;" id="statsSilver">0</div>
                        <div style="font-size: 0.6em; color: #888; margin-top: 2px;">8.5K XP</div>
                    </div>
                    <div style="padding: 8px; background: white; border-radius: 8px; border: 2px solid #ffd700;">
                        <div style="font-size: 1.5em;">🥇</div>
                        <div style="font-size: 0.7em; color: #666; margin: 4px 0;">Altın</div>
                        <div style="font-weight: bold; font-size: 0.9em; color: #ffd700;" id="statsGold">0</div>
                        <div style="font-size: 0.6em; color: #888; margin-top: 2px;">25.5K XP</div>
                    </div>
                    <div style="padding: 8px; background: white; border-radius: 8px; border: 2px solid #b9f2ff;">
                        <div style="font-size: 1.5em;">💎</div>
                        <div style="font-size: 0.7em; color: #666; margin: 4px 0;">Elmas</div>
                        <div style="font-weight: bold; font-size: 0.9em; color: #00d9ff;" id="statsDiamond">0</div>
                        <div style="font-size: 0.6em; color: #888; margin-top: 2px;">85K XP</div>
                    </div>
                </div>
                <div style="margin-top: 10px; padding: 8px; background: rgba(255,255,255,0.2); border-radius: 6px; color: white; font-size: 0.75em; text-align: center;">
                    💡 1 saat oyun = ~8500 XP (1 Gümüş)
                </div>
            </div>

            <!-- Başarı Analizi -->
            <div style="background: #f0f8ff; padding: 8px; border-radius: 6px; margin: 8px 0;">
                <h4 style="margin: 0 0 6px 0; color: #2980b9; font-size: 0.9em;">📈 Başarı Analizi</h4>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 6px;">
                    <div style="text-align: center; padding: 6px; background: white; border-radius: 5px;">
                        <div style="font-size: 1.1em; font-weight: bold; color: #27ae60;" id="statsSuccessRate">0%</div>
                        <div style="font-size: 0.7em; color: #666;">Başarı Oranı</div>
                    </div>
                    <div style="text-align: center; padding: 6px; background: white; border-radius: 5px;">
                        <div style="font-size: 1.1em; font-weight: bold; color: #3498db;" id="statsAvgPointsPerDay">0</div>
                        <div style="font-size: 0.7em; color: #666;">Günlük Ort. Puan</div>
                    </div>
                    <div style="text-align: center; padding: 6px; background: white; border-radius: 5px;">
                        <div style="font-size: 1.1em; font-weight: bold; color: #e67e22;" id="statsPlayConsistency">0%</div>
                        <div style="font-size: 0.7em; color: #666;">Oyun Tutarlılığı</div>
                    </div>
                    <div style="text-align: center; padding: 6px; background: white; border-radius: 5px;">
                        <div style="font-size: 1.1em; font-weight: bold; color: #9b59b6;" id="statsLevelProgress">0%</div>
                        <div style="font-size: 0.7em; color: #666;">Seviye İlerlemesi</div>
                    </div>
                </div>
            </div>

            <!-- Streak Bilgileri -->
            <div style="background: #fff7e6; padding: 12px; border-radius: 8px; margin: 12px 0;">
                <h4 style="margin: 0 0 8px 0; color: #d68910; font-size: 1em;">🔥 Streak İstatistikleri</h4>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                    <div style="text-align: center; padding: 8px; background: white; border-radius: 6px;">
                        <div style="font-size: 1.3em; font-weight: bold; color: #e67e22;" id="statsCurrentStreak">0</div>
                        <div style="font-size: 0.8em; color: #666;">Mevcut Streak</div>
                    </div>
                    <div style="text-align: center; padding: 8px; background: white; border-radius: 6px;">
                        <div style="font-size: 1.3em; font-weight: bold; color: #e67e22;" id="statsBestStreak">0</div>
                        <div style="font-size: 0.8em; color: #666;">En İyi Streak</div>
                    </div>
                    <div style="text-align: center; padding: 8px; background: white; border-radius: 6px;">
                        <div style="font-size: 1.3em; font-weight: bold; color: #27ae60;" id="statsTotalDays">0</div>
                        <div style="font-size: 0.8em; color: #666;">Toplam Oyun Günü</div>
                    </div>
                    <div style="text-align: center; padding: 8px; background: white; border-radius: 6px;">
                        <div style="font-size: 1.3em; font-weight: bold; color: #3498db;" id="statsTodayProgress">0</div>
                        <div style="font-size: 0.8em; color: #666;">Bugünkü İlerleme</div>
                    </div>
                </div>
            </div>

            <!-- Oyun Türü İstatistikleri -->
            <div style="background: #f0fff4; padding: 8px; border-radius: 6px; margin: 8px 0;">
                <h4 style="margin: 0 0 6px 0; color: #27ae60; font-size: 0.9em;">🎮 Oyun Türü İstatistikleri (Bugün)</h4>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 4px; font-size: 0.8em;">
                    <div style="padding: 5px; background: white; border-radius: 4px; display: flex; justify-content: space-between;">
                        <span>📚 Kelime Çevir:</span>
                        <strong id="statsKelimeCevir">0</strong>
                    </div>
                    <div style="padding: 5px; background: white; border-radius: 4px; display: flex; justify-content: space-between;">
                        <span>🎧 Dinle & Bul:</span>
                        <strong id="statsDinleBul">0</strong>
                    </div>
                    <div style="padding: 5px; background: white; border-radius: 4px; display: flex; justify-content: space-between;">
                        <span>📝 Boşluk Doldur:</span>
                        <strong id="statsBoslukDoldur">0</strong>
                    </div>
                    <div style="padding: 5px; background: white; border-radius: 4px; display: flex; justify-content: space-between;">
                        <span>📖 Ayet Oku:</span>
                        <strong id="statsAyetOku">0</strong>
                    </div>
                    <div style="padding: 5px; background: white; border-radius: 4px; display: flex; justify-content: space-between;">
                        <span>🤲 Dua Öğren:</span>
                        <strong id="statsDuaOgre">0</strong>
                    </div>
                    <div style="padding: 5px; background: white; border-radius: 4px; display: flex; justify-content: space-between;">
                        <span>📜 Hadis Oku:</span>
                        <strong id="statsHadisOku">0</strong>
                    </div>
                </div>
            </div>

            <!-- Bugünkü Toplam İstatistikler -->
            <div style="background: #fef9e7; padding: 8px; border-radius: 6px; margin: 8px 0;">
                <h4 style="margin: 0 0 6px 0; color: #b7950b; font-size: 0.9em;">⚡ Bugünkü Performans</h4>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 6px;">
                    <div style="text-align: center; padding: 6px; background: white; border-radius: 5px;">
                        <div style="font-size: 1.1em; font-weight: bold; color: #27ae60;" id="statsTodayCorrect">0</div>
                        <div style="font-size: 0.7em; color: #666;">Toplam Doğru</div>
                    </div>
                    <div style="text-align: center; padding: 6px; background: white; border-radius: 5px;">
                        <div style="font-size: 1.1em; font-weight: bold; color: #f39c12;" id="statsTodayPoints">0</div>
                        <div style="font-size: 0.7em; color: #666;">Toplam Puan</div>
                    </div>
                    <div style="text-align: center; padding: 6px; background: white; border-radius: 5px;">
                        <div style="font-size: 1.1em; font-weight: bold; color: #e74c3c;" id="statsPerfectStreak">0</div>
                        <div style="font-size: 0.7em; color: #666;">Mükemmel Seri</div>
                    </div>
                    <div style="text-align: center; padding: 6px; background: white; border-radius: 5px;">
                        <div style="font-size: 1.1em; font-weight: bold; color: #8e44ad;" id="statsDifficultyCount">0</div>
                        <div style="font-size: 0.7em; color: #666;">Farklı Zorluk</div>
                    </div>
                </div>
            </div>

            <!-- İstatistik Sıfırlama Uyarısı -->
            <div style="background: #ffebee; padding: 10px; border-radius: 6px; margin: 12px 0; border-left: 4px solid #f44336;">
                <div style="font-size: 0.85em; color: #c62828; margin-bottom: 8px;">⚠️ Dikkat: Tüm istatistikleri sıfırlamak istiyorsan:</div>
                <button onclick="confirmResetStats()" style="background: #f44336; color: white; border: none; padding: 8px 12px; border-radius: 4px; font-size: 0.8em; cursor: pointer;">
                    🔄 Tüm İstatistikleri Sıfırla
                </button>
            </div>
            </div>
            <!-- Genel İstatistikler Tab Sonu -->

            <!-- Kelime İstatistikleri Tab -->
            <div id="statsContentWords" style="display: none;">
            <!-- Genel Özet -->
            <div style="background: linear-gradient(135deg, #845EC2 0%, #4E8397 100%); color: white; padding: 15px; border-radius: 12px; margin: 15px 0; text-align: center;">
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; text-align: center;">
                    <div>
                        <div style="font-size: 1.4em; font-weight: bold;" id="wordStatsTotal">0</div>
                        <div style="font-size: 0.8em; opacity: 0.9;">Kelime Görüldü</div>
                    </div>
                    <div>
                        <div style="font-size: 1.4em; font-weight: bold;" id="wordStatsMastered">0</div>
                        <div style="font-size: 0.8em; opacity: 0.9;">Öğrenildi</div>
                    </div>
                    <div>
                        <div style="font-size: 1.4em; font-weight: bold;" id="wordStatsStruggling">0</div>
                        <div style="font-size: 0.8em; opacity: 0.9;">Zorlanılan</div>
                    </div>
                </div>
            </div>

            <!-- Filtreleme Butonları -->
            <div style="display: flex; gap: 8px; margin: 15px 0; flex-wrap: wrap;">
                <button id="filterAll" class="filter-btn active" style="flex: 1; min-width: 80px; padding: 8px; border: none; border-radius: 6px; background: #3498db; color: white; font-size: 0.85em; cursor: pointer;">
                    Hepsi
                </button>
                <button id="filterMastered" class="filter-btn" style="flex: 1; min-width: 80px; padding: 8px; border: none; border-radius: 6px; background: #95a5a6; color: white; font-size: 0.85em; cursor: pointer;">
                    Öğrenildi
                </button>
                <button id="filterStruggling" class="filter-btn" style="flex: 1; min-width: 80px; padding: 8px; border: none; border-radius: 6px; background: #95a5a6; color: white; font-size: 0.85em; cursor: pointer;">
                    Zorlanılan
                </button>
                <button id="filterRecent" class="filter-btn" style="flex: 1; min-width: 80px; padding: 8px; border: none; border-radius: 6px; background: #95a5a6; color: white; font-size: 0.85em; cursor: pointer;">
                    Son Görülen
                </button>
            </div>

            <!-- Kelime Listesi -->
            <div id="wordStatsList" style="max-height: 400px; overflow-y: auto; margin: 15px 0;">
                <!-- Kelime istatistikleri buraya dinamik eklenecek -->
            </div>

            <!-- Öğrenme İpuçları -->
            <div style="background: #f8f9fa; padding: 12px; border-radius: 8px; margin: 15px 0; border-left: 4px solid #f39c12;">
                <div style="font-size: 0.9em; color: #856404; font-weight: bold; margin-bottom: 6px;">💡 Öğrenme İpuçları</div>
                <div style="font-size: 0.8em; color: #666;">
                    • Zorlandığın kelimeler otomatik olarak daha sık gösterilir<br>
                    • %60'ın üzerinde başarı oranı olan kelimeler "öğrenildi" sayılır<br>
                    • Uzun süre görülmeyen kelimeler tekrar önceliklendirilir
                </div>
            </div>

            </div>
            <!-- Kelime İstatistikleri Tab Sonu -->

            <!-- Kapat Butonu -->
            <button class="modal-btn" id="closeStatsBtn">Kapat</button>
        </div>
    </div>

    <!-- Daily Goal Settings Modal -->
    <div class="modal" id="dailyGoalModal">
        <div class="modal-content" style="max-width: 360px;">
            <h3 style="margin: 0 0 15px 0; font-size: 1.2em; text-align: center;">🎯 Günlük Hedef Seç</h3>
            <p style="text-align: center; color: #666; font-size: 0.9em; margin-bottom: 20px;">
                Ne kadar çalışmak istiyorsun?
            </p>
            
            <div style="display: flex; flex-direction: column; gap: 12px;">
                <button onclick="setDailyGoal('easy')" style="background: linear-gradient(135deg, #4ade80 0%, #22c55e 100%); color: white; border: none; padding: 16px; border-radius: 12px; cursor: pointer; text-align: left; transition: transform 0.3s; box-shadow: 0 4px 12px rgba(74,222,128,0.3);">
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <span style="font-size: 2em;">🌱</span>
                        <div>
                            <div style="font-weight: 600; font-size: 1.1em;">Rahat</div>
                            <div style="font-size: 0.85em; opacity: 0.9;">Günde 1,300 XP - ~10 dakika</div>
                        </div>
                    </div>
                </button>
                
                <button onclick="setDailyGoal('normal')" style="background: linear-gradient(135deg, #60a5fa 0%, #3b82f6 100%); color: white; border: none; padding: 16px; border-radius: 12px; cursor: pointer; text-align: left; transition: transform 0.3s; box-shadow: 0 4px 12px rgba(96,165,250,0.3);">
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <span style="font-size: 2em;">🎯</span>
                        <div>
                            <div style="font-weight: 600; font-size: 1.1em;">Normal</div>
                            <div style="font-size: 0.85em; opacity: 0.9;">Günde 2,700 XP - ~20 dakika</div>
                        </div>
                    </div>
                </button>
                
                <button onclick="setDailyGoal('serious')" style="background: linear-gradient(135deg, #f97316 0%, #ea580c 100%); color: white; border: none; padding: 16px; border-radius: 12px; cursor: pointer; text-align: left; transition: transform 0.3s; box-shadow: 0 4px 12px rgba(249,115,22,0.3);">
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <span style="font-size: 2em;">🔥</span>
                        <div>
                            <div style="font-weight: 600; font-size: 1.1em;">Ciddi</div>
                            <div style="font-size: 0.85em; opacity: 0.9;">Günde 6,000 XP - ~45 dakika</div>
                        </div>
                    </div>
                </button>
            </div>
            
            <button id="closeDailyGoalBtn" style="background: #e5e7eb; color: #333; border: none; padding: 12px; border-radius: 8px; margin-top: 15px; width: 100%; cursor: pointer; font-weight: 600;">
                Kapat
            </button>
        </div>
    </div>

    <!-- XP Info Modal -->
    <div class="modal" id="xpInfoModal">
        <div class="modal-content" style="max-width: 400px;">
            <h3 style="margin: 0 0 15px 0; font-size: 1.3em; text-align: center; color: #667eea;">💎 XP Sistemi</h3>
            
            <div style="background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); padding: 12px; border-radius: 10px; margin-bottom: 15px; text-align: center;">
                <div style="font-size: 0.9em; color: #555; font-weight: 600;">1 Saat Oyun = ~8,500 XP</div>
            </div>
            
            <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                <h4 style="margin: 0 0 10px 0; color: #667eea; font-size: 1em;">⭐ Yıldız Sistemi</h4>
                <div style="font-size: 0.85em; color: #555; line-height: 1.6;">
                    <strong>100 XP = 1 Yıldız</strong><br>
                    Sık geri bildirim için. Her soruda ilerleme görürsün!
                </div>
            </div>
            
            <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                <h4 style="margin: 0 0 10px 0; color: #667eea; font-size: 1em;">🏆 Rozet Sistemi</h4>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 0.85em; color: #555;">
                    <div>🥉 <strong>2,000 XP</strong><br><span style="font-size: 0.85em; color: #888;">Bronz (~15 dk)</span></div>
                    <div>🥈 <strong>8,500 XP</strong><br><span style="font-size: 0.85em; color: #888;">Gümüş (~1 saat)</span></div>
                    <div>🥇 <strong>25,500 XP</strong><br><span style="font-size: 0.85em; color: #888;">Altın (~3 gün)</span></div>
                    <div>💎 <strong>85,000 XP</strong><br><span style="font-size: 0.85em; color: #888;">Elmas (~10 gün)</span></div>
                </div>
            </div>
            
            <div style="background: #fff7e6; padding: 12px; border-radius: 10px; margin-bottom: 15px;">
                <h4 style="margin: 0 0 8px 0; color: #f97316; font-size: 1em;">🔥 Combo Bonusu</h4>
                <div style="font-size: 0.85em; color: #555;">
                    <strong>Her 3 doğru cevap = +5 XP bonus!</strong><br>
                    Combo yap, ekstra XP kazan!
                </div>
            </div>
            
            <div style="background: #f0f9ff; padding: 12px; border-radius: 10px; margin-bottom: 15px;">
                <h4 style="margin: 0 0 8px 0; color: #3b82f6; font-size: 1em;">🎯 Günlük Hedef Bonusu</h4>
                <div style="font-size: 0.85em; color: #555;">
                    Günlük hedefini tamamla:<br>
                    <strong style="color: #3b82f6; font-size: 1.1em;">+1,000 XP Bonus!</strong>
                </div>
            </div>
            
            <button id="closeXPInfoBtn" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 12px; border-radius: 8px; width: 100%; cursor: pointer; font-weight: 600; font-size: 1em;">
                Anladım! 🚀
            </button>
        </div>
    </div>

    <!-- Oyun Bitti Modal -->
    <div class="modal" id="gameOverModal">
        <div class="modal-content">
            <h2 id="gameOverTitle">😢 Oyun Bitti</h2>
            <p id="gameOverText"></p>
            <p>Toplam Puan: <strong id="finalScore">0</strong></p>
            <button class="modal-btn" id="restartBtn">Yeniden Başla</button>
        </div>
    </div>

    <script>
        // ============ PRODUCTION CONFIG - DEBUG SISTEMI ============
        const CONFIG = {
            debug: false,              // Ana debug modu (production'da false)
            debugStats: false,          // İstatistik debug'ları (filterWordStats, updateWordStatistics)
            debugElements: false,       // DOM element kontrolleri
            debugAudio: false,          // Ses sistemi debug'ları
            debugGameFlow: false,       // Oyun akışı debug'ları
            showCriticalErrors: true    // Kritik hataları her zaman göster
        };
        
        // Helper fonksiyon - güvenli console.log
        const log = {
            debug: (...args) => { if (CONFIG.debug) console.log(...args); },
            stats: (...args) => { if (CONFIG.debugStats) console.log(...args); },
            elements: (...args) => { if (CONFIG.debugElements) console.log(...args); },
            audio: (...args) => { if (CONFIG.debugAudio) console.log(...args); },
            game: (...args) => { if (CONFIG.debugGameFlow) console.log(...args); },
            error: (...args) => { if (CONFIG.showCriticalErrors) console.error(...args); },
            warn: (...args) => { if (CONFIG.showCriticalErrors) console.warn(...args); }
        };
        
        // ============ GLOBAL FONKSİYONLAR (onclick için erişilebilir olmalı) ============
        
        function switchStatsTab(tabName) {
            log.stats('🔄 switchStatsTab ÇAĞRILDI, tabName:', tabName);
            
            // İçerik divlerini gizle/göster
            const generalContent = document.getElementById('statsContentGeneral');
            const wordsContent = document.getElementById('statsContentWords');
            const generalTab = document.getElementById('statsTabGeneral');
            const wordsTab = document.getElementById('statsTabWords');
            
            // NULL KONTROL - Elementler yoksa hata ver
            if (!generalContent || !wordsContent || !generalTab || !wordsTab) {
                log.error('❌ HATA: İstatistik tab elementleri bulunamadı!', {
                    generalContent: !!generalContent,
                    wordsContent: !!wordsContent,
                    generalTab: !!generalTab,
                    wordsTab: !!wordsTab
                });
                return;
            }
            
            log.elements('📍 Element kontrol:', {
                generalContent: !!generalContent,
                wordsContent: !!wordsContent,
                generalTab: !!generalTab,
                wordsTab: !!wordsTab
            });
            
            if (tabName === 'general') {
                generalContent.style.display = 'block';
                wordsContent.style.display = 'none';
                
                // Tab butonlarını güncelle
                generalTab.style.background = 'linear-gradient(135deg, #8B4513 0%, #D2691E 100%)';
                generalTab.style.color = 'white';
                generalTab.style.border = 'none';
                
                wordsTab.style.background = 'white';
                wordsTab.style.color = '#666';
                wordsTab.style.border = '2px solid #e0e0e0';
            } else if (tabName === 'words') {
                log.stats('📝 Kelimeler sekmesine geçiliyor...');
                generalContent.style.display = 'none';
                wordsContent.style.display = 'block';
                
                log.elements('📍 wordsContent display SONRASI:', window.getComputedStyle(wordsContent).display);
                log.elements('📍 wordsContent visibility:', window.getComputedStyle(wordsContent).visibility);
                log.elements('📍 wordsContent height:', window.getComputedStyle(wordsContent).height);
                log.elements('📍 wordsContent offsetHeight:', wordsContent.offsetHeight);
                
                // Tab butonlarını güncelle
                wordsTab.style.background = 'linear-gradient(135deg, #8B4513 0%, #D2691E 100%)';
                wordsTab.style.color = 'white';
                wordsTab.style.border = 'none';
                
                generalTab.style.background = 'white';
                generalTab.style.color = '#666';
                generalTab.style.border = '2px solid #e0e0e0';
                
                // Kelime istatistiklerini güncelle
                log.stats('🔍 updateWordStatistics fonksiyon tipi:', typeof updateWordStatistics);
                if (typeof updateWordStatistics === 'function') {
                    log.stats('✅ updateWordStatistics çağrılıyor...');
                    updateWordStatistics();
                } else {
                    log.error('❌ updateWordStatistics fonksiyon DEĞİL!');
                }
            }
        }
        
        // Daily Goal Functions
        function showDailyGoalSettings() {
            document.getElementById('dailyGoalModal').style.display = 'flex';
        }
        
        function closeDailyGoalModal() {
            document.getElementById('dailyGoalModal').style.display = 'none';
        }
        
        function setDailyGoal(level) {
            // 1 saat oyun = ~8000 XP
            // Kolay: 10 dakika (~1300 XP)
            // Normal: 20 dakika (~2700 XP)  
            // Ciddi: 45 dakika (~6000 XP)
            const goals = {
                easy: { xp: 1300, name: 'Rahat', icon: '🌱' },
                normal: { xp: 2700, name: 'Normal', icon: '🎯' },
                serious: { xp: 6000, name: 'Ciddi', icon: '🔥' }
            };
            
            const goal = goals[level];
            localStorage.setItem('dailyGoalLevel', level);
            localStorage.setItem('dailyGoalXP', goal.xp);
            
            // Günlük XP'yi sıfırla (her gün başta)
            const today = new Date().toDateString();
            const lastDate = localStorage.getItem('lastDailyGoalDate');
            if (lastDate !== today) {
                localStorage.setItem('dailyXP', '0');
                localStorage.setItem('lastDailyGoalDate', today);
            }
            
            updateDailyGoalDisplay();
            closeDailyGoalModal();
            
            // Başarı mesajı
            showSuccessMessage(goal.icon + ' Günlük hedefin ' + goal.name + ' olarak ayarlandı!');
        }
        
        function updateDailyGoalDisplay() {
            const goalXP = parseInt(localStorage.getItem('dailyGoalXP')) || 2700;
            const dailyXP = parseInt(localStorage.getItem('dailyXP')) || 0;
            const goalLevel = localStorage.getItem('dailyGoalLevel') || 'normal';
            
            const goals = {
                easy: { name: 'Rahat', icon: '🌱' },
                normal: { name: 'Normal', icon: '🎯' },
                serious: { name: 'Ciddi', icon: '🔥' }
            };
            
            const progressPercent = Math.min((dailyXP / goalXP) * 100, 100);
            
            // NULL KONTROL - Elementleri kontrol et
            const progressEl = document.getElementById('dailyGoalProgress');
            const progressTextEl = document.getElementById('dailyGoalProgressText');
            const goalTextEl = document.getElementById('dailyGoalText');
            
            if (!progressEl || !progressTextEl || !goalTextEl) {
                log.error('❌ HATA: Günlük hedef elementleri bulunamadı!');
                return;
            }
            
            progressEl.style.width = progressPercent + '%';
            progressTextEl.textContent = dailyXP + ' / ' + goalXP + ' XP';
            goalTextEl.textContent = goalXP + ' XP hedefine ulaş! (' + goals[goalLevel].name + ')';
            
            // Hedef tamamlandıysa
            if (dailyXP >= goalXP) {
                goalTextEl.textContent = '✅ Günlük hedef tamamlandı!';
            }
        }
        
        function addDailyXP(xp) {
            const today = new Date().toDateString();
            const lastDate = localStorage.getItem('lastDailyGoalDate');
            
            // Yeni gün başladıysa sıfırla
            if (lastDate !== today) {
                localStorage.setItem('dailyXP', '0');
                localStorage.setItem('lastDailyGoalDate', today);
            }
            
            const currentXP = parseInt(localStorage.getItem('dailyXP')) || 0;
            const goalXP = parseInt(localStorage.getItem('dailyGoalXP')) || 2700;
            const newXP = currentXP + xp;
            
            localStorage.setItem('dailyXP', newXP.toString());
            
            // Hedef tamamlandıysa
            if (currentXP < goalXP && newXP >= goalXP) {
                setTimeout(() => {
                    showSuccessMessage('🎉 Günlük hedefini tamamladın! +1000 bonus XP!');
                    // Bonus XP ekle (puan sistemine direkt ekle)
                    totalPoints += 1000;
                    updateStatsBar();
                    saveStats();
                    checkAchievements();
                }, 1000);
            }
            
            updateDailyGoalDisplay();
        }
        
        function showSuccessMessage(message) {
            const msg = document.createElement('div');
            msg.textContent = message;
            msg.style.cssText = 'position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background: linear-gradient(135deg, #4ade80 0%, #22c55e 100%); color: white; padding: 15px 25px; border-radius: 12px; font-weight: 600; z-index: 10000; box-shadow: 0 8px 24px rgba(74,222,128,0.4); animation: slideDown 0.3s ease;';
            document.body.appendChild(msg);
            
            setTimeout(() => {
                msg.style.animation = 'slideUp 0.3s ease';
                setTimeout(() => msg.remove(), 300);
            }, 3000);
        }
        
        // Ses sistemi (GLOBAL)
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        
        function playSound(type) {
            const now = audioContext.currentTime;
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            switch(type) {
                case 'correct':
                    // Yükselen tonlar (C5 -> E5 -> G5)
                    oscillator.frequency.setValueAtTime(523.25, now); // C5
                    oscillator.frequency.setValueAtTime(659.25, now + 0.1); // E5
                    oscillator.frequency.setValueAtTime(783.99, now + 0.2); // G5
                    gainNode.gain.setValueAtTime(0.3, now);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.3);
                    oscillator.start(now);
                    oscillator.stop(now + 0.3);
                    break;
                    
                case 'wrong':
                    // Düşen ton (G4 -> C4)
                    oscillator.frequency.setValueAtTime(392.00, now); // G4
                    oscillator.frequency.exponentialRampToValueAtTime(261.63, now + 0.2); // C4
                    gainNode.gain.setValueAtTime(0.2, now);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.2);
                    oscillator.start(now);
                    oscillator.stop(now + 0.2);
                    break;
                    
                case 'levelup':
                    // Fanfar (C5 -> E5 -> G5 -> C6)
                    oscillator.frequency.setValueAtTime(523.25, now); // C5
                    oscillator.frequency.setValueAtTime(659.25, now + 0.1); // E5
                    oscillator.frequency.setValueAtTime(783.99, now + 0.2); // G5
                    oscillator.frequency.setValueAtTime(1046.50, now + 0.3); // C6
                    gainNode.gain.setValueAtTime(0.3, now);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.5);
                    oscillator.start(now);
                    oscillator.stop(now + 0.5);
                    break;
                    
                case 'combo':
                    // Hızlı yükselen tonlar
                    oscillator.frequency.setValueAtTime(523.25, now); // C5
                    oscillator.frequency.setValueAtTime(783.99, now + 0.05); // G5
                    oscillator.frequency.setValueAtTime(1046.50, now + 0.1); // C6
                    gainNode.gain.setValueAtTime(0.25, now);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.15);
                    oscillator.start(now);
                    oscillator.stop(now + 0.15);
                    break;
            }
        }
        
        // ============ KELİME İSTATİSTİKLERİ FONKSİYONLARI ============
        function updateWordStatistics() {
            log.stats('📊 updateWordStatistics ÇAĞRILDI!');
            
            const wordStats = loadWordStats();
            log.stats('📦 wordStats yüklendi:', wordStats);
            
            // Genel istatistikleri hesapla
            const totalWords = Object.keys(wordStats).length;
            const masteredWords = Object.values(wordStats).filter(stat => stat.masteryLevel >= 3.0 && stat.successRate >= 0.6).length;
            const strugglingWords = Object.values(wordStats).filter(stat => stat.successRate < 0.6 || stat.masteryLevel < 1.0).length;
            
            // Genel özet güncelle
            document.getElementById('wordStatsTotal').textContent = totalWords;
            document.getElementById('wordStatsMastered').textContent = masteredWords;
            document.getElementById('wordStatsStruggling').textContent = strugglingWords;
            
            // Kelime listesini göster (varsayılan: hepsi)
            filterWordStats('all');
            
            // Event listener'ları ekle (sadece bir kez)
            const statsContentWords = document.getElementById('statsContentWords');
            if (!statsContentWords.hasAttribute('data-listeners-added')) {
                document.getElementById('filterAll').onclick = () => filterWordStats('all');
                document.getElementById('filterMastered').onclick = () => filterWordStats('mastered');
                document.getElementById('filterStruggling').onclick = () => filterWordStats('struggling');
                document.getElementById('filterRecent').onclick = () => filterWordStats('recent');
                statsContentWords.setAttribute('data-listeners-added', 'true');
            }
        }
        
        function filterWordStats(filterType) {
            try {
                log.stats('🔍 filterWordStats BAŞLADI, filterType:', filterType);
                
                const wordStats = loadWordStats();
                const listContainer = document.getElementById('wordStatsList');
                log.stats('🔍 filterWordStats çağrıldı, filterType:', filterType, 'wordStats:', wordStats, 'toplam kelime:', Object.keys(wordStats).length);
                log.elements('📦 listContainer elementi:', listContainer ? 'BULUNDU ✅' : 'BULUNAMADI ❌');
                
                if (!listContainer) {
                    log.error('❌ HATA: wordStatsList elementi bulunamadı!');
                    return;
                }
                
                // Filtre butonlarını güncelle
                document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
                const filterBtn = document.getElementById('filter' + filterType.charAt(0).toUpperCase() + filterType.slice(1));
                if (filterBtn) filterBtn.classList.add('active');
                
                let filteredStats = [];
                
                log.stats('🎯 kelimeCevirData uzunluğu:', window.kelimeCevirData ? window.kelimeCevirData.length : 'undefined');
                log.stats('📦 wordStats keyleri:', Object.keys(wordStats));
                
                // Filtreleme
                Object.entries(wordStats).forEach(([wordId, stat]) => {
                    log.stats('🔄 İşleniyor:', wordId, stat);
                    
                    // Kelime verisini bul
                    let wordData = null;
                    
                    // ID formatı: "sure:ayet:kelime" (örn: "105:4:1" veya "2:51:4")
                    // kelimeCevirData'da ID aynı formatta
                    if (window.kelimeCevirData && window.kelimeCevirData.length > 0) {
                        wordData = window.kelimeCevirData.find(w => w.id === wordId);
                    }
                    
                    log.stats('🔍 wordId:', wordId, 'wordData bulundu mu?', wordData ? 'EVET ✅' : 'HAYIR ❌');
                    
                    // Bulunamazsa - ID'den parse et
                    if (!wordData) {
                        const [sure, ayet, kelimeIndex] = wordId.split(':');
                        wordData = { 
                            kelime: wordId, // Geçici olarak ID'yi göster
                            anlam: `Sure ${sure}, Ayet ${ayet}, Kelime ${kelimeIndex}`,
                            id: wordId
                        };
                        log.warn('⚠️ Kelime verisi bulunamadı, geçici veri oluşturuldu:', wordData);
                    }
                    
                    const shouldShow = 
                        filterType === 'all' ||
                        (filterType === 'mastered' && stat.masteryLevel >= 3.0 && stat.successRate >= 0.6) ||
                        (filterType === 'struggling' && (stat.successRate < 0.6 || stat.masteryLevel < 1.0)) ||
                        (filterType === 'recent' && (Date.now() - stat.lastSeen) < 7 * 24 * 60 * 60 * 1000); // Son 7 gün
                    
                    log.stats('🤔 shouldShow:', shouldShow, 'filterType:', filterType, 'stat:', stat);
                    
                    if (shouldShow) {
                        filteredStats.push({ wordId, ...stat, wordData });
                        log.stats('✅ Listeye eklendi:', wordId);
                    } else {
                        log.stats('❌ Listeye EKLENMEDİ:', wordId);
                    }
                });
                
                log.stats('📋 Filtreleme TAMAMLANDI, sonuç:', filteredStats.length, 'kelime');
                
                // Sıralama (öncelik puanına göre)
                filteredStats.sort((a, b) => {
                    if (filterType === 'recent') {
                        return b.lastSeen - a.lastSeen; // En son görülenler önce
                    }
                    return b.priority - a.priority; // Yüksek öncelik önce
                });
                
                log.stats('📋 Sıralama sonrası:', filteredStats.length, 'kelime');
                log.stats('📦 İlk 3 kelime:', filteredStats.slice(0, 3));
                
                // Liste içeriğini oluştur
                if (filteredStats.length === 0) {
                    log.stats('⚠️ filteredStats boş, empty state gösteriliyor');
                // Toplam kelime sayısını kontrol et
                const totalWords = Object.keys(wordStats).length;
                log.stats('📝 Filtrelenmiş liste boş. totalWords:', totalWords, 'filterType:', filterType);
                
                if (totalWords === 0) {
                    // Hiç oyun oynanmamış
                    log.stats('🎮 Hiç oyun oynanmamış - onboarding kartı gösteriliyor');
                    const cardHTML = `
                        <div style="text-align: center; padding: 40px 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 12px; color: white; margin: 20px 0;">
                            <div style="font-size: 3em; margin-bottom: 15px;">🎮</div>
                            <div style="font-size: 1.2em; font-weight: bold; margin-bottom: 10px;">Henüz Hiç Oyun Oynamadın!</div>
                            <div style="font-size: 0.95em; opacity: 0.95; margin-bottom: 20px; line-height: 1.5;">
                                Kelime istatistiklerini görmek için oyun oynamaya başla!<br>
                                Her kelimeyle çalıştıkça ilerleme kaydedilecek 📈
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; max-width: 300px; margin: 0 auto;">
                                <div style="background: rgba(255,255,255,0.2); padding: 12px; border-radius: 8px;">
                                    <div style="font-size: 1.5em; margin-bottom: 5px;">📚</div>
                                    <div style="font-size: 0.8em;">Kelime Çevir</div>
                                </div>
                                <div style="background: rgba(255,255,255,0.2); padding: 12px; border-radius: 8px;">
                                    <div style="font-size: 1.5em; margin-bottom: 5px;">🎧</div>
                                    <div style="font-size: 0.8em;">Dinle ve Bul</div>
                                </div>
                                <div style="background: rgba(255,255,255,0.2); padding: 12px; border-radius: 8px;">
                                    <div style="font-size: 1.5em; margin-bottom: 5px;">✏️</div>
                                    <div style="font-size: 0.8em;">Boşluk Doldur</div>
                                </div>
                                <div style="background: rgba(255,255,255,0.2); padding: 12px; border-radius: 8px;">
                                    <div style="font-size: 1.5em; margin-bottom: 5px;">📖</div>
                                    <div style="font-size: 0.8em;">Ayet Oku</div>
                                </div>
                            </div>
                            <div style="margin-top: 20px; font-size: 0.9em; opacity: 0.9;">
                                Ana menüden bir oyun seç ve başla! 🚀
                            </div>
                        </div>
                    `;
                    listContainer.innerHTML = cardHTML;
                    log.elements('✅ Kart HTML\'i listContainer\'a eklendi, innerHTML uzunluğu:', listContainer.innerHTML.length);
                    log.elements('📍 listContainer display:', window.getComputedStyle(listContainer).display);
                    log.elements('📍 listContainer visibility:', window.getComputedStyle(listContainer).visibility);
                } else {
                    // Oyun oynanmış ama bu kategoride kelime yok
                    log.stats('📋 Oyun oynanmış ama bu kategoride kelime yok - filtre mesajı gösteriliyor');
                    const filterMessages = {
                        'all': 'Henüz hiç kelime istatistiği yok',
                        'mastered': 'Henüz öğrenilmiş kelime yok. Daha fazla pratik yap! 💪',
                        'struggling': 'Harika! Zorlandığın kelime yok. Devam et! 🎉',
                        'recent': 'Son 7 günde kelime çalışılmamış. Bugün pratik yap! 📅'
                    };
                    
                    listContainer.innerHTML = `
                        <div style="text-align: center; padding: 40px 20px; color: #666;">
                            <div style="font-size: 2.5em; margin-bottom: 15px;">
                                ${filterType === 'struggling' ? '🎉' : '🔍'}
                            </div>
                            <div style="font-size: 1.1em; font-weight: 600; margin-bottom: 10px; color: #333;">
                                ${filterMessages[filterType] || 'Bu kategoride kelime bulunamadı'}
                            </div>
                            <div style="font-size: 0.9em; color: #666; margin-top: 10px;">
                                ${filterType === 'mastered' ? 'Daha fazla oyun oyna ve kelimeleri öğren!' : 
                                  filterType === 'struggling' ? 'Tüm kelimeler iyi durumda!' :
                                  filterType === 'recent' ? 'Oyun oynayarak listeni güncel tut!' :
                                  'Oyun oynayarak istatistik oluşturmaya başla!'}
                            </div>
                        </div>
                    `;
                }
                return;
            }
            
            // console.log('✅ Kelime listesi gösteriliyor, toplam:', filteredStats.length, 'kelime');
            listContainer.innerHTML = filteredStats.slice(0, 50).map(item => { // En fazla 50 kelime göster
                const masteryColor = item.masteryLevel >= 3 ? '#27ae60' : item.masteryLevel >= 1.5 ? '#f39c12' : '#e74c3c';
                const masteryText = item.masteryLevel >= 3 ? 'Öğrenildi' : item.masteryLevel >= 1.5 ? 'Öğreniliyor' : 'Zorlanıyor';
                const successPercent = Math.round(item.successRate * 100);
                
                return `
                    <div style="background: white; border-radius: 8px; padding: 12px; margin: 8px 0; border-left: 4px solid ${masteryColor}; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                        <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 8px;">
                            <div style="flex: 1;">
                                <div style="font-size: 1.1em; font-weight: bold; color: #2c3e50; margin-bottom: 2px;">${item.wordData.kelime || item.wordId}</div>
                                <div style="font-size: 0.9em; color: #666;">${item.wordData.anlam || 'Bilinmiyor'}</div>
                            </div>
                            <div style="text-align: right;">
                                <div style="background: ${masteryColor}; color: white; padding: 3px 8px; border-radius: 4px; font-size: 0.75em; font-weight: bold;">${masteryText}</div>
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; font-size: 0.8em;">
                            <div style="text-align: center; padding: 6px; background: #f8f9fa; border-radius: 4px;">
                                <div style="font-weight: bold; color: #27ae60;">${successPercent}%</div>
                                <div style="color: #666;">Başarı</div>
                            </div>
                            <div style="text-align: center; padding: 6px; background: #f8f9fa; border-radius: 4px;">
                                <div style="font-weight: bold; color: #3498db;">${item.attempts}</div>
                                <div style="color: #666;">Deneme</div>
                            </div>
                            <div style="text-align: center; padding: 6px; background: #f8f9fa; border-radius: 4px;">
                                <div style="font-weight: bold; color: #f39c12;">${Math.round(item.priority * 100) / 100}</div>
                                <div style="color: #666;">Öncelik</div>
                            </div>
                        </div>
                        
                        <div style="margin-top: 8px; font-size: 0.75em; color: #666; text-align: center;">
                            Son görülme: ${new Date(item.lastSeen).toLocaleDateString('tr-TR')}
                        </div>
                    </div>
                `;
                }).join('');
                
                log.stats('✅ HTML oluşturuldu ve listContainer\'a yazıldı!');
                
            } catch (error) {
                log.error('🚨 filterWordStats HATA:', error);
                log.error('Stack trace:', error.stack);
            }
        }
        
        // ============ KELİME İSTATİSTİK YÖNETİMİ ============
        function loadWordStats() {
            try {
                const saved = localStorage.getItem('hasene_wordStats');
                return saved ? JSON.parse(saved) : {};
            } catch (error) {
                console.error('📊 Kelime istatistikleri yüklenirken hata:', error);
                return {};
            }
        }

        function saveWordStats(wordStats) {
            try {
                localStorage.setItem('hasene_wordStats', JSON.stringify(wordStats));
                // console.log('💾 Kelime istatistikleri kaydedildi');
            } catch (error) {
                console.error('📊 Kelime istatistikleri kaydedilirken hata:', error);
            }
        }

        function updateWordStats(wordId, isCorrect) {
            // NULL KONTROL - wordId geçerli mi?
            if (!wordId || typeof wordId !== 'string') {
                log.error('❌ Geçersiz wordId:', wordId);
                return;
            }
            
            const wordStats = loadWordStats();
            
            if (!wordStats[wordId]) {
                wordStats[wordId] = {
                    attempts: 0,
                    correct: 0,
                    wrong: 0,
                    lastSeen: Date.now(),
                    masteryLevel: 0,
                    priority: 1.0
                };
            }

            const stats = wordStats[wordId];
            stats.attempts++;
            stats.lastSeen = Date.now();

            if (isCorrect) {
                stats.correct++;
                // Doğru cevap - ustalık artır, öncelik azalt
                stats.masteryLevel = Math.min(5, stats.masteryLevel + 0.2);
                stats.priority = Math.max(0.1, stats.priority * 0.8);
            } else {
                stats.wrong++;
                // Yanlış cevap - ustalık azalt, öncelik artır
                stats.masteryLevel = Math.max(0, stats.masteryLevel - 0.5);
                stats.priority = Math.min(3.0, stats.priority * 1.5);
            }

            // Başarı oranı hesapla
            stats.successRate = stats.attempts > 0 ? (stats.correct / stats.attempts) : 0;

            saveWordStats(wordStats);
            log.stats(`📊 ${wordId} kelimesi istatistiği güncellendi:`, stats);
        }

        function selectIntelligentWord(filteredData) {
            const wordStats = loadWordStats();
            const now = Date.now();
            const oneDay = 24 * 60 * 60 * 1000;

            // Her kelime için öncelik puanı hesapla
            const wordsWithPriority = filteredData.map(word => {
                const stats = wordStats[word.id];
                let priorityScore = 1.0;

                if (stats) {
                    // Temel öncelik puanı (yanlış cevaplanan kelimeler daha öncelikli)
                    priorityScore = stats.priority;

                    // Zaman faktörü (uzun süredir görülmeyen kelimeler)
                    const daysSinceLastSeen = (now - stats.lastSeen) / oneDay;
                    if (daysSinceLastSeen > 3) {
                        priorityScore *= (1 + daysSinceLastSeen * 0.1);
                    }

                    // Başarı oranı faktörü (düşük başarı oranı = yüksek öncelik)
                    if (stats.successRate < 0.6) {
                        priorityScore *= (1.5 - stats.successRate);
                    }

                    // Ustalık seviyesi faktörü (düşük ustalık = yüksek öncelik)
                    priorityScore *= (2.0 - stats.masteryLevel / 5.0);
                } else {
                    // Hiç görülmemiş kelimeler orta öncelikli
                    priorityScore = 1.2;
                }

                return {
                    word,
                    priority: priorityScore
                };
            });

            // Önceliğe göre sırala
            wordsWithPriority.sort((a, b) => b.priority - a.priority);

            // Weighted random selection (en öncelikli kelimeler daha fazla seçilir)
            const totalWeight = wordsWithPriority.reduce((sum, item) => sum + item.priority, 0);
            let random = Math.random() * totalWeight;

            for (const item of wordsWithPriority) {
                random -= item.priority;
                if (random <= 0) {
                    // console.log(`🎯 Seçilen kelime: ${item.word.kelime} (öncelik: ${item.priority.toFixed(2)})`);
                    return item.word;
                }
            }

            // Fallback: ilk kelimeyi döndür
            return wordsWithPriority[0]?.word || filteredData[0];
        }
        
        // ============ GLOBAL FONKSİYONLAR SONU ============
        
        // DOM yüklendikten sonra çalıştır
        document.addEventListener('DOMContentLoaded', function() {
            // console.log('🚀 DOM yüklendi, oyun başlatılıyor...');
            
            // Daily Goal'u başlat
            if (!localStorage.getItem('dailyGoalXP')) {
                localStorage.setItem('dailyGoalXP', '2700');
                localStorage.setItem('dailyGoalLevel', 'normal');
            }
            updateDailyGoalDisplay();
            
            // Modal butonlarına event listener ekle
            const dailyTasksBtn = document.getElementById('dailyTasksBtn');
            const badgesBtn = document.getElementById('badgesBtn');
            const statsBtn = document.getElementById('statsBtn');
            const calendarBtn = document.getElementById('calendarBtn');
            const xpInfoBtn = document.getElementById('xpInfoBtn');
            
            // ============ AYARLAR - BURADAN KONTROLEDEBİLİRSİN ============
            const CONFIG = {
            // OYUN MODLARI
            gameModes: {
                klasik: {
                    name: '📚 Klasik',
                    description: 'Normal oyun modu',
                    questionsPerLevel: 10,
                    timeLimit: 0,  // 0 = süre yok
                    lives: 0,      // 0 = sınırsız can
                    showHint: true
                },
                hizli: {
                    name: '⚡ Hızlı',
                    description: '30 saniye süre',
                    questionsPerLevel: 15,
                    timeLimit: 30,
                    lives: 0,
                    showHint: false
                },
                hayat: {
                    name: '❤️ 3 Can',
                    description: '3 hak, yanlış = -1 can',
                    questionsPerLevel: 20,
                    timeLimit: 0,
                    lives: 3,
                    showHint: true
                },
                zorluk: {
                    name: '🔥 Zorluk',
                    description: 'Sadece zor kelimeler',
                    questionsPerLevel: 10,
                    timeLimit: 20,
                    lives: 3,
                    showHint: false,
                    minDifficulty: 7  // 7-10 arası zorluk
                }
            },

            // ZORLUK SEVİYELERİ (1 saat oyun = ~8000 XP hedefli)
            // Ortalama: ~22 XP/soru (360 soru/saat = 7920 XP + combolar)
            difficultyLevels: {
                kolay: {
                    name: '😊 Kolay',
                    minDiff: 5,
                    maxDiff: 9,
                    pointsMultiplier: 2  // ~13 XP/soru
                },
                orta: {
                    name: '😐 Orta',
                    minDiff: 10,
                    maxDiff: 11,
                    pointsMultiplier: 2  // ~21 XP/soru (ideal)
                },
                zor: {
                    name: '😤 Zor',
                    minDiff: 12,
                    maxDiff: 21,
                    pointsMultiplier: 2  // ~33 XP/soru
                },
                karisik: {
                    name: '🎲 Karışık',
                    minDiff: 5,
                    maxDiff: 21,
                    pointsMultiplier: 2  // ~26 XP/soru ortalama
                }
            },

            // VARSAYILAN AYARLAR
            defaultMode: 'klasik',
            defaultDifficulty: 'orta',  // UI'da mevcut olan zorluk seviyesi
            wrongAnswerPenalty: 5  // Yanlış cevap puan cezası
        };

        // ============ ÖZEL ONAY POP-UP ============
        function showCustomConfirm(correct, wrong, xp) {
            return new Promise((resolve) => {
                const confirmModal = document.getElementById('customConfirm');
                const confirmCorrect = document.getElementById('confirmCorrect');
                const confirmWrong = document.getElementById('confirmWrong');
                const confirmXP = document.getElementById('confirmXP');
                const confirmOK = document.getElementById('confirmOK');
                const confirmCancel = document.getElementById('confirmCancel');

                // Değerleri güncelle
                confirmCorrect.textContent = correct;
                confirmWrong.textContent = wrong;
                confirmXP.textContent = xp;

                // Pop-up'ı göster
                confirmModal.style.display = 'flex';

                // Event listener'ları ekle
                const handleOK = () => {
                    confirmModal.style.display = 'none';
                    cleanup();
                    resolve(true);
                };

                const handleCancel = () => {
                    confirmModal.style.display = 'none';
                    cleanup();
                    resolve(false);
                };

                const cleanup = () => {
                    confirmOK.removeEventListener('click', handleOK);
                    confirmCancel.removeEventListener('click', handleCancel);
                };

                confirmOK.addEventListener('click', handleOK);
                confirmCancel.addEventListener('click', handleCancel);
            });
        }

        // ============ ACHIEVEMENT SİSTEMİ (DOMContentLoaded İÇİNDE) ============
        function checkAchievements() {
            const achievements = [
                { id: 'first_win', name: 'İlk Zafer', desc: 'İlk doğru cevabin', icon: '🎯', condition: () => sessionCorrect >= 1 },
                { id: 'combo_master', name: 'Combo Ustası', desc: '5x combo yap', icon: '🔥', condition: () => comboCount >= 5 },
                { id: 'daily_goal', name: 'Günlük Kahraman', desc: 'Günlük hedefini tamamla', icon: '⭐', condition: () => {
                    const dailyXP = parseInt(localStorage.getItem('dailyXP')) || 0;
                    const goalXP = parseInt(localStorage.getItem('dailyGoalXP')) || 2700;
                    return dailyXP >= goalXP;
                }},
                { id: 'streak_7', name: '7 Gün Streak', desc: '7 gün üst üste oyna', icon: '🔥', condition: () => streakData.currentStreak >= 7 },
                { id: 'level_5', name: 'Seviye 5', desc: 'Seviye 5\'e ulaş', icon: '🏆', condition: () => level >= 5 },
                { id: 'level_10', name: 'Seviye 10', desc: 'Seviye 10\'a ulaş', icon: '💎', condition: () => level >= 10 },
                { id: 'level_20', name: 'Seviye 20', desc: 'Seviye 20\'ye ulaş', icon: '🌟', condition: () => level >= 20 },
                // XP bazlı başarımlar (1 saat oyun = 8500 XP mantığında)
                { id: 'xp_500', name: 'İlk Adım', desc: '500 XP topla (~4 dk)', icon: '🌱', condition: () => totalPoints >= 500 },
                { id: 'xp_2000', name: 'Bronz Yolcu', desc: '2,000 XP (1 Bronz)', icon: '🥉', condition: () => totalPoints >= 2000 },
                { id: 'xp_4000', name: 'Hızlı Başlangıç', desc: '4,000 XP topla', icon: '⚡', condition: () => totalPoints >= 4000 },
                { id: 'xp_8500', name: 'Gümüş Master', desc: '8,500 XP (1 Gümüş)', icon: '🥈', condition: () => totalPoints >= 8500 },
                { id: 'xp_17000', name: 'Çift Gümüş', desc: '17,000 XP topla', icon: '💯', condition: () => totalPoints >= 17000 },
                { id: 'xp_25500', name: 'Altın Master', desc: '25,500 XP (1 Altın)', icon: '🥇', condition: () => totalPoints >= 25500 },
                { id: 'xp_51000', name: 'Çift Altın', desc: '51,000 XP topla', icon: '🔥', condition: () => totalPoints >= 51000 },
                { id: 'xp_85000', name: 'Elmas Master', desc: '85,000 XP (1 Elmas)', icon: '💎', condition: () => totalPoints >= 85000 },
                { id: 'xp_170000', name: 'Efsane', desc: '170,000 XP topla', icon: '✨', condition: () => totalPoints >= 170000 }
            ];
            
            const unlockedAchievements = JSON.parse(localStorage.getItem('unlockedAchievements')) || [];
            let newUnlocks = [];
            
            achievements.forEach(ach => {
                if (!unlockedAchievements.includes(ach.id) && ach.condition()) {
                    unlockedAchievements.push(ach.id);
                    newUnlocks.push(ach);
                }
            });
            
            if (newUnlocks.length > 0) {
                localStorage.setItem('unlockedAchievements', JSON.stringify(unlockedAchievements));
                newUnlocks.forEach(ach => {
                    setTimeout(() => {
                        showAchievementUnlock(ach);
                    }, 500);
                });
            }
        }
        
        function showAchievementUnlock(achievement) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 80px;
                left: 50%;
                transform: translateX(-50%) translateY(-100px);
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                padding: 20px 30px;
                border-radius: 16px;
                z-index: 10001;
                box-shadow: 0 10px 40px rgba(102,126,234,0.5);
                text-align: center;
                min-width: 280px;
                animation: achievementSlide 0.5s ease forwards;
            `;
            
            notification.innerHTML = `
                <div style="font-size: 3em; margin-bottom: 10px;">${achievement.icon}</div>
                <div style="font-size: 1.2em; font-weight: bold; margin-bottom: 5px;">Başarım Kazanıldı!</div>
                <div style="font-size: 1em; font-weight: 600; margin-bottom: 3px;">${achievement.name}</div>
                <div style="font-size: 0.85em; opacity: 0.9;">${achievement.desc}</div>
            `;
            
            document.body.appendChild(notification);
            
            // CSS animation ekle
            if (!document.getElementById('achievementAnim')) {
                const style = document.createElement('style');
                style.id = 'achievementAnim';
                style.textContent = `
                    @keyframes achievementSlide {
                        to { transform: translateX(-50%) translateY(0); }
                    }
                `;
                document.head.appendChild(style);
            }
            
            setTimeout(() => {
                notification.style.animation = 'slideUp 0.5s ease forwards';
                setTimeout(() => notification.remove(), 500);
            }, 4000);
        }

        // ============ OYUN DURUMU ============
        let kelimeBulData = [];  // kelimebul.json
        let ayetOkuData = [];    // ayetoku_formatted.json (optimized)
        let duaData = [];        // duaet.json
        let hadisData = [];      // hadisoku.json
        
        let currentQuestion = null;
        let currentAyetIndex = 0;
        let currentDuaIndex = 0;
        let currentHadisIndex = 0;
        
        // Ses kontrolü için
        let currentAudio = null;

        // Arapça karakter tespiti için yardımcı fonksiyon
        function isArabic(text) {
            const arabicRegex = /[\u0600-\u06FF]/;
            return arabicRegex.test(text);
        }
        
        // Kelime Çevir oyunu için
        let kelimeCevirScore = 0;
        let kelimeCevirCorrect = 0;
        let kelimeCevirWrong = 0;
        
        // Dinle ve Bul oyunu için
        let dinleScore = 0;
        let dinleCorrect = 0;
        let dinleWrong = 0;
        
        // Boşluk Doldur oyunu için
        let boslukScore = 0;
        let boslukCorrect = 0;
        let boslukWrong = 0;
        
        // GLOBAL (KALICI) PUANLAR
        let totalPoints = 0;  // Toplam oyun puanı (kalıcı)
        let starPoints = 0;   // Yıldız puanı (her 500 puan = 1 yıldız)
        let level = 1;        // Global seviye

        // ROZET SİSTEMİ
        let badges = {
            bronze: 0,   // Bronz rozetler (5 yıldız = 1 bronz)
            silver: 0,   // Gümüş rozetler (5 bronz = 1 gümüş)
            gold: 0,     // Altın rozetler (5 gümüş = 1 altın)
            diamond: 0   // Elmas rozetler (5 altın = 1 elmas)
        };

        // STREAK SİSTEMİ (GÜNLİK TAKİP)
        let streakData = {
            currentStreak: 0,    // Mevcut ardışık gün sayısı
            bestStreak: 0,       // En iyi streak rekoru
            lastPlayDate: '',    // Son oyun oynanan tarih (YYYY-MM-DD)
            totalPlayDays: 0,    // Toplam oyun oynanan gün sayısı
            dailyGoal: 5,        // Günlük hedef (doğru cevap sayısı)
            todayProgress: 0,    // Bugünkü ilerleme
            todayDate: '',       // Bugünün tarihi
            playDates: []        // Oyun oynanan tarihler listesi
        };

        // GÜNLİK GÖREVLER SİSTEMİ
        let dailyTasks = {
            lastTaskDate: '',    // Son görev yenileme tarihi
            tasks: [],           // Günlük görevler listesi
            bonusTasks: [],      // Bonus görevler listesi
            completedTasks: [],  // Tamamlanan görevler
            rewardsClaimed: false, // Ödül toplandı mı?
            todayStats: {        // Bugünkü oyun istatistikleri
                kelimeCevir: 0,
                dinleBul: 0,
                boslukDoldur: 0,
                ayetOku: 0,
                duaOgre: 0,
                hadisOku: 0,
                toplamDogru: 0,
                toplamPuan: 0,
                perfectStreak: 0,
                farklıZorluk: new Set()
            }
        };

        // SESSION (OYUN İÇİ) PUANLAR
        let sessionScore = 0;     // Bu oyunun puanı
        let sessionCorrect = 0;   // Bu oyunun doğru sayısı
        let sessionWrong = 0;     // Bu oyunun yanlış sayısı
        let comboCount = 0;       // Üst üste doğru sayısı (combo)

        // ESKI DEĞİŞKENLER (Geriye uyumluluk için)
        let score = 0;
        let correct = 0;
        let wrong = 0;
        let questionCount = 0;
        let currentMode = CONFIG.defaultMode;
        let currentDifficulty = CONFIG.defaultDifficulty;
        
        console.log('Session değişkenleri başlatıldı:', {sessionScore, sessionCorrect, sessionWrong});
        console.log(`🏁 Varsayılan zorluk seviyesi: ${currentDifficulty}`);
        let lives = 0;
        let timer = null;
        let timeLeft = 0;

        // ============ DOM ELEMANLARI ============
        const elements = {
            // Ana menü
            mainMenu: document.getElementById('mainMenu'),
            kelimeCevirBtn: document.getElementById('kelimeCevirBtn'),
            dinleBulBtn: document.getElementById('dinleBulBtn'),
            boslukDoldurBtn: document.getElementById('boslukDoldurBtn'),
            duaEtBtn: document.getElementById('duaEtBtn'),
            ayetOkuBtn: document.getElementById('ayetOkuBtn'),
            hadisOkuBtn: document.getElementById('hadisOkuBtn'),
            
            // Kelime oyunu
            score: document.getElementById('score'),
            level: document.getElementById('level'),
            correct: document.getElementById('correct'),
            wrong: document.getElementById('wrong'),
            progressBar: document.getElementById('progressBar'),
            sureInfo: document.getElementById('sureInfo'),
            arabicWord: document.getElementById('arabicWord'),
            audioBtn: document.getElementById('audioBtn'),
            hintBtn: document.getElementById('hintBtn'),
            options: document.getElementById('options'),
            feedback: document.getElementById('feedback'),
            nextBtn: document.getElementById('nextBtn'),
            difficulty: document.getElementById('difficulty'),
            modal: document.getElementById('modal'),
            newLevel: document.getElementById('newLevel'),
            modalBtn: document.getElementById('modalBtn'),
            modeSelector: document.getElementById('modeSelector'),
            gameScreen: document.getElementById('gameScreen'),
            settingsBtn: document.getElementById('settingsBtn'),
            startBtn: document.getElementById('startBtn'),
            modeButtons: document.getElementById('modeButtons'),
            difficultyButtons: document.getElementById('difficultyButtons'),
            lives: document.getElementById('lives'),
            livesDisplay: document.getElementById('livesDisplay'),
            timer: document.getElementById('timer'),
            timerDisplay: document.getElementById('timerDisplay'),
            currentMode: document.getElementById('currentMode'),
            gameOverModal: document.getElementById('gameOverModal'),
            gameOverTitle: document.getElementById('gameOverTitle'),
            gameOverText: document.getElementById('gameOverText'),
            finalScore: document.getElementById('finalScore'),
            restartBtn: document.getElementById('restartBtn'),
            backToMenuBtn: document.getElementById('backToMenuBtn'),
            backFromGameBtn: document.getElementById('backFromGameBtn'),
            
            // Ayet modu
            ayetMode: document.getElementById('ayetMode'),
            ayetSureInfo: document.getElementById('ayetSureInfo'),
            ayetArabic: document.getElementById('ayetArabic'),
            ayetTranslation: document.getElementById('ayetTranslation'),
            ayetAudioBtn: document.getElementById('ayetAudioBtn'),
            prevAyetBtn: document.getElementById('prevAyetBtn'),
            nextAyetBtn: document.getElementById('nextAyetBtn'),
            backFromAyetBtn: document.getElementById('backFromAyetBtn'),
            
            // Dua modu
            duaMode: document.getElementById('duaMode'),
            duaSureInfo: document.getElementById('duaSureInfo'),
            duaArabic: document.getElementById('duaArabic'),
            duaTranslation: document.getElementById('duaTranslation'),
            duaAudioBtn: document.getElementById('duaAudioBtn'),
            prevDuaBtn: document.getElementById('prevDuaBtn'),
            nextDuaBtn: document.getElementById('nextDuaBtn'),
            backFromDuaBtn: document.getElementById('backFromDuaBtn'),
            
            // Hadis modu
            hadisMode: document.getElementById('hadisMode'),
            hadisCategory: document.getElementById('hadisCategory'),
            hadisTitle: document.getElementById('hadisTitle'),
            hadisHeader: document.getElementById('hadisHeader'),
            hadisText: document.getElementById('hadisText'),
            hadisRef: document.getElementById('hadisRef'),
            prevHadisBtn: document.getElementById('prevHadisBtn'),
            nextHadisBtn: document.getElementById('nextHadisBtn'),
            backFromHadisBtn: document.getElementById('backFromHadisBtn'),
            
            // Boşluk Doldur modu
            boslukMode: document.getElementById('boslukMode'),
            boslukSureInfo: document.getElementById('boslukSureInfo'),
            boslukAyetText: document.getElementById('boslukAyetText'),
            boslukAudioBtn: document.getElementById('boslukAudioBtn'),
            boslukOptions: document.getElementById('boslukOptions'),
            boslukFeedback: document.getElementById('boslukFeedback'),
            boslukNextBtn: document.getElementById('boslukNextBtn'),
            boslukScore: document.getElementById('boslukScore'),
            boslukCorrect: document.getElementById('boslukCorrect'),
            boslukWrong: document.getElementById('boslukWrong'),
            backFromBoslukBtn: document.getElementById('backFromBoslukBtn'),
            
            // Dinle ve Bul modu
            dinleMode: document.getElementById('dinleMode'),
            dinleSureInfo: document.getElementById('dinleSureInfo'),
            dinleAudioBtn: document.getElementById('dinleAudioBtn'),
            dinleOptions: document.getElementById('dinleOptions'),
            dinleFeedback: document.getElementById('dinleFeedback'),
            dinleNextBtn: document.getElementById('dinleNextBtn'),
            dinleScore: document.getElementById('dinleScore'),
            dinleCorrect: document.getElementById('dinleCorrect'),
            dinleWrong: document.getElementById('dinleWrong'),
            backFromDinleBtn: document.getElementById('backFromDinleBtn')
        };
        
        // ============ KRİTİK: NULL KONTROL - EKSIK ELEMENTLER ============
        function checkElements() {
            const missing = [];
            const critical = ['mainMenu', 'kelimeCevirBtn', 'dinleBulBtn', 'boslukDoldurBtn', 
                            'ayetOkuBtn', 'gameScreen', 'modeSelector'];
            
            for (const [key, value] of Object.entries(elements)) {
                if (!value) {
                    missing.push(key);
                    if (critical.includes(key)) {
                        log.error(`❌ KRİTİK: '${key}' elementi bulunamadı!`);
                    }
                }
            }
            
            if (missing.length > 0) {
                log.warn('⚠️ Eksik elementler:', missing.join(', '));
            }
            
            return missing.length === 0;
        }

        // ============ SES DURDURMA FONKSİYONU ============
        function stopCurrentAudio() {
            if (currentAudio && !currentAudio.paused) {
                currentAudio.pause();
                currentAudio.currentTime = 0;
                currentAudio = null;
            }
        }

        // ============ SES ÇALMA FONKSİYONU ============
        function playAudio(audioUrl, button) {
            // Eğer ses çalıyorsa durdur
            stopCurrentAudio();
            
            if (!audioUrl) {
                log.error('Ses dosyası bulunamadı');
                return;
            }
            
            // Butonu devre dışı bırak
            if (button) button.disabled = true;
            
            currentAudio = new Audio(audioUrl);
            
            currentAudio.play().catch(err => {
                log.error('Ses hatası:', err);
                if (button) button.disabled = false;
            });
            
            // Ses bittiğinde butonu aktif et
            currentAudio.onended = () => {
                if (button) button.disabled = false;
            };
        }

        // ============ VERİ YÜKLEME ============
        async function loadData() {
            try {
                // Kelime verilerini yükle (Kelime Çevir ve Dinle ve Bul için)
                const kelimeResponse = await fetch('kelimebul.json');
                kelimeBulData = await kelimeResponse.json();
                // console.log(`${kelimeBulData.length} kelime yüklendi`);
                
                // Ayet verilerini yükle (Boşluk Doldur ve Ayet Oku için)
                const ayetResponse = await fetch('ayetoku_formatted.json');
                ayetOkuData = await ayetResponse.json();
                // console.log(`${ayetOkuData.length} ayet yüklendi`);
                
                // Dua verilerini yükle (Dua Et için)
                const duaResponse = await fetch('duaet.json');
                duaData = await duaResponse.json();
                // console.log(`${duaData.length} dua yüklendi`);
                
                // Hadis verilerini yükle (Hadis Oku için)
                const hadisResponse = await fetch('hadisoku.json');
                hadisData = await hadisResponse.json();
                // console.log(`${hadisData.length} hadis yüklendi`);
                
                // Mod seçiciyi başlat
                initModeSelector();

                // Ana menü zorluk butonlarını başlat
                initMainMenuDifficultyButtons();
                
            } catch (error) {
                log.error('Veri yükleme hatası:', error);
                // NULL KONTROL - mainMenu varsa hata mesajı göster
                if (elements.mainMenu) {
                    elements.mainMenu.innerHTML = '<p style="color: red; text-align: center;">Veriler yüklenemedi!</p>';
                } else {
                    log.error('❌ KRİTİK: mainMenu elementi bulunamadı!');
                }
            }
        }

        // ============ İNDEXEDDB SİSTEMİ (ÜÇÜNCü TARAF ÇEREZİ SORUNU İÇİN) ============
        let db = null;
        
        function initIndexedDB() {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open('HaseneGameDB', 1);
                
                request.onerror = () => reject(request.error);
                request.onsuccess = () => {
                    db = request.result;
                    resolve(db);
                };
                
                request.onupgradeneeded = (event) => {
                    db = event.target.result;
                    if (!db.objectStoreNames.contains('gameData')) {
                        db.createObjectStore('gameData');
                    }
                };
            });
        }
        
        function saveToIndexedDB(key, value) {
            if (!db) return;
            try {
                const transaction = db.transaction(['gameData'], 'readwrite');
                const store = transaction.objectStore('gameData');
                store.put(value, key);
            } catch(e) { console.log('IndexedDB save failed:', e); }
        }
        
        function loadFromIndexedDB(key) {
            return new Promise((resolve) => {
                if (!db) { resolve(null); return; }
                try {
                    const transaction = db.transaction(['gameData'], 'readonly');
                    const store = transaction.objectStore('gameData');
                    const request = store.get(key);
                    request.onsuccess = () => resolve(request.result || null);
                    request.onerror = () => resolve(null);
                } catch(e) { resolve(null); }
            });
        }

        // URL TABANLI VERİ SAKLAMA (Mobil fallback - hiçbir şey çalışmazsa)
        function saveToURL() {
            const gameData = {
                p: totalPoints, // points
                b: badges.bronze + ',' + badges.silver + ',' + badges.gold + ',' + badges.diamond, // badges
                s: streakData.currentStreak, // streak
                d: new Date().toISOString().split('T')[0] // date
            };
            const encoded = btoa(JSON.stringify(gameData));
            const newUrl = window.location.origin + window.location.pathname + '?data=' + encoded;
            
            // URL'yi geçmişe ekle (geri butonu ile erişilebilir)
            if (window.history.pushState) {
                window.history.pushState({gameData: encoded}, '', newUrl);
            }
            console.log('🔗 URL\'ye kaydedildi:', totalPoints, 'puan');
        }
        
        function loadFromURL() {
            try {
                const urlParams = new URLSearchParams(window.location.search);
                const data = urlParams.get('data');
                if (data) {
                    const decoded = JSON.parse(atob(data));
                    totalPoints = parseInt(decoded.p) || 0;
                    
                    // Rozet verilerini yükle
                    if (decoded.b) {
                        const badgeArray = decoded.b.split(',');
                        badges.bronze = parseInt(badgeArray[0]) || 0;
                        badges.silver = parseInt(badgeArray[1]) || 0;
                        badges.gold = parseInt(badgeArray[2]) || 0;
                        badges.diamond = parseInt(badgeArray[3]) || 0;
                    }
                    
                    // Streak verilerini yükle
                    if (decoded.s) {
                        streakData.currentStreak = parseInt(decoded.s) || 0;
                    }
                    
                    console.log('🔗 URL\'den yüklendi:', totalPoints, 'puan');
                    return true;
                }
            } catch(e) {
                console.log('URL yükleme hatası:', e);
            }
            return false;
        }

        // ============ İSTATİSTİK BAR FONKSİYONLARI ============
        async function loadStats() {
            try {
                // IndexedDB'den yükle (üçüncü taraf çerez sorunu için)
                const savedPoints = await loadFromIndexedDB('hasene_totalPoints');
                const savedBadges = await loadFromIndexedDB('hasene_badges');
                const savedStreak = await loadFromIndexedDB('hasene_streak');
                const savedTasks = await loadFromIndexedDB('hasene_dailyTasks');
                
                // Puanları yükle (IndexedDB öncelikli, localStorage yedek)
                totalPoints = parseInt(savedPoints || localStorage.getItem('hasene_totalPoints') || '0');
                starPoints = Math.floor(totalPoints / 500);
                level = calculateLevel(totalPoints);
                
                log.debug('📊 IndexedDB yüklendi:', {totalPoints, savedPoints});
            } catch (error) {
                log.debug('IndexedDB hatası, localStorage denenecek:', error);
                try {
                    // localStorage dene
                    totalPoints = parseInt(localStorage.getItem('hasene_totalPoints') || '0');
                    starPoints = Math.floor(totalPoints / 500);
                    level = calculateLevel(totalPoints);
                    log.debug('📊 localStorage yüklendi:', totalPoints);
                } catch (localError) {
                    log.debug('localStorage da çalışmıyor, URL deneniyor:', localError);
                    // Son çare: URL'den yükle
                    const urlLoaded = loadFromURL();
                    if (urlLoaded) {
                        starPoints = Math.floor(totalPoints / 500);
                        level = calculateLevel(totalPoints);
                    } else {
                        // Hiçbir şey çalışmıyor, varsayılan değerler
                        totalPoints = 0;
                        starPoints = 0;
                        level = 1;
                        log.warn('⚠️ Hiçbir veri sistemi çalışmıyor, sıfırdan başlatılıyor');
                    }
                }
            }
            
            // Rozet sistemi yükle (IndexedDB öncelikli)
            const savedBadgesIndexedDB = await loadFromIndexedDB('hasene_badges');
            const savedBadgesData = savedBadgesIndexedDB || localStorage.getItem('hasene_badges');
            if (savedBadgesData) {
                badges = JSON.parse(typeof savedBadgesData === 'string' ? savedBadgesData : JSON.stringify(savedBadgesData));
            }
            
            // Streak sistemi yükle (IndexedDB öncelikli)
            const savedStreakIndexedDB = await loadFromIndexedDB('hasene_streak');
            const savedStreak = savedStreakIndexedDB || localStorage.getItem('hasene_streak');
            if (savedStreak) {
                streakData = { ...streakData, ...JSON.parse(typeof savedStreak === 'string' ? savedStreak : JSON.stringify(savedStreak)) };
            }
            
            // Günlük görevler yükle (IndexedDB öncelikli) - BU ÇOOK ÖNEMLİ!
            const savedTasksIndexedDB = await loadFromIndexedDB('hasene_dailyTasks');
            const savedTasks = savedTasksIndexedDB || localStorage.getItem('hasene_dailyTasks');
            if (savedTasks) {
                dailyTasks = { ...dailyTasks, ...JSON.parse(typeof savedTasks === 'string' ? savedTasks : JSON.stringify(savedTasks)) };
                // Set nesnelerini yeniden oluştur
                dailyTasks.todayStats.farklıZorluk = new Set(dailyTasks.todayStats.farklıZorluk || []);
            }
            
            // Oyun ayarları yükle (currentMode ve currentDifficulty) - ÇOOK ÖNEMLİ!
            const savedModeIndexedDB = await loadFromIndexedDB('hasene_currentMode');
            const savedMode = savedModeIndexedDB || localStorage.getItem('hasene_currentMode');
            if (savedMode && CONFIG.gameModes[savedMode]) {
                currentMode = savedMode;
                console.log(`🎮 Kaydedilen mod yüklendi: ${currentMode}`);
            }
            
            const savedDifficultyIndexedDB = await loadFromIndexedDB('hasene_currentDifficulty');
            const savedDifficulty = savedDifficultyIndexedDB || localStorage.getItem('hasene_currentDifficulty');
            if (savedDifficulty && CONFIG.difficultyLevels[savedDifficulty]) {
                currentDifficulty = savedDifficulty;
                console.log(`🎯 Kaydedilen zorluk yüklendi: ${currentDifficulty}`);
            }
            
            console.log('📋 Günlük görevler yüklendi:', {
                completedTasks: dailyTasks.completedTasks.length,
                todayStats: dailyTasks.todayStats,
                lastTaskDate: dailyTasks.lastTaskDate
            });
            
            console.log('🎮 Oyun ayarları yüklendi:', {
                currentMode: currentMode,
                currentDifficulty: currentDifficulty
            });
            
            // Günlük kontrol
            checkDailyProgress();
            checkDailyTasks();
        }

        // Daha zorlu seviye hesaplama sistemi
        function calculateLevel(points) {
            if (points < 1000) return 1;        // Level 1: 0-999 puan
            if (points < 2500) return 2;        // Level 2: 1000-2499 puan  
            if (points < 5000) return 3;        // Level 3: 2500-4999 puan
            if (points < 8500) return 4;        // Level 4: 5000-8499 puan
            if (points < 13000) return 5;       // Level 5: 8500-12999 puan
            if (points < 19000) return 6;       // Level 6: 13000-18999 puan
            if (points < 26500) return 7;       // Level 7: 19000-26499 puan
            if (points < 35500) return 8;       // Level 8: 26500-35499 puan
            if (points < 46000) return 9;       // Level 9: 35500-45999 puan
            if (points < 58000) return 10;      // Level 10: 46000-57999 puan
            
            // Level 10'dan sonra her seviye için 15000 puan artış
            const afterLevel10 = points - 58000;
            return 10 + Math.floor(afterLevel10 / 15000) + 1;
        }

        // Bir sonraki seviye için gereken puan
        function getNextLevelRequiredPoints(currentLevel) {
            const levelThresholds = [0, 1000, 2500, 5000, 8500, 13000, 19000, 26500, 35500, 46000, 58000];
            
            // currentLevel 1-10 arasındaysa threshold'u döndür
            if (currentLevel >= 1 && currentLevel <= 10) {
                return levelThresholds[currentLevel];
            }
            
            // Level 10'dan sonra - her seviye için 15000 puan artış
            if (currentLevel > 10) {
                return 58000 + ((currentLevel - 10) * 15000);
            }
            
            // Level 0 veya geçersiz değerler için
            return levelThresholds[1]; // Level 1 threshold'u
        }

        async function saveStats() {
            try {
                // ÇOKLU KAYDETME SİSTEMİ (Üçüncü taraf çerez sorunu için)
                
                // 1. IndexedDB (ana sistem - çerez engellemelerinden etkilenmez)
                if (db) {
                    saveToIndexedDB('hasene_totalPoints', totalPoints.toString());
                    saveToIndexedDB('hasene_badges', JSON.stringify(badges));
                    saveToIndexedDB('hasene_streak', JSON.stringify(streakData));
                    
                    const tasksToSave = { 
                        ...dailyTasks, 
                        todayStats: {
                            ...dailyTasks.todayStats,
                            farklıZorluk: Array.from(dailyTasks.todayStats.farklıZorluk)
                        }
                    };
                    saveToIndexedDB('hasene_dailyTasks', JSON.stringify(tasksToSave));
                    
                    // Oyun ayarları da kaydet (currentMode & currentDifficulty) - KRİTİK!
                    saveToIndexedDB('hasene_currentMode', currentMode);
                    saveToIndexedDB('hasene_currentDifficulty', currentDifficulty);
                }
                
                // 2. localStorage (yedek sistem)
                try {
                    localStorage.setItem('hasene_totalPoints', totalPoints.toString());
                    localStorage.setItem('hasene_badges', JSON.stringify(badges));
                    localStorage.setItem('hasene_streak', JSON.stringify(streakData));
                    
                    // GÜNLÜK GÖREVLER de localStorage'a kaydet (kritik!)
                    const tasksToSave = { 
                        ...dailyTasks, 
                        todayStats: {
                            ...dailyTasks.todayStats,
                            farklıZorluk: Array.from(dailyTasks.todayStats.farklıZorluk)
                        }
                    };
                    localStorage.setItem('hasene_dailyTasks', JSON.stringify(tasksToSave));
                    
                    // Oyun ayarları da localStorage'a kaydet - KRİTİK!
                    localStorage.setItem('hasene_currentMode', currentMode);
                    localStorage.setItem('hasene_currentDifficulty', currentDifficulty);
                } catch(e) { console.log('localStorage failed:', e); }
                
                // 3. URL sistemi (son çare - mobil için)
                try {
                    saveToURL();
                } catch(e) { console.log('URL save failed:', e); }
                
                console.log('💾 ÜÇLÜ KORUMA: IndexedDB + localStorage + URL ile kaydedildi!', totalPoints);
                
            } catch (error) {
                console.error('❌ Kaydetme hatası:', error);
            }
        }

        function resetAllStats() {
            // Tüm istatistikleri sıfırla
            totalPoints = 0;
            starPoints = 0;
            level = 1;
            sessionScore = 0;
            sessionCorrect = 0;
            sessionWrong = 0;
            comboCount = 0;
            
            // Rozetleri sıfırla
            badges = { bronze: 0, silver: 0, gold: 0, diamond: 0 };
            
            // Streak verilerini sıfırla
            streakData = {
                currentStreak: 0,
                playDates: [],
                dailyGoal: 5,
                dailyCorrect: 0
            };
            
            // Daily tasks sıfırla
            dailyTasks = {
                lastTaskDate: null,
                tasks: [],
                bonusTasks: [],
                completedTasks: [],
                rewardsClaimed: false,
                todayStats: {
                    kelimeCevir: 0,
                    dinleBul: 0,
                    boslukDoldur: 0,
                    ayetOku: 0,
                    duaOgre: 0,
                    hadisOku: 0,
                    toplamDogru: 0,
                    toplamPuan: 0,
                    perfectStreak: 0,
                    farklıZorluk: new Set()
                }
            };
            
            // ÜÇ SİSTEMİ DE TAMAMEN TEMİZLE!
            
            // 1. IndexedDB'yi temizle (ANA SİSTEM)
            if (db) {
                try {
                    const transaction = db.transaction(['gameData'], 'readwrite');
                    const store = transaction.objectStore('gameData');
                    store.clear(); // Tüm IndexedDB verilerini sil
                    console.log('🗑️ IndexedDB temizlendi');
                } catch(e) { 
                    console.log('IndexedDB temizleme hatası:', e); 
                }
            }
            
            // 2. localStorage'ı tamamen temizle
            localStorage.removeItem('hasene_totalPoints');
            localStorage.removeItem('hasene_badges');
            localStorage.removeItem('hasene_streak');
            localStorage.removeItem('hasene_dailyTasks');
            localStorage.removeItem('hasene_currentMode');
            localStorage.removeItem('hasene_currentDifficulty');
            localStorage.removeItem('hasene_wordStats'); // KELİME PANELİ İSTATİSTİKLERİ TEMİZLE!
            console.log('🗑️ localStorage tamamen temizlendi (kelime paneli dahil)');
            
            // 3. URL geçmişini temizle (mümkünse)
            try {
                if (window.history.replaceState) {
                    window.history.replaceState({}, '', window.location.pathname);
                }
                console.log('🗑️ URL geçmişi temizlendi');
            } catch(e) { 
                console.log('URL temizleme hatası:', e); 
            }
            
            // Yeni günlük görevler oluştur
            generateDailyTasks(new Date().toISOString().split('T')[0]);
            
            // Ekranı güncelle
            updateStatsBar();
            updateUI();
            
            console.log('✅ TÜM 3 SİSTEM TEMİZLENDİ! IndexedDB + localStorage + URL');
            alert('🔄 Tüm veriler TAMAMEN sıfırlandı! IndexedDB, localStorage ve URL geçmişi temizlendi.');
        }

        function updateStatsBar() {
            // NULL KONTROL - Kritik elementler
            const gamePointsEl = document.getElementById('gamePoints');
            const starPointsEl = document.getElementById('starPoints');
            const playerLevelEl = document.getElementById('playerLevel');
            
            if (!gamePointsEl || !starPointsEl || !playerLevelEl) {
                log.error('❌ HATA: Stats bar elementleri bulunamadı!');
                return;
            }
            
            // Üst bar güncelle
            gamePointsEl.textContent = totalPoints;
            
            // Yıldız puanı güncelle (her 100 puana 1 yıldız - sık geri bildirim için)
            starPoints = Math.floor(totalPoints / 100);
            starPointsEl.textContent = starPoints;
            
            // Rozet sistemini güncelle
            updateBadgeSystem();
            
            // Seviye güncelle (yeni hesaplama sistemi)
            level = calculateLevel(totalPoints);
            playerLevelEl.textContent = level;
            
            // Seviye ilerleme çubuğunu güncelle
            let currentLevelStart, nextLevelStart;
            
            if (level === 1) {
                currentLevelStart = 0;
                nextLevelStart = 1000;
            } else if (level <= 10) {
                const thresholds = [0, 1000, 2500, 5000, 8500, 13000, 19000, 26500, 35500, 46000, 58000];
                currentLevelStart = thresholds[level - 1];
                nextLevelStart = thresholds[level];
            } else {
                // Level 10'dan sonra
                currentLevelStart = 58000 + ((level - 11) * 15000);
                nextLevelStart = 58000 + ((level - 10) * 15000);
            }
            
            const currentLevelPoints = totalPoints - currentLevelStart;
            const levelRequiredPoints = nextLevelStart - currentLevelStart;
            const progressPercentage = Math.max(0, Math.min((currentLevelPoints / levelRequiredPoints) * 100, 100));
            
            const levelProgressElement = document.getElementById('levelProgress');
            if (levelProgressElement) {
                levelProgressElement.style.width = progressPercentage + '%';
            }
            
            // Alt bar (oyun içi stats) güncelle
            const scoreElement = document.getElementById('score');
            const levelElement = document.getElementById('level');
            if (scoreElement) scoreElement.textContent = totalPoints;
            if (levelElement) levelElement.textContent = level;
            
            // Kaydet
            saveStats();
            
            // Debug için mevcut değerleri logla
            log.debug('📊 Mevcut İstatistikler:', {
                totalPoints: totalPoints,
                starPoints: starPoints, 
                level: level,
                sessionScore: sessionScore,
                sessionCorrect: sessionCorrect,
                sessionWrong: sessionWrong
            });
        }
        
        // COMBO FONKSİYONLARI
        function updateCombo() {
            const comboIndicator = document.getElementById('comboIndicator');
            const comboCountEl = document.getElementById('comboCount');
            const comboBonusEl = document.getElementById('comboBonus');
            
            // NULL KONTROL
            if (!comboIndicator || !comboCountEl || !comboBonusEl) {
                log.warn('⚠️ Combo elementleri bulunamadı');
                return;
            }
            
            if (comboCount >= 3) {
                const bonusXP = Math.floor(comboCount / 3) * 5;
                comboCountEl.textContent = comboCount;
                comboBonusEl.textContent = bonusXP;
                
                comboIndicator.style.display = 'block';
                comboIndicator.style.animation = 'comboPopIn 0.3s ease, comboShake 0.5s ease 0.3s';
                
                // Her 3 comboda mesaj göster (bonus zaten addSessionPoints'te eklendi)
                if (comboCount % 3 === 0) {
                    // Combo sesi çal
                    playSound('combo');
                    
                    // Bonus mesajı göster
                    setTimeout(() => {
                        showSuccessMessage(`🔥 COMBO x${comboCount}! +${bonusXP} Bonus XP!`);
                    }, 300);
                }
                
                // 3 saniye sonra gizle
                setTimeout(() => {
                    hideCombo();
                }, 3000);
            }
        }
        
        function hideCombo() {
            const comboIndicator = document.getElementById('comboIndicator');
            comboIndicator.style.animation = 'slideUp 0.3s ease';
            setTimeout(() => {
                comboIndicator.style.display = 'none';
            }, 300);
        }

        // SESSION PUAN FONKSİYONLARI
        function addSessionPoints(points) {
            log.game(`💰 === addSessionPoints(${points}) ÇAĞRILDI ===`);
            log.game(`📊 Önce: sessionScore=${sessionScore}, totalPoints=${totalPoints}`);
            
            // Güvenli puan ekleme - NaN kontrolü
            if (typeof points !== 'number' || isNaN(points)) {
                log.error('❌ Geçersiz puan değeri:', points);
                return;
            }
            
            // Session puanlarını güncelle
            sessionScore += points;
            sessionCorrect++;
            
            // Global puanlara da ekle
            totalPoints += points;
            
            // Bugünkü toplam puana da ekle (günlük performans için)
            dailyTasks.todayStats.toplamPuan += points;
            
            // Daily XP ekle
            addDailyXP(points);
            
            // Doğru cevap sesi
            playSound('correct');
            
            // Combo sistemi
            comboCount++;
            updateCombo();
            
            // Her 3 doğru cevapda combo bonusu
            if (comboCount > 0 && comboCount % 3 === 0) {
                const comboBonus = 5;
                totalPoints += comboBonus;
                dailyTasks.todayStats.toplamPuan += comboBonus; // Bugünkü puana da ekle!
                
                // COMBO BONUSUNU DAILY XP'YE DE EKLE
                addDailyXP(comboBonus);
                
                log.game(`🔥 Combo bonusu: +${comboBonus} XP`);
                
                // COMBO BONUS SONRASI HEMEN UI GÜNCELLE
                updateStatsBar(); // Üst barı hemen güncelle
            }
            
            // Geriye uyumluluk için eski değişkenleri de güncelle
            score = sessionScore;
            correct = sessionCorrect;
            
            // UI güncelle
            updateUI(); // Oyun içi barı güncelle
            updateStatsBar(); // Üst barı güncelle
            checkAchievements(); // Başarımları kontrol et
            
            log.game(`📊 Sonra: sessionScore=${sessionScore}, totalPoints=${totalPoints}, combo=${comboCount}`);
            log.game(`✅ addSessionPoints tamamlandı!`);
        }

        function addSessionWrong() {
            log.game(`❌ === addSessionWrong() ÇAĞRILDI ===`);
            log.game(`📊 Önce: sessionWrong=${sessionWrong}, wrong=${wrong}`);
            sessionWrong++;
            
            // Yanlış cevap sesi
            playSound('wrong');
            
            // Combo kır
            if (comboCount > 0) {
                comboCount = 0;
                hideCombo();
            }
            wrong = sessionWrong; // Geriye uyumluluk
            console.log(`📊 Sonra: sessionWrong=${sessionWrong}, wrong=${wrong}`);
            console.log(`🎨 updateUI() çağrılıyor...`);
            updateUI();
            console.log(`✅ addSessionWrong tamamlandı!`);
        }

        // ============ ROZET SİSTEMİ ============
        function updateBadgeSystem() {
            // 🎯 XP BAZLI ROZET SİSTEMİ (1 saat oyun = ~8500 XP)
            // 🥉 Bronz: 2,000 XP = 1 bronz (~15 dk)
            // 🥈 Gümüş: 8,500 XP = 1 gümüş (~1 saat, 1 günlük hedef)
            // 🥇 Altın: 25,500 XP = 1 altın (~3 gün)
            // 💎 Elmas: 85,000 XP = 1 elmas (~10 gün)
            
            const xp = totalPoints;
            const newBronze = Math.floor(xp / 2000);
            const newSilver = Math.floor(xp / 8500);
            const newGold = Math.floor(xp / 25500);
            const newDiamond = Math.floor(xp / 85000);
            
            // Rozet seviye kontrolü ve modal gösterimi (önce en yüksek rozetleri kontrol et)
            if (newDiamond > badges.diamond) {
                badges.diamond = newDiamond;
                showBadgeUpModal('diamond', '💎 Elmas');
                playSound('levelup'); // Elmas çok önemli, levelup sesi çal
            } else if (newGold > badges.gold) {
                badges.gold = newGold;
                showBadgeUpModal('gold', '🥇 Altın');
                playSound('levelup');
            } else if (newSilver > badges.silver) {
                badges.silver = newSilver;
                showBadgeUpModal('silver', '🥈 Gümüş');
                playSound('correct');
            } else if (newBronze > badges.bronze) {
                badges.bronze = newBronze;
                showBadgeUpModal('bronze', '🥉 Bronz');
                playSound('correct');
            }
            
            // Tüm rozet sayılarını güncelle
            badges.bronze = newBronze;
            badges.silver = newSilver;
            badges.gold = newGold;
            badges.diamond = newDiamond;
            
            // En yüksek rozeti göster
            updateTopBadgeDisplay();
        }

        function updateTopBadgeDisplay() {
            const topBadgeIcon = document.getElementById('topBadgeIcon');
            const topBadgeCount = document.getElementById('topBadgeCount');
            
            if (badges.diamond > 0) {
                topBadgeIcon.textContent = '💎';
                topBadgeCount.textContent = badges.diamond;
            } else if (badges.gold > 0) {
                topBadgeIcon.textContent = '🥇';
                topBadgeCount.textContent = badges.gold;
            } else if (badges.silver > 0) {
                topBadgeIcon.textContent = '🥈';
                topBadgeCount.textContent = badges.silver;
            } else if (badges.bronze > 0) {
                topBadgeIcon.textContent = '🥉';
                topBadgeCount.textContent = badges.bronze;
            } else {
                topBadgeIcon.textContent = '🥉';
                topBadgeCount.textContent = '0';
            }
        }

        function showBadgeUpModal(badgeType, badgeName) {
            // Rozet atlama modalı - şimdilik alert, sonra düzeltiriz
            alert(`🎉 Tebrikler! ${badgeName} rozeti kazandınız!`);
        }

        function showBadgesModal() {
            // Tüm rozet sayılarını güncelle
            document.getElementById('diamondBadgeCount').textContent = badges.diamond;
            document.getElementById('goldBadgeCount').textContent = badges.gold;
            document.getElementById('silverBadgeCount').textContent = badges.silver;
            document.getElementById('bronzeBadgeCount').textContent = badges.bronze;
            
            // İlerleme bilgilerini güncelle
            document.getElementById('badgesModalStars').textContent = starPoints;
            document.getElementById('badgesModalLevel').textContent = level;
            document.getElementById('badgesModalPoints').textContent = totalPoints.toLocaleString();
            
            // Modal'ı göster
            document.getElementById('badgesModal').style.display = 'flex';
        }

        function closeBadgesModal() {
            document.getElementById('badgesModal').style.display = 'none';
        }
        
        function showXPInfoModal() {
            document.getElementById('xpInfoModal').style.display = 'flex';
        }
        
        function closeXPInfoModal() {
            document.getElementById('xpInfoModal').style.display = 'none';
        }

        // ============ İSTATİSTİKLER SİSTEMİ ============
        function showStatsModal() {
            // Genel istatistikleri güncelle
            document.getElementById('statsLevel').textContent = level;
            document.getElementById('statsPoints').textContent = totalPoints.toLocaleString();
            document.getElementById('statsStars').textContent = starPoints;
            
            // Seviye ilerleme barını hesapla
            let currentLevelStart, nextLevelStart;
            const nextLevel = level + 1;
            
            if (level === 1) {
                currentLevelStart = 0;
                nextLevelStart = 1000;
            } else if (level <= 10) {
                const thresholds = [0, 1000, 2500, 5000, 8500, 13000, 19000, 26500, 35500, 46000, 58000];
                currentLevelStart = thresholds[level - 1];
                nextLevelStart = thresholds[level] || (58000 + ((level - 10) * 15000));
            } else {
                // Level 10'dan sonra
                currentLevelStart = 58000 + ((level - 11) * 15000);
                nextLevelStart = 58000 + ((level - 10) * 15000);
            }
            
            const currentLevelPoints = totalPoints - currentLevelStart;
            const levelRequiredPoints = nextLevelStart - currentLevelStart;
            const progressPercentage = Math.max(0, Math.min((currentLevelPoints / levelRequiredPoints) * 100, 100));
            const pointsNeeded = Math.max(0, nextLevelStart - totalPoints);
            
            document.getElementById('statsCurrentLevel').textContent = level;
            document.getElementById('statsNextLevel').textContent = nextLevel;
            document.getElementById('statsLevelProgress').style.width = progressPercentage + '%';
            document.getElementById('statsLevelPointsNeeded').textContent = pointsNeeded.toLocaleString();
            
            // Rozet sayılarını güncelle
            document.getElementById('statsBronze').textContent = badges.bronze;
            document.getElementById('statsSilver').textContent = badges.silver;
            document.getElementById('statsGold').textContent = badges.gold;
            document.getElementById('statsDiamond').textContent = badges.diamond;
            
            // Başarı analizi hesapla
            const totalGameActions = dailyTasks.todayStats.kelimeCevir + dailyTasks.todayStats.dinleBul + 
                                   dailyTasks.todayStats.boslukDoldur + dailyTasks.todayStats.ayetOku + 
                                   dailyTasks.todayStats.duaOgre + dailyTasks.todayStats.hadisOku;
            
            const successRate = totalGameActions > 0 ? Math.round((dailyTasks.todayStats.toplamDogru / totalGameActions) * 100) : 0;
            const avgPointsPerDay = streakData.totalPlayDays > 0 ? Math.round(totalPoints / streakData.totalPlayDays) : totalPoints;
            const playConsistency = Math.round((streakData.totalPlayDays / Math.max(1, getDaysFromFirstPlay())) * 100);
            const levelProgressPercent = Math.round(progressPercentage);
            
            document.getElementById('statsSuccessRate').textContent = successRate + '%';
            document.getElementById('statsAvgPointsPerDay').textContent = avgPointsPerDay.toLocaleString();
            document.getElementById('statsPlayConsistency').textContent = Math.min(100, playConsistency) + '%';
            document.getElementById('statsLevelProgress').textContent = levelProgressPercent + '%';
            
            // Streak bilgilerini güncelle
            document.getElementById('statsCurrentStreak').textContent = streakData.currentStreak;
            document.getElementById('statsBestStreak').textContent = streakData.bestStreak;
            document.getElementById('statsTotalDays').textContent = streakData.totalPlayDays;
            document.getElementById('statsTodayProgress').textContent = Math.min(streakData.todayProgress, streakData.dailyGoal) + '/' + streakData.dailyGoal;
            
            // Bugünkü oyun türü istatistikleri
            document.getElementById('statsKelimeCevir').textContent = dailyTasks.todayStats.kelimeCevir;
            document.getElementById('statsDinleBul').textContent = dailyTasks.todayStats.dinleBul;
            document.getElementById('statsBoslukDoldur').textContent = dailyTasks.todayStats.boslukDoldur;
            document.getElementById('statsAyetOku').textContent = dailyTasks.todayStats.ayetOku;
            document.getElementById('statsDuaOgre').textContent = dailyTasks.todayStats.duaOgre;
            document.getElementById('statsHadisOku').textContent = dailyTasks.todayStats.hadisOku;
            
            // Bugünkü performans
            document.getElementById('statsTodayCorrect').textContent = dailyTasks.todayStats.toplamDogru;
            document.getElementById('statsTodayPoints').textContent = dailyTasks.todayStats.toplamPuan;
            document.getElementById('statsPerfectStreak').textContent = dailyTasks.todayStats.perfectStreak;
            document.getElementById('statsDifficultyCount').textContent = dailyTasks.todayStats.farklıZorluk.size;
            
            // Modal'ı göster
            document.getElementById('statsModal').style.display = 'flex';
            
            // Varsayılan tab'ı göster (Genel)
            switchStatsTab('general');
            
            console.log('📊 İstatistikler modalı açıldı');
        }

        function getDaysFromFirstPlay() {
            if (streakData.playDates.length === 0) return 1;
            
            const firstPlayDate = new Date(streakData.playDates[0]);
            const today = new Date();
            const diffTime = Math.abs(today - firstPlayDate);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            return Math.max(1, diffDays);
        }
        
        function closeStatsModal() {
            document.getElementById('statsModal').style.display = 'none';
        }
        
        function confirmResetStats() {
            const confirmed = confirm('🚨 DİKKAT!\n\nTüm oyun verilerini sıfırlamak istediğinden emin misin?\n\n• Tüm puanlar (0\'a döner)\n• Tüm rozetler (silinir)\n• Tüm streak verileri (sıfırlanır)\n• Tüm günlük görevler (yenilenir)\n• Tüm istatistikler (temizlenir)\n• KELİME PANELİ istatistikleri (sıfırlanır)\n\nBu işlem GERİ ALINMAZ!\n\nDevam etmek istiyor musun?');
            
            if (confirmed) {
                // İkinci onay
                const doubleConfirmed = confirm('🔥 SON UYARI!\n\nGerçekten TÜM VERİLERİ sıfırlamak istiyor musun?\n\nBu işlemden sonra oyuna sıfırdan başlayacaksın!\n\n✅ EVET = Sıfırla\n❌ HAYIR = İptal et');
                
                if (doubleConfirmed) {
                    closeStatsModal(); // Modal'ı kapat
                    resetAllStats(); // Mevcut fonksiyonu kullan
                }
            }
        }

        // Global fonksiyonlar (window'a ekle)
        window.showStatsModal = showStatsModal;
        window.closeStatsModal = closeStatsModal;
        window.confirmResetStats = confirmResetStats;

        // ============ TAKVİM SİSTEMİ ============
        function checkDailyProgress() {
            const today = new Date().toISOString().split('T')[0]; // YYYY-MM-DD
            
            // Eğer bugün ilk defa açılıyorsa
            if (streakData.todayDate !== today) {
                // Önceki gün kontrolü
                const yesterday = new Date();
                yesterday.setDate(yesterday.getDate() - 1);
                const yesterdayStr = yesterday.toISOString().split('T')[0];
                
                // Streak kontrolü - sadece kırılma durumunu kontrol et
                if (streakData.lastPlayDate !== yesterdayStr && streakData.lastPlayDate !== today && streakData.lastPlayDate !== '') {
                    // Streak kırıldı (dün oynamadı ve bugün de henüz oynamadı)
                    console.log(`🔴 Streak kırıldı! Son oyun: ${streakData.lastPlayDate}, dün: ${yesterdayStr}`);
                    streakData.currentStreak = 0;
                }
                
                // Bugünün verilerini sıfırla
                streakData.todayDate = today;
                streakData.todayProgress = 0;
                
                console.log(`📅 Yeni gün başladı: ${today}, mevcut streak: ${streakData.currentStreak}`);
            }
        }

        function updateDailyProgress(correctAnswers) {
            const today = new Date().toISOString().split('T')[0];
            
            // Günlük ilerleme güncelle
            streakData.todayProgress += correctAnswers;
            
            // Takvim açıksa bugünkü hedefi gerçek zamanlı güncelle
            const todayProgressElement = document.getElementById('todayProgress');
            const todayProgressIconElement = document.getElementById('todayProgressIcon');
            
            if (todayProgressElement) {
                const currentProgress = Math.min(streakData.todayProgress, streakData.dailyGoal);
                todayProgressElement.textContent = currentProgress;
                
                // İlerlemeye göre dinamik emoji
                if (todayProgressIconElement) {
                    if (currentProgress >= 5) {
                        todayProgressIconElement.textContent = '✅'; // Tamamlandı
                    } else if (currentProgress >= 3) {
                        todayProgressIconElement.textContent = '🔥'; // İyi gidiyor  
                    } else if (currentProgress >= 1) {
                        todayProgressIconElement.textContent = '💪'; // Başlamış
                    } else {
                        todayProgressIconElement.textContent = '⏳'; // Henüz başlamamış
                    }
                }
            }
            
            // Günlük hedef tamamlandı mı?
            if (streakData.todayProgress >= streakData.dailyGoal && streakData.lastPlayDate !== today) {
                console.log(`🎯 Günlük hedef tamamlandı! İlerleme: ${streakData.todayProgress}/${streakData.dailyGoal}`);
                
                // İlk defa bugün hedefi tamamladı
                streakData.lastPlayDate = today;
                streakData.totalPlayDays++;
                
                console.log(`📈 Toplam oyun günü: ${streakData.totalPlayDays}, önceki streak: ${streakData.currentStreak}`);
                
                // Oyun tarihi listesine ekle
                if (!streakData.playDates.includes(today)) {
                    streakData.playDates.push(today);
                    streakData.playDates.sort();
                }
                
                // Streak güncelle - bugün ilk kez hedefi tamamladı
                if (streakData.currentStreak === 0) {
                    // İlk gün veya streak kırılmışsa 1'den başla
                    streakData.currentStreak = 1;
                } else {
                    // Streak devam ediyorsa artır
                    streakData.currentStreak++;
                }
                
                // En iyi streak'i güncelle
                if (streakData.currentStreak > streakData.bestStreak) {
                    streakData.bestStreak = streakData.currentStreak;
                    console.log(`🏆 Yeni rekor streak: ${streakData.bestStreak} gün!`);
                }
                
                console.log(`🔥 Streak güncellendi: ${streakData.currentStreak} gün (en iyi: ${streakData.bestStreak})`);
                
                // Veriyi kaydet
                saveStats();
                
                // Eğer takvim açıksa otomatik yenile (mavi -> yeşil)
                const calendarModal = document.getElementById('calendarModal');
                if (calendarModal && calendarModal.style.display === 'flex') {
                    generateCalendar();
                }
            }
        }

        function showCalendarModal() {
            // Haftalık streak gösterimini oluştur
            generateWeeklyStreakDisplay();
            
            // Aylık takvimi oluştur
            generateMonthlyCalendar();
            
            // Modal'ı göster
            document.getElementById('calendarModal').style.display = 'flex';
        }

        function closeCalendarModal() {
            document.getElementById('calendarModal').style.display = 'none';
        }

        function generateWeeklyStreakDisplay() {
            // Son 7 günü hesapla
            const today = new Date();
            const weekDays = [];
            const dayNames = ['Pz', 'Pt', 'Sl', 'Çr', 'Pr', 'Cm', 'Ct'];
            
            // Son 7 günü geriye doğru hesapla
            for (let i = 6; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(today.getDate() - i);
                weekDays.push({
                    date: date,
                    dateStr: date.toISOString().split('T')[0],
                    dayName: dayNames[date.getDay()],
                    isToday: i === 0
                });
            }
            
            // PlayDates set'ini oluştur
            const playDatesSet = new Set(streakData.playDates);
            
            // HTML oluştur
            let html = '';
            
            // Container wrapper
            html += '<div style="display: flex; flex-direction: column; gap: 8px; max-width: 100%; margin: 0 auto;">';
            
            // Gün isimleri
            html += '<div style="display: flex; justify-content: space-evenly; align-items: center;">';
            weekDays.forEach(day => {
                const dayColor = day.isToday ? '#f39c12' : '#7f8c8d';
                html += `<div style="text-align: center; font-size: 0.75em; color: ${dayColor}; font-weight: ${day.isToday ? 'bold' : 'normal'}; width: 42px;">${day.dayName}</div>`;
            });
            html += '</div>';
            
            // Streak gösterimi
            html += '<div style="display: flex; justify-content: space-evenly; align-items: center;">';
            weekDays.forEach(day => {
                const hasPlayed = playDatesSet.has(day.dateStr);
                let circleStyle = '';
                let iconContent = '';
                
                if (day.isToday) {
                    if (hasPlayed) {
                        // Bugün oynandı - mavi arka plan, beyaz tick
                        circleStyle = 'width: 42px; height: 42px; border-radius: 50%; background: #3498db; display: flex; align-items: center; justify-content: center; flex-shrink: 0;';
                        iconContent = '✓';
                    } else {
                        // Bugün oynanmadı - gri arka plan
                        circleStyle = 'width: 42px; height: 42px; border-radius: 50%; background: #7f8c8d; display: flex; align-items: center; justify-content: center; flex-shrink: 0;';
                        iconContent = '';
                    }
                } else {
                    if (hasPlayed) {
                        // Geçmiş günler oynandı - turuncu arka plan, beyaz tick
                        circleStyle = 'width: 42px; height: 42px; border-radius: 50%; background: #f39c12; display: flex; align-items: center; justify-content: center; flex-shrink: 0;';
                        iconContent = '✓';
                    } else {
                        // Geçmiş günler oynanmadı - gri arka plan
                        circleStyle = 'width: 42px; height: 42px; border-radius: 50%; background: #7f8c8d; display: flex; align-items: center; justify-content: center; flex-shrink: 0;';
                        iconContent = '';
                    }
                }
                
                html += `<div style="${circleStyle}">
                    <span style="color: white; font-size: 1.3em; font-weight: bold;">${iconContent}</span>
                </div>`;
            });
            html += '</div>'; // Streak gösterimi kapanış
            html += '</div>'; // Container wrapper kapanış
            
            // HTML'i yerleştir
            document.getElementById('weeklyStreakDisplay').innerHTML = html;
        }

        function generateMonthlyCalendar() {
            const today = new Date();
            const year = today.getFullYear();
            const month = today.getMonth();
            const todayDate = today.getDate();
            
            // Ay adını güncelle
            const monthNames = [
                'Ocak', 'Şubat', 'Mart', 'Nisan', 'Mayıs', 'Haziran',
                'Temmuz', 'Ağustos', 'Eylül', 'Ekim', 'Kasım', 'Aralık'
            ];
            document.getElementById('calendarMonth').textContent = `${monthNames[month]} ${year}`;
            
            // Takvim grid'ini temizle ve yeni HTML oluştur
            const grid = document.getElementById('calendarGrid');
            
            // HTML string olarak oluştur
            let html = '';
            
            // Haftanın günlerini ekle (daha kısa isimler + küçük font)
            const dayNames = ['Pz', 'Pt', 'Sl', 'Çr', 'Pr', 'Cm', 'Ct'];
            dayNames.forEach(day => {
                html += `<div style="font-weight: 600; font-size: 0.65em; color: #95a5a6; padding: 3px; text-align: center; height: 20px; display: flex; align-items: center; justify-content: center;">${day}</div>`;
            });
            
            // Ayın ilk gününün haftanın hangi günü olduğunu bul
            const firstDay = new Date(year, month, 1);
            const startingDayOfWeek = (firstDay.getDay() + 6) % 7; // Pazartesi = 0
            
            // Boş günler ekle
            for (let i = 0; i < startingDayOfWeek; i++) {
                html += '<div></div>';
            }
            
            // Mevcut streak'in tarih aralığını hesapla
            const currentStreakDates = [];
            if (streakData.currentStreak > 0 && streakData.lastPlayDate) {
                const lastPlayDate = new Date(streakData.lastPlayDate);
                for (let i = 0; i < streakData.currentStreak; i++) {
                    const streakDate = new Date(lastPlayDate);
                    streakDate.setDate(lastPlayDate.getDate() - i);
                    currentStreakDates.push(streakDate.toISOString().split('T')[0]);
                }
            }
            const currentStreakSet = new Set(currentStreakDates);

            // playDates array'ini Set'e çevir
            const playDatesSet = new Set(streakData.playDates);
            
            // Ayın günlerini ekle
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            for (let day = 1; day <= daysInMonth; day++) {
                const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                
                let style = 'padding: 6px 3px; border-radius: 50%; cursor: pointer; font-size: 0.7em; min-height: 28px; max-height: 32px; display: flex; align-items: center; justify-content: center; color: #ecf0f1; flex-direction: column;';
                
                let dayContent = day;
                let tooltip = dateStr;
                
                // Bugün ise vurgula
                if (day === todayDate) {
                    if (playDatesSet.has(dateStr)) {
                        style += ' background: linear-gradient(135deg, #27ae60, #2ecc71); color: white; font-weight: bold; border: 3px solid #3498db; box-shadow: 0 0 12px rgba(52,152,219,0.6);';
                        dayContent = `<div style="font-size: 0.6em;">${day}</div><div style="font-size: 1.2em;">✅</div>`;
                        tooltip = `${dateStr} - Bugün tamamlandı!`;
                    } else {
                        style += ' background: #3498db; color: white; font-weight: bold; box-shadow: 0 0 8px rgba(52,152,219,0.5); animation: pulse 3s infinite;';
                        dayContent = `<div style="font-size: 0.6em;">${day}</div><div style="font-size: 1.2em;">🎯</div>`;
                        tooltip = `${dateStr} - Bugün (henüz oynanmadı)`;
                    }
                }
                // Mevcut streak'in bir parçasıysa (ALEV 🔥)
                else if (currentStreakSet.has(dateStr) && playDatesSet.has(dateStr)) {
                    style += ' background: linear-gradient(135deg, #e74c3c, #f39c12); color: white; font-weight: bold; border: 2px solid #f1c40f; box-shadow: 0 0 10px rgba(231,76,60,0.4);';
                    dayContent = `<div style="font-size: 0.5em;">${day}</div><div style="font-size: 1.4em;">🔥</div>`;
                    tooltip = `${dateStr} - Streak günü! Alev yakıyor! 🔥`;
                }
                // Oyun oynandı ama streak dışında (normal tik)
                else if (playDatesSet.has(dateStr)) {
                    style += ' background: #2ecc71; color: white; font-weight: 600;';
                    dayContent = `<div style="font-size: 0.6em;">${day}</div><div style="font-size: 1.1em;">✓</div>`;
                    tooltip = `${dateStr} - Tamamlandı`;
                }
                // Geçmiş günler - oynanmadı (BUZ ❄️)
                else if (day < todayDate) {
                    style += ' color: #95a5a6; background: rgba(149,165,166,0.1);';
                    dayContent = `<div style="font-size: 0.6em;">${day}</div><div style="font-size: 1.1em;">❄️</div>`;
                    tooltip = `${dateStr} - Oynanmadı (streak dondu!)`;
                }
                
                html += `<div style="${style}" title="${tooltip}">${dayContent}</div>`;
            }
            
            // HTML'i yerleştir
            grid.innerHTML = html;
        }

        // Global fonksiyonlar (window'a ekle ki HTML onclick çalışsın)
        window.showCalendarModal = showCalendarModal;
        window.closeCalendarModal = closeCalendarModal;

        // ============ GÜNLİK GÖREVLER SİSTEMİ ============
        function checkDailyTasks() {
            const today = new Date().toISOString().split('T')[0];
            
            log.debug('🔍 Günlük görev kontrolü:', {
                bugün: today,
                sonGörevTarihi: dailyTasks.lastTaskDate,
                yeniGünMü: dailyTasks.lastTaskDate !== today,
                mevcutTamamlananlar: dailyTasks.completedTasks.length,
                bugünküStats: dailyTasks.todayStats
            });
            
            // Eğer yeni gün başladıysa görevleri yenile
            if (dailyTasks.lastTaskDate !== today) {
                log.debug('🔄 Yeni gün başladı, görevler yenileniyor...');
                generateDailyTasks(today);
            } else {
                log.debug('✅ Aynı gün, mevcut görevler korunuyor');
            }
        }

        function generateDailyTasks(date) {
            // Temel görevler listesi
            const baseTasks = [
                { id: 'kelime5', name: '5 kelime çevir', target: 5, current: 0, type: 'kelimeCevir', reward: 1 },
                { id: 'ayet3', name: '3 ayet oku', target: 3, current: 0, type: 'ayetOku', reward: 1 },
                { id: 'dua2', name: '2 dua öğren', target: 2, current: 0, type: 'duaOgre', reward: 1 },
                { id: 'hadis1', name: '1 hadis oku', target: 1, current: 0, type: 'hadisOku', reward: 1 },
                { id: 'dogru10', name: '10 doğru cevap ver', target: 10, current: 0, type: 'toplamDogru', reward: 1 },
                { id: 'puan100', name: '100 puan topla', target: 100, current: 0, type: 'toplamPuan', reward: 1 }
            ];

            // Bonus görevler listesi
            const bonusTasksList = [
                { id: 'perfect5', name: 'Hiç yanlış yapmadan 5 soru çöz', target: 5, current: 0, type: 'perfectStreak', reward: 2 },
                { id: 'allDiff', name: '3 farklı zorlukta oyna', target: 3, current: 0, type: 'farklıZorluk', reward: 2 },
                { id: 'combo15', name: '15 doğru cevap ver (bonus)', target: 15, current: 0, type: 'toplamDogru', reward: 2 },
                { id: 'dinle3', name: '3 kelime dinle', target: 3, current: 0, type: 'dinleBul', reward: 2 },
                { id: 'bosluk2', name: '2 boşluk doldur', target: 2, current: 0, type: 'boslukDoldur', reward: 2 }
            ];

            // Rastgele 2 bonus görev seç
            const selectedBonus = bonusTasksList.sort(() => 0.5 - Math.random()).slice(0, 2);

            dailyTasks.lastTaskDate = date;
            dailyTasks.tasks = baseTasks;
            dailyTasks.bonusTasks = selectedBonus;
            dailyTasks.completedTasks = [];
            dailyTasks.rewardsClaimed = false;
            dailyTasks.todayStats = {
                kelimeCevir: 0,
                dinleBul: 0,
                boslukDoldur: 0,
                ayetOku: 0,
                duaOgre: 0,
                hadisOku: 0,
                toplamDogru: 0,
                toplamPuan: 0,
                perfectStreak: 0,
                farklıZorluk: new Set()
            };

            log.debug('🎯 Yeni günlük görevler oluşturuldu:', {
                tarih: date,
                temelGörevler: baseTasks.length,
                bonusGörevler: selectedBonus.length,
                tamamlananlar: dailyTasks.completedTasks.length,
                stats: dailyTasks.todayStats
            });

            saveStats();
        }

        function updateTaskProgress(gameType, amount = 1) {
            log.debug(`📋 updateTaskProgress çağrıldı: ${gameType} +${amount}`);
            
            // Oyun tipine göre istatistiği güncelle
            if (dailyTasks.todayStats[gameType] !== undefined) {
                const eskiDeger = dailyTasks.todayStats[gameType];
                dailyTasks.todayStats[gameType] += amount;
                log.debug(`📊 ${gameType}: ${eskiDeger} → ${dailyTasks.todayStats[gameType]}`);
            }

            // Zorluk takibi
            if (currentDifficulty) {
                dailyTasks.todayStats.farklıZorluk.add(currentDifficulty);
                console.log(`🎯 Zorluk eklendi: ${currentDifficulty}, toplam: ${dailyTasks.todayStats.farklıZorluk.size}`);
            }

            // Görevleri kontrol et ve güncelle
            const allTasks = [...dailyTasks.tasks, ...dailyTasks.bonusTasks];
            
            allTasks.forEach(task => {
                const eskiCurrent = task.current;
                if (task.type === gameType) {
                    task.current = Math.min(task.target, dailyTasks.todayStats[gameType]);
                } else if (task.type === 'farklıZorluk') {
                    task.current = dailyTasks.todayStats.farklıZorluk.size;
                }

                // Görev tamamlandı mı?
                if (task.current >= task.target && !dailyTasks.completedTasks.includes(task.id)) {
                    dailyTasks.completedTasks.push(task.id);
                    console.log(`✅ Görev tamamlandı: ${task.id} (${task.name})`);
                }
                
                if (eskiCurrent !== task.current) {
                    console.log(`🎯 Görev ilerleme: ${task.id} ${eskiCurrent}/${task.target} → ${task.current}/${task.target}`);
                }
            });

            console.log(`📋 Toplam tamamlanan görev: ${dailyTasks.completedTasks.length}`);
            saveStats();
        }

        function showDailyTasksModal() {
            // Günlük görevleri kontrol et ve güncelle
            checkDailyTasks();
            
            // Debug: Görev durumunu logla
            console.log('📋 Daily Tasks Debug:', {
                tasks: dailyTasks.tasks.length,
                bonusTasks: dailyTasks.bonusTasks.length,
                completed: dailyTasks.completedTasks.length,
                lastDate: dailyTasks.lastTaskDate,
                today: new Date().toISOString().split('T')[0]
            });
            
            // Görev verilerini güncelle
            updateTasksDisplay();
            
            // Modal'ı göster
            document.getElementById('dailyTasksModal').style.display = 'flex';
        }

        function closeDailyTasksModal() {
            document.getElementById('dailyTasksModal').style.display = 'none';
        }

        function updateTasksDisplay() {
            // Güvenlik kontrolü: Eğer görevler boşsa, yeniden oluştur
            if (!dailyTasks.tasks || dailyTasks.tasks.length === 0) {
                console.log('⚠️ Tasks boş, yeniden oluşturuluyor...');
                generateDailyTasks(new Date().toISOString().split('T')[0]);
            }
            
            const completedCount = dailyTasks.completedTasks.length;
            const totalCount = dailyTasks.tasks.length + dailyTasks.bonusTasks.length;
            
            console.log('📊 updateTasksDisplay:', { completedCount, totalCount });
            
            // Genel ilerleme
            document.getElementById('completedTasks').textContent = completedCount;
            document.getElementById('totalTasks').textContent = totalCount;
            
            const progressPercent = (completedCount / totalCount) * 100;
            document.getElementById('taskProgress').style.width = progressPercent + '%';

            // Temel görevleri göster
            const dailyList = document.getElementById('dailyTasksList');
            dailyList.innerHTML = '';
            
            dailyTasks.tasks.forEach(task => {
                const taskElement = createTaskElement(task);
                dailyList.appendChild(taskElement);
            });

            // Bonus görevleri göster
            const bonusList = document.getElementById('bonusTasksList');
            bonusList.innerHTML = '';
            
            dailyTasks.bonusTasks.forEach(task => {
                const taskElement = createTaskElement(task);
                bonusList.appendChild(taskElement);
            });

            // Ödül bölümü
            const rewardsSection = document.getElementById('rewardsSection');
            if (completedCount === totalCount && !dailyTasks.rewardsClaimed) {
                rewardsSection.style.display = 'block';
            } else {
                rewardsSection.style.display = 'none';
            }
        }

        function createTaskElement(task) {
            const isCompleted = dailyTasks.completedTasks.includes(task.id);
            const progressPercent = (task.current / task.target) * 100;
            
            const div = document.createElement('div');
            div.style.cssText = `
                padding: 10px; 
                border: 2px solid ${isCompleted ? '#4caf50' : '#e0e0e0'}; 
                border-radius: 6px; 
                margin: 6px 0;
                background: ${isCompleted ? '#f1f8e9' : 'white'};
            `;
            
            div.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px;">
                    <span style="font-weight: 600; font-size: 0.85em; color: ${isCompleted ? '#2e7d2e' : '#333'};">
                        ${isCompleted ? '✅' : '⏳'} ${getTaskDisplayName(task)}
                    </span>
                    <span style="font-size: 0.75em; color: #666;">+${task.reward} ⭐</span>
                </div>
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div style="flex: 1; background: #f0f0f0; border-radius: 8px; height: 5px; margin-right: 8px;">
                        <div style="background: ${isCompleted ? '#4caf50' : '#2196f3'}; height: 100%; border-radius: 8px; width: ${progressPercent}%; transition: width 0.3s;"></div>
                    </div>
                    <span style="font-size: 0.7em; color: #666; font-weight: 500;">${task.current}/${task.target}</span>
                </div>
            `;
            
            return div;
        }

        function getTaskDisplayName(task) {
            // Görev tipine göre uygun isim döndür
            const taskNames = {
                'kelime5': 'Kelime Çevir',
                'ayet3': 'Ayet Oku', 
                'dua2': 'Dua Öğren',
                'dogru10': 'Doğru Cevaplar',
                'puan100': 'Puan Topla',
                'perfect5': 'Mükemmel Seri',
                'allDiff': 'Farklı Zorluklar',
                'hadis1': 'Hadis Oku',
                'dinle3': 'Dinle & Bul',
                'bosluk2': 'Boşluk Doldur'
            };
            
            return taskNames[task.id] || task.name;
        }

        function claimDailyRewards() {
            const completedCount = dailyTasks.completedTasks.length;
            const totalCount = dailyTasks.tasks.length + dailyTasks.bonusTasks.length;
            
            if (completedCount === totalCount && !dailyTasks.rewardsClaimed) {
                // 2500 XP bonus ver (5 yıldız değerinde)
                const bonusXP = 2500;
                totalPoints += bonusXP;
                
                // Bugünkü toplam puana da ekle (istatistikler için)
                dailyTasks.todayStats.toplamPuan += bonusXP;
                
                // Daily XP'ye de ekle
                addDailyXP(bonusXP);
                
                dailyTasks.rewardsClaimed = true;
                saveStats();
                updateStatsBar();
                checkAchievements();
                
                // Ödül modalı göster
                showSuccessMessage('🎉 Tüm günlük görevleri tamamladın! +2,500 XP bonus!');
                
                updateTasksDisplay();
            }
        }

        // Ödül butonu event listener
        document.addEventListener('DOMContentLoaded', () => {
            const claimBtn = document.getElementById('claimRewardsBtn');
            if (claimBtn) {
                claimBtn.addEventListener('click', claimDailyRewards);
            }
        });

        // Global fonksiyonlar
        window.showDailyTasksModal = showDailyTasksModal;
        window.closeDailyTasksModal = closeDailyTasksModal;
        window.claimDailyRewards = claimDailyRewards;

        // OYUN BİTİŞ FONKSİYONU (Oyun bitince çağrılır)
        // NOT: Puanlar zaten addSessionPoints() ile eklendi, burada sadece kontrol yapıyoruz
        function addToGlobalPoints(points, correctAnswers = 0) {
            // Seviye kontrol et (puanlar zaten totalPoints'e eklendi)
            const oldLevel = level;
            const newLevel = calculateLevel(totalPoints);
            
            // Seviye atlama kontrolü
            if (newLevel > oldLevel) {
                level = newLevel;
                showLevelUpModal(newLevel);
                playSound('levelup');
            }
            
            // Günlük ilerlemeyi güncelle
            if (correctAnswers > 0) {
                updateDailyProgress(correctAnswers);
                
                // Günlük görevleri güncelle
                updateTaskProgress('toplamDogru', correctAnswers);
                // NOT: toplamPuan zaten addSessionPoints'te eklendi, burada tekrar ekleme!
            }
            
            updateStatsBar(); // Global barı güncelle
            checkAchievements(); // Başarımları kontrol et
            saveStats(); // Verileri kaydet
        }
        
        // ============ ZORLUK UI GÜNCELLEYICI ============
        function updateDifficultyUI() {
            // Kaydedilen zorluk seviyesine göre UI'yı ayarla
            console.log(`🎯 Zorluk UI güncelleniyor: ${currentDifficulty}`);
            
            // Tüm butonları başlangıç durumuna getir
            document.getElementById('mainDiffKolay').style.cssText = 'flex: 1; min-width: 90px; max-width: 120px; margin: 0; padding: 10px; font-size: 0.85em; background: white; color: #4CAF50; border: 2px solid #4CAF50;';
            document.getElementById('mainDiffOrta').style.cssText = 'flex: 1; min-width: 90px; max-width: 120px; margin: 0; padding: 10px; font-size: 0.85em; background: white; color: #FF9800; border: 2px solid #FF9800;';
            document.getElementById('mainDiffZor').style.cssText = 'flex: 1; min-width: 90px; max-width: 120px; margin: 0; padding: 10px; font-size: 0.85em; background: white; color: #f44336; border: 2px solid #f44336;';
            
            // Active class'ları temizle
            document.querySelectorAll('#mainMenu .diff-btn').forEach(btn => btn.classList.remove('active'));
            
            // Seçili zorluk seviyesini vurgula
            if (currentDifficulty === 'kolay') {
                document.getElementById('mainDiffKolay').style.cssText = 'flex: 1; min-width: 90px; max-width: 120px; margin: 0; padding: 10px; font-size: 0.85em; background: #4CAF50; color: white; border: 2px solid #4CAF50;';
                document.getElementById('mainDiffKolay').classList.add('active');
            } else if (currentDifficulty === 'orta') {
                document.getElementById('mainDiffOrta').style.cssText = 'flex: 1; min-width: 90px; max-width: 120px; margin: 0; padding: 10px; font-size: 0.85em; background: #FF9800; color: white; border: 2px solid #FF9800;';
                document.getElementById('mainDiffOrta').classList.add('active');
            } else if (currentDifficulty === 'zor') {
                document.getElementById('mainDiffZor').style.cssText = 'flex: 1; min-width: 90px; max-width: 120px; margin: 0; padding: 10px; font-size: 0.85em; background: #f44336; color: white; border: 2px solid #f44336;';
                document.getElementById('mainDiffZor').classList.add('active');
            }
        }

        // ============ ANA MENÜ ZORLUK BUTONLARI ============
        function initMainMenuDifficultyButtons() {
            // console.log('🔧 initMainMenuDifficultyButtons çağrıldı');
            
            // Kaydedilen zorluk seviyesini UI'da göster
            updateDifficultyUI();
            
            document.getElementById('mainDiffKolay').onclick = () => {
                console.log('🎯 Zorluk seçildi: KOLAY');
                currentDifficulty = 'kolay';
                saveStats(); // Zorluk değiştiğinde kaydet!
                // Kolay yeşil seçili, diğerleri kendi border renkleri ile beyaz
                document.getElementById('mainDiffKolay').style.cssText = 'flex: 1; min-width: 90px; max-width: 120px; margin: 0; padding: 10px; font-size: 0.85em; background: #4CAF50; color: white; border: 2px solid #4CAF50;';
                document.getElementById('mainDiffOrta').style.cssText = 'flex: 1; min-width: 90px; max-width: 120px; margin: 0; padding: 10px; font-size: 0.85em; background: white; color: #FF9800; border: 2px solid #FF9800;';
                document.getElementById('mainDiffZor').style.cssText = 'flex: 1; min-width: 90px; max-width: 120px; margin: 0; padding: 10px; font-size: 0.85em; background: white; color: #f44336; border: 2px solid #f44336;';
                // Active class'ları güncelle
                document.querySelectorAll('#mainMenu .diff-btn').forEach(btn => btn.classList.remove('active'));
                document.getElementById('mainDiffKolay').classList.add('active');
            };
            
            document.getElementById('mainDiffOrta').onclick = () => {
                console.log('🎯 Zorluk seçildi: ORTA');
                currentDifficulty = 'orta';
                saveStats(); // Zorluk değiştiğinde kaydet!
                // Orta turuncu seçili, diğerleri kendi border renkleri ile beyaz
                document.getElementById('mainDiffKolay').style.cssText = 'flex: 1; min-width: 90px; max-width: 120px; margin: 0; padding: 10px; font-size: 0.85em; background: white; color: #4CAF50; border: 2px solid #4CAF50;';
                document.getElementById('mainDiffOrta').style.cssText = 'flex: 1; min-width: 90px; max-width: 120px; margin: 0; padding: 10px; font-size: 0.85em; background: #FF9800; color: white; border: 2px solid #FF9800;';
                document.getElementById('mainDiffZor').style.cssText = 'flex: 1; min-width: 90px; max-width: 120px; margin: 0; padding: 10px; font-size: 0.85em; background: white; color: #f44336; border: 2px solid #f44336;';
                // Active class'ları güncelle
                document.querySelectorAll('#mainMenu .diff-btn').forEach(btn => btn.classList.remove('active'));
                document.getElementById('mainDiffOrta').classList.add('active');
            };
            
            document.getElementById('mainDiffZor').onclick = () => {
                console.log('🎯 Zorluk seçildi: ZOR');
                currentDifficulty = 'zor';
                saveStats(); // Zorluk değiştiğinde kaydet!
                // Zor kırmızı seçili, diğerleri kendi border renkleri ile beyaz
                document.getElementById('mainDiffKolay').style.cssText = 'flex: 1; min-width: 90px; max-width: 120px; margin: 0; padding: 10px; font-size: 0.85em; background: white; color: #4CAF50; border: 2px solid #4CAF50;';
                document.getElementById('mainDiffOrta').style.cssText = 'flex: 1; min-width: 90px; max-width: 120px; margin: 0; padding: 10px; font-size: 0.85em; background: white; color: #FF9800; border: 2px solid #FF9800;';
                document.getElementById('mainDiffZor').style.cssText = 'flex: 1; min-width: 90px; max-width: 120px; margin: 0; padding: 10px; font-size: 0.85em; background: #f44336; color: white; border: 2px solid #f44336;';
                // Active class'ları güncelle
                document.querySelectorAll('#mainMenu .diff-btn').forEach(btn => btn.classList.remove('active'));
                document.getElementById('mainDiffZor').classList.add('active');
            };
        }

        // ============ ANA MENÜ NAVİGASYONU ============
        // Kelime Çevir modu - oyun modları seçici ile başlar
        elements.kelimeCevirBtn.onclick = () => {
            console.log('📚 === KELİME ÇEVİR OYUNU BAŞLATILIYOR ===');
            console.log('📋 1. Veri kontrol ediliyor...');
            
            if (kelimeBulData.length === 0) {
                console.log('❌ Kelime verileri yüklenemedi!');
                alert('Kelime verileri yüklenemedi!');
                return;
            }
            console.log(`✅ Kelime verileri OK: ${kelimeBulData.length} kelime mevcut`);
            console.log(`🎯 Mevcut zorluk: ${currentDifficulty}`);
            
            console.log('📋 2. Mode Selector açılıyor...');
            if (elements.mainMenu) elements.mainMenu.style.display = 'none';
            if (elements.modeSelector) elements.modeSelector.style.display = 'block';
            if (elements.settingsBtn) elements.settingsBtn.style.display = 'block';
            console.log('✅ Mode Selector açıldı!');
        };

        // Dinle ve Bul modu - Doğrudan başlat
        elements.dinleBulBtn.onclick = () => {
            console.log('🔥 === DINLE VE BUL OYUNU BAŞLATILIYOR ===');
            console.log('📋 1. Veri kontrol ediliyor...');
            
            if (kelimeBulData.length === 0) {
                console.log('❌ Kelime verileri yüklenemedi!');
                alert('Kelime verileri yüklenemedi!');
                return;
            }
            console.log(`✅ Kelime verileri OK: ${kelimeBulData.length} kelime mevcut`);
            
            console.log('📋 2. Zorluk seviyesi kontrol ediliyor...');
            console.log(`🎯 Mevcut zorluk: ${currentDifficulty}`);
            console.log(`🎯 Zorluk config:`, CONFIG.difficultyLevels[currentDifficulty]);
            
            console.log('📋 3. UI değiştiriliyor...');
            if (elements.mainMenu) elements.mainMenu.style.display = 'none';
            if (elements.dinleMode) elements.dinleMode.style.display = 'block';
            console.log('✅ UI değişikliği tamamlandı');
            
            console.log('📋 4. Oyun değişkenleri sıfırlanıyor...');
            console.log(`🔄 Önceki değerler: score=${dinleScore}, correct=${dinleCorrect}, wrong=${dinleWrong}, questionCount=${dinleQuestionCount}`);
            // Dinle modunu başlat
            dinleScore = 0;
            dinleCorrect = 0;
            dinleWrong = 0;
            dinleQuestionCount = 0;
            console.log(`✅ Yeni değerler: score=${dinleScore}, correct=${dinleCorrect}, wrong=${dinleWrong}, questionCount=${dinleQuestionCount}`);
            console.log(`📊 Session değerler: sessionScore=${sessionScore}, sessionCorrect=${sessionCorrect}, sessionWrong=${sessionWrong}`);
            
            // Audio butonu event handler
            elements.dinleAudioBtn.onclick = () => {
                if (currentDinleQuestion && currentDinleQuestion.ses_dosyasi) {
                    playAudio(currentDinleQuestion.ses_dosyasi, elements.dinleAudioBtn);
                }
            };
            
            // Next butonu event handler'ını buraya taşıdık
            elements.dinleNextBtn.onclick = () => {
                console.log(`🔄 === NEXT BUTONU TIKLANDI! ===`);
                console.log(`📊 Mevcut durum: dinleQuestionCount=${dinleQuestionCount}/${DINLE_MAX_QUESTIONS}`);
                console.log(`🎯 Bir sonraki soru yükleniyor...`);
                elements.dinleNextBtn.style.display = 'none';
                loadDinleQuestion();
            };
            
            updateDinleUI();
            loadDinleQuestion();
        };

        // Boşluk Doldur modu
        elements.boslukDoldurBtn.onclick = () => {
            console.log('📋 === BOŞLUK DOLDUR OYUNU BAŞLATILIYOR ===');
            console.log('📋 1. Veri kontrol ediliyor...');
            
            if (ayetOkuData.length === 0) {
                console.log('❌ Ayet verileri yüklenemedi!');
                alert('Ayet verileri yüklenemedi!');
                return;
            }
            console.log(`✅ Ayet verileri OK: ${ayetOkuData.length} ayet mevcut`);
            console.log(`🎯 Mevcut zorluk: ${currentDifficulty}`);
            
            console.log('📋 2. UI değiştiriliyor...');
            if (elements.mainMenu) elements.mainMenu.style.display = 'none';
            if (elements.boslukMode) elements.boslukMode.style.display = 'block';
            console.log('✅ UI değişikliği tamamlandı');
            
            console.log('📋 3. Oyun değişkenleri sıfırlanıyor...');
            console.log(`🔄 Önceki değerler: score=${boslukScore}, correct=${boslukCorrect}, wrong=${boslukWrong}`);
            // Boşluk modunu başlat
            boslukScore = 0;
            boslukCorrect = 0;
            boslukWrong = 0;
            console.log(`✅ Yeni değerler: score=${boslukScore}, correct=${boslukCorrect}, wrong=${boslukWrong}`);
            console.log(`📊 Session değerler: sessionScore=${sessionScore}, sessionCorrect=${sessionCorrect}, sessionWrong=${sessionWrong}`);
            
            updateBoslukUI();
            loadBoslukQuestion();
        };

        // Dua Et modu
        elements.duaEtBtn.onclick = () => {
            if (duaData.length === 0) {
                alert('Dua verileri yüklenemedi!');
                return;
            }
            if (elements.mainMenu) elements.mainMenu.style.display = 'none';
            if (elements.duaMode) elements.duaMode.style.display = 'block';
            // Rastgele dua ile başla
            currentDuaIndex = Math.floor(Math.random() * duaData.length);
            showDua();
        };

        // Ayet Oku modu
        elements.ayetOkuBtn.onclick = () => {
            if (ayetOkuData.length === 0) {
                alert('Ayet verileri yüklenemedi!');
                return;
            }
            if (elements.mainMenu) elements.mainMenu.style.display = 'none';
            if (elements.ayetMode) elements.ayetMode.style.display = 'block';
            // Rastgele ayet ile başla
            currentAyetIndex = Math.floor(Math.random() * ayetOkuData.length);
            showAyet();
        };

        // Hadis Oku modu
        elements.hadisOkuBtn.onclick = () => {
            if (hadisData.length === 0) {
                alert('Hadis verileri yüklenemedi!');
                return;
            }
            if (elements.mainMenu) elements.mainMenu.style.display = 'none';
            if (elements.hadisMode) elements.hadisMode.style.display = 'block';
            // Rastgele hadis ile başla
            currentHadisIndex = Math.floor(Math.random() * hadisData.length);
            showHadis();
        };

        // Geri butonları
        elements.backToMenuBtn.onclick = () => {
            elements.modeSelector.style.display = 'none';
            elements.mainMenu.style.display = 'block';
            elements.settingsBtn.style.display = 'none';
        };

        elements.backFromGameBtn.onclick = async () => {
            // Ses durdur
            stopCurrentAudio();
            
            // Oyun sırasında çıkış - puanlar zaten kaydedildi ama kullanıcıya bilgi verelim
            if (sessionScore > 0) {
                const confirmed = await showCustomConfirm(sessionCorrect, sessionWrong, sessionScore);
                
                if (!confirmed) {
                    return; // Kullanıcı vazgeçti
                }
                
                // Session istatistiklerini günlük görevlere kaydet
                if (sessionCorrect > 0) {
                    updateTaskProgress('toplamDogru', sessionCorrect);
                    // NOT: toplamPuan zaten addSessionPoints'te eklendi, burada tekrar eklemeyelim!
                }
                
                // Session değişkenlerini sıfırla
                sessionScore = 0;
                sessionCorrect = 0;
                sessionWrong = 0;
                comboCount = 0;
                
                console.log('🏁 Oyundan erken çıkıldı. Puanlar kaydedildi:', {
                    totalPoints,
                    kazanilanPuan: sessionScore
                });
            }
            
            stopTimer();
            if (elements.gameScreen) elements.gameScreen.style.display = 'none';
            if (elements.modeSelector) elements.modeSelector.style.display = 'none';
            if (elements.mainMenu) {
                elements.mainMenu.removeAttribute('style');
                elements.mainMenu.style.display = 'block';
            }
            if (elements.settingsBtn) elements.settingsBtn.style.display = 'none';
        };

        elements.backFromAyetBtn.onclick = () => {
            elements.ayetMode.style.display = 'none';
            elements.modeSelector.style.display = 'none';
            elements.gameScreen.style.display = 'none';
            elements.mainMenu.removeAttribute('style');
            elements.mainMenu.style.display = 'block';
            elements.settingsBtn.style.display = 'none';
        };

        elements.backFromDuaBtn.onclick = () => {
            elements.duaMode.style.display = 'none';
            elements.modeSelector.style.display = 'none';
            elements.gameScreen.style.display = 'none';
            elements.mainMenu.removeAttribute('style');
            elements.mainMenu.style.display = 'block';
            elements.settingsBtn.style.display = 'none';
        };

        elements.backFromHadisBtn.onclick = () => {
            elements.hadisMode.style.display = 'none';
            elements.modeSelector.style.display = 'none';
            elements.gameScreen.style.display = 'none';
            elements.mainMenu.removeAttribute('style');
            elements.mainMenu.style.display = 'block';
            elements.settingsBtn.style.display = 'none';
        };

        elements.backFromBoslukBtn.onclick = async () => {
            // Ses durdur
            stopCurrentAudio();
            
            // Oyun sırasında çıkış - puanlar zaten kaydedildi
            if (boslukScore > 0) {
                const confirmed = await showCustomConfirm(boslukCorrect, boslukWrong, boslukScore);
                
                if (!confirmed) return;
                
                // Session istatistiklerini kaydet
                if (boslukCorrect > 0) {
                    updateTaskProgress('boslukDoldur', boslukCorrect);
                    updateTaskProgress('toplamDogru', boslukCorrect);
                    // NOT: toplamPuan zaten addSessionPoints'te eklendi!
                }
                
                // Reset
                boslukScore = 0;
                boslukCorrect = 0;
                boslukWrong = 0;
                sessionScore = 0;
                sessionCorrect = 0;
                sessionWrong = 0;
                comboCount = 0;
            }
            
            elements.boslukMode.style.display = 'none';
            elements.modeSelector.style.display = 'none';
            elements.gameScreen.style.display = 'none';
            elements.mainMenu.removeAttribute('style');
            elements.mainMenu.style.display = 'block';
            elements.settingsBtn.style.display = 'none';
        };

        elements.backFromDinleBtn.onclick = async () => {
            // Ses durdur
            stopCurrentAudio();
            
            // Oyun sırasında çıkış - puanlar zaten kaydedildi
            if (dinleScore > 0) {
                const confirmed = await showCustomConfirm(dinleCorrect, dinleWrong, dinleScore);
                
                if (!confirmed) return;
                
                // Session istatistiklerini kaydet
                if (dinleCorrect > 0) {
                    updateTaskProgress('dinleBul', dinleCorrect);
                    updateTaskProgress('toplamDogru', dinleCorrect);
                    // NOT: toplamPuan zaten addSessionPoints'te eklendi!
                }
                
                // Reset
                dinleScore = 0;
                dinleCorrect = 0;
                dinleWrong = 0;
                sessionScore = 0;
                sessionCorrect = 0;
                sessionWrong = 0;
                comboCount = 0;
            }
            
            elements.dinleMode.style.display = 'none';
            elements.modeSelector.style.display = 'none';
            elements.gameScreen.style.display = 'none';
            if (elements.mainMenu) {
                elements.mainMenu.removeAttribute('style');
                elements.mainMenu.style.display = 'block';
            }
            if (elements.settingsBtn) {
                elements.settingsBtn.style.display = 'none';
            }
        };

        // ============ MOD SEÇİCİYİ BAŞLAT (Sadece Kelime Çevir için) ============
        function initModeSelector() {
            // Sadece Kelime Çevir oyun modlarını oluştur
            Object.keys(CONFIG.gameModes).forEach(modeKey => {
                const mode = CONFIG.gameModes[modeKey];
                const btn = document.createElement('button');
                btn.className = 'mode-btn';
                if (modeKey === currentMode) btn.classList.add('active');
                btn.innerHTML = `<strong>${mode.name}</strong><small>${mode.description}</small>`;
                btn.onclick = () => selectMode(modeKey);
                elements.modeButtons.appendChild(btn);
            });
        }

        // ============ MOD SEÇ ============
        function selectMode(modeKey) {
            currentMode = modeKey;
            saveStats(); // Mod değiştiğinde kaydet!
            document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
            event.target.closest('.mode-btn').classList.add('active');
        }

        // ============ OYUNU BAŞLAT ============
        elements.startBtn.onclick = () => {
            const mode = CONFIG.gameModes[currentMode];
            
            // Ayarları uygula
            lives = mode.lives;
            if (lives > 0) {
                elements.livesDisplay.style.display = 'block';
                elements.lives.textContent = lives;
            } else {
                elements.livesDisplay.style.display = 'none';
            }

            if (mode.timeLimit > 0) {
                elements.timerDisplay.style.display = 'block';
            } else {
                elements.timerDisplay.style.display = 'none';
            }

            if (mode.showHint) {
                elements.hintBtn.style.display = 'block';
            } else {
                elements.hintBtn.style.display = 'none';
            }

            elements.currentMode.textContent = mode.name;

            // Session puanlarını sıfırla (global puanları koru)
            sessionScore = 0;
            sessionCorrect = 0;
            sessionWrong = 0;
            comboCount = 0;
            questionCount = 0;
            
            // Combo indicator'ı gizle
            hideCombo();
            
            // Geriye uyumluluk için eski değişkenleri de sıfırla
            score = 0;
            correct = 0;
            wrong = 0;

            updateUI();

            // Ekranları değiştir - Sadece Kelime Çevir oyunu başlat
            elements.modeSelector.style.display = 'none';
            elements.gameScreen.style.display = 'block';
            loadQuestion();
        };

        // ============ AYARLARA DÖN ============
        if (elements.settingsBtn) {
            elements.settingsBtn.onclick = () => {
                stopTimer();
                elements.gameScreen.style.display = 'none';
                elements.modeSelector.style.display = 'block';
            };
        }

        // ============ SORU YÜKLEME (Kelime Çevir) ============
        function loadQuestion() {
            // Önceki ses varsa durdur
            stopCurrentAudio();
            
            console.log('📚 === KELİME ÇEVİR SORU YÜKLENİYOR (AKILLI SEÇİM) ===');
            console.log(`📊 Mevcut soru sayısı: ${questionCount}`);
            console.log(`🎯 Mevcut mod: ${currentMode}`);
            console.log(`🎯 Zorluk: ${currentDifficulty}`);
            
            const mode = CONFIG.gameModes[currentMode];
            console.log(`📋 Mod detayları:`, mode);
            
            // Soru sayısı kontrolü - oyun bitirme
            if (questionCount >= mode.questionsPerLevel) {
                console.log(`🏁 === KELİME ÇEVİR OYUNU BİTTİ ===`);
                console.log(`✅ ${mode.questionsPerLevel} soru tamamlandı!`);
                console.log(`📊 Final session score: ${sessionScore}`);
                
                // Günlük görev ilerlemesini güncelle
                updateTaskProgress('kelimeCevir', sessionCorrect);
                
                // Session puanlarını global'e aktar
                console.log(`💰 Session puanları global'e aktarılıyor: ${sessionScore} puan`);
                addToGlobalPoints(sessionScore, sessionCorrect);
                
                // Direkt ana menüye dön (popup yok)
                console.log(`🔄 Ana menüye dönülüyor...`);
                elements.gameScreen.style.display = 'none';
                elements.modeSelector.style.display = 'none';
                elements.mainMenu.style.display = 'block';
                console.log(`✅ Kelime Çevir oyunu bitti ve ana menüye dönüldü!`);
                return;
            }

            // Can kontrolü
            if (mode.lives > 0 && lives <= 0) {
                console.log(`💀 Can bitti! Oyun sona eriyor...`);
                gameOver('Can bitti!');
                return;
            }

            console.log(`🔍 Zorluk filtreleme başlıyor...`);
            console.log(`🎯 Seçili zorluk: ${currentDifficulty}`);
            
            // Zorluk filtreleme
            const diffLevel = CONFIG.difficultyLevels[currentDifficulty];
            console.log(`📋 Zorluk aralığı: ${diffLevel.minDiff}-${diffLevel.maxDiff}`);
            console.log(`📦 Toplam kelime sayısı: ${kelimeBulData.length}`);
            
            let filteredData = kelimeBulData.filter(w => 
                w.difficulty >= diffLevel.minDiff && w.difficulty <= diffLevel.maxDiff
            );
            console.log(`✅ Zorluk filtresi sonrası: ${filteredData.length} kelime`);

            // Mod özel zorluk kontrolü
            if (mode.minDifficulty) {
                console.log(`📋 Mod minimum zorluk kontrolü: >= ${mode.minDifficulty}`);
                filteredData = filteredData.filter(w => w.difficulty >= mode.minDifficulty);
                console.log(`✅ Mod filtresi sonrası: ${filteredData.length} kelime`);
            }

            if (filteredData.length === 0) {
                filteredData = kelimeBulData;
            }

            // AKILLI KELİME SEÇİMİ - Zorlanılan kelimeleri daha sık göster
            console.log('🧠 Akıllı kelime seçimi başlıyor...');
            currentQuestion = selectIntelligentWord(filteredData);

            // UI güncelle
            elements.arabicWord.textContent = currentQuestion.kelime;
            elements.sureInfo.textContent = `ID: ${currentQuestion.id}`;

            // Seçenekler oluştur
            const wrongAnswers = getWrongAnswers(3);
            const allOptions = [
                { text: currentQuestion.anlam, correct: true },
                ...wrongAnswers.map(w => ({ text: w.anlam, correct: false }))
            ];

            // Karıştır
            shuffle(allOptions);

            // Seçenekleri göster
            elements.options.innerHTML = '';
            const labels = ['A', 'B', 'C', 'D'];
            allOptions.forEach((opt, i) => {
                const btn = document.createElement('button');
                btn.className = 'option';
                btn.textContent = `${labels[i]}) ${opt.text}`;
                btn.onclick = () => checkAnswer(btn, opt.correct);
                elements.options.appendChild(btn);
            });

            // Sıfırla
            elements.feedback.textContent = '';
            elements.feedback.className = 'feedback';
            elements.nextBtn.style.display = 'none';
            elements.hintBtn.disabled = false;

            // İlerleme güncelle
            updateProgress();

            // Süreyi başlat
            if (mode.timeLimit > 0) {
                startTimer(mode.timeLimit);
            }
        }

        // ============ YANLIŞ CEVAPLAR ============
        function getWrongAnswers(count) {
            const wrong = [];
            const filtered = kelimeBulData.filter(w => w.id !== currentQuestion.id);
            
            while (wrong.length < count && filtered.length > 0) {
                const idx = Math.floor(Math.random() * filtered.length);
                const word = filtered[idx];
                
                if (!wrong.find(w => w.anlam === word.anlam)) {
                    wrong.push(word);
                }
                filtered.splice(idx, 1);
            }
            
            return wrong;
        }

        // ============ KARIŞTIR ============
        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        // ============ CEVAP KONTROL ============
        function checkAnswer(button, isCorrect) {
            console.log(`🚨 === KELİME ÇEVİR CEVAP KONTROLÜ ===`);
            console.log(`👆 Tıklanan buton: "${button.textContent}"`);
            console.log(`✅/❌ isCorrect parametresi: ${isCorrect}`);
            console.log(`📊 Mevcut soru: #${questionCount + 1}`);
            console.log(`📊 Önce - session: score=${sessionScore}, correct=${sessionCorrect}, wrong=${sessionWrong}`);
            console.log(`📊 Önce - kelime çevir: score=${score}, correct=${correct}, wrong=${wrong}`);
            
            stopTimer();
            
            // Tüm butonları kapat
            const allBtns = document.querySelectorAll('.option');
            console.log(`🔒 ${allBtns.length} buton devre dışı bırakılıyor...`);
            allBtns.forEach(btn => btn.disabled = true);

            const mode = CONFIG.gameModes[currentMode];
            const diffLevel = CONFIG.difficultyLevels[currentDifficulty];
            console.log(`🎯 Mod: ${currentMode}, Zorluk: ${currentDifficulty}`);

            // KELİME İSTATİSTİKLERİNİ GÜNCELLE
            console.log(`📊 Kelime istatistiği güncelleniyor: ${currentQuestion.kelime} (ID: ${currentQuestion.id})`);
            updateWordStats(currentQuestion.id, isCorrect);

            if (isCorrect) {
                console.log(`✅ === DOĞRU CEVAP İŞLEMİ ===`);
                button.classList.add('correct');
                elements.feedback.textContent = '✅ Doğru!';
                elements.feedback.className = 'feedback correct';
                
                const points = currentQuestion.difficulty * diffLevel.pointsMultiplier;
                console.log(`💰 Puan hesaplama: ${currentQuestion.difficulty} × ${diffLevel.pointsMultiplier} = ${points} puan`);
                console.log(`📊 addSessionPoints(${points}) çağrılıyor...`);
                addSessionPoints(points); // Session puanına ekle
                
                // Daily task progress - her doğru cevap için
                updateTaskProgress('kelimeCevir', 1);
                
                // Perfect streak kontrolü - hiç yanlış yapmamışsak perfect streak artır
                if (sessionWrong === 0) {
                    updateTaskProgress('perfectStreak', 1);
                    console.log(`🔥 Perfect streak artırıldı! Mevcut: ${dailyTasks.todayStats.perfectStreak}`);
                }
                
                console.log(`✅ Doğru cevap işlemi tamamlandı!`);
                
                updateUI();
            } else {
                console.log(`❌ === YANLIŞ CEVAP İŞLEMİ ===`);
                button.classList.add('wrong');
                elements.feedback.textContent = `❌ Yanlış! Doğru: ${currentQuestion.anlam}`;
                elements.feedback.className = 'feedback wrong';
                
                console.log(`📊 addSessionWrong() çağrılıyor...`);
                addSessionWrong(); // Session yanlış sayısını artır
                
                console.log(`💸 Puan cezası uygulanıyor: ${CONFIG.wrongAnswerPenalty} puan`);
                console.log(`📊 Eski score: ${score}`);
                // Puan cezası
                score = Math.max(0, score - CONFIG.wrongAnswerPenalty);
                console.log(`📊 Yeni score: ${score}`);
                
                // Can kaybı
                if (mode.lives > 0) {
                    console.log(`💀 Can kaybı: ${lives} - 1 = ${lives - 1}`);
                    lives--;
                    elements.lives.textContent = lives;
                    
                    if (lives <= 0) {
                        setTimeout(() => gameOver('Canlarınız bitti!'), 1500);
                    }
                }

                updateUI();

                // Doğru cevabı göster
                allBtns.forEach(btn => {
                    if (btn.textContent.includes(currentQuestion.anlam)) {
                        btn.classList.add('correct');
                    }
                });
            }

            questionCount++;
            elements.nextBtn.style.display = 'block';
        }

        // ============ SES ÇALMA ============
        elements.audioBtn.onclick = () => {
            if (currentQuestion && currentQuestion.ses_dosyasi) {
                playAudio(currentQuestion.ses_dosyasi, elements.audioBtn);
            }
        };

        // ============ SONRAKİ SORU ============
        elements.nextBtn.onclick = () => {
            loadQuestion();
        };

        // ============ İLERLEME GÜNCELLE ============
        function updateProgress() {
            const mode = CONFIG.gameModes[currentMode];
            const progress = (questionCount / mode.questionsPerLevel) * 100;
            if (elements.progressBar) {
                elements.progressBar.style.width = `${progress}%`;
            }
        }

        // ============ UI GÜNCELLE ============
        function updateUI() {
            // Alt bar: Sadece session (oyun içi) puanları göster
            elements.score.textContent = sessionScore;
            elements.correct.textContent = sessionCorrect;
            elements.wrong.textContent = sessionWrong;
            elements.level.textContent = level; // Global seviye
        }

        // ============ SÜRE YÖNETİMİ ============
        function startTimer(seconds) {
            stopTimer();
            timeLeft = seconds;
            
            // Timer elementini kontrol et
            if (elements.timer) {
                elements.timer.textContent = timeLeft;
            }
            
            timer = setInterval(() => {
                timeLeft--;
                
                // Timer elementini sadece varsa güncelle
                if (elements.timer) {
                    elements.timer.textContent = timeLeft;
                }
                
                if (timeLeft <= 0) {
                    stopTimer();
                    gameOver('Süre doldu!');
                }
            }, 1000);
        }

        function stopTimer() {
            if (timer) {
                clearInterval(timer);
                timer = null;
            }
        }

        // ============ İPUCU ============
        elements.hintBtn.onclick = () => {
            // Bir yanlış cevabı kaldır
            const allBtns = document.querySelectorAll('.option');
            const wrongBtns = Array.from(allBtns).filter(btn => 
                !btn.textContent.includes(currentQuestion.anlam) && !btn.disabled
            );
            
            if (wrongBtns.length > 0) {
                const randomWrong = wrongBtns[Math.floor(Math.random() * wrongBtns.length)];
                randomWrong.style.opacity = '0.3';
                randomWrong.disabled = true;
                
                // İpucu puan cezası
                score = Math.max(0, score - 10);
                updateUI();
                
                elements.hintBtn.disabled = true;
            }
        };

        // ============ SEVİYE ATLAMA ============
        function showLevelUpModal(newLevel) {
            elements.newLevel.textContent = newLevel;
            
            // Modal için ek bilgileri güncelle
            const modalTotalPoints = document.getElementById('modalTotalPoints');
            const modalNextLevelPoints = document.getElementById('modalNextLevelPoints');
            
            if (modalTotalPoints && modalNextLevelPoints) {
                modalTotalPoints.textContent = totalPoints.toLocaleString();
                modalNextLevelPoints.textContent = getNextLevelRequiredPoints(newLevel).toLocaleString();
            }
            
            // Seviye atlama sesi çal
            playSound('levelup');
            
            // Konfeti efekti başlat!
            createConfetti();
            
            elements.modal.style.display = 'flex';
        }
        
        function createConfetti() {
            const colors = ['#FFD700', '#FF6B6B', '#4ECDC4', '#45B7D1', '#FFA07A', '#98D8C8', '#F7DC6F', '#BB8FCE'];
            const confettiCount = 50;
            
            for (let i = 0; i < confettiCount; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.style.cssText = `
                        position: fixed;
                        width: 10px;
                        height: 10px;
                        background: ${colors[Math.floor(Math.random() * colors.length)]};
                        left: ${Math.random() * 100}%;
                        top: -10px;
                        opacity: 1;
                        transform: rotate(${Math.random() * 360}deg);
                        z-index: 10000;
                        pointer-events: none;
                        border-radius: ${Math.random() > 0.5 ? '50%' : '0'};
                    `;
                    
                    document.body.appendChild(confetti);
                    
                    const fall = confetti.animate([
                        { 
                            transform: `translateY(0) rotate(${Math.random() * 360}deg)`,
                            opacity: 1
                        },
                        { 
                            transform: `translateY(${window.innerHeight + 20}px) rotate(${Math.random() * 360 + 720}deg)`,
                            opacity: 0
                        }
                    ], {
                        duration: 2000 + Math.random() * 1000,
                        easing: 'cubic-bezier(0.25, 0.46, 0.45, 0.94)'
                    });
                    
                    fall.onfinish = () => confetti.remove();
                }, i * 30);
            }
        }

        // Eski levelUp fonksiyonu artık kullanılmıyor
        function levelUp() {
            // Bu fonksiyon artık kullanılmıyor - yeni puan bazlı sistem kullanıyoruz
        }

        // ============ OYUN BİTTİ ============
        function gameOver(reason) {
            stopTimer();
            
            // Session puanlarını global'e aktar
            addToGlobalPoints(sessionScore, sessionCorrect);
            
            if (elements.gameOverTitle) elements.gameOverTitle.textContent = '😢 Oyun Bitti';
            if (elements.gameOverText) elements.gameOverText.textContent = reason;
            if (elements.finalScore) elements.finalScore.textContent = `Bu Oyun: ${sessionScore} puan\nToplam: ${totalPoints} puan`;
            if (elements.gameOverModal) elements.gameOverModal.style.display = 'block';
        }

        // ============ YENİDEN BAŞLAT ============
        elements.restartBtn.onclick = () => {
            if (elements.gameOverModal) elements.gameOverModal.style.display = 'none';
            if (elements.gameScreen) elements.gameScreen.style.display = 'none';
            if (elements.modeSelector) elements.modeSelector.style.display = 'none';
            if (elements.mainMenu) elements.mainMenu.style.display = 'block';
            if (elements.settingsBtn) elements.settingsBtn.style.display = 'none';
        };

        // ============ MODAL KAPAT ============
        elements.modalBtn.onclick = () => {
            if (elements.modal) elements.modal.style.display = 'none';
            // Sadece modal'ı kapat - seviye yükselme bilgilendirmesi için gereksiz işlem yapma
        };

        // ============ DİNLE VE BUL MODU ============
        let currentDinleQuestion = null;
        let dinleQuestionCount = 0;
        const DINLE_MAX_QUESTIONS = 10;

        function loadDinleQuestion() {
            // Önceki ses varsa durdur
            stopCurrentAudio();
            
            console.log(`🎪 === SORU YÜKLENİYOR ===`);
            console.log(`📊 Mevcut soru sayısı: ${dinleQuestionCount}/${DINLE_MAX_QUESTIONS}`);
            console.log(`📊 Oyun durumu: score=${dinleScore}, correct=${dinleCorrect}, wrong=${dinleWrong}`);
            
            // 10 soru kontrolü
            if (dinleQuestionCount >= DINLE_MAX_QUESTIONS) {
                console.log(`🏁 === OYUN BİTİŞİ TETİKLENDİ ===`);
                console.log(`✅ ${DINLE_MAX_QUESTIONS} soru tamamlandı!`);
                console.log(`📊 Final oyun skorları: dinleScore=${dinleScore}, dinleCorrect=${dinleCorrect}, dinleWrong=${dinleWrong}`);
                console.log(`📊 Final session skorları: sessionScore=${sessionScore}, sessionCorrect=${sessionCorrect}, sessionWrong=${sessionWrong}`);
                
                // Günlük görev ilerlemesini güncelle
                updateTaskProgress('dinleBul', sessionCorrect);
                
                console.log(`💰 Session puanları global'e aktarılıyor: ${sessionScore} puan`);
                // Session puanlarını global'e aktar
                addToGlobalPoints(sessionScore, sessionCorrect);
                
                console.log(`🔄 Ana menüye dönülüyor...`);
                // Direkt ana menüye dön
                elements.dinleMode.style.display = 'none';
                elements.mainMenu.style.display = 'block';
                
                console.log(`🧹 Oyun değişkenleri temizleniyor...`);
                // Sıfırla
                dinleScore = 0;
                dinleCorrect = 0;
                dinleWrong = 0;
                dinleQuestionCount = 0;
                updateDinleUI();
                console.log(`✅ Oyun bitti ve ana menüye dönüldü!`);
                return;
            }

            console.log(`🔍 Zorluk filtreleme başlıyor...`);
            console.log(`🎯 Seçili zorluk: ${currentDifficulty}`);
            // Zorluk filtreleme (Kelime Çevir ile aynı)
            const diffLevel = CONFIG.difficultyLevels[currentDifficulty];
            console.log(`📋 Zorluk aralığı: ${diffLevel.minDiff}-${diffLevel.maxDiff}`);
            console.log(`📦 Toplam kelime sayısı: ${kelimeBulData.length}`);
            
            let filteredData = kelimeBulData.filter(w => 
                w.difficulty >= diffLevel.minDiff && w.difficulty <= diffLevel.maxDiff
            );
            console.log(`✅ Filtrelenmiş kelime sayısı: ${filteredData.length}`);

            if (filteredData.length === 0) {
                console.log(`⚠️ Filtrelenmiş veri boş! Tüm kelimeler kullanılacak.`);
                filteredData = kelimeBulData;
            }

            console.log(`🧠 Akıllı kelime seçimi (Dinle Modu) başlıyor...`);
            currentDinleQuestion = selectIntelligentWord(filteredData);
            console.log(`✅ Seçilen kelime: ${currentDinleQuestion.kelime}`);
            
            console.log(`📝 === SORU #${dinleQuestionCount + 1} ===`);
            console.log(`🔤 Kelime: "${currentDinleQuestion.kelime}"`);
            console.log(`💭 Anlam: "${currentDinleQuestion.anlam}"`);
            console.log(`📊 Soru zorluğu: ${currentDinleQuestion.difficulty}`);
            console.log(`📊 Seçili zorluk: ${currentDifficulty} (${diffLevel.minDiff}-${diffLevel.maxDiff})`);
            console.log(`🎯 Puan hesaplama: ${currentDinleQuestion.difficulty} × 2 = ${currentDinleQuestion.difficulty * 2} puan`);

            console.log(`🎨 UI güncelleniyor...`);
            // UI güncelle
            elements.dinleSureInfo.textContent = `ID: ${currentDinleQuestion.id}`;
            console.log(`✅ Kelime ID: ${currentDinleQuestion.id}`);

            console.log(`🔀 Seçenekler oluşturuluyor... (4 Arapça kelime)`);
            // Seçenekler oluştur (4 Arapça kelime) - aynı zorluktan
            const wrongAnswers = [];
            let attempts = 0;
            while (wrongAnswers.length < 3 && attempts < 50) {
                attempts++;
                const random = filteredData[Math.floor(Math.random() * filteredData.length)];
                if (random.kelime !== currentDinleQuestion.kelime && 
                    !wrongAnswers.find(w => w.kelime === random.kelime)) {
                    wrongAnswers.push(random);
                    console.log(`✅ Yanlış cevap #${wrongAnswers.length}: "${random.kelime}" (zorluk: ${random.difficulty})`);
                }
            }
            console.log(`📊 Yanlış cevap oluşturma: ${attempts} deneme, ${wrongAnswers.length}/3 başarılı`);

            const allOptions = [
                { text: currentDinleQuestion.kelime, correct: true },
                ...wrongAnswers.map(w => ({ text: w.kelime, correct: false }))
            ];
            console.log(`🎯 Doğru cevap: "${currentDinleQuestion.kelime}" (index: 0)`);
            console.log(`❌ Yanlış cevaplar: ${wrongAnswers.map(w => `"${w.kelime}"`).join(', ')}`);

            shuffle(allOptions);

            // Seçenekleri göster
            elements.dinleOptions.innerHTML = '';
            const labels = ['A', 'B', 'C', 'D'];
            allOptions.forEach((opt, i) => {
                const btn = document.createElement('button');
                btn.className = 'option';
                // Arapça ise özel sınıf ekle ve düzgün formatlama
                if (isArabic(opt.text)) {
                    btn.classList.add('arabic-option');
                    // Arapça için özel format: LTR yönde harf + Arapça metin
                    btn.innerHTML = `<span style="direction: ltr; display: flex; align-items: center; justify-content: center; gap: 8px;"><span>${labels[i]})</span><span style="direction: rtl;">${opt.text}</span></span>`;
                } else {
                    btn.textContent = `${labels[i]}) ${opt.text}`;
                }
                btn.onclick = () => checkDinleAnswer(btn, opt.correct);
                elements.dinleOptions.appendChild(btn);
            });

            elements.dinleFeedback.textContent = '';
            elements.dinleFeedback.className = 'feedback';
            elements.dinleNextBtn.style.display = 'none';

            // Otomatik ses çal
            if (currentDinleQuestion.ses_dosyasi) {
                playAudio(currentDinleQuestion.ses_dosyasi, elements.dinleAudioBtn);
            }
        }

        function checkDinleAnswer(button, isCorrect) {
            console.log(`🚨 === CEVAP KONTROLÜ BAŞLIYOR ===`);
            console.log(`👆 Tıklanan buton: "${button.textContent}"`);
            console.log(`✅/❌ isCorrect parametresi: ${isCorrect}`);
            console.log(`📊 Mevcut soru: #${dinleQuestionCount + 1}/${DINLE_MAX_QUESTIONS}`);
            console.log(`� Önce - session score: ${sessionScore}, session correct: ${sessionCorrect}, session wrong: ${sessionWrong}`);
            console.log(`📊 Önce - dinle score: ${dinleScore}, dinle correct: ${dinleCorrect}, dinle wrong: ${dinleWrong}`);
            
            // KELİME İSTATİSTİKLERİNİ GÜNCELLE (Dinle Modu)
            console.log(`📊 Kelime istatistiği güncelleniyor (Dinle): ${currentDinleQuestion.kelime} (ID: ${currentDinleQuestion.id})`);
            updateWordStats(currentDinleQuestion.id, isCorrect);
            
            const allBtns = elements.dinleOptions.querySelectorAll('.option');
            console.log(`🔒 ${allBtns.length} buton devre dışı bırakılıyor...`);
            allBtns.forEach(btn => btn.disabled = true);

            if (isCorrect) {
                console.log(`✅ === DOĞRU CEVAP İŞLEMİ ===`);
                button.classList.add('correct');
                elements.dinleFeedback.textContent = '✅ Doğru!';
                elements.dinleFeedback.className = 'feedback correct';
                
                const points = currentDinleQuestion.difficulty * 2;
                console.log(`💰 Puan hesaplama: ${currentDinleQuestion.difficulty} × 2 = ${points} puan`);
                
                console.log(`📊 Dinle score güncelleniyor: ${dinleScore} + ${points} = ${dinleScore + points}`);
                dinleScore += points; // Local oyun puanı
                
                console.log(`📊 Dinle correct güncelleniyor: ${dinleCorrect} + 1 = ${dinleCorrect + 1}`);
                dinleCorrect++;
                
                console.log(`📊 addSessionPoints(${points}) çağrılıyor...`);
                addSessionPoints(points); // Session puanına ekle
                
                // Daily task progress - her doğru cevap için
                updateTaskProgress('dinleBul', 1);
                
                // Perfect streak kontrolü - hiç yanlış yapmamışsak perfect streak artır
                if (sessionWrong === 0) {
                    updateTaskProgress('perfectStreak', 1);
                    console.log(`🔥 Perfect streak artırıldı! Mevcut: ${dailyTasks.todayStats.perfectStreak}`);
                }
                
                console.log(`✅ Doğru cevap işlemi tamamlandı!`);
                console.log(`📊 Sonra - session score: ${sessionScore}, session correct: ${sessionCorrect}`);
            } else {
                console.log(`❌ === YANLIŞ CEVAP İŞLEMİ ===`);
                button.classList.add('wrong');
                elements.dinleFeedback.textContent = `❌ Yanlış! Doğru: ${currentDinleQuestion.kelime} (${currentDinleQuestion.anlam})`;
                elements.dinleFeedback.className = 'feedback wrong';
                
                console.log(`📊 Dinle wrong güncelleniyor: ${dinleWrong} + 1 = ${dinleWrong + 1}`);
                dinleWrong++;
                
                console.log(`📊 addSessionWrong() çağrılıyor...`);
                addSessionWrong(); // Session yanlış sayısını artır
                console.log(`❌ ÖNEMLI: Yanlış cevap için puan EKLENMEDİ!`);
                console.log(`📊 Session score değişmedi: ${sessionScore}`);

                console.log(`🔍 Doğru cevabı gösteriliyor...`);
                // Doğru cevabı göster
                let correctButtonFound = false;
                allBtns.forEach(btn => {
                    if (btn.textContent.includes(currentDinleQuestion.kelime)) {
                        btn.classList.add('correct');
                        correctButtonFound = true;
                        console.log(`✅ Doğru buton bulundu ve işaretlendi: "${btn.textContent}"`);
                    }
                });
                if (!correctButtonFound) {
                    console.log(`⚠️ Doğru buton bulunamadı!`);
                }
            }

            console.log(`📊 Soru sayacı artırılıyor: ${dinleQuestionCount} + 1 = ${dinleQuestionCount + 1}`);
            dinleQuestionCount++; // Soru sayacını artır
            console.log(`📊 FINAL - session: score=${sessionScore}, correct=${sessionCorrect}, wrong=${sessionWrong}`);
            console.log(`📊 FINAL - dinle: score=${dinleScore}, correct=${dinleCorrect}, wrong=${dinleWrong}, questionCount=${dinleQuestionCount}`);
            console.log(`🚨 === CEVAP KONTROLÜ BİTTİ ===`);
            console.log(`🎨 UI güncelleniyor ve Next butonu gösteriliyor...`);
            updateDinleUI();
            elements.dinleNextBtn.style.display = 'block';
            console.log(`✅ Cevap işlemi tamamen tamamlandı!`);
        }

        function updateDinleUI() {
            console.log(`🎨 DinleUI güncelleniyor...`);
            console.log(`📊 Gösterilecek değerler: score=${dinleScore}, correct=${dinleCorrect}, wrong=${dinleWrong}`);
            elements.dinleScore.textContent = dinleScore;
            elements.dinleCorrect.textContent = dinleCorrect;
            elements.dinleWrong.textContent = dinleWrong;
            console.log(`✅ DinleUI güncellendi!`);
        }

        // ============ BOŞLUK DOLDUR MODU ============
        let currentBoslukQuestion = null;
        let missingWord = '';
        let missingIndex = -1;
        let boslukQuestionCount = 0;
        const BOSLUK_MAX_QUESTIONS = 10;

        function loadBoslukQuestion() {
            // Önceki ses varsa durdur
            stopCurrentAudio();
            
            console.log('📋 === BOŞLUK DOLDUR SORU YÜKLENİYOR ===');
            console.log(`📊 Mevcut soru sayısı: ${boslukQuestionCount}/${BOSLUK_MAX_QUESTIONS}`);
            console.log(`📊 Oyun durumu: score=${boslukScore}, correct=${boslukCorrect}, wrong=${boslukWrong}`);
            
            // 10 soru kontrolü
            if (boslukQuestionCount >= BOSLUK_MAX_QUESTIONS) {
                console.log(`🏁 === BOŞLUK DOLDUR OYUNU BİTTİ ===`);
                console.log(`✅ ${BOSLUK_MAX_QUESTIONS} soru tamamlandı!`);
                console.log(`📊 Final oyun skorları: boslukScore=${boslukScore}, boslukCorrect=${boslukCorrect}, boslukWrong=${boslukWrong}`);
                console.log(`📊 Final session skorları: sessionScore=${sessionScore}, sessionCorrect=${sessionCorrect}, sessionWrong=${sessionWrong}`);
                
                // Günlük görev ilerlemesini güncelle
                updateTaskProgress('boslukDoldur', sessionCorrect);
                
                console.log(`💰 Session puanları global'e aktarılıyor: ${sessionScore} puan`);
                // Session puanlarını global'e aktar
                addToGlobalPoints(sessionScore, sessionCorrect);
                
                console.log(`🔄 Ana menüye dönülüyor...`);
                // Direkt ana menüye dön
                elements.boslukMode.style.display = 'none';
                elements.mainMenu.style.display = 'block';
                
                console.log(`🧹 Oyun değişkenleri temizleniyor...`);
                // Sıfırla
                boslukScore = 0;
                boslukCorrect = 0;
                boslukWrong = 0;
                boslukQuestionCount = 0;
                updateBoslukUI();
                console.log(`✅ Boşluk Doldur oyunu bitti ve ana menüye dönüldü!`);
                return;
            }

            console.log(`🔍 Ayet filtreleme başlıyor...`);
            // Rastgele ayet seç (ayet_metni olan ayetleri filtrele)
            const validAyets = ayetOkuData.filter(a => a.ayet_metni && a.ayet_metni.trim());
            console.log(`📦 Toplam ayet sayısı: ${ayetOkuData.length}`);
            console.log(`✅ Geçerli ayet sayısı: ${validAyets.length}`);
            
            if (validAyets.length === 0) {
                console.error('❌ Geçerli ayet bulunamadı!');
                return;
            }
            
            console.log(`🎲 Rastgele ayet seçiliyor...`);
            const randomIndex = Math.floor(Math.random() * validAyets.length);
            const ayet = validAyets[randomIndex];
            console.log(`✅ Seçilen ayet index: ${randomIndex}/${validAyets.length}`);
            
            console.log(`📝 === SORU #${boslukQuestionCount + 1} ===`);
            console.log(`📖 Sure: ${ayet.sure_adi || 'Bilinmiyor'}`);
            console.log(`🔢 Ayet No: ${ayet.ayet_no || 'Bilinmiyor'}`);
            console.log(`📝 Ayet Metni: "${ayet.ayet_metni}"`);
            
            // Ayet metnini kelimelere böl
            const words = ayet.ayet_metni.split(' ').filter(w => w && w.trim());
            console.log(`🔤 Kelime sayısı: ${words.length}`);
            console.log(`🔤 Kelimeler:`, words);
            
            if (words.length < 4) {
                // Çok kısa ayetler için tekrar dene
                loadBoslukQuestion();
                return;
            }

            // Rastgele bir kelimeyi gizle
            missingIndex = Math.floor(Math.random() * words.length);
            missingWord = words[missingIndex];

            // Boşluk ile değiştir
            const displayText = words.map((w, i) => i === missingIndex ? '______' : w).join(' ');

            currentBoslukQuestion = ayet;

            // UI güncelle
            elements.boslukSureInfo.textContent = `Ayet ID: ${ayet.ayet_kimligi || randomIndex}`;
            elements.boslukAyetText.textContent = displayText;

            // Seçenekler oluştur (boşluğa gelecek kelime)
            const wrongWords = [];
            let attempts = 0;
            while (wrongWords.length < 3 && attempts < 100) {
                attempts++;
                const randomAyet = validAyets[Math.floor(Math.random() * validAyets.length)];
                if (!randomAyet.ayet_metni) continue;
                
                const randomWords = randomAyet.ayet_metni.split(' ').filter(w => w && w.trim());
                if (randomWords.length === 0) continue;
                
                const randomWord = randomWords[Math.floor(Math.random() * randomWords.length)];
                if (randomWord && randomWord !== missingWord && !wrongWords.includes(randomWord)) {
                    wrongWords.push(randomWord);
                }
            }
            
            // Eğer yeterli yanlış cevap bulunamadıysa, eksik olanları doldur
            while (wrongWords.length < 3) {
                wrongWords.push('...');
            }

            const allOptions = [
                { text: missingWord, correct: true },
                ...wrongWords.map(w => ({ text: w, correct: false }))
            ];

            shuffle(allOptions);

            // Seçenekleri göster
            elements.boslukOptions.innerHTML = '';
            const labels = ['A', 'B', 'C', 'D'];
            allOptions.forEach((opt, i) => {
                const btn = document.createElement('button');
                btn.className = 'option';
                // Boşluk Doldur'da her zaman Arapça format kullan (ayet parçaları)
                if (opt.text === '...' || opt.text.trim() === '') {
                    // Boş seçenekler için normal format
                    btn.textContent = `${labels[i]}) ${opt.text}`;
                } else {
                    // Arapça kelimeler için özel format
                    btn.classList.add('arabic-option');
                    btn.innerHTML = `<span style="direction: ltr; display: flex; align-items: center; justify-content: center; gap: 8px;"><span>${labels[i]})</span><span style="direction: rtl;">${opt.text}</span></span>`;
                }
                btn.onclick = () => checkBoslukAnswer(btn, opt.correct);
                elements.boslukOptions.appendChild(btn);
            });

            elements.boslukFeedback.textContent = '';
            elements.boslukFeedback.className = 'feedback';
            elements.boslukNextBtn.style.display = 'none';

            // Otomatik ses çal
            if (currentBoslukQuestion && currentBoslukQuestion.ayet_ses_dosyasi) {
                playAudio(currentBoslukQuestion.ayet_ses_dosyasi, elements.boslukAudioBtn);
            }
        }

        elements.boslukAudioBtn.onclick = () => {
            if (currentBoslukQuestion && currentBoslukQuestion.ayet_ses_dosyasi) {
                playAudio(currentBoslukQuestion.ayet_ses_dosyasi, elements.boslukAudioBtn);
            }
        };

        function checkBoslukAnswer(button, isCorrect) {
            console.log(`🚨 === BOŞLUK DOLDUR CEVAP KONTROLÜ ===`);
            console.log(`👆 Tıklanan buton: "${button.textContent}"`);
            console.log(`✅/❌ isCorrect parametresi: ${isCorrect}`);
            console.log(`📊 Mevcut soru: #${boslukQuestionCount + 1}/${BOSLUK_MAX_QUESTIONS}`);
            console.log(`📊 Eksik kelime: "${missingWord}"`);
            console.log(`📊 Önce - session: score=${sessionScore}, correct=${sessionCorrect}, wrong=${sessionWrong}`);
            console.log(`📊 Önce - boşluk: score=${boslukScore}, correct=${boslukCorrect}, wrong=${boslukWrong}`);
            
            // KELİME İSTATİSTİKLERİNİ GÜNCELLE (Boşluk - eksik kelime için)
            const missingWordId = `bosluk_${missingWord.toLowerCase().replace(/[^a-zA-Z0-9ğüşiöçĞÜŞİÖÇ]/g, '_')}`;
            console.log(`📊 Boşluk kelime istatistiği güncelleniyor: "${missingWord}" (ID: ${missingWordId})`);
            updateWordStats(missingWordId, isCorrect);
            
            const allBtns = elements.boslukOptions.querySelectorAll('.option');
            console.log(`🔒 ${allBtns.length} buton devre dışı bırakılıyor...`);
            allBtns.forEach(btn => btn.disabled = true);

            if (isCorrect) {
                console.log(`✅ === DOĞRU CEVAP İŞLEMİ ===`);
                button.classList.add('correct');
                elements.boslukFeedback.textContent = '✅ Doğru!';
                elements.boslukFeedback.className = 'feedback correct';
                
                console.log(`💰 Boşluk Doldur sabit puan: 10 puan ekleniyor`);
                console.log(`📊 Boşluk score güncelleniyor: ${boslukScore} + 10 = ${boslukScore + 10}`);
                boslukScore += 10; // Local oyun puanı
                boslukCorrect++;
                
                console.log(`📊 addSessionPoints(10) çağrılıyor...`);
                addSessionPoints(10); // Session puanına ekle
                
                // Daily task progress - her doğru cevap için
                updateTaskProgress('boslukDoldur', 1);
                
                // Perfect streak kontrolü - hiç yanlış yapmamışsak perfect streak artır
                if (sessionWrong === 0) {
                    updateTaskProgress('perfectStreak', 1);
                    console.log(`🔥 Perfect streak artırıldı! Mevcut: ${dailyTasks.todayStats.perfectStreak}`);
                }
                
                console.log(`✅ Doğru cevap işlemi tamamlandı!`);

                // Tam ayeti göster
                elements.boslukAyetText.textContent = currentBoslukQuestion.ayet_metni;
            } else {
                console.log(`❌ === YANLIŞ CEVAP İŞLEMİ ===`);
                button.classList.add('wrong');
                elements.boslukFeedback.textContent = `❌ Yanlış! Doğru kelime: ${missingWord}`;
                elements.boslukFeedback.className = 'feedback wrong';
                
                console.log(`📊 Boşluk wrong güncelleniyor: ${boslukWrong} + 1 = ${boslukWrong + 1}`);
                boslukWrong++;
                
                console.log(`📊 addSessionWrong() çağrılıyor...`);
                addSessionWrong(); // Session yanlış sayısını artır
                console.log(`❌ ÖNEMLI: Yanlış cevap için puan EKLENMEDİ!`);

                console.log(`🔍 Doğru cevabı gösteriliyor...`);
                // Doğru cevabı göster
                let correctButtonFound = false;
                allBtns.forEach(btn => {
                    if (btn.textContent.includes(missingWord)) {
                        btn.classList.add('correct');
                        correctButtonFound = true;
                        console.log(`✅ Doğru buton bulundu: "${btn.textContent}"`);
                    }
                });
                if (!correctButtonFound) {
                    console.log(`⚠️ Doğru buton bulunamadı! Aranan: "${missingWord}"`);
                }

                // Tam ayeti göster
                elements.boslukAyetText.textContent = currentBoslukQuestion.ayet_metni;
            }

            console.log(`📊 Soru sayacı artırılıyor: ${boslukQuestionCount} + 1 = ${boslukQuestionCount + 1}`);
            boslukQuestionCount++; // Soru sayacını artır
            console.log(`📊 FINAL - session: score=${sessionScore}, correct=${sessionCorrect}, wrong=${sessionWrong}`);
            console.log(`📊 FINAL - boşluk: score=${boslukScore}, correct=${boslukCorrect}, wrong=${boslukWrong}, questionCount=${boslukQuestionCount}`);
            console.log(`🚨 === BOŞLUK DOLDUR CEVAP KONTROLÜ BİTTİ ===`);
            updateBoslukUI();
            elements.boslukNextBtn.style.display = 'block';
        }

        elements.boslukNextBtn.onclick = () => {
            loadBoslukQuestion();
        };

        function updateBoslukUI() {
            console.log(`🎨 BoslukUI güncelleniyor...`);
            console.log(`📊 Gösterilecek değerler: score=${boslukScore}, correct=${boslukCorrect}, wrong=${boslukWrong}`);
            elements.boslukScore.textContent = boslukScore;
            elements.boslukCorrect.textContent = boslukCorrect;
            elements.boslukWrong.textContent = boslukWrong;
            console.log(`✅ BoslukUI güncellendi!`);
        }

        // ============ DUA ET MODU ============
        function showDua() {
            const dua = duaData[currentDuaIndex];
            if (!dua) return;

            elements.duaSureInfo.textContent = `Ayet: ${dua.ayet || ''}`;
            elements.duaArabic.textContent = dua.dua || '';
            elements.duaTranslation.textContent = dua.tercume || '';

            elements.prevDuaBtn.disabled = currentDuaIndex === 0;
            elements.nextDuaBtn.disabled = currentDuaIndex === duaData.length - 1;
        }

        elements.prevDuaBtn.onclick = () => {
            if (currentDuaIndex > 0) {
                currentDuaIndex--;
                showDua();
                // Navigasyon - görev sayılmaz
            }
        };

        elements.nextDuaBtn.onclick = () => {
            if (currentDuaIndex < duaData.length - 1) {
                currentDuaIndex++;
                showDua();
                // Navigasyon - görev sayılmaz
            }
        };

        elements.duaAudioBtn.onclick = () => {
            const dua = duaData[currentDuaIndex];
            if (dua && dua.ses_url) {
                // Ses başlangıç zamanı için özel işlem
                if (currentAudio && !currentAudio.paused) {
                    currentAudio.pause();
                    currentAudio.currentTime = 0;
                }
                
                elements.duaAudioBtn.disabled = true;
                currentAudio = new Audio(dua.ses_url);
                
                if (dua.start) {
                    currentAudio.currentTime = dua.start;
                }
                
                currentAudio.play().catch(err => {
                    console.error('Ses hatası:', err);
                    elements.duaAudioBtn.disabled = false;
                });
                
                currentAudio.onended = () => {
                    elements.duaAudioBtn.disabled = false;
                    // Daily task progress - SONUNA KADAR dinledi!
                    updateTaskProgress('duaOgre', 1);
                };
            }
        };

        // ============ AYET OKU MODU (RASTGELE) ============
        function showAyet() {
            // Rastgele ayet seç
            currentAyetIndex = Math.floor(Math.random() * ayetOkuData.length);
            const ayet = ayetOkuData[currentAyetIndex];
            if (!ayet) return;
            
            elements.ayetSureInfo.textContent = `${ayet.sure_adı || 'Sûre'} - Ayet`;
            elements.ayetArabic.textContent = ayet.ayet_metni || '';
            elements.ayetTranslation.textContent = ayet.meal || '';
        }

        elements.prevAyetBtn.onclick = () => {
            showAyet(); // Rastgele önceki ayet
            // Navigasyon - görev sayılmaz
        };

        elements.nextAyetBtn.onclick = () => {
            showAyet(); // Rastgele sonraki ayet
            // Navigasyon - görev sayılmaz
        };

        elements.ayetAudioBtn.onclick = () => {
            const ayet = ayetOkuData[currentAyetIndex];
            if (ayet && ayet.ayet_ses_dosyasi) {
                // Eğer ses çalıyorsa durdur
                if (currentAudio && !currentAudio.paused) {
                    currentAudio.pause();
                    currentAudio.currentTime = 0;
                }
                
                elements.ayetAudioBtn.disabled = true;
                currentAudio = new Audio(ayet.ayet_ses_dosyasi);
                
                currentAudio.play().catch(err => {
                    console.error('Ses hatası:', err);
                    elements.ayetAudioBtn.disabled = false;
                });
                
                // Ses sonuna kadar dinlendiğinde görev sayılsın
                currentAudio.onended = () => {
                    elements.ayetAudioBtn.disabled = false;
                    // Daily task progress - SONUNA KADAR dinledi!
                    updateTaskProgress('ayetOku', 1);
                };
            }
        };

        // ============ HADİS OKU MODU (RASTGELE) ============
        function showHadis() {
            // Rastgele hadis seç
            currentHadisIndex = Math.floor(Math.random() * hadisData.length);
            const hadis = hadisData[currentHadisIndex];
            if (!hadis) return;

            elements.hadisCategory.textContent = hadis.section || '';
            elements.hadisTitle.textContent = hadis.chapterName || '';
            elements.hadisHeader.textContent = hadis.header || '';
            elements.hadisText.textContent = hadis.text || '';
            elements.hadisRef.textContent = hadis.refno || '';
        }

        elements.prevHadisBtn.onclick = () => {
            showHadis(); // Rastgele önceki hadis
            // Daily task progress - hadis okuma
            updateTaskProgress('hadisOku', 1);
        };

        elements.nextHadisBtn.onclick = () => {
            showHadis(); // Rastgele sonraki hadis
            // Daily task progress - hadis okuma
            updateTaskProgress('hadisOku', 1);
        };

        // ============ OYUNU BAŞLAT ============
        loadData();
        updateStatsBar(); // İstatistik barını initialize et
            // Global debug fonksiyonu - console'dan çağırılabilir
            window.debugStats = function() {
                console.log('🔧 DEBUG - Mevcut Oyun İstatistikleri:');
                console.log('Total Points:', typeof totalPoints !== 'undefined' ? totalPoints : 'Henüz yüklenmedi');
                console.log('Star Points:', typeof starPoints !== 'undefined' ? starPoints : 'Henüz yüklenmedi');
                console.log('Level:', typeof level !== 'undefined' ? level : 'Henüz yüklenmedi');
                console.log('Session Score:', typeof sessionScore !== 'undefined' ? sessionScore : 'Henüz yüklenmedi');
            };

            // Seviye geçiş test fonksiyonu - console'dan çağırılabilir
            window.testLevelUp = function(targetPoints) {
                console.log('🎯 Seviye geçiş testi başlatılıyor...');
                console.log('Mevcut puan:', totalPoints);
                console.log('Hedef puan:', targetPoints);
                
                // Hedef puana sıçrama
                const oldLevel = calculateLevel(totalPoints);
                const difference = targetPoints - totalPoints;
                totalPoints = targetPoints;
                
                // Bugünkü puana da farkı ekle (test amaçlı)
                dailyTasks.todayStats.toplamPuan += difference;
                
                const newLevel = calculateLevel(totalPoints);
                
                console.log('Eski seviye:', oldLevel);
                console.log('Yeni seviye:', newLevel);
                
                // Seviye atlama kontrolü
                if (newLevel > oldLevel) {
                    level = newLevel;
                    console.log('✅ Seviye atlandı! Modal gösteriliyor...');
                    showLevelUpModal(newLevel);
                } else {
                    console.log('❌ Seviye atlanmadı.');
                }
                
                updateStatsBar();
                saveStats(); // Değişiklikleri kaydet
            };

            // Hızlı seviye test fonksiyonları
            window.testLevel2 = () => testLevelUp(1000);   // Seviye 2'ye çık
            window.testLevel3 = () => testLevelUp(2500);   // Seviye 3'e çık
            window.testLevel5 = () => testLevelUp(8500);   // Seviye 5'e çık
            window.testLevel10 = () => testLevelUp(46000); // Seviye 10'a çık
            window.resetPoints = () => { 
                totalPoints = 0; 
                level = 1; 
                updateStatsBar(); 
                saveStats(); 
                console.log('🔄 Puanlar sıfırlandı'); 
            };
            window.resetAllStats = resetAllStats;

            // Modal fonksiyonlarını global hale getir
            window.showBadgesModal = showBadgesModal;
            window.closeBadgesModal = closeBadgesModal;
            
            // SON ADIM: Kaydedilmiş verileri yükle
            try {
                // VERI SİSTEMİ BAŞLATMA (üçüncü taraf çerez sorunu için)
                console.log('🚀 Veri sistemi başlatılıyor...');
                
                // IndexedDB başlat (çerez engellemelerinden etkilenmez)
                initIndexedDB().then(async () => {
                    console.log('✅ IndexedDB hazır!');
                    await loadStats(); // Verileri yükle (IndexedDB öncelikli) - AWAIT EKLENDİ!
                    updateStatsBar();
                    console.log('💾 Veriler yüklendi:', totalPoints, 'puan');
                }).catch(async (error) => {
                    console.error('❌ IndexedDB hatası, localStorage kullanılıyor:', error);
                    await loadStats(); // Fallback olarak localStorage - AWAIT EKLENDİ!
                    updateStatsBar();
                });
            } catch (error) {
                alert(`❌ HATA: ${error.message}`);
                console.error('❌ Veri yükleme hatası:', error);
            }
            
            // ============ MODAL BUTONLARINA EVENT LISTENER EKLE ============
            if (dailyTasksBtn) dailyTasksBtn.onclick = showDailyTasksModal;
            if (badgesBtn) badgesBtn.onclick = showBadgesModal;
            if (statsBtn) statsBtn.onclick = showStatsModal;
            if (calendarBtn) calendarBtn.onclick = showCalendarModal;
            if (xpInfoBtn) xpInfoBtn.onclick = showXPInfoModal;
            
            // Modal kapatma butonları
            const closeBadgesBtn = document.getElementById('closeBadgesBtn');
            const closeCalendarBtn = document.getElementById('closeCalendarBtn');
            const closeDailyTasksBtn = document.getElementById('closeDailyTasksBtn');
            const closeStatsBtn = document.getElementById('closeStatsBtn');
            const closeDailyGoalBtn = document.getElementById('closeDailyGoalBtn');
            const closeXPInfoBtn = document.getElementById('closeXPInfoBtn');
            
            if (closeBadgesBtn) closeBadgesBtn.onclick = closeBadgesModal;
            if (closeCalendarBtn) closeCalendarBtn.onclick = closeCalendarModal;
            if (closeDailyTasksBtn) closeDailyTasksBtn.onclick = closeDailyTasksModal;
            if (closeStatsBtn) closeStatsBtn.onclick = closeStatsModal;
            if (closeDailyGoalBtn) closeDailyGoalBtn.onclick = closeDailyGoalModal;
            if (closeXPInfoBtn) closeXPInfoBtn.onclick = closeXPInfoModal;
        
        }); // DOMContentLoaded event listener sonu

        // ============ PWA SERVICE WORKER KAYDI ============
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(registration => {
                        console.log('🎮 SW registered: ', registration);
                        
                        // PWA yükleme prompt'u
                        let deferredPrompt;
                        window.addEventListener('beforeinstallprompt', (e) => {
                            console.log('💾 PWA install prompt available');
                            e.preventDefault();
                            deferredPrompt = e;
                            
                            // Install button göster (isteğe bağlı)
                            showPWAInstallPrompt(deferredPrompt);
                        });

                        // PWA yüklendiğinde
                        window.addEventListener('appinstalled', (evt) => {
                            console.log('📱 PWA was installed');
                            alert('🎉 Hasene Arapça Oyunu başarıyla yüklendi!\n\nArtık telefon masaüstünden açabilirsiniz! 🚀');
                        });
                    })
                    .catch(registrationError => {
                        console.log('❌ SW registration failed: ', registrationError);
                    });
            });

            // PWA Install Prompt fonksiyonu
            function showPWAInstallPrompt(deferredPrompt) {
                // 3 saniye sonra install prompt göster
                setTimeout(() => {
                    if (confirm('📱 Bu oyunu telefonunuza yüklemek ister misiniz?\n\n✅ Offline oynayabilirsiniz\n🚀 Daha hızlı açılır\n📲 Masaüstü ikonu oluşur')) {
                        deferredPrompt.prompt();
                        deferredPrompt.userChoice.then((choiceResult) => {
                            if (choiceResult.outcome === 'accepted') {
                                console.log('✅ User accepted the install prompt');
                            } else {
                                console.log('❌ User dismissed the install prompt');
                            }
                            deferredPrompt = null;
                        });
                    }
                }, 3000);
            }
        }

        // ============ LOADING SAYFASI KONTROLü ============
        window.addEventListener('DOMContentLoaded', () => {
            const loadingScreen = document.getElementById('loadingScreen');
            const mainContainer = document.getElementById('mainContainer');
            
            // 3 saniye sonra loading sayfasını kaldır
            setTimeout(() => {
                loadingScreen.classList.add('fade-out');
                
                // Fade-out animasyonu bittikten sonra
                setTimeout(() => {
                    loadingScreen.style.display = 'none';
                    mainContainer.style.display = 'block';
                }, 500); // fade-out süresi
            }, 3000); // 3 saniye
        });


    </script>

    <!-- Özel Onay Pop-up -->
    <div class="custom-confirm" id="customConfirm">
        <div class="confirm-content">
            <div class="confirm-title">🎮 Oyundan Çıkış</div>
            <div class="confirm-stats" id="confirmStats">
                <div class="confirm-stat">
                    <span>✅ Doğru cevap:</span>
                    <span id="confirmCorrect">0</span>
                </div>
                <div class="confirm-stat">
                    <span>❌ Yanlış cevap:</span>
                    <span id="confirmWrong">0</span>
                </div>
                <div class="confirm-stat">
                    <span>💰 Kazanılan XP:</span>
                    <span id="confirmXP">0</span>
                </div>
            </div>
            <div class="confirm-message">
                Puanlarınız zaten kaydedildi, güvenle çıkabilirsiniz.
            </div>
            <div class="confirm-buttons">
                <button class="confirm-btn cancel" id="confirmCancel">İptal</button>
                <button class="confirm-btn ok" id="confirmOK">Çıkış Yap</button>
            </div>
        </div>
    </div>

</body>
</html>
